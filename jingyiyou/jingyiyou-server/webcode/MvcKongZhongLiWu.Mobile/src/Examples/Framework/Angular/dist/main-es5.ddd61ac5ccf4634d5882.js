(function(){function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],s=!0,a=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(u){a=!0,o=u}finally{try{s||null==r.return||r.return()}finally{if(a)throw o}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,e)})(e)}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(o,r.prototype),o}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=_superPropBase(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}(self.webpackChunkzego_express_demo=self.webpackChunkzego_express_demo||[]).push([[179],{8255:function(e){function t(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=function(){return[]},t.resolve=t,t.id=8255,e.exports=t},9576:function _(module,__unused_webpack_exports,__webpack_require__){var t;"undefined"!=typeof self&&self,t=function t(__WEBPACK_EXTERNAL_MODULE__4119__){return function(){var __webpack_modules__={4537:function(e){"use strict";e.exports=function(e,t){for(var r=new Array(arguments.length-1),n=0,o=2,i=!0;o<arguments.length;)r[n++]=arguments[o++];return new Promise(function(o,s){r[n]=function(e){if(i)if(i=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];o.apply(null,t)}};try{e.apply(t||null,r)}catch(e){i&&(i=!1,s(e))}})}},7419:function(e,t){"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=new Array(64),o=new Array(123),i=0;i<64;)o[n[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;r.encode=function(e,t,r){for(var o,i=null,s=[],a=0,u=0;t<r;){var l=e[t++];switch(u){case 0:s[a++]=n[l>>2],o=(3&l)<<4,u=1;break;case 1:s[a++]=n[o|l>>4],o=(15&l)<<2,u=2;break;case 2:s[a++]=n[o|l>>6],s[a++]=n[63&l],u=0}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=n[o],s[a++]=61,1===u&&(s[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var s="invalid encoding";r.decode=function(e,t,r){for(var n,i=r,a=0,u=0;u<e.length;){var l=e.charCodeAt(u++);if(61===l&&a>1)break;if(void 0===(l=o[l]))throw Error(s);switch(a){case 0:n=l,a=1;break;case 1:t[r++]=n<<2|(48&l)>>4,n=l,a=2;break;case 2:t[r++]=(15&n)<<4|(60&l)>>2,n=l,a=3;break;case 3:t[r++]=(3&n)<<6|l,a=0}}if(1===a)throw Error(s);return r-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},9211:function(e){"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},945:function(e){"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3]}function i(e,n,o){t[0]=e,n[o]=r[3],n[o+1]=r[2],n[o+2]=r[1],n[o+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?o:i,e.writeFloatBE=n?i:o,e.readFloatLE=n?s:a,e.readFloatBE=n?a:s}():function(){function t(e,t,r,n){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var i=Math.floor(Math.log(t)/Math.LN2);e((o<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,r,n)}}function s(e,t,r){var n=e(t,r),o=2*(n>>31)+1,i=n>>>23&255,s=8388607&n;return 255===i?s?NaN:o*(1/0):0===i?1401298464324817e-60*o*s:o*Math.pow(2,i-150)*(s+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,n),e.readFloatLE=s.bind(null,o),e.readFloatBE=s.bind(null,i)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function o(e,n,o){t[0]=e,n[o]=r[0],n[o+1]=r[1],n[o+2]=r[2],n[o+3]=r[3],n[o+4]=r[4],n[o+5]=r[5],n[o+6]=r[6],n[o+7]=r[7]}function i(e,n,o){t[0]=e,n[o]=r[7],n[o+1]=r[6],n[o+2]=r[5],n[o+3]=r[4],n[o+4]=r[3],n[o+5]=r[2],n[o+6]=r[1],n[o+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?o:i,e.writeDoubleBE=n?i:o,e.readDoubleLE=n?s:a,e.readDoubleBE=n?a:s}():function(){function t(e,t,r,n,o,i){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,o,i+t),e(1/n>0?0:2147483648,o,i+r);else if(isNaN(n))e(0,o,i+t),e(2146959360,o,i+r);else if(n>17976931348623157e292)e(0,o,i+t),e((s<<31|2146435072)>>>0,o,i+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,o,i+t),e((s<<31|a/4294967296)>>>0,o,i+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=n*Math.pow(2,-u))>>>0,o,i+t),e((s<<31|u+1023<<20|1048576*a&1048575)>>>0,o,i+r)}}}function s(e,t,r,n,o){var i=e(n,o+t),s=e(n,o+r),a=2*(s>>31)+1,u=s>>>20&2047,l=4294967296*(1048575&s)+i;return 2047===u?l?NaN:a*(1/0):0===u?5e-324*a*l:a*Math.pow(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=s.bind(null,o,0,4),e.readDoubleBE=s.bind(null,i,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function i(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},7199:function _(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},6662:function(e){"use strict";e.exports=function(e,t,r){var n=r||8192,o=n>>>1,i=null,s=n;return function(r){if(r<1||r>o)return e(r);s+r>n&&(i=e(n),s=0);var a=t.call(i,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},4997:function(e,t){"use strict";var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,o=null,i=[],s=0;t<r;)(n=e[t++])<128?i[s++]=n:n>191&&n<224?i[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[s++]=55296+(n>>10),i[s++]=56320+(1023&n)):i[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o?(s&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))},r.write=function(e,t,r){for(var n,o,i=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(o=e.charCodeAt(s+1)))?(++s,t[r++]=(n=65536+((1023&n)<<10)+(1023&o))>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-i}},2100:function(e,t,r){"use strict";e.exports=r(9482)},9482:function(e,t,r){"use strict";var n=t;function o(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(1173),n.BufferWriter=r(3155),n.Reader=r(1408),n.BufferReader=r(593),n.util=r(9693),n.rpc=r(5994),n.roots=r(5054),n.configure=o,o()},1408:function(e,t,r){"use strict";e.exports=u;var n,o=r(9693),i=o.LongBits,s=o.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")},d=function(){return o.Buffer?function(e){return(u.create=function(e){return o.Buffer.isBuffer(e)?new n(e):c(e)})(e)}:c};function h(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new i(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}u.create=d(),u.prototype._slice=o.Array.prototype.subarray||o.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=o.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=o.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},u.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){n=e,u.create=d(),n._configure();var t=o.Long?"toLong":"toNumber";o.merge(u.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},593:function(e,t,r){"use strict";e.exports=i;var n=r(1408);(i.prototype=Object.create(n.prototype)).constructor=i;var o=r(9693);function i(e){n.call(this,e)}i._configure=function(){o.Buffer&&(i.prototype._slice=o.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},5054:function(e){"use strict";e.exports={}},5994:function(e,t,r){"use strict";t.Service=r(7948)},7948:function(e,t,r){"use strict";e.exports=o;var n=r(9693);function o(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(o.prototype=Object.create(n.EventEmitter.prototype)).constructor=o,o.prototype.rpcCall=function e(t,r,o,i,s){if(!i)throw TypeError("request must be specified");var a=this;if(!s)return n.asPromise(e,a,t,r,o,i);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof o))try{r=o[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)})}catch(e){return a.emit("error",e,t),void setTimeout(function(){s(e)},0)}else setTimeout(function(){s(Error("already ended"))},0)},o.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1945:function(e,t,r){"use strict";e.exports=o;var n=r(9693);function o(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=o.zero=new o(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var s=o.zeroHash="\0\0\0\0\0\0\0\0";o.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new o(r,n)},o.from=function(e){if("number"==typeof e)return o.fromNumber(e);if(n.isString(e)){if(!n.Long)return o.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new o(e.low>>>0,e.high>>>0):i},o.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},o.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;o.fromHash=function(e){return e===s?i:new o((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},o.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},o.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},o.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},o.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},9693:function(e,t,r){"use strict";var n=t;function o(e,t,r){for(var n=Object.keys(t),o=0;o<n.length;++o)void 0!==e[n[o]]&&r||(e[n[o]]=t[n[o]]);return e}function i(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&o(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(4537),n.base64=r(7419),n.EventEmitter=r(9211),n.float=r(945),n.inquire=r(7199),n.utf8=r(4997),n.pool=r(6662),n.LongBits=r(1945),n.isNode=Boolean(void 0!==r.g&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),n.global=n.isNode&&r.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=o,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=i,n.ProtocolError=i("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&null!=this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}},1173:function(e,t,r){"use strict";e.exports=d;var n,o=r(9693),i=o.LongBits,s=o.base64,a=o.utf8;function u(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new u(l,0,0),this.tail=this.head,this.states=null}var h=function(){return o.Buffer?function(){return(d.create=function(){return new n})()}:function(){return new d}};function p(e,t,r){t[r]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function _(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=h(),d.alloc=function(e){return new o.Array(e)},o.Array!==Array&&(d.alloc=o.pool(d.alloc,o.Array.prototype.subarray)),d.prototype._push=function(e,t,r){return this.tail=this.tail.next=new u(e,t,r),this.len+=t,this},(f.prototype=Object.create(u.prototype)).fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(g,10,i.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.int64=d.prototype.uint64=function(e){var t=i.from(e);return this._push(g,t.length(),t)},d.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(g,t.length(),t)},d.prototype.bool=function(e){return this._push(p,1,e?1:0)},d.prototype.sfixed32=d.prototype.fixed32=function(e){return this._push(_,4,e>>>0)},d.prototype.sfixed64=d.prototype.fixed64=function(e){var t=i.from(e);return this._push(_,4,t.lo)._push(_,4,t.hi)},d.prototype.float=function(e){return this._push(o.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(o.float.writeDoubleLE,8,e)};var m=o.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(o.isString(e)){var r=d.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(m,t,e)},d.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},d.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new u(l,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(l,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d._configure=function(e){n=e,d.create=h(),n._configure()}},3155:function(e,t,r){"use strict";e.exports=i;var n=r(1173);(i.prototype=Object.create(n.prototype)).constructor=i;var o=r(9693);function i(){n.call(this)}function s(e,t,r){e.length<40?o.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}i._configure=function(){i.alloc=o._Buffer_allocUnsafe,i.writeBytesBuffer=o.Buffer&&o.Buffer.prototype instanceof Uint8Array&&"set"===o.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},i.prototype.bytes=function(e){o.isString(e)&&(e=o._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=o.Buffer.byteLength(e);return this.uint32(t),t&&this._push(s,t,e),this},i._configure()},8835:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRealTimeSequentialDataManager=void 0;var n=r(3504),o=function(){function e(e,t){this.dataChannelManager=new n.DataChannelListener(e,t)}return e.prototype.startBroadcasting=function(e){return this.dataChannelManager.startBroadcasting(e)},e.prototype.stopBroadcasting=function(e){return this.dataChannelManager.stopBroadcasting(e)},e.prototype.sendRealTimeSequentialData=function(e,t){return this.dataChannelManager.sendRealTimeSequentialData(e,t)},e.prototype.startSubscribing=function(e){return this.dataChannelManager.startSubscribing(e)},e.prototype.stopSubscribing=function(e){return this.dataChannelManager.stopSubscribing(e)},e.prototype.on=function(e,t){this.dataChannelManager.on(e,t)},e.prototype.off=function(e,t){this.dataChannelManager.off(e,t)},e}();t.ZegoRealTimeSequentialDataManager=o},1297:function(e,t){"use strict";var r,n,o;Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRangeAudioMode=t.ZegoRangeAudioMicrophoneState=t.ZegoMixStreamRenderMode=void 0,(o=t.ZegoMixStreamRenderMode||(t.ZegoMixStreamRenderMode={}))[o.AspectFill=0]="AspectFill",o[o.AspectFit=1]="AspectFit",(n=t.ZegoRangeAudioMicrophoneState||(t.ZegoRangeAudioMicrophoneState={}))[n.Off=0]="Off",n[n.TurningOn=1]="TurningOn",n[n.On=2]="On",(r=t.ZegoRangeAudioMode||(t.ZegoRangeAudioMode={}))[r.World=0]="World",r[r.Team=1]="Team"},3116:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressRangeAudio=void 0;var o=n(r(2760)),i=function(){function e(e){this.zegoAudioListener=o.default.getInstance(e)}return e.getInstance=function(t){if(!e.instance){if(!t)throw Error("create instance failed.");e.instance=new e(t)}return e.instance},e.prototype.on=function(e,t){return this.zegoAudioListener.on(e,t)},e.prototype.off=function(e,t){return this.zegoAudioListener.off(e,t)},e.prototype.setAudioReceiveRange=function(e){this.zegoAudioListener.setAudioReceiveRange(e)},e.prototype.updateSelfPosition=function(e,t,r,n){this.zegoAudioListener.updateSelfPosition(e,t,r,n)},e.prototype.updateAudioSource=function(e,t){this.zegoAudioListener.updateAudioSource(e,t)},e.prototype.enableSpatializer=function(e){return this.zegoAudioListener.enableSpatializer(e)},e.prototype.enableMicrophone=function(e){return this.zegoAudioListener.enableMicrophone(e)},e.prototype.enableSpeaker=function(e){return this.zegoAudioListener.enableSpeaker(e)},e.prototype.setRangeAudioMode=function(e){this.zegoAudioListener.setRangeAudioMode(e)},e.prototype.setTeamID=function(e){this.zegoAudioListener.setRangeAudioTeamID(e)},e.prototype.isAudioContextRunning=function(){return"running"===this.zegoAudioListener.getAudioContextState()},e.prototype.resumeAudioContext=function(){return this.zegoAudioListener.resumeAudioContext()},e}();t.ZegoExpressRangeAudio=i},4780:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressEngine=t.ClientUtil=void 0;var s=r(9880),a=i(r(3126)),u=i(r(9869)),l=i(r(3824)),c=i(r(7526)),d=i(r(577)),h=r(2777),p=r(4897),f=r(957);s.ZegoExpressEngine.use(a.default),s.ZegoExpressEngine.use(u.default),s.ZegoExpressEngine.use(l.default),s.ZegoExpressEngine.use(c.default),s.ZegoExpressEngine.use(d.default),s.ZegoExpressEngine.use(h.RangeAudio),s.ZegoExpressEngine.use(p.DataChannel),s.ZegoExpressEngine.use(f.BeautyEffect);var g=r(9880);Object.defineProperty(t,"ClientUtil",{enumerable:!0,get:function(){return g.ClientUtil}});var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(s.ZegoExpressEngine);t.ZegoExpressEngine=_},9880:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=t.ZegoExpressEngine=void 0;var i=r(4119),s=r(5321),a=function(e){function t(t,r){var n=this;return i.ZegoExpressWebRTMEngine.version="2.14.0",(n=e.call(this,t,r)||this).zegoWebRTC=new s.ZegoWebRTC(n.logger,n.dataReport,n.zegoWebRTM),n}return o(t,e),t.use=function(e){i.ZegoExpressWebRTMEngine.use(e),s.ZegoWebRTC.use(e)},t.prototype.checkSystemRequirements=function(e,t){return void 0===t&&(t=0),this.zegoWebRTC.checkSystemRequirements(t,e)},t.prototype.off=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.off(e,t):!!this.zegoWebRTC.stateCenter.listenerList[e]&&this.zegoWebRTC.off(e,t)},t.prototype.on=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.on(e,t):!!this.zegoWebRTC.stateCenter.listenerList[e]&&this.zegoWebRTC.on(e,t)},t.prototype.createStream=function(e){return this.zegoWebRTC.createStream(e)},t.prototype.getElectronScreenSources=function(){return this.zegoWebRTC.getElectronScreenSources()},t.prototype.destroyStream=function(e){return this.zegoWebRTC.destroyStream(e)},t.prototype.startPublishingStream=function(e,t,r){return this.zegoWebRTC.startPublishingStream(e,t,r)},t.prototype.stopPublishingStream=function(e){return this.zegoWebRTC.stopPublishingStream(e)},t.prototype.setVideoConfig=function(e,t){return this.zegoWebRTC.setVideoConfig(e,t)},t.prototype.setAudioConfig=function(e,t){return this.zegoWebRTC.setAudioConfig(e,t)},t.prototype.replaceTrack=function(e,t){return this.zegoWebRTC.replaceTrack(e,t)},t.prototype.setCaptureVolume=function(e,t){return this.zegoWebRTC.setCaptureVolume(e,t)},t.prototype.setStreamExtraInfo=function(e,t){return this.zegoWebRTC.setStreamExtraInfo(e,t)},t.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.addPublishCdnUrl(e,t)},t.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWebRTC.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWebRTC.removePublishCdnUrl(e,t)},t.prototype.mutePublishStreamVideo=function(e,t,r){return this.zegoWebRTC.mutePublishStreamVideo(e,t,r)},t.prototype.mutePublishStreamAudio=function(e,t){return this.zegoWebRTC.mutePublishStreamAudio(e,t)},t.prototype.setEffectsBeauty=function(e,t,r){return this.zegoWebRTC.setBeautyEffect(e,t,r)},t.prototype.startPlayingStream=function(e,t){return this.zegoWebRTC.startPlayingStream(e,t)},t.prototype.stopPlayingStream=function(e){return this.zegoWebRTC.stopPlayingStream(e)},t.prototype.mutePlayStreamVideo=function(e,t){return this.zegoWebRTC.mutePlayStreamVideo(e,t)},t.prototype.mutePlayStreamAudio=function(e,t){return this.zegoWebRTC.mutePlayStreamAudio(e,t)},t.prototype.startMixerTask=function(e){return this.zegoWebRTC.startMixerTask(e)},t.prototype.stopMixerTask=function(e){return this.zegoWebRTC.stopMixerTask(e)},t.prototype.setMixerTaskConfig=function(e){return this.zegoWebRTC.setMixerTaskConfig(e)},t.prototype.startMixingAudio=function(e,t){return this.zegoWebRTC.startMixingAudio(e,t)},t.prototype.stopMixingAudio=function(e,t){return this.zegoWebRTC.stopMixingAudio(e,t)},t.prototype.setMixingAudioVolume=function(e,t,r){return this.zegoWebRTC.setMixingAudioVolume(e,t,r)},t.prototype.enumDevices=function(){return this.zegoWebRTC.enumDevices()},t.prototype.getCameras=function(){return this.zegoWebRTC.getCameras()},t.prototype.getMicrophones=function(){return this.zegoWebRTC.getMicrophones()},t.prototype.getSpeakers=function(){return this.zegoWebRTC.getSpeakers()},t.prototype.useVideoDevice=function(e,t){return this.zegoWebRTC.useVideoDevice(e,t)},t.prototype.useAudioDevice=function(e,t){return this.zegoWebRTC.useAudioDevice(e,t)},t.prototype.setSoundLevelDelegate=function(e,t){return this.zegoWebRTC.setSoundLevelDelegate(e,t)},t.prototype.isMicrophoneMuted=function(){return this.zegoWebRTC.isMicrophoneMuted()},t.prototype.muteMicrophone=function(e){return this.zegoWebRTC.muteMicrophone(e)},t.prototype.createRangeAudioInstance=function(){return this.zegoWebRTC.createRangeAudioInstance()},t.prototype.createRealTimeSequentialDataManager=function(e){return this.zegoWebRTC.createRealTimeSequentialDataManager(e)},t.prototype.destroyRealTimeSequentialDataManager=function(e){this.zegoWebRTC.destroyRealTimeSequentialDataManager(e)},t}(i.ZegoExpressWebRTMEngine);t.ZegoExpressEngine=a;var u=r(608);Object.defineProperty(t,"ClientUtil",{enumerable:!0,get:function(){return u.ClientUtil}})},1089:function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WECHATMINI_ACTION=t.ZEGO_WEBRTC_ACTION=void 0,function(e){e.CONSTRUCTOR="zc.0",e.CHECK_SUPPORT="zc.csr",e.CREATE_STREAM="zc.cs",e.DESTROY_STREAM="zc.ds",e.START_PUBLISHING_STREAM="zc.sps.0",e.START_PLAYING_STREAM="zc.sps.1",e.STOP_PUBLISHING_STREAM="zc.sps.0.0",e.STOP_PLAYING_STREAM="zc.sps.1.0",e.ON_STREAM="zc.os",e.ON_PUSH_STREAM_UPDATE="zc.opsu",e.BIND_WINDOW_LISTENER="zc.wl",e.SET_AUDIO_OUTPUT="zc.sao",e.SET_CUSTOM_SIGNAL_URL="zc.scsu",e.SET_TURN_OVER_TCP_ONLY="zc.stoto",e.RDH_ACTIVE="zc.rdh.a",e.RDH_MAX_TIME="zc.rdh.m",e.RDH_WEBRTC_URL_RSP="zc.rdh.hfwur",e.PUBLISH_STATE_HANDLE="zc.psh.0",e.PLAY_STATE_HANDLE="zc.psh.1",e.STATECENTER_ACTION_LISTENER="zc.sc.al",e.STATECENTER_SET_SETTING="zc.sc.ss",e.SIGNAL_SET_SESSION_INFO="zc.s.ssi",e.SIGNAL_RESET_CONNECT_TIMER="zc.s.rct",e.SIGNAL_BIND_WEBSOCKET_HANDLE="zc.s.bwh",e.SIGNAL_RESET_CHECK_MESSAGE="zc.s.rcm",e.SIGNAL_UPDATE_TOKEN="zc.s.ut",e.SIGNAL_SEND_MESSAGE_WITH_CALLBACK="zc.s.smwc",e.SIGNAL_CONNECT_SERVER="zc.s.cs.0",e.SIGNAL_START_CONNECT_TIMER="zc.s.sct",e.SIGNAL_DISCONNECT_SERVER="zc.s.dc",e.SIGNAL_CREATE_SESSION="zc.s.cs.1",e.SIGNAL_REMOVE_SESSION="zc.s.rs",e.SIGNAL_SEND_REMOVE_SESSION="zc.s.srs",e.SIGNAL_SEND_MESSAGE="zc.s.sm",e.SIGNAL_HANDLE_RESPOND_DATA="zc.s.hrd",e.SIGNAL_ADD_SESSION="zc.s.as",e.SIGNAL_HANDLE_PUSH_DATA="zc.s.hpd",e.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA="zc.s.hprsd",e.SIGNAL_SEND_MEDIA_DESC="zc.s.smd",e.SIGNAL_SEND_CANDIDATE_INFO="zc.s.sci",e.SIGNAL_SEND_MEDIA_DESC_ACK="zc.s.smda",e.SIGNAL_SEND_CANDIDATE_INFO_ACK="zc.s.scia",e.SIGNAL_SEND_CLOSE_SESSION_ACK="zc.s.scsa",e.SIGNAL_SEND_RESET_SESSION_ACK="zc.s.srsa",e.SIGNAL_REGISTER_PUSH_CALLBACK="zc.s.rpc",e.SIGNAL_CHECK_MESSAGE_TIMEOUT="zc.s.cmt",e.SIGNAL_SEND_HEARTBEAT="zc.s.sh",e.SIGNAL_QUALITY_REPORT="zc.s.qr",e.SIGNAL_SEND_STREAM_STATUS="zc.s.sss",e.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM="zc.s.apvs",e.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM="zc.s.apas",e.SIGNAL_SEND_BROADCAST_STATUS="zc.s.sbs",e.SIGNAL_SEND_NET_PROBE="zc.s.snp",e.SIGNAL_SEND_NET_QUALITY_INFO_PUSH_ACK="zc.s.npa",e.PUBLISHER_START_PUBLISH="zc.p.0.sp.0",e.PUBLISHER_PUBLISH_SUCCESS="zc.p.ps",e.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS="zc.p.0.ocpss",e.PUBLISHER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.0.hcsws",e.PUBLISHER_ON_CREATE_OFFER_SUCCESS="zc.p.0.ocos",e.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.0.oslds",e.PUBLISHER_ON_GET_REMOTE_DESCRIPTION="zc.p.0.ogrd",e.PUBLISHER_ON_RECV_MEDIA_DESC="zc.p.0.ormd",e.PUBLISHER_ON_RECV_CANDIDATE_INFO="zc.p.0.orci.0",e.PUBLISHER_ON_RECV_PUBLISH_EVENT="zc.p.0.orpe",e.PUBLISHER_ON_RECV_CLIENT_INFO="zc.p.0.orci.1",e.PUBLISHER_ON_ICE_CANDIDATE="zc.p.0.oic",e.PUBLISHER_ON_CONNECTION_STATE_CHANGE="zc.p.0.ocsc",e.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.0.oicsc",e.PUBLISHER_RESET_PUBLISH="zc.p.0.rp",e.PUBLISHER_SET_PLAYER_QUALITY_TIMER="zc.p.0.spqt",e.PUBLISHER_UPLOAD_PUBLISH_QUALITY="zc.p.0.upq",e.PUBLISHER_ON_RECV_RESET_SESSION="zc.p.0.orrs",e.PUBLISHER_ON_RECV_CLOSE_SESSION="zc.p.0.orcs",e.PUBLISHER_SEND_CANDIDATE_INFO="zc.p.0.sci",e.PUBLISHER_STATE_ERROR="zc.p.0.psr",e.PUBLISHER_STOP_PUBLISH="zc.p.0.sp.1",e.PUBLISHER_ON_DISCONNECT="zc.p.0.od",e.PUBLISHER_START_SOUND_LEVEL="zc.p.0.ssl.0",e.PUBLISHER_STOP_SOUND_LEVEL="zc.p.0.ssl.1",e.PUBLISHER_HANDLE_ENC_BITRATE="zc.p.0.heb",e.PUBLISHER_ON_RECV_NET_QUALITY_INFO="zc.p.0.nqi",e.PUBLISHER_ON_RECV_UPDATE_MEDIA_DESC="zc.p.0.orumd",e.PLAYER_START_PLAY="zc.p.1.sp.0",e.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS="zc.p.ocpss.1",e.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.hcsws.1",e.PLAYER_ON_CREATE_OFFER_SUCCESS="zc.p.ocos.1",e.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.oslds.1",e.PLAYER_ON_RECV_MEDIA_DESC="zc.p.ormd.1",e.PLAYER_ON_RECV_CANDIDATE_INFO="zc.p.orci.1",e.PLAYER_ON_RECV_PLAY_EVENT="zc.p.orpe.1",e.PLAYER_ON_RECV_CLIENT_INFO="zc.p.orci.1.1",e.PLAYER_ON_ICE_CANDIDATE="zc.p.oic.1",e.PLAYER_ON_CONNECTION_STATE_CHANGE="zc.p.ocsc.1",e.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.oicsc.1",e.PLAYER_RESET_PLAY="zc.p.rp.1",e.PLAYER_SET_PLAYER_QUALITY_TIMER="zc.p.spqt.1",e.PLAYER_UPLOAD_PLAYER_QUALITY="zc.p.upq.1",e.PLAYER_ON_RECV_RESET_SESSION="zc.p.orrs.1",e.PLAYER_ON_RECV_CLOSE_SESSION="zc.p.orcs.1",e.PLAYER_ON_RECV_STREAM_STATUS="zc.p.orss.1",e.PLAYER_ON_GOT_REMOTE_STREAM="zc.p.ogrs.1",e.PLAYER_SEND_CANDIDATE_INFO="zc.p.sci.1",e.PLAYER_STATE_ERROR="zc.p.psr.1",e.PLAYER_STOP_PLAY="zc.p.1.sp.1",e.PLAYER_ON_DISCONNECT="zc.p.od.1",e.PLAYER_START_SOUND_LEVEL="zc.p.ssl.1",e.PLAYER_STOP_SOUND_LEVEL="zc.p.ssl.1.1",e.PLAYER_ON_RECV_NET_QUALITY_INFO="zc.p.1.nqi",e.PUBLISH_SET_CAPTURE_VOLUME="zc.p.scv",e.PUBLISH_SET_BEAUTY_EFFECT="zc.p.0.sbe",e.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ="zc.sh.msbss",e.STREAMHANDLER_MERGE_STREAM="zc.sh.ms",e.STREAMHANDLER_PATCH_STREAM_LIST="zc.sh.psl"}(t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={})),(r=t.ZEGO_WECHATMINI_ACTION||(t.ZEGO_WECHATMINI_ACTION={})).ADD_PUBLISH_CDN_URL="zw.apcu",r.REMOVE_PUBLISH_CDN_URL="zw.rpcu",r.STOP_MIXER_TASK="zw.smt",r.ON_STREAM="zw.os",r.ON_PUSH_STREAM_UPDATE="zw.opsu",r.ON_PUBLISH_STATE_UPDATE="zw.w.opsu",r.ON_PUBLISH_STATE_UPDATE_HANDLE="zw.w.opsuh",r.WECHATMINI_SETPREFERPLAYSOURCETYPE="zw.w.sppst.1",r.WECHATMINI_BIND_LISTENER="zw.w.bl",r.WECHATMINI_DELETE_LISTENER="zw.w.dl",r.WECHATMINI_UPDATE_PLAYER_STATE="zw.w.ups",r.WECHATMINI_UPDATE_PLAYER_NET_STATUS="zw.w.upns",r.WECHATMINI_SET_CUSTOM_SIGNAL_URL="zw.w.scsu",r.WECHATMINI_GET_NEXT_URL="zw.w.gnu",r.WECHATMINI_BIND_STREAM_CENTER_HANDLER="zw.w.bsch",r.WECHATMINI_BIND_RTM_LISTENER="zw.w.brl",r.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE="zw.pu.sppst.0",r.PUBLISHMODULE_START_PUBLISHING_STREAM="zw.pu.sps.0",r.PUBLISHMODULE_STOP_PUBLISHING_STREAM="zw.pu.sps.0.0",r.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL="zw.pu.fpsu.0",r.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP="zw.pu.hfspur.0",r.PUBLISHMODULE_DO_PUBLISH_STREAM="zw.pu.dps.0",r.PUBLISHMODULE_UPDATE_STREAM_INFO="zw.pu.upi",r.PUBLISHMODULE_HANDLE_STREAM_UPDATE_RSP="zw.pu.hsur",r.PLAYMODULE_START_PLAYING_STREAM="zw.pl.sps.1",r.PLAYMODULE_STOP_PLAYING_STREAM="zw.pl.sps.1.0",r.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN="zw.pl.spsfc",r.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP="zw.pl.spsfb",r.PLAYMODULE_DO_PLAY_STREAM="zw.pl.dps",r.PLAYMODULE_FETCH_PLAY_STREAM_URL="zw.pl.fpsu",r.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP="zw.pl.hfsur",r.STREAMCENTERWECHAT_RESET="zw.scw.r.0",r.STREAMCENTERWECHAT_START_PUBLISHING_STREAM="zw.scw.sps.0",r.STREAMCENTERWECHAT_START_PLAYING_STREAM="zw.scw.sps.1",r.STREAMCENTERWECHAT_START_PLAYER="zw.scw.sp.0",r.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE="zw.scw.opuu.0",r.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE="zw.scw.ups.0",r.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS="zw.scw.upns",r.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE="zw.scw.ups.0.0",r.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE="zw.scw.ups.1.0",r.STREAMCENTERWECHAT_GET_NEXT_URL="zw.scw.gnu",r.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM="zw.scw.sps.0.0",r.STREAMCENTERWECHAT_STOP_PLAYING_STREAM="zw.scw.sps.1.0",r.STREAMCENTERWECHAT_STOP_PLAYER="zw.scw.sp.1",r.STREAMCENTERWECHAT_ON_PLAY_START="zw.scw.ops.0",r.STREAMCENTERWECHAT_ON_PLAY_STOP="zw.scw.ops.1",r.STREAMCENTERWECHAT_ON_PLAY_RETRY="zw.scw.opr",r.PLAYWECHAT_TRY_START_PLAYER="zw.pw.tsp.0",r.PLAYWECHAT_UPDATE_EVENT="zw.pw.ue",r.PLAYWECHAT_GET_PLAY_URL="zw.pw.gpu"},9595:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RTC=t.ZegoSettingConfig=void 0;var r=function(){function e(){this.defaultSetting={publish_video_codec:"H264",camera_video_bitrate:800,screen_video_bitrate:1500,custom_video_bitrate:0,l3_play_buffer_ms:500,AEC:!0,AGC:!0,ANS:!0,resource_mode:0,bitrate_mode:"default"},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setSetting=function(e,t){var r=Array.isArray(t)&&t.length>0;for(var n in e)for(var o in e[n])if(!o.endsWith("_ctrlmode")){if(r&&-1==t.indexOf(o))continue;var i=e[n][o+"_ctrlmode"];1===i||2===i?this.setting[o]=e[n][o]:this.defaultSetting[o]&&(this.setting[o]=this.defaultSetting[o]),"number"==typeof i&&(this.setting[o+"_ctrlmode"]=e[n][o+"_ctrlmode"])}},e.prototype.getSetting=function(e,t){return void 0===t&&(t=!1),t?2==this.setting[e+"_ctrlmode"]?this.setting[e]:void 0:this.setting[e]},e}();t.ZegoSettingConfig=r,t.RTC="rtc"},7325:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var n=r(6706),o=r(608),i=r(1089),s=r(9595),a=r(6706),u=r(3529),l=function(){function e(e,t){this.logger=e,this.dataReport=t,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.publishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnOverTcpOnly=!1,this.customSetTcpOrUdp=!1,this.supportUdp=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[],receiveRealTimeSequentialData:[],beautyEffectOverload:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=a.ENUM_NETWORK_STATE.offline,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.clientIP="",this.type="PUBLIC",this.roomList=[],this.isMultiRoom=!1,this.browser="",this.logReportCallback=o.ClientUtil.logReportCallback,this.unregisterCallback=o.ClientUtil.unregisterCallback,this.checkIllegalCharacters=o.ClientUtil.checkIllegalCharacters,this.decodeServerError=o.ClientUtil.decodeServerError,this.getLiveRoomError=o.ClientUtil.getLiveRoomError,this.getServerError=o.ClientUtil.getServerError,this.mergeStreamList=o.ClientUtil.mergeStreamList,this.checkInteger=o.ClientUtil.checkInteger,this.isUrl=o.ClientUtil.isUrl,this.actionSuccessCallback=o.ClientUtil.actionSuccessCallback,this.checkValidNumber=o.ClientUtil.checkValidNumber,this.getDevices=o.ClientUtil.getDevices,this.settingConfig=new s.ZegoSettingConfig}return e.prototype.getRequestId=function(){return this.idName+"-"+a.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r,n){var o={request_id:t,room_id:e,from_userid:this.idName,from_username:this.nickName,to_userid:r};return null!=n&&(o.result=n),JSON.stringify(o)},e.prototype.actionListener=function(e){for(var t=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];if(!["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate"].includes(e)&&this.listenerList[e]){var s=n.getReportSeq();this.dataReport.newReport(s,u.ZegoRTCLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(s,{listener:e,params:r}),this.dataReport.uploadReport(s)}this.listenerList[e]&&this.listenerList[e].forEach(function(n){try{setTimeout(function(){n.apply(void 0,r)},0)}catch(r){t.logger.error(i.ZEGO_WEBRTC_ACTION.STATECENTER_ACTION_LISTENER+" "+e+" "+r)}})},e.prototype.getRoomByRoomID=function(e){return this.roomList.find(function(t){return t.roomID==e})},e.prototype.getPlayRoom=function(e){return this.roomList.find(function(t){return!!t.streamList.find(function(t){return t.stream_id==e})})},e}();t.StateCenter=l},5740:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenter=void 0,t.ZegoStreamCenter=function(){this.publisherList={},this.playerList={}}},7560:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamHandler=void 0;var n=r(6706),o=r(2752),i=r(1089),s=function(){function e(e,t,r,n,o){this.logger=e,this.stateCenter=t,this.rtm=r,this.streamCenter=n,this.roomID=o,this.minStreamSeq=0,this.streamSeq=0,this.streamQuerying=!1,this.streamSeqMergeMap=null,this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3}return e.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]:"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]:"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]:"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]:"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]:"string"==typeof t.urls_rtmp?t.urls_rtmp:""},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){this.logger.info("zb.sh.hss call stream update"),this.room=t,e.body?(this.streamListHBMergeInterval=e.body.stream_list_hb_wait_merge_time||2e3,this.streamListMergeInterval=e.body.stream_list_push_merge_timeout||5e3,this.streamQuerying=!1,this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info||[]),this.handleReconnectStream(e.body.stream_info),this.logger.info("zb.sh.hss call end")):this.logger.error("zb.sh.hss server response wrong")},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,i){var s,a,u,l=this;if(void 0===r&&(r=""),this.logger.info("zb.sh.usi call"),"PUBLIC"===this.stateCenter.type){var c=JSON.stringify({stream_id:e,extra_info:r});a={sub_cmd:t,stream_msg:c,third_token:null===(s=this.room)||void 0===s?void 0:s.token},u="stream"}else a={room_header:{room_id:this.roomID,room_sid:this.rtm.getRoomSid()||"0",room_user_session_id:this.rtm.getRoomSessionID()||"0"},stream_id:e,extra_info:r,title:"",stream_sid:this.stateCenter.publishStreamList[e].sid},u=t;var d=this.room;this.room.streamInfoList[e]={},this.room.streamInfoList[e].seq=this.rtm.service.sendMessage(u,a,function(e,t){l.handleStreamUpdateRsp(e)},function(s,a){var u=l.room;if(u&&!u.isResetRoom&&!l.rtm.service.isDisConnect()&&s.code&&s.code==o.errorCodeList.TIMEOUT.code&&u.streamInfoList[e].seq==a)2001==t&&l.stateCenter.publishStreamList[e]&&l.stateCenter.publishStreamList[e].state==n.ENUM_PUBLISH_STREAM_STATE.update_info||2002==t?setTimeout(function(){l.updateStreamInfo(e,t,r,i)},0):i&&i(o.errorCodeList.TIMEOUT);else if(s.body&&s.body.err_code){var c=l.stateCenter.getServerError(s.body.err_code);[1011,1000002002].includes(c.code)&&(c=o.errorCodeList.TOKEN_EXPIRED),i&&i(c,a),t===n.ENUM_STREAM_SUB_CMD.liveBegin&&l.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.error,e,c)}},void 0,{sessionID:null==d?void 0:d.sessionID,roomID:null==d?void 0:d.roomID,roomSessionID:null==d?void 0:d.roomSessionID}),this.logger.info("zb.sh.usi call success cmd "+t)},e.prototype.handleStreamUpdateRsp=function(e){var t,r,o;if(this.rtm.service.isDisConnect())this.logger.error("zb.sh.hsur not login");else if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.streamSeq+" server seq "+e.body.stream_seq),"PUBLIC"===this.stateCenter.type?this.streamSeq=e.body.stream_seq:this.streamSeq++;var i=this.room;if(i)if("PUBLIC"===this.stateCenter.type){(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.token_remain_time)&&(this.stateCenter.getRoomByRoomID(null===(r=null==e?void 0:e.header)||void 0===r?void 0:r.room_id)?this.rtm.resetRoomTokenTimer(e.header.room_id,e.body.token_remain_time):this.logger.error("zb.sh.hsur room no found ignore "+JSON.stringify(null===(o=e.header)||void 0===o?void 0:o.room_id)));for(var s=function(t){var r=e.body.stream_info[t].stream_id,o=a.stateCenter.publishStreamList[r];if(!o)return a.logger.info("hsur.0 stream is not exist"),{value:void 0};o.state==n.ENUM_PUBLISH_STREAM_STATE.update_info&&(o.state=n.ENUM_PUBLISH_STREAM_STATE.publishing,i.streamList.find(function(e){return e.stream_id==r})||i.streamList.push(e.body.stream_info[t]),a.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.start,r,{code:0,message:""})),delete i.streamInfoList[r]},a=this,u=0;u<e.body.stream_info.length;u++){var l=s(u);if("object"==typeof l)return l.value}}else{var c=e.body.stream_id;this.stateCenter.publishStreamList[c]&&this.stateCenter.publishStreamList[c].state==n.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[c].state=n.ENUM_PUBLISH_STREAM_STATE.publishing,this.stateCenter.publishStreamList[c].sid=e.body.stream_sid,this.stateCenter.publishStreamList[c].ver=e.body.stream_ver,i.streamList.find(function(e){return e.stream_id==c})||i.streamList.push({stream_id:e.body.stream_id,stream_seq:e.body.stream_seq,stream_sid:e.body.stream_sid,stream_ver:e.body.stream_ver,user_id:"",user_name:""}),this.onPublishStateUpdate(0,c,{code:0,message:""})),delete i.streamInfoList[c]}else this.logger.info("hsur.0 room no found")}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code)},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info("zb.sh.hfslr call"),this.streamQuerying=!1,0===e.body.err_code?this.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.info("zb.sh.hfslr call success")):this.logger.info("zb.sh.hfslr same seq"):this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.info("zb.sh.hfus call"),this.streamSeq=e,this.logger.debug("zb.sh.hfus server seq "+this.streamSeq),this.stateCenter.mergeStreamList(this.stateCenter.idName,this.room.streamList,t,function(e,t,o){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.roomID,n.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.roomID,n.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==o.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.roomID,r.makeCallbackStreamList(o)))}),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case n.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case n.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case n.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handlePriPushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.streams_info&&0!==e.body.streams_info.length){if(e.body.streams_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.mergeStreamByStreamSeq(e.body.stream_cmd,e.body.stream_seq,e.body.streams_info);switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case n.ENUM_STREAM_UPDATE_CMD_PRI.added:this.handleAddedStreamList(e.body.streams_info);break;case n.ENUM_STREAM_UPDATE_CMD_PRI.deleted:this.handleDeletedStreamList(e.body.streams_info);break;case n.ENUM_STREAM_UPDATE_CMD_PRI.updated:this.handleUpdatedStreamList(e.body.streams_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],o=0;o<e.length;o++)if(e[o].anchor_id_name!=this.stateCenter.idName&&e[o].user_id!==this.stateCenter.idName){t=!1;for(var i=0;i<this.room.streamList.length;i++)if(e[o].stream_id===this.room.streamList[i].stream_id){t=!0;break}t||r.push(e[o])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var s=0;s<r.length;s++)this.room.streamList.push(r[s]);this.onStreamUpdated(this.roomID,n.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var o=this.room.streamList.length-1;o>=0;o--)if(e[r].stream_id===this.room.streamList[o].stream_id){this.room.streamList.splice(o--,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.roomID,n.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var n=0;n<this.room.streamList.length;n++)if(e[r].stream_id===this.room.streamList[n].stream_id){e[r].extra_info!==this.room.streamList[n].extra_info&&(this.room.streamList[n]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.roomID,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(){if(this.logger.info("zb.sh.fsl call"),this.rtm.service.isDisConnect())this.logger.info("zb.sh.fsl state error");else if(this.streamQuerying)this.logger.info("zb.sh.fsl already doing");else if(this.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request"),"PUBLIC"===this.stateCenter.type){var e={reserve:0},t=this.room;this.rtm.service.sendMessage("stream_info",e,this.handleFetchStreamListRsp.bind(this),function(e,t){},void 0,{roomID:null==t?void 0:t.roomID,sessionID:null==t?void 0:t.sessionID,roomSessionID:null==t?void 0:t.roomSessionID}),this.logger.info("zb.sh.fsl call success")}else{if(!this.rtm.isLogin(this.roomID))return void this.logger.info("zb.sh.fsl room state error");e={room_header:{room_id:this.roomID,room_sid:this.rtm.getRoomSid()||"0",room_user_session_id:this.rtm.getRoomSessionID()||"0"}},this.rtm.service.sendMessage("zegochat_js.room_info_req",e,this.handleFetchStreamListRsp.bind(this),function(e,t){})}},e.prototype.handleReconnectStream=function(e){this.logger.info("zb.sh.hrs call");var t=this.streamCenter.publisherList,r=this.streamCenter.playerList,o=function(r){if(t[r].room.roomID!==i.roomID)return"continue";if(t[r].publisher.state!=n.ENUM_PUBLISH_STATE.publishing||e.find(function(e){return e.stream_id==r})){if(t[r].publisher.state==n.ENUM_PUBLISH_STATE.stop&&e.find(function(e){return e.stream_id==r})){i.updateStreamInfo(r,"PUBLIC"===i.stateCenter.type?n.ENUM_STREAM_SUB_CMD.liveEnd:n.ENUM_STREAM_CMD_PRI.liveEnd);for(var o=0;o<i.room.streamList.length;o++)if(i.room.streamList[o].stream_id==r){i.room.streamList.splice(o--,1);break}}}else i.updateStreamInfo(r,"PUBLIC"===i.stateCenter.type?n.ENUM_STREAM_SUB_CMD.liveBegin:n.ENUM_STREAM_CMD_PRI.liveBegin,i.stateCenter.publishStreamList[r].extra_info)},i=this;for(var s in t)o(s);for(var s in t)t[s].room.roomID===this.roomID&&t[s].isReDispatch&&(this.logger.info("zb.sh.hrs "+s+"retry dispatch"),(a=t[s].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(s,t[s].publishOption,!0),a.active(0),t[s].isReDispatch=!1);for(var s in r){var a;r[s].room.roomID===this.roomID&&r[s].isReDispatch&&(this.logger.info("zb.sh.hrs "+s+"retry dispatch"),(a=r[s].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(s,r[s].playOption,!1),a.active(0),r[s].isReDispatch=!1)}this.logger.info("zb.sh.hrs end")},e.prototype.makeCallbackStreamList=function(e){var t=[];if("PUBLIC"===this.stateCenter.type){if(e&&e.length>0)for(var r=0;r<e.length;r++){var n={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:e[r].stream_gid,closeType:e[r].close_type};this.setCDNInfo(n,e[r]),t.push(n)}}else if(e&&e.length>0)for(r=0;r<e.length;r++)t.push(n={user_id:e[r].user_id,user_name:e[r].user_name,stream_id:e[r].stream_id,stream_sid:e[r].stream_sid,extra_info:e[r].extra_info,title:e[r].title,stream_ver:e[r].stream_ver});return t},e.prototype.sendBizChannelRequest=function(e,t,r,n){var o=this;void 0===n&&(n=!1),e=Object.assign(e,{is_retry_req:n?1:0});var i=this.room;this.rtm.service.sendMessage("biz_channel",e,function(e,r){t(e.header.seq,e.body.cmd,e.body.rsp_body)},function(n,i){var s=n.body.err_code;"number"!=typeof s||2002!==s?r(s,i,n.body.rsp_body):o.sendBizChannelRequest(e,t,r,!0)},void 0,{roomID:null==i?void 0:i.roomID,sessionID:null==i?void 0:i.sessionID,roomSessionID:null==i?void 0:i.roomSessionID})},e.prototype.updateStreamExtraInfo=function(e,t,r,n){},e.prototype.setStreamExtraInfo=function(e,t,r,n){},e.prototype._publishTarget=function(e,t,r){},e.prototype.patchStreamList=function(e){var t=this;e.body.stream_seq===this.streamSeq||this.streamSeqMergeMap||(this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_PATCH_STREAM_LIST+" call update stream "+this.streamSeq+" server "+e.body.stream_seq),this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout(function(){t.handleMergeTimeout()},this.streamListHBMergeInterval)),this.minStreamSeq=e.body.stream_seq},e.prototype.mergeStreamByStreamSeq=function(e,t,r){var n=this;this.streamSeqMergeMap||(this.logger.warn(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" new merge stream list "+this.streamSeq+" server "+t),this.streamSeqMergeMap={},this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout(function(){n.handleMergeTimeout()},this.streamListMergeInterval)),this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" "+this.streamSeqMergeMap+" "+e+" "+t+" "+r),this.streamSeqMergeMap[t]={cmd:e,streamList:r}},e.prototype.handleMergeTimeout=function(){if(this.streamSeqMergeMap){var e=Object.keys(this.streamSeqMergeMap).map(function(e){return+e}).sort(function(e,t){return e-t});e[e.length-1]-e[0]+1===e.length||e[e.length-1]>=this.minStreamSeq?this.mergeStream(e):(this.streamSeqMergeMap=null,this.fetchStreamList())}},e.prototype.mergeStream=function(e){var t=this;this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" merge streamList "+this.streamSeq+" streamSeqList "+e.join(","));var r=e[e.length-1],o=[];e.forEach(function(e){if(t.streamSeqMergeMap&&t.streamSeqMergeMap[e])switch(t.streamSeqMergeMap[e].cmd){case n.ENUM_STREAM_UPDATE_CMD.added:t.streamSeqMergeMap[e].streamList.forEach(function(e){var t=o.findIndex(function(t){return t.stream_id==e.stream_id});-1!==t&&o.splice(t),o.push(e)});break;case n.ENUM_STREAM_UPDATE_CMD.deleted:t.streamSeqMergeMap[e].streamList.forEach(function(e){var t=o.findIndex(function(t){return t.stream_id==e.stream_id});-1!==t&&o.splice(t)});break;case n.ENUM_STREAM_UPDATE_CMD.updated:t.streamSeqMergeMap[e].streamList.forEach(function(e){var t=o.findIndex(function(t){return t.stream_id==e.stream_id});-1!==t&&o.splice(t),o.push(e)})}}),this.streamSeqMergeMap=null,this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" "+o),this.handleFullUpdateStream(r,o)},e.prototype.reset=function(){this.minStreamSeq=0,this.streamSeqMergeMap=null,this.streamSeqMergeTimer&&(clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=void 0),this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3},e.prototype.getRoomInfo=function(){var e=this;return new Promise(function(t,r){if(e.rtm.isLogin(e.roomID)){var n=function(e,n){if(0!==e.body.code)r({errorCode:e.body.code,extendData:e.body.message});else{var o=e.body.streams_info.map(function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info}});t({streamList:o})}},o={room_header:{room_id:e.roomID,room_sid:e.rtm.getRoomSid()||"0",room_user_session_id:e.rtm.getRoomSessionID()||"0"}};e.rtm.service.sendMessage("zegochat_js.room_info_req",o,n,n)}else e.logger.error("zn.rh.gri no enter room")})},e}();t.StreamHandler=s},6706:function(e,t,r){"use strict";var n,o,i,s,a,u,l,c,d,h,p,f,g;Object.defineProperty(t,"__esModule",{value:!0}),t.ENUM_PUBLISH_STATE_UPDATE=t.LinkedList=t.ListNode=t.E_CLIENT_TYPE=t.ENUM_SOURCE_TYPE=t.ENUM_DISPATCH_TYPE=t.ENUM_BROADCASTER_STATUS=t.ENUM_PLAY_SOURCE_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.QUALITYLEVEL=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD_PRI=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.STREAM_DELETE_REASON=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.ENUM_STREAM_UPDATE_TYPE=t.ENUM_STREAM_CMD_PRI=t.ENUM_STREAM_SUB_CMD=t.ENUM_PUBLISH_STREAM_STATE=t.MAX_RETRY_CONNECT_INTERVAL=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_PROBE_STATE=t.ENUM_PLAY_STATE_NEGO=t.ENUM_PLAYER_STATE=t.ENUM_PLAY_STATE=t.ENUM_PUBLISH_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.ZegoExpressWebRTMEngine=t.getReportSeq=t.getSeq=t.QUALITY_CONSTANT=t.QualityGrade=t.REPORT_ACTION=t.ENUM_RETRY_STATE=t.ENUM_PLAY_STATE_UPDATE=void 0,t.PROTO_VERSION="2.14.0",t.ROOMVERSION="V1",(g=t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={}))[g.debug=0]="debug",g[g.info=1]="info",g[g.warn=2]="warn",g[g.error=3]="error",g[g.report=99]="report",g[g.disable=100]="disable",t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},(f=t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={}))[f.disable=0]="disable",f[f.websocket=1]="websocket",f[f.https=2]="https",t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},(p=t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={}))[p.disconnected=0]="disconnected",p[p.connecting=1]="connecting",p[p.connected=2]="connected",t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1500},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOfferRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOfferRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAYER_STATE={start:0,playing:1,stop:2},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6,iceClosed:7,iceFailed:8},(h=t.ENUM_PROBE_STATE||(t.ENUM_PROBE_STATE={}))[h.tryProbe=0]="tryProbe",h[h.probed=2]="probed",t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=3,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.MAX_RETRY_CONNECT_INTERVAL=12,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},(d=t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={}))[d.logout=0]="logout",d[d.trylogin=1]="trylogin",d[d.login=2]="login",(c=t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={}))[c.offline=0]="offline",c[c.online=1]="online",t.STREAM_DELETE_REASON={0:{code:1,description:"user_stop_publishing_stream_normal"},1:{code:2,description:"user_heart_beat_timeout"},2:{code:3,description:"user_repeat_login"},3:{code:4,description:"user_kicked_out"},4:{code:5,description:"user_offline"},100:{code:6,description:"remove_by_server"}},function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CDN=1]="CDN",e[e.RTC=2]="RTC",e[e.L3=3]="L3"}(n||(n={})),t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.ENUM_STREAM_UPDATE_CMD_PRI={added:1,updated:2,deleted:3},t.SERVER_ERROR_CODE=1e4,(l=t.QUALITYLEVEL||(t.QUALITYLEVEL={}))[l.low=1]="low",l[l.stantard=2]="stantard",l[l.hight=3]="hight",l[l.custome=4]="custome",t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6,iceClosed:7,iceFailed:8},(u=t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={}))[u.cdn=0]="cdn",u[u.ultra=1]="ultra",(a=t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={}))[a.stop=0]="stop",a[a.start=1]="start",(s=t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={}))[s.cdn=0]="cdn",s[s.ultra=1]="ultra",s[s.customUrl=2]="customUrl",(i=t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={}))[i.CDN=0]="CDN",i[i.BGP=1]="BGP",(o=t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))[o.ClientType_None=0]="ClientType_None",o[o.ClientType_H5=1]="ClientType_H5",o[o.ClientType_SmallPragram=2]="ClientType_SmallPragram",o[o.ClientType_Webrtc=3]="ClientType_Webrtc";var _=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=_;var m,v,E=function(){function e(){this.start=new _,this.end=new _,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new _(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,n=null;t.hasNext()&&!r;)e(t=t.next)&&(n=t,r=!0);return n},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this.insertBefore(this._numNodes>0?this.start.next:this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=E,t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},(v=t.QualityGrade||(t.QualityGrade={}))[v.Unknown=-1]="Unknown",v[v.Excellent=0]="Excellent",v[v.Good=1]="Good",v[v.Middle=2]="Middle",v[v.Poor=3]="Poor",v[v.Die=4]="Die",(m=t.QUALITY_CONSTANT||(t.QUALITY_CONSTANT={}))[m.MinQuality=0]="MinQuality",m[m.DieQuality=0]="DieQuality",m[m.PoorMinQuality=1]="PoorMinQuality",m[m.MiddleMinQuality=30]="MiddleMinQuality",m[m.GoodMinQuality=60]="GoodMinQuality",m[m.ExcellentMinQuality=85]="ExcellentMinQuality",m[m.MaxQuality=100]="MaxQuality";var T=r(4119);Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return T.getSeq}}),Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return T.getReportSeq}}),Object.defineProperty(t,"ZegoExpressWebRTMEngine",{enumerable:!0,get:function(){return T.ZegoExpressWebRTMEngine}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return T.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return T.ZegoDataReport}}),Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return T.ZegoExpressWebRTM}})},2752:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},STREAMID_TOO_LONG:{code:1000014,message:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,message:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,message:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,message:"network is broken"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,message:"init sdk wrong"},WX_GET_SETTING_FAIL:{code:1101001,message:"wx get setting fail"},USER_ID_NULL:{code:1002005,message:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,message:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,message:"user ID is too long"},USER_NAME_NULL:{code:1002008,message:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,message:"username is too long"},ROOM_ID_NULL:{code:1002011,message:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,message:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,message:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,message:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,message:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,message:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,message:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,message:"server has sent a signal to kick out"},ROOM_INNER_ERROR:{code:1002099,message:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,message:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,message:"parse json error."},LOGIN_PROCESSING:{code:1102012,message:"login is processing."},LIVEROOM_REQUEST_ERROR:{code:1102013,message:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,message:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,message:"user login state is wrong."},TOKEN_ERROR:{code:1102016,message:"token error"},DISPATCH_ERROR:{code:1102017,message:"dispatch error"},TOKEN_EXPIRED:{code:1102018,message:"token expired"},SUBCMD_ERROR:{code:1102019,message:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,message:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},DISPATCH_TIMEOUT:{code:1102022,message:"dispatch request timeout"},CONNECT_FAILED:{code:1102023,message:"connect signal fail"},PUBLISHER_MEDIA_SERVER_FORBID:{code:1003025,message:"stream is forbided by media server"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,message:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,message:"input param error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,message:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,message:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,message:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,message:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,message:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,message:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,message:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,message:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,message:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,message:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,message:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,message:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,message:"ice connection error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,message:"negotiation timeout"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,message:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,message:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,message:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},REPEATED_PULL:{code:1103049,message:"repeated pull same stream"},PUBLISHER_WEBSOCKET_DISCONNECTED:{code:1103050,message:"websocket disconnected"},PUBLISHER_RETRY_TIMEOUT:{code:1103051,message:"publisher retry timeout"},PUBLISHER_HTTPS_REQUIRED:{code:1103053,message:"https is required"},PUBLISHER_NO_PREVIEW:{code:1103054,message:"no preview"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISHER_IS_PUBLISHING:{code:1103056,message:"publish is publishing"},PUBLISHER_CLIENT_IP_CHANGED:{code:1103058,message:"client ip changed"},PUBLISHER_TTL_OVERTIME:{code:1103059,message:"ttl over time"},PUBLISHER_SESSION_TIMEOUT:{code:1103060,message:"session request timeout"},PUBLISHER_GET_USER_MEDIA_FAIL:{code:1103061,message:"get media fail"},PUBLISHER_DEVICE_NO_ALLOWED:{code:1103064,message:"get device not allowed"},PUBLISHER_DEVICE_NO_READABLE:{code:1103065,message:"device is not readable"},PUBLISHER_OVER_CONSTRAINED:{code:1103066,message:"device does not meet constraints"},PUBLISHER_UPDATE_SDP_TIMEOUT:{code:1103067,message:"update sdp time out"},PUBLISHER_UPDATE_SDP_FAIL:{code:1103068,message:"update sdp fail"},VIDEO_EFFECT_IS_STARTING:{code:1103073,message:"video effect is starting, please operate after video effect is started"},PLAYER_PARAM:{code:1104001,message:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,message:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,message:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,message:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,message:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,message:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,message:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,message:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,message:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,message:"ice connection error"},PLAYER_WEBSOCKET_DISCONNECTED:{code:1104029,message:"websocket disconnected"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,message:"negotiation timeout"},PLAYER_RETRY_TIMEOUT:{code:1104031,message:"player retry timeout"},PLAYER_IS_PLAYING:{code:1104032,message:"player is playing"},PLAYER_CLIENT_IP_CHANGED:{code:1104033,message:"client ip changed"},PLAYER_TTL_OVERTIME:{code:1104034,message:"ttl is over time"},PLAYER_SESSION_RESET:{code:1104035,message:"reset session push"},PLAYER_SESSION_TIMEOUT:{code:1104036,message:"session request timeout"},PLAYER_PROBE_TIMEOUT:{code:1104037,message:"probe time out"},PLAYER_UNSUPPORTED_PROTOCOL:{code:1104038,message:"resource mode is not supported"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,message:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,message:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,message:"message content is too long"},IM_SEND_FAILED:{code:1009010,message:"failed to send message"},FREQ_LIMITED:{code:1109001,message:"frequency limited."}}},3529:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWechatLogEvent=t.ZegoRTCLogEvent=void 0;var n=r(2752),o=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskCreateStream:{event:"/sdk/create_stream",error:{kBrowserNotSupportError:n.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kParamError:n.errorCodeList.PUBLISHER_PARAM,kScreenCancelError:n.errorCodeList.PUBLISH_SCREEN_CANCELED,kScreenFailedError:n.errorCodeList.PUBLISHER_SCREEN_FAILED,kScreenNotSupportError:n.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT,kHttpsRequiredError:n.errorCodeList.PUBLISHER_HTTPS_REQUIRED,kGetUserMediaError:n.errorCodeList.PUBLISHER_GET_USER_MEDIA_FAIL,kDeviceNoAllowedError:n.errorCodeList.PUBLISHER_DEVICE_NO_ALLOWED,kDeviceNoReadableError:n.errorCodeList.PUBLISHER_DEVICE_NO_READABLE,kDeviceOverConstrainedError:n.errorCodeList.PUBLISHER_OVER_CONSTRAINED},stream_type:o,screen:o,camera:o,custom:o},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishParamError:n.errorCodeList.PUBLISHER_PARAM,kPublishNetworkTimeoutError:n.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:n.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:n.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:n.errorCodeList.NETWORK_BROKEN,kPublishNoPreviewError:n.errorCodeList.PUBLISH_NO_PREVIEW,kPublishEffectIsStarting:n.errorCodeList.VIDEO_EFFECT_IS_STARTING,kPublishNoLoginError:n.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:n.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kMediaServerForbidError:n.errorCodeList.PUBLISHER_MEDIA_SERVER_FORBID,kPublishTokenExpiredError:n.errorCodeList.TOKEN_EXPIRED,kPublishSessionClosedError:n.errorCodeList.PUBLISHER_SESSION_CLOSED,kPublishNegoTimeoutError:n.errorCodeList.PUBLISHER_SERVER_NEGO_TIMEOUT,kCreateOfferError:n.errorCodeList.PUBLISHER_CREATE_OFFER_ERROR,kSetLocalDescError:n.errorCodeList.PUBLISHER_SET_LOCAL_DESC_ERROR,kSessionTimeoutError:n.errorCodeList.PUBLISHER_SESSION_TIMEOUT,kSessionRequestError:n.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL,kSetRemoteDescError:n.errorCodeList.PUBLISHER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:n.errorCodeList.PUBLISHER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:n.errorCodeList.PUBLISHER_WEBSOCKET_DISCONNECTED,kMediaDescError:n.errorCodeList.PUBLISHER_MEDIA_DESC_ERROR,kCandidateError:n.errorCodeList.PUBLISHER_CANDIDATE_ERROR,kIsPublishing:n.errorCodeList.PUBLISHER_IS_PUBLISHING,kClientIPChangedError:n.errorCodeList.PUBLISHER_CLIENT_IP_CHANGED,kTTLOverTimeError:n.errorCodeList.PUBLISHER_TTL_OVERTIME,kUpdateMediaDescriptionTimeOut:n.errorCodeList.PUBLISHER_UPDATE_SDP_TIMEOUT,kUpdateMediaDescriptionError:n.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL},publishOption:o,message:o,session_id:o,stream:o,video_en_codec_id:o,cap_w:o,cap_h:o,w:o,h:o,video_en_fps:o,video_en_bps:o,audio_c_channel_count:o,audio_en_bps:o,aec_level:o,ans_level:o,agc:o,traffic_control_min_video_bitrate:o},kZegoTaskVideoCaptureSize:{event:"/sdk/api/publish_video_c_size",session_id:o,w:o,h:o},kZegoTaskVideoPlaySize:{event:"/sdk/play_video_size_changed",session_id:o,w:o,h:o},kZegoTaskRePublish:{event:"/sdk/republish",stream:o},kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:n.errorCodeList.PUBLISHER_PARAM},stream:o},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kStreamIDNullError:n.errorCodeList.STREAM_ID_NULL,kPlayParamError:n.errorCodeList.PLAYER_PARAM,kPlayStreamIDToLongError:n.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:n.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:n.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:n.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:n.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:n.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:n.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:n.errorCodeList.NETWORK_BROKEN,kPlayUnsupportedResourceMode:n.errorCodeList.PLAYER_UNSUPPORTED_PROTOCOL,kPlayRetryTimeoutError:n.errorCodeList.PLAYER_RETRY_TIMEOUT,kPlaySessionClosedError:n.errorCodeList.PLAYER_SESSION_CLOSED,kPlaySessionResetError:n.errorCodeList.PLAYER_SESSION_RESET,kPlayNegoTimeoutError:n.errorCodeList.PLAYER_SERVER_NEGO_TIMEOUT,kCreateOfferError:n.errorCodeList.PLAYER_CREATE_OFFER_ERROR,kSetLocalDescError:n.errorCodeList.PLAYER_SET_LOCAL_DESC_ERROR,kSessionRequestError:n.errorCodeList.PLAYER_SESSION_REQUEST_FAIL,kSessionTimeoutError:n.errorCodeList.PLAYER_SESSION_TIMEOUT,kSetRemoteDescError:n.errorCodeList.PLAYER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:n.errorCodeList.PLAYER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:n.errorCodeList.PLAYER_WEBSOCKET_DISCONNECTED,kCandidateError:n.errorCodeList.PLAYER_CANDIDATE_ERROR,kMediaDescError:n.errorCodeList.PLAYER_MEDIA_DESC_ERROR,kIsPlaying:n.errorCodeList.PLAYER_IS_PLAYING,kClientIPChangedError:n.errorCodeList.PLAYER_CLIENT_IP_CHANGED,kTTLOverTimeError:n.errorCodeList.PLAYER_TTL_OVERTIME,kProbeTimeOutError:n.errorCodeList.PLAYER_PROBE_TIMEOUT},playOption:o,message:o,session_id:o,stream:o,audio_activate:o,video_activate:o},kZegoTaskRePlay:{event:"/sdk/replay",stream:o},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:n.errorCodeList.PUBLISHER_PARAM},stream:o},kZegoTaskEnumDevices:{event:"/device/list",error:{kBrowserNotSupportError:n.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:n.errorCodeList.ENUMERATE_DEVICES_FAIL},dev_list:o},kZegoTaskAudioOutput:{event:"/device/audio_capture",error:{kBrowserNotSupportError:n.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:n.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:o,device:o},kZegoTaskVideoCapture:{event:"/device/video_capture",error:{kBrowserNotSupportError:n.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:n.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:o,device:o},kZegoTaskDeviceInterrupt:{event:"/device/interrupt",error:{kBrowserNotSupportError:n.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:n.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:o,interrupt:o},kZegoTaskSetDebug:"/sdk/set_debug",kZegoTaskSetLog:"/sdk/set_log_config",kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",capability:o},kZegoTaskRemoteCameraUpdate:{event:"/sdk/remote_camera_update",stream:o,status:o},kZegoTaskRemoteMicUpdate:{event:"/sdk/remote_mic_update",stream:o,status:o},kZegoTaskDestroyStream:{event:"/sdk/destroy_stream",error:{kLocalStreamError:n.errorCodeList.LOCALSTREAM_WRONG}},kZegoTaskScreenSharingEnded:"/sdk/screen_share_end",kZegoTaskAudioOutputChanged:{event:"/device/api/audio_output",session_id:o,stream:o,device:o,reason:o},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:o,update_stream:o},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:o},kZegoTaskPlayDecodeFirstVideoFrame:{event:"/sdk/play_decode_first_video_frame",session_id:o,fft_consumed:o},kZegoVisibilityChange:{event:"/app/background"},kZegoSetCaptureVolume:{event:"/sdk/set_capture_volume",error:{kParamError:n.errorCodeList.INPUT_PARAM}},kZegoListener:{event:"/sdk/listener"},kZegoNetProbe:{event:"/sdk/net_probe"},kZegoNetProbeResult:{event:"/sdk/net_probe_result"},kZegoTaskCloudSettingCache:{event:"/cloud_setting/cache"},kZegoTaskCloudSettingRefresh:{event:"/cloud_setting/refresh"}},t.ZegoWechatLogEvent={kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",error:{kCheckSystemGetSettingFailError:n.errorCodeList.WX_GET_SETTING_FAIL},capability:o},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:n.errorCodeList.STREAM_ID_NULL,kPublishParamError:n.errorCodeList.PUBLISHER_PARAM,kPublishStreamIDTooLongError:n.errorCodeList.STREAMID_TOO_LONG,kPublishStreamIDInvalidCharacterError:n.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPublishNetworkTimeoutError:n.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:n.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:n.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:n.errorCodeList.NETWORK_BROKEN,kPublishNoLoginError:n.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:n.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kIsPublishing:n.errorCodeList.PUBLISHER_IS_PUBLISHING},publishOption:o,stream:o,message:o},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:n.errorCodeList.STREAM_ID_NULL,kPlayParamError:n.errorCodeList.PLAYER_PARAM,kPlayStreamIDTooLongError:n.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:n.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:n.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:n.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:n.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:n.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:n.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:n.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:n.errorCodeList.PLAYER_RETRY_TIMEOUT,kIsPlaying:n.errorCodeList.PLAYER_IS_PLAYING},playOption:o,message:o,session_id:o,stream:o,audio_activate:o,video_activate:o},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskRePublish:"/sdk/republish",kZegoTaskRePlay:"/sdk/replay",kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:n.errorCodeList.PUBLISHER_PARAM},stream:o},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:n.errorCodeList.PUBLISHER_PARAM},stream:o},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:o,update_stream:o},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:o}}},2367:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WEBRTC_ACTION=void 0,function(e){e.SET_VIDEO_CONFIG="zc.svc",e.SET_AUDIO_CONFIG="zc.sac",e.REPLACE_TRACK="zc.rp",e.SET_BEAUTY_EFFECT="zc.sbe",e.ENABLE_STREAM="zc.es",e.ENABLE_MIC_ONLY="zc.emo",e.ACTIVATE_SEI_INSERT="zc.asi",e.MUTE_PUBLISH_STREAM_VIDEO="zc.mpsv.0",e.MUTE_PUBLISH_STREAM_AUDIO="zc.mpsa.0",e.MUTE_MIC="zc.mm",e.MUTE_PLAY_STREAM_VIDEO="zc.mpsv.1",e.MUTE_PLAY_STREAM_AUDIO="zc.mpsa.1",e.ADD_TRACK="zc.at",e.REMOVE_TRACK="zc.rt",e.HANDLE_TRACK="zc.ht"}(t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={}))},4495:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AdvancedModule=void 0;var s=r(2367),a=r(5098),u=r(8706),l=function(){function e(e,t,r,n){this.logger=e,this.dataReport=t,this.streamCenter=r,this.stateCenter=n,this.screenShotReady=!1}return e.prototype.setVideoConfig=function(e,t){var r=this;return this.logger.info(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" call"),new Promise(function(n,o){var i=r.stateCenter.getReportSeq();return r.dataReport.newReport(i,u.ZegoRTCLogEvent.kZegoSetVideoConfig.event),e instanceof MediaStream?t&&"object"==typeof t&&0!=Object.keys(t).length?t.width&&!r.stateCenter.checkValidNumber(t.width)?(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints width integer number, range[1, 10000]"),r.dataReport.addMsgInfo(i,{error:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints width integer number, range[1, 10000]"}),r.dataReport.uploadReport(i),void o({errorCode:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):t.height&&!r.stateCenter.checkValidNumber(t.height)?(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints height integer number, range[1, 10000]"),r.dataReport.addMsgInfo(i,{error:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,message:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints height integer number, range[1, 10000]"}),r.dataReport.uploadReport(i),void o({errorCode:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):void r.setPublishStreamConstraints(e,t,function(e){r.dataReport.uploadReport(i),n(e)}):(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" constraints wrong"),r.dataReport.addMsgInfo(i,u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError),r.dataReport.uploadReport(i),void o({errorCode:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" constraints wrong"})):(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_VIDEO_CONFIG+" localStream not found"),r.dataReport.addMsgInfo(i,u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kLocalStreamError),r.dataReport.uploadReport(i),void o({errorCode:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoSetVideoConfig.error.kParamError.message+" localStream no found"}))})},e.prototype.setAudioConfig=function(e,t){var r=this;return this.logger.info(s.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" call"),new Promise(function(n){var o=r.stateCenter.getReportSeq();return r.dataReport.newReport(o,u.ZegoRTCLogEvent.kZegoSetAudioConfig.event),e instanceof MediaStream?!t||"object"!=typeof t||0==Object.keys(t).length||void 0!==t.AEC&&"boolean"!=typeof t.AEC||void 0!==t.AGC&&"boolean"!=typeof t.AGC||void 0!==t.ANS&&"boolean"!=typeof t.ANS?(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" constraints wrong"),r.dataReport.addMsgInfo(o,u.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),r.dataReport.uploadReport(o),void n({errorCode:u.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" constraints wrong"})):void r.setPublishStreamConstraints(e,t,function(e){r.dataReport.uploadReport(o),n(e)}):(r.logger.error(s.ZEGO_WEBRTC_ACTION.SET_AUDIO_CONFIG+" localStream not found"),r.dataReport.addMsgInfo(o,u.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError),r.dataReport.uploadReport(o),void n({errorCode:u.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoSetAudioConfig.error.kParamError.message+" localStream no found"}))})},e.prototype.enableStream=function(e,t){if(this.logger.info(s.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" call"),"boolean"!=typeof t.video&&"boolean"!=typeof t.audio)return this.logger.error(s.ZEGO_WEBRTC_ACTION.ENABLE_STREAM+" option error"),!1;var r=!0,n=!0;return"boolean"==typeof t.video&&(r=this.enableCamera(e,t.video,t.retain)),"boolean"==typeof t.audio&&(n=this.enableMicrophone(e,t.audio)),r&&n},e.prototype.enableMicrophoneOnly=function(e){if(this.logger.info(s.ZEGO_WEBRTC_ACTION.ENABLE_MIC_ONLY+" call"),"boolean"!=typeof e)return!1;for(var t=0;t<this.streamCenter.previewStreamList.length;t++)if(!this.streamCenter.previewStreamList[t].enableMicrophoneOnly(e,this.streamCenter))return this.logger.error("zsc.emo.0 previewer "+t+" change mic mute state failed"),!1;return this.streamCenter.isMicEnabled=e,!0},e.prototype.replaceTrack=function(e,t){return o(this,void 0,void 0,function(){var r,n;return i(this,function(o){return r=this.stateCenter.getReportSeq(),this.dataReport.newReport(r,u.ZegoRTCLogEvent.kZegoReplaceTrack.event),e instanceof MediaStream?t&&t instanceof MediaStreamTrack?(n=this._replaceTrack(e,t),this.dataReport.uploadReport(r),[2,n]):(this.logger.error(s.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" mediastream track no found"),this.dataReport.uploadReport(r,void 0,u.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),[2,{errorCode:u.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" mediastream track no found"}]):(this.logger.error(s.ZEGO_WEBRTC_ACTION.REPLACE_TRACK+" localStream not found"),this.dataReport.uploadReport(r,void 0,u.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError),[2,{errorCode:u.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" localStream no found"}])})})},e.prototype.setPublishStreamConstraints=function(e,t,r){var n=this,o=null;for(var i in this.logger.info("zsc.spsc.0 constraints",JSON.stringify(t)),this.streamCenter.publisherList)this.streamCenter.publisherList[i].localStream==e&&(o=this.streamCenter.publisherList[i]);if(!o)return this.logger.error("zsc.spsc.0 publisher not found"),void(r&&r({errorCode:a.errorCodeList.PUBLISH_NOT_PUBLISH.code,extendedData:a.errorCodeList.PUBLISH_NOT_PUBLISH.message}));this.logger.info("zsc.spsc.0 streamId ",o.streamID);var s=null==o?void 0:o.publisher.previewer;if(!s)return this.logger.error("zsc.spsc.0 preview no found"),void(r&&r({errorCode:a.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:a.errorCodeList.PUBLISH_NO_PREVIEW.message}));var u=!1,l=!1;(t.width||t.height||t.frameRate)&&(s.mediaStreamConfig.videoQuality=4,u=!0),void 0===t.ANS&&void 0===t.AGC&&void 0===t.AEC||(l=!0);var c=s.localStream,d=s.videoTrack,h=s.audioTrack;u&&!d?(this.logger.error("zsc.spsc.0 video track not found"),r&&r({errorCode:a.errorCodeList.TRACK_NOT_FOUND.code,extendedData:a.errorCodeList.TRACK_NOT_FOUND.message})):t.video=!0,l&&!h?(this.logger.error("zsc.spsc.0 audio track not found"),r&&r({errorCode:a.errorCodeList.TRACK_NOT_FOUND.code,extendedData:a.errorCodeList.TRACK_NOT_FOUND.message})):t.audio=!0;var p=JSON.parse(JSON.stringify(s.mediaStreamConfig)),f=Object.assign(s.mediaStreamConfig,t),g=s.getMediaStreamConstraints(f,!0);this.logger.info("zsc.spsc.0 applyConstraints ",JSON.stringify(g));var _=[];if(u&&_.push(d.applyConstraints(g.video)),l&&(h.stop(),_.push(navigator.mediaDevices.getUserMedia({video:!1,audio:g.audio}))),t.maxBitrate){var m=o.publisher.peerConnection.getSenders().find(function(e){return e.track&&"video"===e.track.kind}),v=m.getParameters();m?(v.encodings||(v.encodings=[{}]),v.encodings[0].maxBitrate=1e3*t.maxBitrate,_.push(m.setParameters(v))):this.logger.error("zsc.spsc.0 video sender no found")}if(_.length>0)Promise.all(_).then(function(e){if(n.logger.info("zsc.spsc.0 set constraints success",e[1]),l){var i=(u?e[1]:e[0]).getAudioTracks()[0];i.enabled=0===o.publisher.mic_status;var s=o.publisher.peerConnection.getSenders().find(function(e){return"audio"===e.track.kind});if(s&&(s.replaceTrack(i),c)){var a=n.streamCenter.checkPreview(c);a&&(a.replacePreviewTrack(i),a.gainNode=null)}}t.maxBitrate&&o.publisher&&(o.publisher.videoInfo.bitRate=t.maxBitrate),r&&r({errorCode:0,extendedData:""})}).catch(function(e){n.logger.error("zsc.spsc.0 fail reason ",e.name,JSON.stringify(e)),r&&r({errorCode:a.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:e.name+" "+(e.constraint?"constraint:"+e.constraint:"")})});else{if(this.logger.warn("zsc.spsc.0 constaints is no changes"),l){var E=s.getMediaStreamConstraints(p);this.logger.info("zsc.spsc.0 oldMediaStreamConstraints ",JSON.stringify(E)),navigator.mediaDevices.getUserMedia({video:!1,audio:E.audio}).then(function(e){var t=e.getAudioTracks()[0],r=o.publisher.peerConnection.getSenders().find(function(e){return null!==e.track&&e.track.kind===h.kind});if(r){r.replaceTrack(t);var i=n.streamCenter.checkPreview(c);i&&i.replacePreviewTrack(t)}n.logger.info("zsc.spsc.0.1 setbackup suc ")}).catch(function(e){n.logger.error("zsc.spsc.0.1 setbackup fail "+e.name)})}r&&r({errorCode:a.errorCodeList.PUBLISHER_CONSTRAINTS_ERROR.code,extendedData:"constraints is no changes"})}},e.prototype.useVideoDevice=function(e,t){var r=this;return this.logger.info("zc.uvd.0 call"),new Promise(function(n){var o=r.stateCenter.getReportSeq();if(r.dataReport.newReport(o,u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.event),r.dataReport.addMsgInfo(o,{device:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.device(t)}),!(e instanceof MediaStream))return r.logger.error("zc.uvd.0 localStream not found"),r.dataReport.addMsgInfo(o,u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kLocalStreamError),r.dataReport.uploadReport(o),void n({errorCode:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});if("string"!=typeof t)return r.logger.error("zc.uvd.0 deviceID must be string"),r.dataReport.addMsgInfo(o,{error:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,message:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message+" deviceID must be string"}),r.dataReport.uploadReport(o),void n({errorCode:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.code,extendedData:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kParamError.message});var i=function(t){var i,s;r.dataReport.uploadReport(o);var a=r.streamCenter.checkPublish(e);a&&(a.cameraLabel=(null===(s=null===(i=a.publisher.previewer)||void 0===i?void 0:i.videoTrack)||void 0===s?void 0:s.label)||a.cameraLabel),n(t)};r.stateCenter.getDevices(function(o){if(!o.cameras.find(function(e){return e.deviceID==t}))return r.logger.error("zc.uvd.0 device is not found"),void n({errorCode:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.code,extendedData:u.ZegoRTCLogEvent.kZegoTaskUseVideoDevice.error.kDevicesNoFoundError.message});r.switchDevice("video",e,t,i)},function(n){r.logger.warn("zc.uvd.0 getDevices err:",n),r.switchDevice("video",e,t,i)})})},e.prototype.useAudioDevice=function(e,t){var r=this;return this.logger.info("zc.uad.1 call"),new Promise(function(n){var o=r.stateCenter.getReportSeq();r.dataReport.newReport(o,u.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.event),r.dataReport.addMsgInfo(o,{device:u.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.device(t)});var i=function(e,t){r.logger.error("zc.uad.1 "+t);var i=e;i.message=i.message+(t?" "+t:""),r.dataReport.addMsgInfo(o,i),r.dataReport.uploadReport(o),n({errorCode:i.code,extendedData:i.message})},s=function(t){var i;r.dataReport.uploadReport(o);var s=r.streamCenter.checkPublish(e);s&&(s.microLabel=(null===(i=e.getAudioTracks()[0])||void 0===i?void 0:i.label)||s.microLabel),n(t)};e instanceof MediaStream?"string"==typeof t?r.stateCenter.getDevices(function(o){if(!o.microphones.find(function(e){return e.deviceID==t}))return r.logger.error("zc.uad.1 device is not found"),void n({errorCode:u.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.code,extendedData:u.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kDevicesNoFoundError.message});r.switchDevice("audio",e,t,s)},function(n){r.logger.warn("zc.uad.1 getDevices err:",n),r.switchDevice("audio",e,t,s)}):i(u.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kParamError,"deviceID must be string"):i(u.ZegoRTCLogEvent.kZegoTaskUseAudioDevice.error.kLocalStreamError,"localStream not found")})},e.prototype.publishTarget=function(e){var t=this,r=this.stateCenter.getReportSeq();switch(e.type){case"addpush":this.dataReport.newReport(r,u.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case"delpush":case"clearpush":this.dataReport.newReport(r,u.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(r,{stream:u.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(e.streamID),target_url:u.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(e.pushUrl)}),new Promise(function(n,o){var i=function(e,n){t.logger.error("zb.pt"+(n||e.message)),t.dataReport.addMsgInfo(r,{error:e.code,message:e.message+(n||"")}),t.dataReport.uploadReport(r),o({errorCode:e.code,extendedData:e.message+(n?" "+n:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return t.logger.error("zb.sh.pt cdn push type error"),void i(a.errorCodeList.PUBLISHER_CDN_PUSH_ERROR,"type error");if(e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(t.stateCenter.publishStreamList[e.streamID]){var s=t.streamCenter.getRoomByStreamID(e.streamID);s?s.streamHandler._publishTarget(e,function(e){t.dataReport.uploadReport(r),n(e)},i):i(u.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoLoginError)}else i(u.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);else i(u.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error");else i(u.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error")})},e.prototype.handleTrack=function(e,t,r,n,u){var l;return o(this,void 0,void 0,function(){var c,d,h,p,f,g,_,m,v,E,T=this;return i(this,function(y){switch(y.label){case 0:return t instanceof MediaStream?r instanceof MediaStreamTrack&&"audio"!=r.kind?(c=this.streamCenter.checkPreview(t))?"video"===r.kind&&(null===(l=c.videoEffect)||void 0===l?void 0:l.enabled)?(this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" need to disable video beauty effect first"),u&&u({errorCode:a.errorCodeList.VIDEO_EFFECT_IS_RUNNING.code,extendedData:"need to disable video beauty effect before add or remove track"}),[2]):"ADD"==e&&(t.getTracks().length>=2||t.getTracks().find(function(e){return e.kind==r.kind}))?(this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" only stream which have one track and kind no exist can add track"),u&&u({errorCode:a.errorCodeList.TRACK_CAN_NOT_ADD.code,extendedData:a.errorCodeList.TRACK_CAN_NOT_ADD.message}),[2]):"REMOVE"!=e||1!=t.getTracks().length&&t.getTracks().includes(r)?!(d=this.streamCenter.checkPublish(t))||5===d.publisher.stateNego&&1!=d.publisher.isUpdateSDP?d?(p=c,f=d.publisher.peerConnection,(h=d.publisher).isUpdateSDP=!0,"ADD"!=e?[3,1]:(f.addTrack(r,t),[3,4])):[3,6]:(this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" publish state wrong"),u&&u({errorCode:a.errorCodeList.PUBLISHER_STATE_WRONG.code,extendedData:a.errorCodeList.PUBLISHER_STATE_WRONG.message}),[2]):(this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" not supported"),u({errorCode:a.errorCodeList.HANDLE_TRACK_NOT_SUPPORTED.code,extendedData:a.errorCodeList.HANDLE_TRACK_NOT_SUPPORTED.message}),[2]):(this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" stream no found"),u&&u({errorCode:a.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:a.errorCodeList.PUBLISH_NO_PREVIEW.message}),[2]):(this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" only can handle video track"),u({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:a.errorCodeList.INPUT_PARAM.message}),[2]):(this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" stream wrong"),u({errorCode:a.errorCodeList.INPUT_PARAM.code,extendedData:a.errorCodeList.INPUT_PARAM.message}),[2]);case 1:return window.RTCPeerConnection&&window.RTCPeerConnection.prototype.getTransceivers&&window.RTCRtpTransceiver.prototype.stop?[4,f.getSenders().find(function(e){return e.track&&e.track==r})]:(this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" not supported getTransceivers"),u({errorCode:a.errorCodeList.HANDLE_TRACK_NOT_SUPPORTED.code,extendedData:a.errorCodeList.HANDLE_TRACK_NOT_SUPPORTED.message}),[2]);case 2:return g=y.sent(),[4,f.getTransceivers().find(function(e){return e.sender==g})];case 3:if(_=y.sent(),!(g&&_&&_.stop))return this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" sender no found"),u&&u({errorCode:a.errorCodeList.TRACK_NOT_FOUND.code,extendedData:a.errorCodeList.TRACK_NOT_FOUND.message}),[2];try{f.removeTrack(g),_.stop()}catch(e){this.logger.error(s.ZEGO_WEBRTC_ACTION.HANDLE_TRACK+" "+e),e&&e({errorCode:a.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL.code,extendedData:a.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL.message+" "+e})}y.label=4;case 4:return m={},v=this.streamCenter.previewStreamList.find(function(e){return e.localStream.getTracks().find(function(e){return e==r})}),m=v&&"ADD"==e?v.videoInfo:{},[4,f.createOffer()];case 5:return E=y.sent(),h.onCreateOfferSuccess(E,!0,m,function(s){return o(T,void 0,void 0,function(){var o;return i(this,function(i){return 0!==s?u&&u({errorCode:a.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL.code,extendedData:a.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL.message}):(o="video"==r.kind?"videoTrack":"audioTrack","ADD"==e?(t.addTrack(r),p[o]=r,"video"==r.kind&&1==r.enabled?h.sendStreamStatus(0,h.mic_status):1==r.enabled&&h.sendStreamStatus(h.camera_status,0)):("video"==r.kind?h.sendStreamStatus(2,h.mic_status):h.sendStreamStatus(h.camera_status,2),t.removeTrack(r),p[o]=null),c.mediaStreamConfig.video="ADD"==e,n({errorCode:0,extendedData:""})),[2]})})}),[3,7];case 6:"ADD"==e?t.addTrack(r):t.removeTrack(r),n({errorCode:0,extendedData:""}),c.mediaStreamConfig.video="ADD"==e,y.label=7;case 7:return[2]}})})},e.prototype.switchDevice=function(e,t,r,o){var i=this,s=this.streamCenter.checkPublish(t);if(s&&s.publisher&&5!==s.publisher.stateNego)return this.logger.error("zsc.sd.0 stream is publishing"),void(o&&o({errorCode:a.errorCodeList.PUBLISHER_STREAM_NO_FOUND.code,extendedData:a.errorCodeList.PUBLISHER_STREAM_NO_FOUND.message}));var u=this.streamCenter.checkPreview(t);if(!u)return this.logger.error("zsc.sd.0 preview no found"),void(o&&o({errorCode:a.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:a.errorCodeList.PUBLISH_NO_PREVIEW.message}));if("video"===e&&0==u.mediaStreamConfig.video)return this.logger.error("zsc.sd.0 camera can not be changed when video is false"),void(o&&o({errorCode:a.errorCodeList.VIDEO_DEVICE_FALSE.code,extendedData:a.errorCodeList.VIDEO_DEVICE_FALSE.message}));if("audio"===e&&0==u.mediaStreamConfig.audio)return this.logger.error("zsc.sd.0 microphone can not be changed when audio is false"),void(o&&o({errorCode:a.errorCodeList.AUDIO_DEVICE_FALSE.code,extendedData:a.errorCodeList.AUDIO_DEVICE_FALSE.message}));u.mediaStreamConfig.videoInput!==r&&delete u.mediaStreamConfig.facingMode;var l,c={};"video"===e?(c.videoInput=r,l=u.videoTrack):(c.audioInput=r,l=u.audioTrack);var d=this.stateCenter.browser;this.logger.info("zsc.sd.0 browser "+d),"firefox"===d&&l.stop();var h=n(n({},u.mediaStreamConfig),c),p=u.getMediaStreamConstraints(h),f=function(t,r){r.getTracks().forEach(function(t){if(t.kind===e){var r=u["video"===e?"videoTrack":"audioTrack"];t.enabled=r.enabled,r&&r.stop(),s?s.publisher.replacePublishedTrack(t):u&&u.replacePreviewTrack(t)}}),u.restartSoundLevel()};"audio"==e?p.video=!1:p.audio=!1,navigator.mediaDevices.getUserMedia(p).then(function(t){Object.assign(u.mediaStreamConfig,c),f(0,t),i.logger.info("zsc.sd.0 swtich "+e+" device success"),o&&o({errorCode:0,extendedData:""})},function(t){var r,n;"video"==e?null===(r=u.videoTrack)||void 0===r||r.stop():null===(n=u.audioTrack)||void 0===n||n.stop(),i.logger.warn("zsc.sd.0 swtich "+e+" device failed, stop last device and retry. ",t+""),navigator.mediaDevices.getUserMedia(p).then(function(t){Object.assign(u.mediaStreamConfig,c),f(0,t),i.logger.info("zsc.sd.0 swtich "+e+" device success"),o&&o({errorCode:0,extendedData:""})},function(t){i.logger.warn("zsc.sd.0 swtich "+e+" device failed and recover last device. ",t+"");var r=u.getMediaStreamConstraints(u.mediaStreamConfig),n=a.errorCodeList.VIDEO_DEVICE_FALSE;"audio"===e&&(n=a.errorCodeList.AUDIO_DEVICE_FALSE),navigator.mediaDevices.getUserMedia(r).then(function(r){f(0,r),i.logger.info("zsc.sd.0 recover last "+e+" device success"),o&&o({errorCode:n.code,extendedData:n.message+" "+JSON.stringify(t)})},function(t){i.logger.error("zsc.sd.0 swtich "+e+" device and recover failed, please recreate stream. ",t+""),o&&o({errorCode:n.code,extendedData:n.message+" "+JSON.stringify(t)})})})})},e.prototype._replaceTrack=function(e,t){var r=this.streamCenter.checkPreview(e),n=this.streamCenter.checkPublish(e);return n?n.publisher.replacePublishedTrack(t):r?r.localStream.getTracks().find(function(e){return e.kind===t.kind})?(r.replacePreviewTrack(t),{errorCode:0,extendedData:""}):(this.logger.error("zc.rt.0 track no found"),{errorCode:a.errorCodeList.TRACK_NOT_FOUND.code,extendedData:a.errorCodeList.TRACK_NOT_FOUND.message}):(this.logger.error("zc.rt.0 preview no found"),{errorCode:a.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:a.errorCodeList.PUBLISH_NO_PREVIEW.message})},e.prototype.enableMicrophone=function(e,t){var r=this.streamCenter.checkPreview(e);return r?r.enableMicrophone(t,this.streamCenter):(this.logger.error("zsc.em.0 no preview"),!1)},e.prototype.enableCamera=function(e,t,r){var n=this.streamCenter.checkPreview(e);return n?n.enableCamera(t,this.streamCenter,r):(this.logger.error("zsc.ec.0 no preview"),!1)},e}();t.AdvancedModule=l},4378:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.signal=t.publisher=t.publishModule=t.playModule=t.preview=t.streamHandler=t.zegoWebRTC=t.ENUM_PUBLISH_STREAM_STATE=t.ENUM_STREAM_CMD_PRI=t.ENUM_STREAM_SUB_CMD=t.PROTO_VERSION=void 0;var s=r(2367),a=r(5098),u=r(8706),l=r(7248);t.PROTO_VERSION="2.14.0",t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.zegoWebRTC={mutePublishStreamVideo:function(e,t,r){this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" call");var n=this.stateCenter.getReportSeq();if(this.dataReport.newReport(n,u.ZegoRTCLogEvent.kZegoTaskMutePublishVideo),"boolean"!=typeof t||void 0!==r&&"boolean"!=typeof r)return this.logger.error(s.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" option error"),!1;var o=this.rtcModules.advancedModule.enableStream(e,{video:!t,retain:r});return this.dataReport.uploadReport(n),this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_VIDEO+" end"),o},mutePublishStreamAudio:function(e,t){this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" call");var r=this.stateCenter.getReportSeq();if(this.dataReport.newReport(r,u.ZegoRTCLogEvent.kZegoTaskMutePublishAudio),"boolean"!=typeof t)return this.logger.error(s.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" option error"),!1;var n=this.rtcModules.advancedModule.enableStream(e,{audio:!t});return this.dataReport.uploadReport(r),this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_PUBLISH_STREAM_AUDIO+" end"),n},mutePlayStreamVideo:function(e,t){this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" call "+e+" "+t);var r=this.stateCenter.getReportSeq();this.dataReport.newReport(r,u.ZegoRTCLogEvent.kZegoTaskMutePlayVideo);var n=this.rtcModules.playModule.mutePlayStream(e,"video",t);return this.dataReport.uploadReport(r),this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_VIDEO+" end"),n},mutePlayStreamAudio:function(e,t){this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+" call "+e+" "+t);var r=this.stateCenter.getReportSeq();this.dataReport.newReport(r,u.ZegoRTCLogEvent.kZegoTaskMutePlayAudio);var n=this.rtcModules.playModule.mutePlayStream(e,"audio",t);return this.dataReport.uploadReport(r),this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_PLAY_STREAM_AUDIO+"end"),n},muteMicrophone:function(e){this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_MIC+" call");var t=this.stateCenter.getReportSeq();if(this.dataReport.newReport(t,u.ZegoRTCLogEvent.kZegoTaskMuteMicrophone),"boolean"!=typeof e)return this.logger.error(s.ZEGO_WEBRTC_ACTION.MUTE_MIC+" option error"),!1;var r=this.rtcModules.advancedModule.enableMicrophoneOnly(!e);return this.dataReport.uploadReport(t),this.logger.info(s.ZEGO_WEBRTC_ACTION.MUTE_MIC+" end"),r},activateSEIInsert:function(e){return this.rtcModules.publishModule.activateSEIInsert(e.stream,e.action,e.infoType)},getAudioInfo:function(e,t,r){if(!e)return this.logger.error("localStream is empty!"),!1;var o=n({},r);return new l.MediaUtil(this.ac,o).connectToSource(e,function(e){t(e)})},startRecord:function(e){var t=this,r=this.streamCenter.checkPreview(e);if(r){var n=e.clone(),o=n.getAudioTracks();o.length>0&&r.hasEmptyAudioTrack&&o.forEach(function(e){n.removeTrack(e)}),this.recordedBlobs=[];var i={mimeType:"video/webm;codecs=vp9"};MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:"video/webm;codecs=vp8,opus"},MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:"video/webm"},MediaRecorder.isTypeSupported(i.mimeType)||(i={mimeType:""}))));try{this.mediaRecorder=new MediaRecorder(n,i)}catch(e){return void this.logger.error("Exception while creating ZegoMediaRecorder:",e)}this.mediaRecorder.onstop=function(e){t.logger.warn("Recorder stopped: "+e)},this.mediaRecorder.ondataavailable=this.handleDataAvailable.bind(this),this.mediaRecorder.start(10)}else this.logger.error("stream is not from zego!")},stopRecord:function(){this.mediaRecorder?this.mediaRecorder.stop():this.logger.warn("please invoke startRecord first")},resumeRecord:function(){this.mediaRecorder?this.mediaRecorder.resume():this.logger.warn("please invoke startRecord first")},pauseRecord:function(){this.mediaRecorder?this.mediaRecorder.pause():this.logger.warn("please invoke startRecord first")},saveRecord:function(e){if(this.mediaRecorder&&this.recordedBlobs){var t=new Blob(this.recordedBlobs,{type:"video/webm"}),r=window.URL.createObjectURL(t),n=document.createElement("a");n.style.display="none",n.href=r,n.download=e+".webm",document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),window.URL.revokeObjectURL(r)},100)}else this.logger.warn("please invoke startRecord first")},handleDataAvailable:function(e){e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)},takeSnapShot:function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var n=r.getContext("2d");n&&n.drawImage(e,0,0,r.width,r.height),t.src=r.toDataURL("image/jpeg")}else this.logger.error("video can not empty")},saveSnapShot:function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var n=r.getContext("2d");n&&n.drawImage(e,0,0,r.width,r.height),r.toBlob(function(e){var r=window.URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=r,n.download=t+".jpeg",document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),window.URL.revokeObjectURL(r)},100)})}else this.logger.error("video can not empty")},setStreamExtraInfo:function(e,t){var r=this;return new Promise(function(n,o){var i=r.stateCenter.getReportSeq();r.dataReport.newReport(i,u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),r.dataReport.addMsgInfo(i,{stream:u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(e),stream_extra_info:u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(t)});var s=function(e,t){r.logger.error("zb.ssei "+t),r.dataReport.addMsgInfo(i,{error:e.code,message:e.message+" "+t}),r.dataReport.uploadReport(i),o({errorCode:e.code,extendedData:e.message+" "+t})};if("string"==typeof e&&""!=e)if("string"==typeof t&&""!=t)if(r.RTM.service.isDisConnect())s(u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login");else if(r.stateCenter.publishStreamList[e]){var a=r.streamCenter.getRoomByStreamID(e);a?(r.dataReport.addMsgInfo(i,{room_sid:u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(a.sessionID)}),a.streamHandler.setStreamExtraInfo(e,t,n,s),r.dataReport.uploadReport(i)):s(u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login")}else s(u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError,"publish stream no found");else s(u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"extraInfo must be string and no empty");else s(u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"streamID must be string and not empty")})},addTrack:function(e,t){var r=this;return new Promise(function(n,o){r.logger.info(s.ZEGO_WEBRTC_ACTION.ADD_TRACK+" call"),r.rtcModules.advancedModule.handleTrack("ADD",e,t,n,o)})},removeTrack:function(e,t){var r=this;return new Promise(function(n,o){r.logger.info(s.ZEGO_WEBRTC_ACTION.REMOVE_TRACK+" call"),r.rtcModules.advancedModule.handleTrack("REMOVE",e,t,n,o)})}},t.streamHandler={_publishTarget:function(e,r,n){var o=this;this.logger.info("zb.sh.ptcall");var i=Math.ceil((new Date).getTime()/1e3),s=e.streamID;this.stateCenter.testEnvironment&&(s="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var l={appid:this.stateCenter.appid,biz_type:0,timestamp:i,seq:this.stateCenter.cdnSeq++,version:1*t.PROTO_VERSION,stream_id:s,pushurl:e.pushUrl},c={channel:"media",cmd:e.type,req_body:JSON.stringify(l)};this.logger.debug("zb.sh.pt send command"),this.sendBizChannelRequest(c,function(t,i,s){if(o.logger.info("zb.sh.pt receive message"),0!=s.length){var l=JSON.parse(s),c=l.code,d=l.message;c&&0!=c?(o.logger.error("zb.sh.pt "+e.type+" error code: "+c+" "+d),n(a.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: "+e.type+" "+c+" "+d)):(o.logger.info("zb.sh.pt "+e.type+" success"),r&&r({errorCode:0,extendedData:""}))}else n(u.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoResponseError)},function(t,r,i){o.logger.info("zb.sh.pt error: "+t);var s=u.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError;2001==t||2002==t&&(s=u.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),o.logger.error("zb.sh.pt "),n(s," cmd: "+e.type+" "+t+"   ")})},updateStreamExtraInfo:function(e,r,n,o){var i;this.logger.info("zb.sh.usei call"),i="PUBLIC"===this.stateCenter.type?t.ENUM_STREAM_SUB_CMD.liveUpdate:t.ENUM_STREAM_CMD_PRI.liveUpdate,this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state>=t.ENUM_PUBLISH_STREAM_STATE.update_info?(this.stateCenter.publishStreamList[e].extra_info=r,this.updateStreamInfo(e,i,r),n({errorCode:0})):o(u.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kUpdateStreamInfoFailError)},setStreamExtraInfo:function(e,t,r,n){this.updateStreamExtraInfo(e,t,r,n)}},t.preview={enableCamera:function(e,t,r){var n,o,i=this;if(!this.localStream)return this.logger.error("zp.ec.2 no localStream"),!1;var s=this.videoTrack;if(r&&!e||!s)r&&!e&&((null===(n=this.videoEffect)||void 0===n?void 0:n.enabled)?this.logger.warn("zp.ec.2 Unable to keep the preview screen when beauty is turned on"):(this.cloneVideoTrack&&this.cloneVideoTrack.stop(),this.cloneVideoTrack=this.videoTrack.clone(),this.cloneVideoTrack.enabled=!0,this.replacePreviewTrack(this.cloneVideoTrack,!1,{retainTrack:!0})));else if("chrome"===this.stateCenter.browser&&e&&void 0!==typeof s.getSettings().width&&s.getSettings().width>0&&navigator.userAgent){var a=0,u=navigator.userAgent.toLowerCase().match(/chrome\/([\d.]+)/)[1];if(u&&(a=parseInt(u.split(",")[0])),a&&a>=87&&a<92){var l=s.getSettings().width-1,c=s.getSettings().height-1,d=s.getSettings().frameRate;s.applyConstraints({width:l,height:c,frameRate:d}).then(function(){s.applyConstraints({width:i.videoInfo.width,height:i.videoInfo.height,frameRate:d})})}}null==s||(s.enabled=e);var h=null===(o=t.checkPublish(this.localStream))||void 0===o?void 0:o.publisher;if(h){var p=this.videoTrack&&"live"===this.videoTrack.readyState?e?0:20:2,f=h.mic_status;h.camera_status===p&&h.mic_status===f||h.sendStreamStatus(p,f)}return this.logger.info("zp.ec.2 call success"),!0},enableMicrophone:function(e,t){var r;if(!this.localStream)return this.logger.error("zp.em.2 no localStream"),!1;this.localStream.getAudioTracks().forEach(function(t){t.enabled=e}),this.audioTrack&&(this.audioTrack.enabled=e&&t.isMicEnabled);var n=null===(r=t.checkPublish(this.localStream))||void 0===r?void 0:r.publisher;if(n&&n.signal){var o=n.camera_status,i=e&&t.isMicEnabled?0:20;n.camera_status===o&&n.mic_status===i||n.sendStreamStatus(o,i)}return this.isAudioEnabled=e,this.logger.debug("zp.em.2 call success"),!0},replacePreviewTrack:function(e,t,r){var n;return void 0===t&&(t=!1),o(this,void 0,void 0,function(){var o,s,a;return i(this,function(i){switch(i.label){case 0:return e&&e.kind&&this.localStream?(o=!0===(null==r?void 0:r.retainTrack),s="audio"===e.kind?"audioTrack":"videoTrack",t||!(null===(n=this.videoEffect)||void 0===n?void 0:n.enabled)||"video"!==e.kind?[3,3]:o?[3,2]:[4,this.videoEffect.setInput(e)]):[2];case 1:i.sent(),i.label=2;case 2:return[3,4];case 3:(a=this.localStream.getTracks().find(function(t){return t.kind===e.kind}))&&this.localStream.removeTrack(a),this.localStream.addTrack(e),i.label=4;case 4:return t||o||(this[s]=e),[2]}})})}},t.playModule={mutePlayStream:function(e,t,r){var n=this;return this.logger.info("zsc.mps.0 call "+t+" "+r),new Promise(function(o,i){if("string"!=typeof e||""==e)return n.logger.error("zsc.mps.0 streamID must be string and not empty"),void i(!1);if("boolean"!=typeof r)return n.logger.error("zsc.mps.0 mute must be boolean"),void i(!1);var s=n.streamCenter.playerList[e];if(!s)return n.logger.error("zsc.mps.0 player not found"),void i(!1);if("video"===t){if(s.playOption&&!1===s.playOption.video||s.player&&0!==s.player.cameraStatus)return n.logger.error("zsc.mps.0 stream no contain video"),void i(!1);s.player.signal.ActivatePlayVideoStream(n.stateCenter.getSeq(),s.player.sessionId,r,function(){n.logger.info("zsc.mps.0 suc");var e=n.stateCenter.getReportSeq();s.player.playMediaStatus.video=!r,n.dataReport.newReport(e,u.ZegoRTCLogEvent.kZegoPlayContentChanged.event),n.dataReport.addMsgInfo(e,{session_id:u.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(s.player.sessionId),video_activate:u.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(s.player.playMediaStatus.video?1:0),audio_activate:u.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(s.player.playMediaStatus.audio?1:0)}),n.playVideoStatus=n.dataReport.uploadReport(e),o(!0)},function(){n.logger.error("zsc.mps.0 fail"),i(!1)})}else if("audio"===t){if(s.playOption&&!1===s.playOption.audio||s.player&&0!==s.player.micStatus)return n.logger.error("zsc.mps.0 stream no contain audio"),void i(!1);s.player.signal.ActivatePlayAudioStream(n.stateCenter.getSeq(),s.player.sessionId,r,function(){n.logger.info("zsc.mps.0 suc");var e=n.stateCenter.getReportSeq();s.player.playMediaStatus.audio=!r,n.dataReport.newReport(e,u.ZegoRTCLogEvent.kZegoPlayContentChanged.event),n.dataReport.addMsgInfo(e,{session_id:u.ZegoRTCLogEvent.kZegoPlayContentChanged.session_id(s.player.sessionId),video_activate:u.ZegoRTCLogEvent.kZegoPlayContentChanged.video_activate(s.player.playMediaStatus.video?1:0),audio_activate:u.ZegoRTCLogEvent.kZegoPlayContentChanged.audio_activate(s.player.playMediaStatus.audio?1:0)}),n.dataReport.uploadReport(e),o(!0)},function(){n.logger.error("zsc.mps.0 fail"),i(!1)})}else i(!1)})},setStreamAudioOutput:function(e,t){var r=this;return!(null==t||0==t.length||!e||(this.logger.debug("zsc.ssao.0 device "+t),e?"undefined"!==e.sinkId?(e.setSinkId(t).then(function(){r.logger.info("zsc.ssao.0 success device: "+t)}).catch(function(e){r.logger.info("zsc.ssao.0 "+e.name)}),0):(this.logger.error("zsc.ssao.0 browser does not suppport"),1):(this.logger.error("zsc.ssao.0 no localVideo"),1)))}},t.publishModule={activateSEIInsert:function(e,t,r){void 0===r&&(r=0);var n=this.streamCenter.checkPreview(e);if(!n)return this.logger.error(s.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" stream is not created"),!1;if(0!==t&&1!==t)return this.logger.error(s.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" value of \u201caction\u201d should be 0 or 1"),!1;n.activatesSEIConfig={action:t,infoType:r};var o=this.streamCenter.checkPublish(e);return o&&(null==o||o.publisher.activateSEIInsert(t,r)),!0}},t.publisher={activateSEIInsert:function(e,t){var r=this;return new Promise(function(n,o){return r.signal?(r.signal&&r.signal.activateSEIInsert(r.stateCenter.getSeq(),r.sessionId,r.peerID,e,t,function(e,t,o){var i=!1;0===o.result?(r.logger.info(s.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" called success"),i=!0):1===o.result?(r.logger.error(s.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" "+o.peer_id+" invalid param."),i=!1):2===o.result&&(r.logger.error(s.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" peer not exist"),i=!1),n(i)},function(e){1===e&&r.logger.error(s.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" request timeout")}),!1):n(!1)})},replacePublishedTrack:function(e,t){var r;return void 0===t&&(t=!1),o(this,void 0,void 0,function(){var n,o,s,u,l,c,d,h,p,f;return i(this,function(i){switch(i.label){case 0:return n=this.localStream,s=null==(o=this.previewer)?void 0:o.videoEffect,l=o[(u=e.kind)+"Track"],c=null===(r=this.peerConnection)||void 0===r?void 0:r.getSenders().find(function(e){return e.track.kind===u}),l?(d=0,h=0,"video"===u?(p=e.readyState,f=e.enabled,t&&(p=l.readyState,f=l.enabled),d="live"!==p?2:!0===f?0:20,h=n.getAudioTracks()[0]&&1==n.getAudioTracks()[0].enabled?0:20):"audio"===u&&(h="live"!==e.readyState?2:!0===e.enabled?0:20,d="live"!==o.readyState?2:!0===o.enabled?0:20),[4,o.replacePreviewTrack(e,t)]):[3,2];case 1:return i.sent(),c?("audio"!==u&&!t&&(null==s?void 0:s.enabled)||c.replaceTrack(e),this.camera_status===d&&this.mic_status===h||this.sendStreamStatus(d,h)):this.logger.info("zc.rt.1 replace remote track will work after stream published"),this.logger.info("zc.rt.1 replace remote track success"),[2,{errorCode:0,extendedData:""}];case 2:return this.logger.error("zc.rt.1 publisher track no found"),[2,{errorCode:a.errorCodeList.TRACK_NOT_FOUND.code,extendedData:a.errorCodeList.TRACK_NOT_FOUND.message}]}})})}},t.signal={activateSEIInsert:function(e,t,r,n,o,i,a){this.logger.info(s.ZEGO_WEBRTC_ACTION.ACTIVATE_SEI_INSERT+" call "+t),this.sendMessageWithCallback("ActivateSEIInsertReq",e,t,{peer_id:r,action:n,info_type:o},i,a)}}},5098:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISH_TARGET_NO_RESPONSE:{code:1103063,message:"publish target no response"},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},INVALID_CHANNEL:{code:1102024,message:"invalid channel"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publishing stream is null"},PUBLISHER_UPDATE_STREAM_INFO_FAIL:{code:1103062,message:"update stream info fail"},TRACK_CAN_NOT_ADD:{code:1103063,message:"only stream which have one track and kind no exist can add track"},TRACK_CAN_NOT_REMOVE:{code:1103064,message:"stream which only has one track can not remove "},PUBLISHER_UPDATE_SDP_FAIL:{code:1103068,message:"update sdp fail"},PUBLISHER_STATE_WRONG:{code:1103069,message:"publisher state wrong"},HANDLE_TRACK_NOT_SUPPORTED:{code:1103070,message:"not support remove track"},VIDEO_EFFECT_IS_RUNNING:{code:1103071,message:"video effect processor is running"}}},3824:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4495),o=r(4378);t.default={type:"Advance",install:function(e,t,r,i,s,a,u,l){for(var c in Object.defineProperty(t.prototype,"initAdvance",{value:function(){this.advancedModule=new n.AdvancedModule(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),o.zegoWebRTC)Object.defineProperty(e.prototype,c,{value:o.zegoWebRTC[c],writable:!1});for(var c in o.streamHandler)Object.defineProperty(r.prototype,c,{value:o.streamHandler[c],writable:!1});for(var c in o.preview)Object.defineProperty(i.prototype,c,{value:o.preview[c],writable:!1});for(var c in o.playModule)Object.defineProperty(s.prototype,c,{value:o.playModule[c],writable:!1});for(var c in o.publishModule)Object.defineProperty(a.prototype,c,{value:o.publishModule[c],writable:!1});for(var c in o.publisher)Object.defineProperty(u.prototype,c,{value:o.publisher[c],writable:!1});for(var c in o.signal)Object.defineProperty(l.prototype,c,{value:o.signal[c],writable:!1})}}},8706:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTCLogEvent=void 0;var n=r(5098),o=function(e){return e};t.ZegoRTCLogEvent={kZegoSetVideoConfig:{event:"/sdk/set_video_config",error:{kParamError:n.errorCodeList.INPUT_PARAM,kLocalStreamError:n.errorCodeList.LOCALSTREAM_WRONG}},kZegoSetAudioConfig:{event:"/sdk/set_audio_config",error:{kParamError:n.errorCodeList.INPUT_PARAM}},kZegoReplaceTrack:{event:"/sdk/replace_track",error:{kParamError:n.errorCodeList.INPUT_PARAM}},kZegoTaskUseVideoDevice:{event:"/device/api/video_c",error:{kParamError:n.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:n.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:n.errorCodeList.LOCALSTREAM_WRONG},device:o},kZegoTaskUseAudioDevice:{event:"/device/api/audio_c",error:{kParamError:n.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:n.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:n.errorCodeList.LOCALSTREAM_WRONG},device:o},kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:n.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:n.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kNoLoginError:n.errorCodeList.NOT_LOGIN,kNoResponseError:n.errorCodeList.PUBLISH_TARGET_NO_RESPONSE,kBizChannelError:n.errorCodeList.BIZ_CHANNEL_ERROR,kInvalidChannelError:n.errorCodeList.INVALID_CHANNEL,kUnknownServerError:n.errorCodeList.UNKNOWN_SERVER_ERROR}},kZegoTaskAddPublishCdnUrl:{event:"/sdk/add_publish_cdn_url",error:{kParamError:n.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:"/sdk/remove_publish_cdn_url",error:{kParamError:n.errorCodeList.INPUT_PARAM},stream:o,target_url:o},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:n.errorCodeList.INPUT_PARAM}},kZegoPlayContentChanged:{event:"/sdk/play_content_changed",session_id:o,video_activate:o,audio_activate:o},kZegoTaskMutePublishVideo:"/sdk/mute_publish_video",kZegoTaskMutePublishAudio:"/sdk/mute_publish_audio",kZegoTaskMuteMicrophone:"/sdk/mute_microphone",kZegoTaskMutePlayVideo:"/sdk/mute_play_video",kZegoTaskMutePlayAudio:"/sdk/mute_play_audio",kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:n.errorCodeList.INPUT_PARAM,kExtraInfoNullError:n.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:n.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:n.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:n.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:o,stream_extra_info:o,room_sid:o}}},7248:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaUtil=void 0;var r=function(){function e(e,t){var r=this,n=t.type,o=t.channels,i=void 0===o?1:o,s=t.bufferSize,a=void 0===s?0:s,u=t.sampleBit,l=void 0===u?16:u,c=t.sampleRate,d=void 0===c?44100:c;this.instant=0,this.slow=0,this.clip=0,this.context=e,this.type=n,this.channels=i,this.bufferSize=a,this.sampleBit=l,this.sampleRate=d,this.script=e.createScriptProcessor(a,i,i),(new Date).getTime(),this.script.addEventListener("audioprocess",function(e){var t,o=e.inputBuffer.getChannelData(0),i=0,s=0;for(t=0;t<o.length;++t)i+=o[t]*o[t],Math.abs(o[t])>.99&&(s+=1);if(r.instant=Math.sqrt(i/o.length),r.slow=.95*r.slow+.05*r.instant,r.clip=s/o.length,"pcm"===n||"wav"===n){for(var a=[],u=0;u<r.channels;u++)a.push(e.inputBuffer.getChannelData(u));r.recorderBuffer(a)}}),"pcm"!==n&&"wav"!==n||this.initRecorderBuffer(n)}return e.prototype.connectToSource=function(e,t){try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),void 0!==t&&t(null)}catch(e){console.error(e),void 0!==t&&t(e)}return this},e.prototype.recorderBuffer=function(e){this.worker.postMessage({command:"record",val:e})},e.prototype.initRecorderBuffer=function(e){var t=this;this.worker=this.inlineWorker(function(){var e,t,r,n,o,i,s=[];function a(e,t,r){for(var n=0;n<r.length;n++,t+=2){var o=Math.max(-1,Math.min(1,r[n]));e.setInt16(t,o<0?32768*o:32767*o,!0)}}function u(e,t,r){for(var n=0;n<r.length;n++,t++){var o=Math.max(-1,Math.min(1,r[n])),i=o<0?128*o:127*o;e.setInt8(t,i+=128)}}function l(e,t,r){for(var n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))}function c(e,t){for(var r=new Float32Array(t.length/e),n=0,o=0;n<r.length;)r[n]=t[o],o+=e,n++;return r}function d(e,t,r){for(var n=new Float32Array(t*e.length),o=0,i=0;i<r[0].length;i++)n.set(r[0][i],o),o+=r[0][i].length;return n}function h(e,t){for(var r=new Float32Array(e.length+t.length),n=0;n<e.length+t.length;n+=2)r[n]=e[n/2>>0],r[n+1]=t[n/2>>0];return r}function p(t){var r,n;if(1==e)r=d(s[0],o,s),1!=t&&(n=c(t,r));else if(2==e){var i=d(s[0],o,s),a=d(s[1],o,s);1!=t?n=h(c(t,i),c(t,a)):r=h(i,a)}return 1!=t?n:r}this.onmessage=function(c){switch(c.data.command){case"init":e=(d=c.data.val).sampleChannel,t=d.sampleBit,r=d.sampleRate,n=d.oldSampleRate,o=d.bufferSize,i=d.type;break;case"record":!function(o){for(var c=0;c<e;c++)s[c]||(s[c]=[]),s[c].push(o[c]);var d=Math.round(n/r);"pcm"===i?function(e){var r=function(e,r){var n;8==r?n=e.length:16==r&&(n=e.length,n*=2);var o=new ArrayBuffer(n),i=new DataView(o);return 8==r?u(i,0,e):16==t&&a(i,0,e),i}(p(e),t);self.postMessage({command:"exportPcmLive",val:r})}(d):"wav"===i&&function(n){var o=function(n,o){var i;8==o?i=n.length:16==t&&(i=n.length,i*=2);var s=new ArrayBuffer(i+44),c=new DataView(s),d=r,h=t,p=e;return l(c,0,"RIFF"),c.setUint32(4,36+i,!0),l(c,8,"WAVE"),l(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,p,!0),c.setUint32(24,d,!0),c.setUint32(28,d*p*(h/8),!0),c.setUint16(32,p*(h/8),!0),c.setUint16(34,h,!0),l(c,36,"data"),c.setUint32(40,i,!0),8==t?u(c,44,n):16==t&&a(c,44,n),c}(p(n),t);self.postMessage({command:"exportWav",val:o})}(d),s=[]}(c.data.val)}var d}}),this.worker.postMessage({command:"init",val:{sampleChannel:this.channels,sampleBit:this.sampleBit,sampleRate:this.sampleRate,oldSampleRate:this.context.sampleRate,bufferSize:this.bufferSize,type:e}}),this.worker.onmessage=function(e){switch(e.data.command){case"exportPcmLive":t.onReceiveBuffer(e.data.val);break;case"exportWav":t.onReceiveWav(e.data.val)}}},e.prototype.onReceiveBuffer=function(e){},e.prototype.onReceiveWav=function(e){},e.prototype.writeString=function(e,t,r){for(var n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))},e.prototype.writeBuffer=function(e,t,r){for(var n=0;n<r.byteLength;n++)e.setUint8(t+n,r[n])},e.prototype.concatenation=function(e){for(var t=0,r=0;r<e.length;++r)t+=e[r].buffer.byteLength;var n=new Uint8Array(t),o=0;for(r=0;r<e.length;++r)n.set(new Uint8Array(e[r].buffer),o),o+=e[r].buffer.byteLength;return n},e.prototype.encodeWave=function(e){var t=this.concatenation(e),r=t.byteLength,n=new ArrayBuffer(r+44),o=new DataView(n),i=this.sampleRate,s=this.sampleBit,a=this.channels;return this.writeString(o,0,"RIFF"),o.setUint32(4,36+r,!0),this.writeString(o,8,"WAVE"),this.writeString(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,a,!0),o.setUint32(24,i,!0),o.setUint32(28,i*a*(s/8),!0),o.setUint16(32,a*(s/8),!0),o.setUint16(34,s,!0),this.writeString(o,36,"data"),o.setUint32(40,r,!0),this.writeBuffer(o,44,t),o},e.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e.prototype.inlineWorker=function(e){if(Worker&&e){var t=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([t],{type:"text/javascript"}));return new Worker(r)}return null},e}();t.MediaUtil=r},2523:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WEBRTC_ACTION=void 0,function(e){e.PRELOAD_EFFECT="zc.pe.0",e.PLAY_EFFECT="zc.pe.1",e.PAUSE_EFFECT="zc.pe.2",e.RESUME_EFFECT="zc.re",e.STOP_EFFECT="zc.se",e.UNLOAD_EFFECT="zc.ue",e.SET_EFFECT_VOLUME="zc.sev",e.START_MIXING_AUDIO="zc.sma.0",e.STOP_MIXING_AUDIO="zc.sma.1",e.MIXING_BUFFER="zc.mb",e.STOP_MIXING_BUFFER="zc.smb",e.SET_MIXING_AUDIO_VOLUME="zc.smav",e.PUBLISHER_PLAY_EFFECT="zc.p.0.pe.0",e.PUBLISHER_PAUSE_EFFECT="zc.p.0.pe.1",e.PUBLISHER_RESUME_EFFECT="zc.p.0.re",e.PUBLISHER_STOP_EFFECT="zc.p.0.se",e.PUBLISHER_START_MIXING_AUDIO="zc.p.0.sma.0",e.PUBLISHER_STOP_MIXING_AUDIO="zc.p.0.sma.1",e.PUBLISHER_MIXING_BUFFER="zc.p.0.mb",e.PUBLISHER_SET_MIXING_AUDIO_VOLUME="zc.p.0.smav"}(t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={}))},4194:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMix=void 0;var n=r(4853),o=function(){function e(e,t,r,n){this.logger=e,this.stateCenter=t,this.ac=r,this.mediaEleSources=n,this.audioBufferList=[],this.loop=!1,this.replace=!1,this.effectEndedCallBack=null,this.effectEndedListener=null,this.startTimes=0,this.startOffset=0,this.pauseTimes=0,this.resumeOffset=0,this.paused=!1,this.isMixAudio=!1,this.isMixingBuffer=!1,this.audioCurrentTimer=null}return e.prototype.preloadEffect=function(e,t){var r=this;this.logger.info("amu.pe.0 start preload effect");var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||304==n.status){var e=n.response;r.ac.resume(),r.ac.decodeAudioData(e,function(e){r.logger.info("amu.pe.0 effect preload success"),t("",e)},function(e){t(e)})}else t(n.statusText)},n.send()},e.prototype.playEffect=function(e,t,r,n,o){var i=this;!0!==this.isMixAudio?this.audioBuffer?(this.startOffset=e||0,this.loop=t||!1,this.replace=r||!1,this.effectEndedCallBack=o,this.mixEffect(this.audioBuffer,function(){i.buffSource.loop=!!t,e?i.buffSource.start(0,e/1e3):i.buffSource.start(0),i.startTimes=Date.now(),i.effectEndedListener=i.effectEndedHandler.bind(i),i.buffSource.addEventListener("ended",i.effectEndedListener),n&&n()})):this.logger.error("amu.pe.1 no audio buffer found"):this.logger.error("amu.pe.1 audio is mixing")},e.prototype.mixingBuffer=function(e,t){var r=this;!0!==this.isMixAudio||0!=this.audioBufferList.length||0!=this.isMixingBuffer?(this.ac.resume(),this.ac.decodeAudioData(e,function(e){r.audioBufferList.push(e),1==r.audioBufferList.length&&r.playRealTimeEffect(r.audioBufferList[0]),r.isMixingBuffer=!0,t&&t()},function(e){r.logger.error("amu.mb.0 "+e),t&&t({code:n.errorCodeList.PUBLISHER_DECODE_AUDIO_FAIL.code,message:n.errorCodeList.PUBLISHER_DECODE_AUDIO_FAIL.message+" "+e})})):this.logger.error("amu.mb.0 audio is mixing")},e.prototype.stopMingBuffer=function(){return this.isMixingBuffer=!1,this.stopMixingAudio()},e.prototype.playRealTimeEffect=function(e){var t=this;this.mixEffect(e,function(){t.buffSource&&t.buffSource.start(0),t.buffSource&&t.buffSource.addEventListener("ended",function(){t.audioBufferList.shift(),t.audioBufferList.length>0&&t.isMixAudio&&t.playRealTimeEffect(t.audioBufferList[0])})})},e.prototype.pauseEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be paused"):(this.stopMixingAudio(),this.resumeOffset=(this.pauseTimes-this.startTimes+this.startOffset)%(1e3*this.audioBuffer.duration),this.paused=!0)},e.prototype.resumeEffect=function(){this.audioBufferList.length>0?this.logger.error("amu.pe.0 real time buffer can not be resume"):(this.playEffect(this.resumeOffset,this.loop,this.replace,void 0,this.effectEndedCallBack),this.startOffset=this.resumeOffset,this.paused=!1)},e.prototype.mixEffect=function(e,t){this.localStream?(this.ac.resume(),this.gainNode=this.ac.createGain(),this.buffSource=this.ac.createBufferSource(),this.buffSource.buffer=e,this.buffSource.connect(this.gainNode),this.gainNode.connect(this.ac.destination),this.replaceTrack()&&t()):this.logger.error("amu.me.0 localStream can not be found")},e.prototype.startMixingAudio=function(e,t){if(this.replace=t||!1,this.isMixAudio)return this.logger.error("amu.sma.0 audio is mixing"),!1;if(!this.localStream)return this.logger.error("amu.sma.0 localStream can not be found"),!1;if(e.captureStream=e.captureStream||e.mozCaptureStream||e.webkitCaptureStream,this.ac.resume(),this.gainNode=this.ac.createGain(),"safari"===this.stateCenter.browser){var r=this.mediaEleSources.find(function(t){return t.audio===e});if(r)this.mixAudio=r.node;else{var n=this.ac.createMediaElementSource(e);this.mixAudio=n,this.mediaEleSources.push({audio:e,node:n})}e.currentTime=e.currentTime,this.audioCurrentTimer=setInterval(function(){e.currentTime=e.currentTime+.45},6e3)}else this.mixAudio=this.ac.createMediaStreamSource(e.captureStream());return this.mixAudio.connect(this.gainNode),this.replaceTrack()},e.prototype.replaceTrack=function(){this.streamSource=this.ac.createMediaStreamSource(this.localStream),this.destination=this.ac.createMediaStreamDestination(),!this.replace&&this.streamSource.connect(this.destination),this.gainNode.connect(this.destination);var e=this.destination.stream.getAudioTracks()[0],t=this.peerConnection.getSenders().find(function(t){return t.track.kind===e.kind});return t?(this.micTrack=this.localStream.getAudioTracks()[0],t.replaceTrack(e),this.localStream.removeTrack(this.micTrack),this.localStream.addTrack(e),this.isMixAudio=!0,!0):(this.logger.error("amu.rt.0 no sender"),!1)},e.prototype.stopMixingAudio=function(){var e=this;return this.paused?(this.logger.info("amu.sma.1 audioEffect paused"),!0):this.isMixAudio?this.localStream?(this.peerConnection.getSenders().find(function(t){return t.track.kind===e.micTrack.kind}),this.mixAudio?(this.mixAudio.disconnect(this.gainNode),this.mixAudio=null,this.audioCurrentTimer&&(clearInterval(this.audioCurrentTimer),this.audioCurrentTimer=null)):this.buffSource&&(this.buffSource.removeEventListener("ended",this.effectEndedListener),this.buffSource.stop(),this.pauseTimes=Date.now(),this.buffSource.disconnect(this.gainNode),this.buffSource=null),this.gainNode.disconnect(this.destination),this.isMixAudio=!1,this.audioBufferList=[],!0):(this.logger.error("amu.sma.1 localStream can not be found"),!1):(this.logger.warn("amu.sma.1 no mixing audio found"),!0)},e.prototype.setMixingAudioVolume=function(e){return this.gainNode?(this.gainNode.gain.value=e,!0):(this.logger.error("amu.sma.2 no mixing audio found"),!1)},e.prototype.effectEndedHandler=function(){this.stopMixingAudio(),this.effectEndedCallBack&&this.effectEndedCallBack()},e}();t.AudioMix=o},6459:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMixModule=void 0;var n=r(2523),o=r(4234),i=function(){function e(e,t,r,n,o){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=n,this.ac=o,this.buffer=null,this.blank=null,"safari"==this.stateCenter.browser&&null==this.blank&&null==this.buffer&&(this.ac.resume(),this.buffer=this.ac.createBuffer(1,1,this.ac.sampleRate),this.blank=this.ac.createBufferSource(),this.blank.buffer=this.buffer,this.blank.connect(this.ac.destination),this.blank.start())}return e.prototype.preloadEffect=function(e,t,r){e&&"string"==typeof e&&t&&"string"==typeof t?this.stateCenter.audioEffectBuffer[e]?this.logger.error(n.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" audio buffer already exists"):(this.logger.info(n.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" start preload effect"),this._preloadEffect(this.ac,e,t,r)):this.logger.error(n.ZEGO_WEBRTC_ACTION.PRELOAD_EFFECT+" params error")},e.prototype.playEffect=function(e,t,r){e.streamID&&"string"==typeof e.streamID&&e.effectID&&"string"==typeof e.effectID?this.stateCenter.audioEffectBuffer[e.effectID]?this._playEffect(e,t,r):this.logger.error(n.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" audio buffer doesn't exists"):this.logger.error(n.ZEGO_WEBRTC_ACTION.PLAY_EFFECT+" params error")},e.prototype.pauseEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(n.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" effect "),this._pauseEffect(e,t)):(this.logger.error(n.ZEGO_WEBRTC_ACTION.PAUSE_EFFECT+" streamID format error"),!1)},e.prototype.resumeEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(n.ZEGO_WEBRTC_ACTION.RESUME_EFFECT+" effect "),this._resumeEffect(e,t)):(this.logger.error(n.ZEGO_WEBRTC_ACTION.RESUME_EFFECT+" streamID format error"),!1)},e.prototype.stopEffect=function(e,t){return e&&"string"==typeof e?(t&&"string"!=typeof t&&this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_EFFECT+" effect "),this._stopEffect(e,t)):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_EFFECT+" streamID format error"),!1)},e.prototype.unloadEffect=function(e){return e&&"string"==typeof e?(delete this.stateCenter.audioEffectBuffer[e],!0):(this.logger.error(n.ZEGO_WEBRTC_ACTION.UNLOAD_EFFECT+" params error"),!1)},e.prototype.setEffectVolume=function(e,t,r){if(!e||"string"!=typeof e)return this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" streamID format error"),!1;r&&"string"!=typeof r&&this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" effect ");var o=this.streamCenter.getPublisher(e);return o?o.setEffectVolume(t/100,r):(this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_EFFECT_VOLUME+" publisher doesn't exist"),!1)},e.prototype.startMixingAudio=function(e,t){return this.logger.info(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" call "+e),e&&"string"==typeof e?t?(this.logger.info(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" end "+e),Array.isArray(t)&&0!==t.length?this._startMixingAudio(e,t):(this.logger.error(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" audio param type error"),!1)):(this.logger.error(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" no audio"),!1):(this.logger.error(n.ZEGO_WEBRTC_ACTION.START_MIXING_AUDIO+" stream id type error"),!1)},e.prototype.stopMixingAudio=function(e,t){return e&&"string"==typeof e?Array.isArray(t)&&0!==t.length||void 0===t?this._stopMixingAudio(e,t):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_AUDIO+" audio param type error"),!1):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_AUDIO+" param streamID format error"),!1)},e.prototype.mixingBuffer=function(e,t,r,o){this.logger.info(n.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" call streamID: "+e+" sourceID:"+t),e&&"string"==typeof e?t&&"string"==typeof t?(this._mixingBuffer(e,t,r,o),this.logger.info(n.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" end")):this.logger.error(n.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" param source id format error"):this.logger.error(n.ZEGO_WEBRTC_ACTION.MIXING_BUFFER+" param streamid format error")},e.prototype.stopMixingBuffer=function(e,t){return this.logger.info(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" call streamID: "+e+" sourceID:"+t),e&&"string"==typeof e?t&&"string"==typeof t?this._stopMixingBuffer(e,t):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" param source id format error"),!1):(this.logger.error(n.ZEGO_WEBRTC_ACTION.STOP_MIXING_BUFFER+" param streamid format error"),!1)},e.prototype.setMixingAudioVolume=function(e,t,r){return this.logger.info(n.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" call"),"string"!=typeof e||""==e?(this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" stream ID must be string and not empty"),!1):"number"!=typeof t||t<0||t>100?(this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" volume must be a number between 0 and 100"),!1):r&&r instanceof HTMLMediaElement?this._setMixingAudioVolume(e,t,r):(this.logger.error(n.ZEGO_WEBRTC_ACTION.SET_MIXING_AUDIO_VOLUME+" no audio"),!1)},e.prototype.getSoundLevel=function(e,t,r){this.logger.info("zc.gsl call");var n=this.stateCenter.getReportSeq();this.dataReport.newReport(n,o.ZegoRTCLogEvent.kZegoTaskGetSoundLevel.event);try{this.ac.resume();var i=this.ac.createMediaStreamSource(e),s=this.ac.createScriptProcessor(4096,1,1);this.stateCenter.audioStreamList[e.id]={mic:i,script:s},i.connect(s),s.connect(this.ac.destination),s.onaudioprocess=function(e){for(var r=e.inputBuffer.getChannelData(0),n=0,o=0;o<r.length;o++)n<r[o]&&(n=r[o]);t(n)},this.dataReport.uploadReport(n)}catch(e){r(e),this.dataReport.addMsgInfo(n,o.ZegoRTCLogEvent.kZegoTaskGetSoundLevel.error.kGetSoundLevelError),this.dataReport.uploadReport(n)}this.logger.info("zc.gsl call success")},e.prototype.stopSoundLevel=function(e){this.logger.info("zc.ssl call");var t=this.stateCenter.getReportSeq();this.dataReport.newReport(t,o.ZegoRTCLogEvent.kZegoTaskStopSoundLevel);var r=this.stateCenter.audioStreamList[e.id];r.mic.disconnect(),r.script.disconnect(),delete this.stateCenter.audioStreamList[e.id],this.dataReport.uploadReport(t)},e.prototype._preloadEffect=function(e,t,r,n){var o=this,i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||304==i.status)e.decodeAudioData(i.response,function(e){o.logger.info("zc.pe.0 effect preload success"),o.stateCenter.audioEffectBuffer[t]=e,n&&n()},function(e){o.logger.error("zc.pe.0 effect preload fail "+e),n&&n(e)});else{var r=i.statusText;o.logger.error("zc.pe.0 effect preload fail "+r),n&&n(r)}},i.send()},e.prototype._playEffect=function(e,t,r){var n=this.stateCenter.audioEffectBuffer[e.effectID],o=this.streamCenter.getPublisher(e.streamID);o?n?o.playEffect(e,n,t,r):this.logger.error("zc.pe.1 no audio buffer found"):this.logger.error("zc.pe.1 publisher doesn't exist")},e.prototype._pauseEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.pauseEffect(t):(this.logger.error("zc.pe.2 publisher doesn't exist"),!1)},e.prototype._resumeEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.resumeEffect(t):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},e.prototype._stopEffect=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopEffect(t):(this.logger.error("zc.re.0 publisher doesn't exist"),!1)},e.prototype._setMixingAudioVolume=function(e,t,r){var n=this.streamCenter.getPublisher(e);return n?n.setMixingAudioVolume(t/100,r):(this.logger.error("zc.sma.2 publisher doesn't exist"),!1)},e.prototype._startMixingAudio=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.startMixingAudio(t):(this.logger.error("zc.sma.0 publisher doesn't exist"),!1)},e.prototype._stopMixingAudio=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopMixingAudio(t):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},e.prototype._mixingBuffer=function(e,t,r,n){var o=this.streamCenter.getPublisher(e);o?r instanceof ArrayBuffer?o.mixingBuffer(t,r,n):this.logger.error("zc.mb.0 array buffer not found"):this.logger.error("zc.mb.0 publisher doesn't exist")},e.prototype._stopMixingBuffer=function(e,t){var r=this.streamCenter.getPublisher(e);return r?r.stopMixingBuffer(t):(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},e}();t.AudioMixModule=i},6214:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.publisher=void 0;var n=r(2523),o=r(4194);t.publisher={playEffect:function(e,t,r,i){if(this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" call"),this.effectList.find(function(r){return r.effectID==e.effectID&&r.audioBuffer==t}))this.logger.warn(n.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" effect alreadly exist ");else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var s=new o.AudioMix(this.logger,this.stateCenter,this.ac,this.mediaEleSources);s.localStream=this.localStream,s.peerConnection=this.peerConnection,s.audioBuffer=t,this.effectList.push({audioMix:s,effectID:e.effectID,audioBuffer:t}),s.playEffect(e.playTime,e.loop,!1,r,i),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_PLAY_EFFECT+""+this.streamId+" play effect "+e.effectID+" success")}},pauseEffect:function(e){var t=this.effectList.find(function(t){return t.effectID==e});if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.pauseEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_PAUSE_EFFECT+" "+this.streamId+" pause "+e+" success");else{if(void 0!==e)return this.logger.error(n.ZEGO_WEBRTC_ACTION.PUBLISHER_PAUSE_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(e){return e.audioMix.pauseEffect()}),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},resumeEffect:function(e){var t=this.effectList.find(function(t){return t.effectID==e});if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.resumeEffect(),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_RESUME_EFFECT+" "+this.streamId+" resume"+e+" success");else{if(void 0!==e)return this.logger.error(n.ZEGO_WEBRTC_ACTION.PUBLISHER_RESUME_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(e){return e.audioMix.resumeEffect()}),this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!1},stopEffect:function(e){var t=this.effectList.find(function(t){return t.effectID==e});if(t)this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),t.audioMix.stopMixingAudio(),this.effectList.splice(this.effectList.indexOf(t),1),this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_EFFECT+" "+this.streamId+" pause "+e+" success");else{if(void 0!==e)return this.logger.error(n.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_EFFECT+" "+this.streamId+" no effect ID found"),!1;this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.effectList.forEach(function(e){return e.audioMix.stopMixingAudio()}),this.effectList=[],this.streamCenter.soundLevelDelegate&&this.startSoundLevel()}return!0},setEffectVolume:function(e,t){var r=this.effectList.find(function(e){return e.effectID==t});if(r)r.audioMix.setMixingAudioVolume(e),this.logger.info("zp.sev.0 "+this.streamId+" set volume "+t+" success");else{if(void 0!==t)return this.logger.error("zp.sev.0 "+this.streamId+" no effect ID found"),!1;this.effectList.forEach(function(t){return t.audioMix.setMixingAudioVolume(e)})}return!0},startMixingAudio:function(e){var t=this;return this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" "+this.streamId+" call"),this.localStream?(this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),e.forEach(function(e){if(t.audioMixList.find(function(t){return t.media==e}))t.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" "+t.streamId+" mix audio already exist");else{t.streamCenter.soundLevelDelegate&&t.stopSoundLevel();var r=new o.AudioMix(t.logger,t.stateCenter,t.ac,t.mediaEleSources);r.localStream=t.localStream,r.peerConnection=t.peerConnection,t.audioMixList.push({audioMix:r,media:e}),r.startMixingAudio(e),t.streamCenter.soundLevelDelegate&&t.startSoundLevel()}}),!0):(this.logger.error(n.ZEGO_WEBRTC_ACTION.PUBLISHER_START_MIXING_AUDIO+" localStream not found"),!1)},stopMixingAudio:function(e){var t=this;return this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_MIXING_AUDIO+" "+this.streamId+" call"),e?e.forEach(function(e){for(var r=0;r<t.audioMixList.length;r++)if(t.audioMixList[r].media==e){t.audioMixList[r].audioMix.stopMixingAudio()&&t.audioMixList.splice(r--,1);break}}):(this.audioMixList.forEach(function(e){return e.audioMix.stopMixingAudio()}),this.audioMixList=[]),!0},mixingBuffer:function(e,t,r){var i=this;if(this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_MIXING_BUFFER+" "+this.streamId+" call"),this.micTrack||(this.micTrack=this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks()[0]:null),this.arrayBufferMap[e])this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[e].mixingBuffer(t,function(){i.streamCenter.soundLevelDelegate&&i.startSoundLevel(),r&&r()});else{this.streamCenter.soundLevelDelegate&&this.stopSoundLevel();var s=new o.AudioMix(this.logger,this.stateCenter,this.ac,this.mediaEleSources);s.localStream=this.localStream,s.peerConnection=this.peerConnection,this.arrayBufferMap[e]=s,s.mixingBuffer(t,function(){i.streamCenter.soundLevelDelegate&&i.startSoundLevel(),r&&r()})}},stopMixingBuffer:function(e){if(e&&this.arrayBufferMap[e])return this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap[e].stopMingBuffer(),delete this.arrayBufferMap[e],this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0;if(void 0===e){for(var t in this.streamCenter.soundLevelDelegate&&this.stopSoundLevel(),this.arrayBufferMap)this.arrayBufferMap[t].stopMingBuffer();return this.streamCenter.soundLevelDelegate&&this.startSoundLevel(),!0}return this.logger.warn(n.ZEGO_WEBRTC_ACTION.PUBLISHER_MIXING_BUFFER+" "+this.streamId+" arrayBuffer no found"),!1},setMixingAudioVolume:function(e,t){this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" call");var r=this.audioMixList.find(function(e){return e.media===t});return r?(r.audioMix.setMixingAudioVolume(e),this.logger.info(n.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" call success"),!0):(this.logger.error(n.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_MIXING_AUDIO_VOLUME+" "+this.streamId+" audio is not mixing"),!1)}}},4853:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={GET_SOUND_LEVEL_FAIL:{code:1000019,message:"get sound level error"},PUBLISHER_DECODE_AUDIO_FAIL:{code:1103057,message:"decode audio data fail"}}},7526:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6459),o=r(6214);t.default={type:"AudioMix",install:function(e,t){for(var r in Object.defineProperty(e.prototype,"initAudioMix",{value:function(){this.audioMixModule=new n.AudioMixModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.ac)}}),o.publisher)Object.defineProperty(t.prototype,r,{value:o.publisher[r],writable:!1})}}},4234:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTCLogEvent=void 0;var n=r(4853);t.ZegoRTCLogEvent={kZegoTaskGetSoundLevel:{event:"/sdk/get_sound_level",error:{kGetSoundLevelError:n.errorCodeList.GET_SOUND_LEVEL_FAIL}},kZegoTaskStopSoundLevel:"/sdk/stop_sound_level"}},4897:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataChannel=void 0;var n=r(8835);t.DataChannel={type:"DataChannel",install:function(e){Object.defineProperty(e.prototype,"createRealTimeSequentialDataManager",{value:function(e){this.enableDataChannel(!0);var t=this.stateCenter.getRoomByRoomID(e);return t?t.dataChannelManager?null:(t.dataChannelManager=new n.ZegoRealTimeSequentialDataManager(this,e),t.dataChannelManager):(this.logger.error("zc.crsdm room no exist"),null)},writable:!1}),Object.defineProperty(e.prototype,"destroyRealTimeSequentialDataManager",{value:function(e){var t=this.stateCenter.roomList.find(function(t){return t.dataChannelManager==e});t&&(e.dataChannelManager.reset(),t.dataChannelManager=null)},writable:!1})}}},3504:function(e,t){"use strict";var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataChannelListener=void 0;var o=function(){function e(e,t){this.zegoWebRTC=e,this.roomID=t,this.pubDataChannelList=[],this.subDataChannelList=[],this.listenerList={receiveRealTimeSequentialData:[]},this.logger=e.logger}return e.prototype.startBroadcasting=function(e,t){return r(this,void 0,void 0,function(){var t,r,o,i;return n(this,function(n){switch(n.label){case 0:return this.logger.info("dc.sb.0 call"),this.pubDataChannelList.includes(e)?(this.logger.error("dc.sb.0 datachannel already exist"),[2,!1]):(t=this.zegoWebRTC.streamCenter.publisherList[e])&&t.publisher.dataChannel?(this.pubDataChannelList.push(e),[2,!0]):t&&!t.publisher.dataChannel?(this.logger.error("dc.sb.0 publish datachannel no exist, try other stream ID"),[2,!1]):this.broadcastStream?[3,2]:(r=document.createElement("canvas"),o=this,[4,this.zegoWebRTC.createStream({custom:{source:r}})]);case 1:o.broadcastStream=n.sent(),n.label=2;case 2:return(i=this.zegoWebRTC.startPublishingStream(e,this.broadcastStream,{roomID:this.roomID},!0))&&this.pubDataChannelList.push(e),this.logger.info("dc.sb.0 end"),[2,i]}})})},e.prototype.stopBroadcasting=function(e){this.logger.info("dc.sb.1 call"),this.pubDataChannelList=this.pubDataChannelList.filter(function(t){return t!==e});var t=this.zegoWebRTC.streamCenter.publisherList[e];return t?(t.room.roomID==this.roomID&&t.isDataChannel&&this.zegoWebRTC.stopPublishingStream(e),this.logger.info("dc.sb.1 end"),!0):(this.logger.error("dc.sb.1 datachannel no found"),!1)},e.prototype.sendRealTimeSequentialData=function(e,t){if(!t instanceof ArrayBuffer)return this.logger.error("dc.srsd data type wrong"),!1;var r=this.zegoWebRTC.streamCenter.publisherList[e];return r&&this.pubDataChannelList.includes(e)?this.sendBCMessage(r.publisher,t):(this.logger.error("dc.srsd datachannel no found"),!1)},e.prototype.sendBCMessage=function(e,t){var r;if(!e.dataChannelState)return!1;for(var n=new Uint8Array(t),o=0,i=t.byteLength,s=e.send_seq,a=0,u=(new Date).getTime(),l=0;i>0;){i>1151?l=1141:(l=i,a=1);var c=new Uint8Array(l+10);c[0]=1,c[1]=a,c[2]=e.send_seq>>8&255,c[3]=255&e.send_seq,c[4]=s>>8&255,c[5]=255&s,c[6]=u>>24&255,c[7]=u>>16&255,c[8]=u>>8&255,c[9]=255&u;for(var d=0;d<l;d++)c[d+10]=n[d+o];i-=l,o+=l,e.send_seq++,e.send_seq>=65536&&(e.send_seq=0),null===(r=e.dataChannel)||void 0===r||r.send(c)}return!0},e.prototype.startSubscribing=function(e,t){var o,i;return r(this,void 0,void 0,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return this.logger.info("dc.ss.0 call"),this.subDataChannelList.includes(e)?(this.logger.error("dc.ss.0 datachannel already exist"),[2,!1]):(t=this.zegoWebRTC.streamCenter.playerList[e])?[3,2]:[4,this.zegoWebRTC.startPlayingStream(e,void 0,!0)];case 1:n.sent(),t=this.zegoWebRTC.streamCenter.playerList[e],n.label=2;case 2:return(r=t.player).dataChannel?(!(null===(o=r.onDataChannelList)||void 0===o?void 0:o.includes(this.onReceivedDataChannel.bind(this)))&&(null===(i=r.onDataChannelList)||void 0===i||i.push(this.onReceivedDataChannel.bind(this))),this.subDataChannelList.push(e),this.logger.info("dc.ss.0 end"),[2,!0]):(this.logger.error("dc.ss.0 datachannel no exist, try other stream ID"),[2,!1])}})})},e.prototype.stopSubscribing=function(e){this.logger.info("dc.ss.1 call"),this.subDataChannelList=this.subDataChannelList.filter(function(t){return t!==e});var t=this.zegoWebRTC.streamCenter.playerList[e];return t?(t.room.roomID==this.roomID&&t.isDataChannel&&this.zegoWebRTC.stopPlayingStream(e),this.logger.info("dc.ss.1 end"),!0):(this.logger.error("dc.ss.1 datachannel no subscribe"),!1)},e.prototype.on=function(e,t){this.bindListener(e,t)},e.prototype.off=function(e,t){this.deleteListener(e,t)},e.prototype.bindListener=function(e,t){return this.listenerList[e]?"function"!=typeof t?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(-1==this.listenerList[e].indexOf(t)&&this.listenerList[e].push(t),!0):(this.logger.error("dc.o.0 event "+e+" no found"),!1)},e.prototype.deleteListener=function(e,t){if(!this.listenerList[e])return this.logger.error("dc.o.1 listener no found"),!1;var r=this.listenerList[e];return t?r.splice(r.indexOf(t),1):this.listenerList[e]=[],!0},e.prototype.actionListener=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.listenerList[e]&&this.listenerList[e].forEach(function(n){try{setTimeout(function(){n.apply(void 0,r)},0)}catch(r){t.logger.error("dc.al "+e+" "+r)}})},e.prototype.onReceivedDataChannel=function(e,t,r){this.actionListener("receiveRealTimeSequentialData",e,t,r)},e.prototype.reset=function(){var e=this;for(var t in this.logger.info("dc.rs call"),this.pubDataChannelList.forEach(function(t){var r=e.zegoWebRTC.streamCenter.publisherList[t];r&&r.room.roomID==e.roomID&&r.isDataChannel&&e.zegoWebRTC.stopPublishingStream(t)}),this.subDataChannelList.forEach(function(t){var r=e.zegoWebRTC.streamCenter.playerList[t];r&&r.room.roomID==e.roomID&&r.isDataChannel&&e.zegoWebRTC.stopPlayingStream(t)}),this.listenerList)this.listenerList[t]=[];this.broadcastStream&&this.zegoWebRTC.destroyStream(this.broadcastStream),this.broadcastStream=void 0,this.logger.info("dc.rs end")},e}();t.DataChannelListener=o},5906:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.streamHandler=t.zegoWebRTC=void 0;var n=r(817),o=r(6145),i="2.14.0",s=1e4,a={},u="addMsgInfo";function l(e){var t,r,o,i,a="",u=n.errorCodeList;return e.errorCode<2e9&&e.errorCode>1e9?(o={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",190:"MIXER_START_REQUEST_ERROR"},i="MIXER_INNER_ERROR",(r=e.errorCode-s)>1e9&&o[r-1e9]&&(i=o[r-1e9]),t=u[a=i]):e.errorCode<1e6&&(t=this.stateCenter.decodeServerError(e.errorCode,e.extendedData),a=this.stateCenter.getLiveRoomError(e.errorCode)),{reportErr:t,actualError:u[a]}}t.zegoWebRTC={startMixerTask:function(e){var t=this;return new Promise(function(r,n){var i=t.stateCenter.getReportSeq();t.dataReport.newReport(i,o.ZegoRTCLogEvent.kZegoTaskMixStart.event),t.stateCenter.logReportCallback("kZegoTaskMixStart"+e.taskID,t.dataReport,i,t.stateCenter.reportList);var s={errorCode:1005027,extendedData:"mix stream input parameters are wrong"};if(null==e?void 0:e.inputList.find(function(e){return null==e.streamID&&(s.extendedData=s.extendedData+". streamID should be of string type",!0)}))return t.dataReport.addMsgInfo(i,s),t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),void n(s);e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var a=function(r){var o=l(r),s=o.actualError;t.dataReport.addMsgInfo(i,o.reportErr||r),t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),s&&(r.errorCode=null==s?void 0:s.code,r.extendedData=(null==s?void 0:s.message)||""),n(r)},u=t.stateCenter.roomList[0];u?u.streamHandler.updateMixStream(e,function(n){t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),r(n)},a):a({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.message})})},setMixerTaskConfig:function(e){var t=this;return new Promise(function(r,n){var i=t.stateCenter.getReportSeq();t.dataReport.newReport(i,o.ZegoRTCLogEvent.kZegoTaskMixConfig.event),t.stateCenter.logReportCallback("kZegoTaskMixConfig",t.dataReport,i,t.stateCenter.reportList);var s=t.stateCenter.roomList[0];s?s.streamHandler.setMixerTaskConfig(e).then(function(e){t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),r(e)}).catch(function(e){t.dataReport.addMsgInfo(i,e),t.dataReport.uploadReport(i),t.stateCenter.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),n(e)}):n({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.message})})},stopMixerTask:function(e){var t=this;return new Promise(function(r,n){var i=t.stateCenter.getReportSeq();if(t.dataReport.newReport(i,o.ZegoRTCLogEvent.kZegoTaskMixStop.event),!e||"string"!=typeof e||e.length>256||!t.stateCenter.checkIllegalCharacters(e))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.dataReport.addMsgInfo(i,{error:o.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,message:o.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"}),t.dataReport.uploadReport(i),void n({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"});var s=function(e){var r=l(e),o=r.actualError;t.dataReport.addMsgInfo(i,r.reportErr||e),t.dataReport.uploadReport(i),o&&(e.errorCode=null==o?void 0:o.code,e.extendedData=(null==o?void 0:o.message)||""),n(e)},a=t.stateCenter.roomList[0];a?a.streamHandler.stopMixStream(e,function(e){t.dataReport.uploadReport(i),r(e)},s):s({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.message})})}},t.streamHandler={setMixerTaskConfig:function(e){var t=this;return new Promise(function(r,n){var i,s={},l={};if(e&&e.videoCodec){var c=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(c))return t.logger.error("zb.sh.ums param videoCode error"),n({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;s.videoCodec=c,l.video_codec=c}if(e.backgroundColor){if(!t.stateCenter.checkInteger(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),n({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;s.backgroundColor=e.backgroundColor,l.background_color=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return t.logger.error("zb.sh.ums param outputBgImage error"),n({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return t.logger.error("zb.sh.ums illegal input background image URL"),n({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;s.backgroundImage=e.backgroundImage,l.background_image=e.backgroundImage}e.waterMark&&(s.waterMark=e.waterMark,l.water_mark=e.waterMark),e.extraParams&&(s.extraParams||(s.extraParams=[]),(i=s.extraParams).push.apply(i,e.extraParams)),s=a,t.stateCenter.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)&&t.stateCenter.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)(u,void 0,{config:o.ZegoRTCLogEvent.kZegoTaskMixConfig.config(l)}),r({errorCode:0,extendedData:""})})},stopMixStream:function(e,t,r,a,u){var l=this;this.logger.info("zb.sh.sms call");var c={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:i};"string"==typeof e&&(c.task_id=e),null!=a?c.stream_id=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+a:a:null!=u&&(c.mixurl=u);var d={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(c)};return this.sendBizChannelRequest(d,function(){t&&t({errorCode:0})},function(e){var t;"number"==typeof e?r&&r({errorCode:l.stateCenter.getServerError(s+e).code,extendedData:""}):(l.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e)),t=e==n.errorCodeList.TIMEOUT?o.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:o.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,r&&r({errorCode:t.code,extendedData:t.message}))}),!0},updateMixStream:function(e,t,r){var l,c=this;if(this.logger.info("zb.sh.ums call"),!e.noTaskID&&!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!e.noTaskID&&"string"!=typeof e.taskID)return this.logger.error("zb.rh.lg taskId must be string"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.noTaskID&&e.taskID.length>256)return this.logger.error("zb.sh.ums taskId is too long"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!e.noTaskID&&!this.stateCenter.checkIllegalCharacters(e.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;e.inputList.forEach(function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)});for(var d=e.inputList.every(function(e){return"AUDIO"===e.contentType}),h=0;h<e.inputList.length;h++){var p=e.inputList[h],f={errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message};if("object"!=typeof p.layout)return this.logger.error("zb.sh.ums input layout must be object"),r(f),!1;if(!(this.stateCenter.checkInteger(p.layout.top,!1)&&this.stateCenter.checkInteger(p.layout.bottom,!1)&&this.stateCenter.checkInteger(p.layout.left,!1)&&this.stateCenter.checkInteger(p.layout.right,!1)))return this.logger.error("zb.sh.ums top\u3001left\u3001bottom\u3001right must be integer number"),r(f),!1;if(void 0!==p.renderMode&&![0,1].includes(p.renderMode))return this.logger.error("zb.sh.ums render_mode is wrong"),r(f),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(e.outputList.some(function(e){return"string"==typeof e&&!c.stateCenter.isUrl(e)&&!c.stateCenter.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!c.stateCenter.isUrl(e.target)&&!c.stateCenter.checkIllegalCharacters(e.target)}))return this.logger.error("zb.sh.ums stream output target is incorrect"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!(d||e.outputConfig&&"object"==typeof e.outputConfig))return this.logger.error("zb.sh.ums no output config found"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(d&&(void 0===e.outputConfig&&(e.outputConfig={outputBitrate:0,outputFPS:0,outputWidth:0,outputHeight:0}),e.outputConfig.outputBitrate=.001,e.outputConfig.outputFPS=1,e.outputConfig.outputWidth=1,e.outputConfig.outputHeight=1),!(d||e.outputConfig.outputBitrate&&this.stateCenter.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputFPS||!this.stateCenter.checkInteger(e.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputWidth||!this.stateCenter.checkInteger(e.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputHeight||!this.stateCenter.checkInteger(e.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var g=0;e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(g=e.outputConfig.singleStreamPassThrough?1:0);var _={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:i,bypass:g},m=a;m&&(m.videoCodec&&(_.extra_params=[{key:"video_encode",value:m.videoCodec}]),m.backgroundColor&&(_.output_bg_color=m.backgroundColor),m.backgroundImage&&(_.output_bg_image=m.backgroundImage),m.waterMark&&(_.watermark=m.waterMark),m.extraParams&&(!_.extra_params&&(_.extra_params=[]),(l=_.extra_params).push.apply(l,m.extraParams)));var v=[];for(h=0;h<e.inputList.length;h++){var E=e.inputList[h],T=E.streamID;this.stateCenter.testEnvironment&&(T="zegotest-"+this.stateCenter.appid+"-"+E.streamID),v.push({stream_id:T,content_control:"AUDIO"===E.contentType?1:0,rect:{layer:h,top:E.layout.top,left:E.layout.left,bottom:E.layout.bottom,right:E.layout.right},render_mode:E.renderMode})}_.MixInput=v,this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(u,void 0,{mix_stream_id:o.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_id(e.taskID),stream_cnt:o.ZegoRTCLogEvent.kZegoTaskMixStart.stream_cnt(v.length),input_stream_list:o.ZegoRTCLogEvent.kZegoTaskMixStart.input_stream_list(v)});var y=[];e.outputList.forEach(function(t){var n={},i="";if("string"==typeof t)i=t;else{if("object"!=typeof t||!t.target)return c.logger.error("zb.sh.ums output target required"),r({errorCode:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;i=t.target}i.startsWith("rtmp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8")?n.mixurl=i:n.stream_id=c.stateCenter.testEnvironment?"zegotest-"+c.stateCenter.appid+"-"+i:i,n.bitrate=1e3*e.outputConfig.outputBitrate,n.fps=e.outputConfig.outputFPS,n.width=e.outputConfig.outputWidth,n.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(n.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===m.videoCodec?n.audio_enc_id=3:"h264"===m.videoCodec&&(n.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(n.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(n.audio_channel_cnt=e.outputConfig.outputAudioChannels),n.testenv=c.stateCenter.testEnvironment?1:0,y.push(n)}),_.MixOutput=y,this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(u,void 0,{output_target_list:o.ZegoRTCLogEvent.kZegoTaskMixStart.output_target_list(y)});var S={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(_)};return this.logger.debug("zb.sh.ums send command"),this.sendBizChannelRequest(S,function(e,n,o){c.logger.debug("zb.sh.ums receive message");var i="zegotest-"+c.stateCenter.appid+"-";if(0!=o.length){for(var s=JSON.parse(o),a=[],u=0;u<s.play.length;u++){var l={rtmpURL:"",hlsURL:"",flvURL:""},d=s.play[u].stream_alias||"";c.stateCenter.testEnvironment&&d&&d.startsWith(i)&&(d=d.slice(i.length)),l.streamID=d,s.play[u].rtmp_url&&s.play[u].rtmp_url.length>0&&(l.rtmpURL=s.play[u].rtmp_url),s.play[u].hls_url&&s.play[u].hls_url.length>0&&(l.hlsURL=s.play[u].hls_url),s.play[u].hdl_url&&s.play[u].hdl_url.length>0&&(l.flvURL=s.play[u].hdl_url),a.push(l)}t&&t({errorCode:0,extendedData:JSON.stringify({mixerOutputList:a})})}else r&&r({errorCode:c.stateCenter.getServerError(10001).code,extendedData:""})},function(e,t,i){if("number"==typeof e){c.logger.debug("zb.sh.ums error: "+e);var a=[];if(1000000150==e&&0!=i.length)for(var u=JSON.parse(i),l="zegotest-"+c.stateCenter.appid+"-",d=0;d<u.non_exist_streams.length;d++){var h=u.non_exist_streams[d];c.stateCenter.testEnvironment&&h.startsWith(l)?a.push(h.slice(l.length)):a.push(h)}r&&r({errorCode:c.stateCenter.getServerError(s+e).code,extendedData:""})}else{var p;c.logger.debug("zb.sh.ums error code "+e.code),p=e==n.errorCodeList.TIMEOUT?o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:o.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,r&&r({errorCode:p.code,extendedData:p.message})}}),!0}}},817:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}}},577:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5906);t.default={type:"MixStream",install:function(e,t){for(var r in n.zegoWebRTC)Object.defineProperty(e.prototype,r,{value:n.zegoWebRTC[r],writable:!1});for(var r in n.streamHandler)Object.defineProperty(t.prototype,r,{value:n.streamHandler[r],writable:!1})}}},6145:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTCLogEvent=void 0;var n=r(817),o=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:n.errorCodeList.INPUT_PARAM,kTaskIDNullError:n.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:n.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:n.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:n.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:n.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:n.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:n.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:n.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:n.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:n.errorCodeList.NOT_LOGIN},mix_stream_id:o,stream_cnt:o,input_stream_list:o,output_target_list:o},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:n.errorCodeList.INPUT_PARAM,kTaskIDNullError:n.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:n.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:n.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:n.errorCodeList.NOT_LOGIN}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:n.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:n.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:n.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID,kNoLoginError:n.errorCodeList.NOT_LOGIN},config:o}}},2760:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(r(2730)),a=i(r(5947)),u=i(r(1646)),l=i(r(1576)),c=r(7803),d=r(1297),h=function(){function e(e){var t=this;this.isSpatial=!1,this.audioSourceList=[],this.speakingUserIdList=[],this._audioCtx=null,this.zegoRTC=e,this.zegoRTC.on("roomStreamUpdate",function(e,r,n){var o=n.map(function(e){return e.streamID});"DELETE"===r?t.speakingUserIdList=t.speakingUserIdList.filter(function(e){var r=!o.includes(e);if(!r){var n=t.audioSourceMap[e];n&&n.isPlaying&&n.stopPlayingAudio()}return r}):"ADD"===r&&(t.speakingUserIdList=t.speakingUserIdList.concat(o),n.forEach(function(e){if(!t.audioSourceMap[e.streamID]){var r=t.getStreamInfo(e.extraInfo),n=new s.default({userID:e.streamID,teamID:r.teamID,sendMode:r.sendMode},{audioCtx:t.audioCtx,zegoRTC:t.zegoRTC,isSpatial:t.isSpatial,maxDistance:t.rangeListener.recvRange});t.audioSourceList.push(n),t.playStreamHandler.handlePlayAudioTask()}})),t.playStreamHandler.setAudioSourceList(t.speakingAudioSourceList)}),this.zegoRTC.on("playerStateUpdate",function(e){var r=t.audioSourceMap[e.streamID];r&&(r.isPlaying="NO_PLAY"!==e.state)}),this.zegoRTC.on("streamExtraInfoUpdate",function(e,r){r.forEach(function(e){var r=t.audioSourceMap[e.streamID];if(r){var n=t.getStreamInfo(e.extraInfo),o=n.teamID,i=n.sendMode;o!==r.teamID&&(r.teamID=o,t.enableSpatializer(t.isSpatial)),void 0!==i&&(r.sendMode=i),t.playStreamHandler.handlePlayAudioTask()}})}),this.zegoRTC.RTM._on("_roomStateUpdate",function(e,r){"CONNECTED"===r?(t.roomID=e,t.rangeListener.userID=t.zegoRTC.RTM.getUserID()):"DISCONNECTED"===r&&(t.roomID=void 0,t.rangeListener.reset(),t.audioSourceList=[])});var r=window.AudioContext||window.webkitAudioContext;this._audioCtx=this.zegoRTC&&this.zegoRTC.ac||new r,this.rangeListener=a.default.getInstance(this.audioCtx,this.zegoRTC),this.playStreamHandler=u.default.getInstance(this.rangeListener),this.eventManager=l.default.getInstance()}return Object.defineProperty(e.prototype,"audioSourceMap",{get:function(){return this.audioSourceList.reduce(function(e,t){return t.userID&&(e[t.userID]=t),e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speakingAudioSourceList",{get:function(){var e=this;return this.audioSourceList.filter(function(t){return!!e.speakingUserIdList.includes(t.userID)})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playingAudioSourceList",{get:function(){return this.audioSourceList.filter(function(e){return e.isPlaying})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioCtx",{get:function(){if(!this._audioCtx){var e=window.AudioContext||window.webkitAudioContext;this._audioCtx=new e}return this._audioCtx},enumerable:!1,configurable:!0}),e.getInstance=function(t){return e.instance||(e.instance=new e(t)),e.instance},e.prototype.resumeAudioContext=function(){return n(this,void 0,void 0,function(){var e=this;return o(this,function(t){return[2,new Promise(function(t){e.audioCtx.onstatechange=function(){"running"===e.audioCtx.state&&t(!0)},e.audioCtx.suspend(),e.audioCtx.resume(),setTimeout(function(){t(!1)},3e3)})]})})},e.prototype.getAudioContextState=function(){return this.audioCtx.state},e.prototype.getStreamInfo=function(e){var t=void 0,r=void 0;try{var n=JSON.parse(e);t=n.range_audio_team_id,[d.ZegoRangeAudioMode.World,d.ZegoRangeAudioMode.Team].includes(n.range_audio_mode)&&(r=n.range_audio_mode)}catch(e){}return{teamID:t,sendMode:r}},e.prototype.setAudioReceiveRange=function(e){if(!c.checkNumber(e))throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' requires to be type number.");if((e=Number(e))<0)throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' can not be less than 0.");this.rangeListener.recvRange=e,this.audioSourceList.forEach(function(t){t.setMaxDistance(e)})},e.prototype.updateSelfPosition=function(e,t,r,n){var o=function(e){return"Failed to execute 'updateSelfPosition': Argument '"+e+"' requires an array of type number.\""};if(!c.checkCoordinate(e))throw new Error(o("position"));if(!c.checkCoordinate(t))throw new Error(o("axisForward"));if(!c.checkCoordinate(r))throw new Error(o("axisRight"));if(!c.checkCoordinate(n))throw new Error(o("axisUp"));this.rangeListener&&this.rangeListener.updateSelfPosition(e,t,n),this.playStreamHandler.setListener(this.rangeListener)},e.prototype.updateAudioSource=function(e,t){if(e=String(e),!c.checkCoordinate(t))throw new Error("Failed to execute 'updateAudioSource': Arguments 'position' must be an array of type number.");var r=this.audioSourceMap[e];r?r.setPosition(t):(r=new s.default({userID:e,position:t},{audioCtx:this.audioCtx,zegoRTC:this.zegoRTC,isSpatial:this.isSpatial,maxDistance:this.rangeListener.recvRange}),this.enableSpatializer(this.isSpatial),this.audioSourceList.push(r)),this.playStreamHandler.setAudioSourceList(this.speakingAudioSourceList)},e.prototype.enableMicrophone=function(e){if(void 0===e&&(e=!0),!this.rangeListener.userID)throw new Error("Enable mic failed. Please log in room first.");return e?this.rangeListener.startPublishingStream():this.rangeListener.stopPublishingStream()},e.prototype.enableSpeaker=function(e){if(void 0===e&&(e=!0),!this.roomID)throw new Error("Enable speaker failed. Please log in room first.");this.playStreamHandler.isEnable=e,e?(this.playStreamHandler.startPlayingAudioStream(),this.playStreamHandler.handlePlayAudioTask()):this.playStreamHandler.stopPlayingAudioStream()},e.prototype.enableSpatializer=function(e){var t=this;void 0===e&&(e=!0),this.isSpatial=!!e,this.audioSourceList.forEach(function(r){var n=!(![r.teamID,t.rangeListener.teamID].includes(void 0)&&t.rangeListener.teamID===r.teamID)&&e;r.enableSpatializer(n)}),e&&this.rangeListener.updateListenerEffect()},e.prototype.setRangeAudioTeamID=function(e){this.rangeListener.setTeamID(e),this.enableSpatializer(this.isSpatial),this.playStreamHandler.handlePlayAudioTask()},e.prototype.setRangeAudioMode=function(e){this.rangeListener.setSendMode(e),this.rangeListener.setRecvMode(e),this.playStreamHandler.handlePlayAudioTask()},e.prototype.on=function(e,t){return this.eventManager.addEventHandler(e,t)},e.prototype.off=function(e,t){return this.eventManager.removeEventHandler(e,t)},e}();t.default=h},2777:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RangeAudio=void 0;var n=r(3116);t.RangeAudio={type:"RangeAudio",install:function(e){Object.defineProperty(e.prototype,"createRangeAudioInstance",{value:function(){return this.rangeAudio||(this.rangeAudio=n.ZegoExpressRangeAudio.getInstance(this)),this.rangeAudio},writable:!1})}}},2730:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(1297),s=function(){function e(e,t){this.panner=null,this.isSpatial=!1,this.autoPlay=!0,this.position=null,this.stream=null,this.sourceNode=null,this.isPlaying=!1,this.distance=null,this.audioCtx=t.audioCtx,this.zegoRTC=t.zegoRTC,this.isSpatial=t.isSpatial,this.maxDistance=t.maxDistance||1e5,this.userID=e.userID,this.teamID=e.teamID,this.sendMode=void 0!==e.sendMode?e.sendMode:i.ZegoRangeAudioMode.World,e.position&&(this.position=e.position)}return Object.defineProperty(e.prototype,"audioWrapper",{get:function(){var e=document.getElementById("#zg-audio-source-wrapper");return e||((e=document.createElement("div")).setAttribute("id","zg-audio-source-wrapper"),document.body.appendChild(e)),e},enumerable:!1,configurable:!0}),e.prototype.createPanner=function(){var e=this.position||[0,0,0];return new PannerNode(this.audioCtx,{panningModel:"HRTF",distanceModel:"linear",refDistance:1,maxDistance:this.maxDistance,rolloffFactor:1,coneOuterGain:.4,positionX:e[1],positionY:e[0],positionZ:-e[0]})},e.prototype.startPlayingAudio=function(){return n(this,void 0,void 0,function(){var e,t;return o(this,function(r){switch(r.label){case 0:return(e=document.getElementById("zg-audio-source-"+this.userID))?[3,2]:((e=document.createElement("audio")).setAttribute("autoplay","autoplay"),e.setAttribute("id","zg-audio-source-"+this.userID),e.setAttribute("crossorigin","anonymous"),t=this,[4,this.zegoRTC.startPlayingStream(this.userID)]);case 1:t.stream=r.sent(),this.audioWrapper.appendChild(e),this.stream&&(e.srcObject=this.stream,this.sourceNode=this.audioCtx.createMediaStreamSource(this.stream)),this.panner||(this.panner=this.createPanner()),this.sourceNode&&this.enableSpatializer(this.isSpatial,!0),"suspended"===this.audioCtx.state&&this.audioCtx.resume(),r.label=2;case 2:return e&&e.parentNode&&e.parentNode.removeChild(e),[2]}})})},e.prototype.stopPlayingAudio=function(){this.isPlaying&&this.zegoRTC.stopPlayingStream(this.userID),this.stream=null,this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null)},e.prototype.setPosition=function(e){this.position=e,this.panner&&(this.panner.positionX.value=e[1],this.panner.positionY.value=e[2],this.panner.positionZ.value=-e[0])},e.prototype.setMaxDistance=function(e){this.maxDistance=e,this.panner&&(this.panner.maxDistance=this.maxDistance)},e.prototype.getDistanceFromListener=function(e){var t=this.position,r=e.position;if(!r||!t)return null;var n=[t[0]-r[0],t[1]-r[1],t[2]-r[2]];return this.distance=Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)),this.distance},e.prototype.enableSpatializer=function(e,t){void 0===t&&(t=!1),(t||this.isSpatial!==e)&&(this.isSpatial=e,this.sourceNode&&(e&&this.panner?(this.sourceNode.disconnect(),this.sourceNode.connect(this.panner).connect(this.audioCtx.destination)):e||(this.sourceNode.disconnect(),this.sourceNode.connect(this.audioCtx.destination))))},e}();t.default=s},1576:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.handlerListMap={microphoneStateUpdate:[]}}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.addEventHandler=function(e,t){if(!this.handlerListMap[e])return!1;if("function"!=typeof t)throw new Error("Params callBack is not a Function");return-1==this.handlerListMap[e].indexOf(t)&&this.handlerListMap[e].push(t),!0},e.prototype.removeEventHandler=function(e,t){return!!this.handlerListMap[e]&&(this.handlerListMap[e]=t?this.handlerListMap[e].filter(function(e){return e!==t}):[],!0)},e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.handlerListMap[e]&&this.handlerListMap[e].forEach(function(r){try{setTimeout(function(){r.apply(void 0,t)},0)}catch(t){console.error("dispatch "+e+" "+t)}})},e}();t.default=r},1646:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1297),o=function(){function e(e){this.isEnable=!1,this.interval=3e3,this.timer=null,this.audioSourceList=[],this.hasChanged=!1,this.maxPlayingQuantity=20,this.rangeListener=e}return e.getInstance=function(t){return e.instance||(e.instance=new e(t)),e.instance},e.prototype.setListener=function(e){this.rangeListener=e,this.hasChanged=!0},e.prototype.setAudioSourceList=function(e){this.audioSourceList=e,this.hasChanged=!0},e.prototype.startPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.playAudioTask()},e.prototype.playAudioTask=function(){var e=this;this.hasChanged&&(this.hasChanged=!1,this.handlePlayAudioTask()),this.timer=window.setTimeout(function(){e.playAudioTask()},this.interval)},e.prototype.handlePlayAudioTask=function(){var e=this;if(this.isEnable){var t=this.getTeamAudioSourceGroup(),r=t.otherList,o=0;t.teamList.forEach(function(t){o<e.maxPlayingQuantity&&(t.isPlaying||t.startPlayingAudio(),o++)});var i=this.rangeListener.recvMode===n.ZegoRangeAudioMode.World;i&&(r.forEach(function(t){t.distance=t.getDistanceFromListener(e.rangeListener)}),r.sort(function(e,t){return null===e.distance?1:null===t.distance||e.distance<t.distance?-1:e.distance>t.distance?1:0})),r.forEach(function(t){i&&o<e.maxPlayingQuantity&&t.sendMode!==n.ZegoRangeAudioMode.Team&&null!==t.distance&&(null===e.rangeListener.recvRange||t.distance<=e.rangeListener.recvRange)?(t.isPlaying||t.startPlayingAudio(),o++):t.stopPlayingAudio()})}else this.stopPlayingAudioStream()},e.prototype.getTeamAudioSourceGroup=function(){var e=this,t=[],r=[];return this.audioSourceList.forEach(function(n){[n.teamID,e.rangeListener.teamID].includes(void 0)||n.teamID!==e.rangeListener.teamID?r.push(n):t.push(n)}),{teamList:t,otherList:r}},e.prototype.stopPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.audioSourceList.forEach(function(e){e.stopPlayingAudio()})},e}();t.default=o},5947:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1297),i=n(r(1576)),s=function(){function e(e,t){var r=this;this.recvMode=o.ZegoRangeAudioMode.World,this.sendMode=o.ZegoRangeAudioMode.World,this.recvRange=null,this.position=null,this.forwardAxis=[1,0,0],this.upAxis=[0,0,1],this.audioStream=null,this.isPublishing=!1,this.zegoRTC=t,this.audioCtx=e,this.audioListener=this.audioCtx.listener,this.eventHandler=i.default.getInstance(),this.zegoRTC.on("publisherStateUpdate",function(e){var t=e.state,n=e.errorCode,i=e.extendedData;e.streamID===r.userID&&("NO_PUBLISH"===t?(r.isPublishing=!1,r.stopPublishingStream()):r.isPublishing=!0),r.eventHandler.emit("microphoneStateUpdate",{NO_PUBLISH:o.ZegoRangeAudioMicrophoneState.Off,PUBLISH_REQUESTING:o.ZegoRangeAudioMicrophoneState.TurningOn,PUBLISHING:o.ZegoRangeAudioMicrophoneState.On}[t],n,i)})}return e.getInstance=function(t,r){return e.instance||(e.instance=new e(t,r)),e.instance},e.prototype.updateSelfPosition=function(e,t,r){this.position=e,this.forwardAxis=t,Array.isArray(r)&&(this.upAxis=r),this.updateListenerEffect()},e.prototype.updateListenerEffect=function(){this.position&&(this.audioListener.positionX?(this.audioListener.positionX.value=this.position[1],this.audioListener.positionY.value=this.position[2],this.audioListener.positionZ.value=-this.position[0]):this.audioListener.setPosition(this.position[1],this.position[2],-this.position[0]),this.audioListener.forwardX?(this.audioListener.forwardX.value=this.forwardAxis[1],this.audioListener.forwardY.value=this.forwardAxis[2],this.audioListener.forwardZ.value=-this.forwardAxis[0],this.audioListener.upX.value=this.upAxis[1],this.audioListener.upY.value=this.upAxis[2],this.audioListener.upZ.value=-this.upAxis[0]):this.audioListener.setOrientation(this.forwardAxis[1],this.forwardAxis[2],-this.forwardAxis[0],this.upAxis[1],this.upAxis[2],-this.upAxis[0]))},e.prototype.startPublishingStream=function(){var e=this;this.zegoRTC.createStream({camera:{video:!1,audio:!0,audioBitrate:30}}).then(function(t){if(!e.userID)throw e.zegoRTC.destroyStream(t),Error("Enable mic failed. Please log in room first.");e.audioStream&&e.audioStream!==t&&e.zegoRTC.destroyStream(e.audioStream),e.audioStream=t,e.zegoRTC.startPublishingStream(e.userID,t,{extraInfo:JSON.stringify({range_audio_team_id:e.teamID,range_audio_mode:e.sendMode})})}).catch(function(e){throw e})},e.prototype.stopPublishingStream=function(){this.isPublishing&&this.userID&&this.zegoRTC.stopPublishingStream(this.userID),this.isPublishing=!1,this.audioStream&&(this.zegoRTC.destroyStream(this.audioStream),this.audioStream=null)},e.prototype.setRecvMode=function(e){this.recvMode=e},e.prototype.setSendMode=function(e){this.sendMode=e,this.updateSteamExtraInfo()},e.prototype.setTeamID=function(e){this.teamID=e,this.updateSteamExtraInfo()},e.prototype.updateSteamExtraInfo=function(){this.userID&&this.isPublishing&&this.zegoRTC.setStreamExtraInfo(this.userID,JSON.stringify({range_audio_team_id:this.teamID||void 0,range_audio_mode:this.sendMode}))},e.prototype.reset=function(){this.audioStream&&this.stopPublishingStream(),this.userID=void 0},e}();t.default=s},7803:function(e,t){"use strict";function r(e){return!isNaN(Number(e))&&Number.MAX_SAFE_INTEGER>=Number(e)&&Number(e)>=-Number.MAX_SAFE_INTEGER}Object.defineProperty(t,"__esModule",{value:!0}),t.checkCoordinate=t.checkBoolean=t.checkNumber=void 0,t.checkNumber=r,t.checkBoolean=function(e){return!1},t.checkCoordinate=function(e){if(Array.isArray(e)){for(var t=0;t<3;t++)if(!r(e[t]))return!1;return!0}return!1}},3524:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.preview=t.zegoWebRTC=void 0;var s=i(r(954)),a=r(3471);t.zegoWebRTC={setBeautyEffect:function(e,t,r){var n=this;return new Promise(function(o,i){if(!(e instanceof MediaStream))return n.logger.error(ZEGO_WEBRTC_ACTION.SET_BEAUTY_EFFECT+" localStream not found"),void i({errorCode:ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.code,extendedData:ZegoRTCLogEvent.kZegoReplaceTrack.error.kParamError.message+" localStream no found"});t=!!t;var s=function(e){o(e)},u=n.streamCenter.checkPreview(e);if(!u)return n.logger.error("zc.sbe.0 preview no found"),void s({errorCode:a.errorCodeList.PUBLISH_NO_PREVIEW.code,extendedData:a.errorCodeList.PUBLISH_NO_PREVIEW.message});u.setBeautyEffect(t,r).then(function(){s({errorCode:0,extendedData:""})}).catch(function(e){i({errorCode:e.errorCode||-1,extendedData:e.extendedData||JSON.stringify(e)})})})}},t.preview={setBeautyEffect:function(e,t){return n(this,void 0,void 0,function(){var r,i=this;return o(this,function(u){switch(u.label){case 0:if(!this.videoTrack)return this.logger.error("zc.p.0.sbe.0 video track no found"),[2];if("undefined"==typeof WebGLRenderingContext)throw{errorCode:(r=a.errorCodeList.VIDEO_EFFECT_NOT_SUPPORT).code,extendedData:r.message};return s.default?this.videoEffect?this.videoTrack===this.videoEffect.input?[3,2]:[4,this.videoEffect.setInput(this.videoTrack)]:[3,4]:[3,7];case 1:u.sent(),u.label=2;case 2:return[4,this.videoEffect.setBeautyEffectOptions(e,t)];case 3:return u.sent(),[3,6];case 4:return this.videoEffect=new s.default(this.logger,this.videoTrack),this.videoEffect.onOverload=function(e){i.stateCenter.actionListener("beautyEffectOverload",i.localStream,e)},this.videoEffect.onOutputChange=function(e){return n(i,void 0,void 0,function(){var t,r,n;return o(this,function(o){return this.videoTrack&&this.localStream&&(t=this.videoTrack,e&&(t=e),this.localStream.getVideoTracks()[0]!==t&&((r=null===(n=this.streamCenter.checkPublish(this.localStream))||void 0===n?void 0:n.publisher)&&r.previewer?r.replacePublishedTrack(t,!0):this.replacePreviewTrack(t,!!e))),[2]})})},[4,this.videoEffect.setBeautyEffectOptions(e,t)];case 5:u.sent(),u.label=6;case 6:return[3,8];case 7:this.logger.error("zc.p.0.sbe.0 beauty effect module no found"),u.label=8;case 8:return[2]}})})}}},3048:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PUBLISH_SET_BEAUTY_EFFECT=void 0;var s=i(r(8606)),a=i(r(5683)),u=i(r(8302));t.PUBLISH_SET_BEAUTY_EFFECT="zc.p.0.sbe.2";var l=function(){function e(e){this.logger=e,this.gl=null,this.effectConfig={sharpenIntensity:.5,whitenIntensity:.5,rosyIntensity:.5,smoothIntensity:.5},this.originResolution={width:0,height:0},this.shaderList=[],this.frameBufferList=[],this.outputTextureList=[],this.inputTexture=null,this.enableBeauty=!1}return e.prototype.setEnableBeauty=function(e){this.enableBeauty=!!e},e.prototype.init=function(e,r,i){return n(this,void 0,void 0,function(){var n,l,c;return o(this,function(o){return"undefined"!=typeof WebGLRenderingContext?(this.gl=i.getContext("webgl"),this.gl?(this.initGL(e,r),this.inputTexture?(this.canvasEl=i,(n=new s.default(this.gl,e,r)).setConstUniforms(),(l=new a.default(this.gl,e,r)).setConstUniforms(),(c=new u.default(this.gl,e,r)).setConstUniforms(),this.shaderList=[n,l,c],this.setEffectConfig(this.effectConfig),[2]):[2,this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" input texture not found")]):[2,this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" not get webgl context")]):[2,this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" not support webgl!")]})})},e.prototype.render=function(e){return n(this,void 0,void 0,function(){var r,n,i,s,a=this;return o(this,function(o){switch(o.label){case 0:return(r=this.gl)&&this.canvasEl?this.originResolution.height===e.videoHeight&&this.originResolution.width===e.videoWidth||!(Math.abs(this.originResolution.height-e.videoHeight)>2||Math.abs(this.originResolution.width-e.videoWidth)>2)?[3,3]:0===e.videoHeight||0===e.videoWidth?[2]:(this.canvasEl.width=e.videoWidth,this.canvasEl.height=e.videoHeight,e.setAttribute("width",e.videoWidth.toString()),e.setAttribute("height",e.videoHeight.toString()),!this.gl||this.gl.isContextLost()?[3,1]:(this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" resolution changed, reset resolution"),this.resetResolution(e.videoWidth,e.videoHeight),[3,3])):(this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" video effect manager is not init!"),[2]);case 1:return this.logger.warn(t.PUBLISH_SET_BEAUTY_EFFECT+" resolution changed and gl context lost, restart effect"),this.release(),[4,this.init(e.videoWidth,e.videoHeight,this.canvasEl)];case 2:o.sent(),o.label=3;case 3:return n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],i=[0,1,2,0,2,3],s=[0,0,1,0,1,1,0,1],r.viewport(0,0,e.width,e.height),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.inputTexture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),this.shaderList.forEach(function(e,t){var o=e.program;if(o){e.renderPreTextures&&e.renderPreTextures(n,i,s),r.useProgram(o),e.render();var u=r.getUniformLocation(o,"uTexture"),l=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,l),r.bufferData(r.ARRAY_BUFFER,new Float32Array(n),r.STATIC_DRAW);var c=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,c),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),r.STATIC_DRAW);var d=r.getAttribLocation(o,"aPosition");r.enableVertexAttribArray(d),r.vertexAttribPointer(d,3,r.FLOAT,!1,0,0);var h=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,new Float32Array(s),r.STATIC_DRAW);var p=r.getAttribLocation(o,"aTexCoordinate");r.enableVertexAttribArray(p),r.vertexAttribPointer(p,2,r.FLOAT,!1,0,0);var f=t===a.shaderList.length-1?null:a.outputTextureList[t];r.bindFramebuffer(r.FRAMEBUFFER,t===a.shaderList.length-1?null:a.frameBufferList[t]),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),r.activeTexture(r.TEXTURE0),f&&r.bindTexture(r.TEXTURE_2D,f),r.uniform1i(u,0)}}),[2]}})})},e.prototype.setEffectConfig=function(e){var t=this;isNaN(e.sharpenIntensity)||(this.effectConfig.sharpenIntensity=e.sharpenIntensity),isNaN(e.whitenIntensity)||(this.effectConfig.whitenIntensity=e.whitenIntensity),isNaN(e.rosyIntensity)||(this.effectConfig.rosyIntensity=e.rosyIntensity),isNaN(e.smoothIntensity)||(this.effectConfig.smoothIntensity=e.smoothIntensity),this.shaderList.forEach(function(e){e.setEffectConfig(t.effectConfig)})},e.prototype.release=function(){var e=this;this.shaderList.forEach(function(t){var r;t.program&&(null===(r=e.gl)||void 0===r||r.deleteProgram(t.program))}),this.outputTextureList.forEach(function(t){var r;t&&(null===(r=e.gl)||void 0===r||r.deleteTexture(t))}),this.frameBufferList.forEach(function(t){var r;t&&(null===(r=e.gl)||void 0===r||r.deleteFramebuffer(t))}),this.inputTexture=this.gl=null,this.shaderList=[],this.outputTextureList=[],this.frameBufferList=[]},e.prototype.initGL=function(e,r){var n=this.gl;if(!n)return this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" webgl context not found");this.inputTexture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.inputTexture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR);for(var o=0;3>o;o++){var i=n.createTexture();if(!i)return this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" create texture failed");n.bindTexture(n.TEXTURE_2D,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,r,0,n.RGBA,n.UNSIGNED_BYTE,null);var s=n.createFramebuffer();if(!s)return this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" create frame buffer failed");n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,i,0),this.outputTextureList.push(i),this.frameBufferList.push(s)}n.viewport(0,0,e,r),this.originResolution.width=e,this.originResolution.height=r},e.prototype.resetResolution=function(e,r){var n=this.gl;if(!n)return this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" can not find webgl context");this.outputTextureList.forEach(function(t){n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,r,0,n.RGBA,n.UNSIGNED_BYTE,null)}),n.viewport(0,0,e,r),this.originResolution.width=e,this.originResolution.height=r},e}();t.default=l},3471:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={VIDEO_EFFECT_NOT_SUPPORT:{code:1103072,message:"not support beauty effect"}}},957:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BeautyEffect=void 0;var n=r(3524);t.BeautyEffect={type:"BeautyEffect",install:function(e,t){for(var r in n.preview)Object.defineProperty(t.prototype,r,{value:n.preview[r],writable:!1});for(var r in n.zegoWebRTC)Object.defineProperty(e.prototype,r,{value:n.zegoWebRTC[r],writable:!1})}}},836:function(e,t){"use strict";var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.logger=e,this.recordedFrameCount=0,this.targetFrameRate=0,this.recordingDuration=0}return e.prototype.startRecordBeautyEffectOutput=function(e){return r(this,void 0,void 0,function(){var t,r,o,i=this;return n(this,function(n){switch(n.label){case 0:return t=6,this.recordID?(this.logger.warn("zc.p.0.sbe.3 detector is already recording"),[2,{result:!0}]):(r=(new Date).getTime(),this.recordID=r,this.targetFrameRate=e,this.recordedFrameCount=0,this.recordingDuration=t,[4,new Promise(function(e){window.setTimeout(e,1e3*i.recordingDuration)})]);case 1:return n.sent(),this.recordID!==r?(this.recordID=void 0,[2,{result:!0}]):(this.recordID=void 0,o=this.recordedFrameCount/t,this.recordedFrameCount<this.targetFrameRate*this.recordingDuration/2?(this.logger.warn("zc.p.0.sbe.3 detect effect overload: current fps: "+o),[2,{result:!1,targetFPS:this.targetFrameRate,currentFPS:o}]):(this.logger.info("zc.p.0.sbe.3 detect effect current fps: "+o),[2,{result:!0}]))}})})},e.prototype.stopRecordBeautyEffectOutput=function(){this.recordedFrameCount=this.targetFrameRate=0,this.recordID=void 0},e.prototype.addFrame=function(){this.recordID&&(this.recordedFrameCount+=1)},e}();t.default=o},5683:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(r(6976)),a=r(1199),u=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.width=r,o.height=n,o.type="LightShader",o.uLightIntensity=null,o.uRedIntensity=null,o.whitenIntensity=.5,o.rosyIntensity=.5,o.program=o.makeProgram(a.lightVS,a.lightFS),o}return o(t,e),t.prototype.setEffectConfig=function(e){isNaN(e.whitenIntensity)||(this.whitenIntensity=e.whitenIntensity/100),isNaN(e.rosyIntensity)||(this.rosyIntensity=e.rosyIntensity/100)},t.prototype.render=function(){var e=this.gl;e.uniform1f(this.uLightIntensity,this.whitenIntensity),e.uniform1f(this.uRedIntensity,this.rosyIntensity)},t.prototype.setConstUniforms=function(){var e=this.program;if(e){var t=this.gl;t.useProgram(e),this.uLightIntensity=t.getUniformLocation(e,"intensity"),t.uniform1f(this.uLightIntensity,this.whitenIntensity),this.uRedIntensity=t.getUniformLocation(e,"rosyIntensity"),t.uniform1f(this.uRedIntensity,this.rosyIntensity);var r=t.getUniformLocation(e,"uPMVMatrix");t.uniformMatrix4fv(r,!1,[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}},t}(s.default);t.default=u},6976:function(e,t){"use strict";function r(e){for(var t=e,r="",n=0;n<t.length;n++){var o=t.charCodeAt(n),i=o;o>=65&&o<=90&&(i=(o-65-13+26)%26+65),o>=97&&o<=122&&(i=(o-97-13+26)%26+97),r+=String.fromCharCode(i)}return r}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.gl=e,this.program=null,this.program=null}return e.prototype.setEffectConfig=function(e){},e.prototype.setConstUniforms=function(){},e.prototype.render=function(){},e.prototype.renderPreTextures=function(e,t,r){},e.prototype.makeProgram=function(e,t){var n=this.gl,o=r(e),i=r(t),s=this.makeShader(o,n.VERTEX_SHADER),a=this.makeShader(i,n.FRAGMENT_SHADER),u=n.createProgram();return n.attachShader(u,s),n.attachShader(u,a),n.linkProgram(u),n.getProgramParameter(u,n.LINK_STATUS),u},e.prototype.makeShader=function(e,t){var r=this.gl,n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS),n},e}();t.default=n},8606:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(r(6976)),a=r(1199),u=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.width=r,o.height=n,o.type="BlurShader",o.blurXProgram=null,o.blurYProgram=null,o.diffProgram=null,o.uIntensity=null,o.smoothIntensity=.5,o.blurTextureList=[],o.blurBufferList=[],o.blurXProgram=o.makeProgram(a.borderBlurVS,a.borderBlurFS),o.setBorderBlurProgram(o.blurXProgram,1/(r||1),0),o.blurYProgram=o.makeProgram(a.borderBlurVS,a.borderBlurFS),o.setBorderBlurProgram(o.blurYProgram,0,1/(n||1)),o.diffProgram=o.makeProgram(a.diffBlurVS,a.diffBlurFS),o.setDiffBlurProgram(o.diffProgram),o.program=o.makeProgram(a.mixBlurVS,a.mixBlurFS),o.initBlurBuffer(),o}return o(t,e),t.prototype.setEffectConfig=function(e){isNaN(e.smoothIntensity)||(this.smoothIntensity=e.smoothIntensity/100)},t.prototype.render=function(){this.gl.uniform1f(this.uIntensity,this.smoothIntensity)},t.prototype.initBlurBuffer=function(){var e=this.gl;this.blurTextureList=[],this.blurTextureList=[];for(var t=0;t<3;t++){var r=e.createTexture();if(!r)return;e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null);var n=e.createFramebuffer();if(!n)return;e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),this.blurTextureList.push(r),this.blurBufferList.push(n)}},t.prototype.renderPreTextures=function(e,t,r){var n=this,o=this.gl,i=[0,1,0],s=[1,1,2];[this.blurXProgram,this.blurYProgram,this.diffProgram].forEach(function(a,u){if(a){o.useProgram(a);var l=o.getUniformLocation(a,"uTexture");o.uniform1i(l,i[u]);var c=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,c),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.STATIC_DRAW);var d=o.createBuffer();o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,d),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),o.STATIC_DRAW);var h=o.getAttribLocation(a,"aPosition");o.enableVertexAttribArray(h),o.vertexAttribPointer(h,3,o.FLOAT,!1,0,0);var p=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,p),o.bufferData(o.ARRAY_BUFFER,new Float32Array(r),o.STATIC_DRAW);var f=o.getAttribLocation(a,"aTexCoordinate");o.enableVertexAttribArray(f),o.vertexAttribPointer(f,2,o.FLOAT,!1,0,0),o.bindFramebuffer(o.FRAMEBUFFER,n.blurBufferList[u]),o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0),o.activeTexture(o.TEXTURE0+s[u]),o.bindTexture(o.TEXTURE_2D,n.blurTextureList[u])}})},t.prototype.setConstUniforms=function(){var e=this.width,t=this.height,r=this.program;if(r){var n=this.gl;n.useProgram(r);var o=n.getUniformLocation(r,"widthOffset");n.uniform1f(o,1/e);var i=n.getUniformLocation(r,"heightOffset");n.uniform1f(i,1/t),this.uIntensity=n.getUniformLocation(r,"blurAlpha"),n.uniform1f(this.uIntensity,this.smoothIntensity);var s=n.getUniformLocation(r,"blurTexture");n.uniform1i(s,1);var a=n.getUniformLocation(r,"blurDiffTexture");n.uniform1i(a,2)}},t.prototype.setBorderBlurProgram=function(e,t,r){var n=this.gl;n.useProgram(e);var o=n.getUniformLocation(e,"texBlurWidthOffset");n.uniform1f(o,t);var i=n.getUniformLocation(e,"texBlurHeightOffset");n.uniform1f(i,r)},t.prototype.setDiffBlurProgram=function(e){var t=this.gl;t.useProgram(e);var r=t.getUniformLocation(e,"blurTexture");t.uniform1i(r,1)},t}(s.default);t.default=u},1199:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mixBlurFS=t.mixBlurVS=t.diffBlurFS=t.diffBlurVS=t.borderBlurFS=t.borderBlurVS=t.sharpnessFS=t.sharpnessVS=t.lightFS=t.lightVS=void 0,t.lightVS="cerpvfvba uvtuc sybng;\nnggevohgr irp2 nGrkPbbeqvangr;\nnggevohgr irp4 nCbfvgvba;\nhavsbez zng4 hCZIZngevk;\ninelvat irp2 iGrkPbbeq;\nibvq znva() {\n    ty_Cbfvgvba = hCZIZngevk * nCbfvgvba;\n    iGrkPbbeq = nGrkPbbeqvangr;\n}",t.lightFS="cerpvfvba uvtuc sybng;\ninelvat irp2 iGrkPbbeq;\nhavsbez fnzcyre2Q hGrkgher;\nhavsbez sybng vagrafvgl;\nhavsbez sybng ebflVagrafvgl;\nirp3 oevtugarffNaqPbagenfg(irp3 pbybe){\n  sybng v = vagrafvgl * 1.0;\n  sybng CV = 3.1415926;\n  sybng O = 0.12 * v;\n  sybng p = 0.1 * v;\n  sybng x = gna((45. + 44. * p) / 180.0 * CV);\n  pbybe = ((pbybe*255.0 - 127.5 * (1.0 - O)) * x + 127.5 * (1.0 + O)) / 255.0;\n  erghea pbybe;\n}\nibvq znva() {\n  irp4 grkgherPbybe = grkgher2Q(hGrkgher, iGrkPbbeq);\n  grkgherPbybe = irp4(oevtugarffNaqPbagenfg(grkgherPbybe.eto), grkgherPbybe.j);\n  grkgherPbybe.e = zva(grkgherPbybe.e + 0.06 * ebflVagrafvgl, 1.0);\n  ty_SentPbybe = grkgherPbybe;\n}",t.sharpnessVS="\nnggevohgr irp4 nCbfvgvba;\nnggevohgr irp4 nGrkPbbeqvangr;\nhavsbez sybng vzntrJvqguSnpgbe;\nhavsbez sybng vzntrUrvtugSnpgbe;\nhavsbez sybng funecarff; \ninelvat irp2 iGrkPbbeq;\ninelvat irp2 yrsgGrkgherPbbeqvangr;\ninelvat irp2 evtugGrkgherPbbeqvangr;\ninelvat irp2 gbcGrkgherPbbeqvangr;\ninelvat irp2 obggbzGrkgherPbbeqvangr;\ninelvat sybng pragreZhygvcyvre;\ninelvat sybng rqtrZhygvcyvre;\nibvq znva() {\n  ty_Cbfvgvba = nCbfvgvba;\n  irp2 jvqguFgrc = irp2(vzntrJvqguSnpgbe, 0.0);\n  irp2 urvtugFgrc = irp2(0.0, vzntrUrvtugSnpgbe);\n  iGrkPbbeq = nGrkPbbeqvangr.kl;\n  yrsgGrkgherPbbeqvangr = nGrkPbbeqvangr.kl - jvqguFgrc;\n  evtugGrkgherPbbeqvangr = nGrkPbbeqvangr.kl + jvqguFgrc;\n  gbcGrkgherPbbeqvangr = nGrkPbbeqvangr.kl + urvtugFgrc;\n  obggbzGrkgherPbbeqvangr = nGrkPbbeqvangr.kl - urvtugFgrc;\n  pragreZhygvcyvre = 1.0 + 4.0 * funecarff;\n  rqtrZhygvcyvre = funecarff;\n}\n",t.sharpnessFS="\ncerpvfvba uvtuc sybng;\ninelvat uvtuc irp2 iGrkPbbeq;\ninelvat uvtuc irp2 yrsgGrkgherPbbeqvangr;\ninelvat uvtuc irp2 evtugGrkgherPbbeqvangr;\ninelvat uvtuc irp2 gbcGrkgherPbbeqvangr;\ninelvat uvtuc irp2 obggbzGrkgherPbbeqvangr;\ninelvat uvtuc sybng pragreZhygvcyvre;\ninelvat uvtuc sybng rqtrZhygvcyvre;\nhavsbez fnzcyre2Q hGrkgher;\nibvq znva() {\n  zrqvhzc irp4 nPbybe = grkgher2Q(hGrkgher, iGrkPbbeq);\n  zrqvhzc irp3 grkgherPbybe = nPbybe.eto;\n  zrqvhzc irp3 yrsgGrkgherPbybe = grkgher2Q(hGrkgher, yrsgGrkgherPbbeqvangr).eto;\n  zrqvhzc irp3 evtugGrkgherPbybe = grkgher2Q(hGrkgher, evtugGrkgherPbbeqvangr).eto;\n  zrqvhzc irp3 gbcGrkgherPbybe = grkgher2Q(hGrkgher, gbcGrkgherPbbeqvangr).eto;\n  zrqvhzc irp3 obggbzGrkgherPbybe = grkgher2Q(hGrkgher, obggbzGrkgherPbbeqvangr).eto;\n  ty_SentPbybe = irp4((grkgherPbybe * pragreZhygvcyvre - (yrsgGrkgherPbybe * rqtrZhygvcyvre + evtugGrkgherPbybe * rqtrZhygvcyvre + gbcGrkgherPbybe * rqtrZhygvcyvre + obggbzGrkgherPbybe * rqtrZhygvcyvre)), nPbybe.n);\n}",t.borderBlurVS="nggevohgr irp4 nCbfvgvba;\nnggevohgr irp4 nGrkPbbeqvangr;\nhavsbez uvtuc sybng grkOyheJvqguBssfrg;\nhavsbez uvtuc sybng grkOyheUrvtugBssfrg;\ninelvat irp2 i_grkpbbeq0;\ninelvat irp4 grkgherFuvsg_1;\ninelvat irp4 grkgherFuvsg_2;\ninelvat irp4 grkgherFuvsg_3;\ninelvat irp4 grkgherFuvsg_4;\nibvq znva()\n{\n  ty_Cbfvgvba = nCbfvgvba;\n  i_grkpbbeq0 = nGrkPbbeqvangr.kl;\n\n  irp2 fvatyrFgrcBssfrg = irp2(grkOyheJvqguBssfrg, grkOyheUrvtugBssfrg)*2.5;\n\n  grkgherFuvsg_1 = irp4(nGrkPbbeqvangr.kl - fvatyrFgrcBssfrg, nGrkPbbeqvangr.kl + fvatyrFgrcBssfrg);\n  grkgherFuvsg_2 = irp4(nGrkPbbeqvangr.kl - 2.0 * fvatyrFgrcBssfrg, nGrkPbbeqvangr.kl + 2.0 * fvatyrFgrcBssfrg);\n  grkgherFuvsg_3 = irp4(nGrkPbbeqvangr.kl - 3.0 * fvatyrFgrcBssfrg, nGrkPbbeqvangr.kl + 3.0 * fvatyrFgrcBssfrg);\n  grkgherFuvsg_4 = irp4(nGrkPbbeqvangr.kl - 4.0 * fvatyrFgrcBssfrg, nGrkPbbeqvangr.kl + 4.0 * fvatyrFgrcBssfrg);\n}",t.borderBlurFS="cerpvfvba zrqvhzc sybng;\nhavsbez fnzcyre2Q hGrkgher;\ninelvat irp2 i_grkpbbeq0;\ninelvat uvtuc irp4 grkgherFuvsg_1;\ninelvat uvtuc irp4 grkgherFuvsg_2;\ninelvat uvtuc irp4 grkgherFuvsg_3;\ninelvat uvtuc irp4 grkgherFuvsg_4;\nibvq znva(ibvq) { \n  zrqvhzc irp3 fhz = grkgher2Q(hGrkgher, i_grkpbbeq0).eto;\n  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_1.kl).eto;\n  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_1.mj).eto;\n  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_2.kl).eto;\n  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_2.mj).eto;\n  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_3.kl).eto;\n  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_3.mj).eto;\n  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_4.kl).eto;\n  fhz += grkgher2Q(hGrkgher, grkgherFuvsg_4.mj).eto;\n  ty_SentPbybe = irp4(fhz * 0.1111, 1.0); \n}",t.diffBlurVS="nggevohgr irp4 nCbfvgvba;\nnggevohgr irp4 nGrkPbbeqvangr;\nhavsbez zng4 hCZIZngevk;\ninelvat irp2 i_grkpbbeq0;\nibvq znva()\n{\n  // ty_Cbfvgvba = hCZIZngevk * nCbfvgvba;\n  ty_Cbfvgvba = nCbfvgvba;\n  i_grkpbbeq0 = nGrkPbbeqvangr.kl;\n}",t.diffBlurFS="cerpvfvba zrqvhzc sybng;\nhavsbez fnzcyre2Q hGrkgher;\ninelvat irp2 i_grkpbbeq0;\nhavsbez fnzcyre2Q oyheGrkgher;\nibvq znva(ibvq) {\n  irp4 vPbybe = grkgher2Q(oyheGrkgher, i_grkpbbeq0);\n  irp4 zrnaPbybe = grkgher2Q(hGrkgher, i_grkpbbeq0);\n  irp4 qvssPbybe = vPbybe - zrnaPbybe;\n  qvssPbybe.e = zva(qvssPbybe.e * 50.0 * qvssPbybe.e, 1.0);\n  qvssPbybe.t = zva(qvssPbybe.t * 50.0 * qvssPbybe.t, 1.0);\n  qvssPbybe.o = zva(qvssPbybe.o * 50.0 * qvssPbybe.o, 1.0);\n  ty_SentPbybe = irp4(qvssPbybe.eto, 1.0);\n}",t.mixBlurVS="\nnggevohgr irp4 nCbfvgvba;\nnggevohgr irp4 nGrkPbbeqvangr;\ninelvat irp2 i_grkpbbeq0;\nhavsbez sybng jvqguBssfrg;\nhavsbez sybng urvtugBssfrg;\ninelvat irp2 grkgherFuvsg_1;\ninelvat irp2 grkgherFuvsg_2;\ninelvat irp2 grkgherFuvsg_3;\ninelvat irp2 grkgherFuvsg_4;\nibvq znva()\n{\n  ty_Cbfvgvba = nCbfvgvba;\n  i_grkpbbeq0 = nGrkPbbeqvangr.kl;\n  grkgherFuvsg_1 = irp2(i_grkpbbeq0 + 0.5 * irp2(jvqguBssfrg,urvtugBssfrg));\n  grkgherFuvsg_2 = irp2(i_grkpbbeq0 + 0.5 * irp2(-jvqguBssfrg,-urvtugBssfrg));\n  grkgherFuvsg_3 = irp2(i_grkpbbeq0 + 0.5 * irp2(-jvqguBssfrg,urvtugBssfrg));\n  grkgherFuvsg_4 = irp2(i_grkpbbeq0 + 0.5 * irp2(jvqguBssfrg,-urvtugBssfrg));\n}\n",t.mixBlurFS="\ncerpvfvba zrqvhzc sybng;\nhavsbez fnzcyre2Q hGrkgher;\ninelvat irp2 i_grkpbbeq0;\nhavsbez fnzcyre2Q oyheGrkgher;\nhavsbez fnzcyre2Q oyheQvssGrkgher;\nhavsbez ybjc sybng oyheNycun;\nibvq znva(ibvq) {\n  ybjc irp4 vPbybe = grkgher2Q(hGrkgher, i_grkpbbeq0);\n  ybjc irp4 zrnaPbybe = grkgher2Q(oyheGrkgher, i_grkpbbeq0);\n  ybjc irp4 inePbybe = grkgher2Q(oyheQvssGrkgher, i_grkpbbeq0);\n  ybjc sybng nycun = oyheNycun * 1.0;\n  ybjc sybng gurgn = 0.1;\n  zrqvhzc sybng c = pynzc((zva(vPbybe.e, zrnaPbybe.e - 0.1) - 0.2) * 4.0, 0.0, 1.0);\n  zrqvhzc sybng zrnaIne = znk(znk(inePbybe.e, inePbybe.t), inePbybe.o);\n  zrqvhzc sybng xZva = 0.1;\n  ybjc irp3 erfhygPbybe;\n  xZva = (1.0 - zrnaIne / (zrnaIne + gurgn)) * c * nycun;\n  erfhygPbybe = zvk(vPbybe.eto, zrnaPbybe.eto, xZva);\n  erfhygPbybe = zvk(vPbybe.eto, erfhygPbybe, zva(1.0,nycun));\n  ty_SentPbybe = irp4(erfhygPbybe,1.0);\n}"},8302:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(r(6976)),a=r(1199),u=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.width=r,o.height=n,o.type="SharpnessShader",o.uIntensity=null,o.sharpenIntensity=.5,o.program=o.makeProgram(a.sharpnessVS,a.sharpnessFS),o}return o(t,e),t.prototype.setEffectConfig=function(e){isNaN(e.sharpenIntensity)||(this.sharpenIntensity=e.sharpenIntensity/100)},t.prototype.render=function(){this.gl.uniform1f(this.uIntensity,.5*this.sharpenIntensity)},t.prototype.setConstUniforms=function(){var e=this.width,t=this.height,r=this.program;if(r){var n=this.gl;n.useProgram(r);var o=n.getUniformLocation(r,"imageWidthFactor");n.uniform1f(o,1/e);var i=n.getUniformLocation(r,"imageHeightFactor");n.uniform1f(i,1/t),this.uIntensity=n.getUniformLocation(r,"sharpness"),n.uniform1f(this.uIntensity,.5*this.sharpenIntensity)}},t}(s.default);t.default=u},954:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PUBLISH_SET_BEAUTY_EFFECT=void 0;var s=i(r(836)),a=i(r(3048));t.PUBLISH_SET_BEAUTY_EFFECT="zc.p.0.sbe.1";var u=function(){function e(e,t){var r=this;this.logger=e,this.kind="video",this._enabled=!1,this.lastRenderTime=0,this.isStarting=!1,this.animationFrameId=0,this.backgroundLoop=null,this.eventHandler={visibilitychange:function(){if(document.hidden){!function e(){r.enabled&&r.videoEl&&r.manager.render(r.videoEl),r.output&&r.output.requestFrame&&r.output.requestFrame(),r.detector.addFrame(),r.backgroundLoop=window.setTimeout(e,Math.floor(1e3/r.fps))}()}else r.backgroundLoop&&(clearTimeout(r.backgroundLoop),r.backgroundLoop=null)}},this.setInput(t,!0),this.fps=15,this.detector=new s.default(e),this.backgroundLoop&&clearTimeout(this.backgroundLoop),this.backgroundLoop=null,this.lastRenderTime=0,this.manager=new a.default(e)}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){return this._output},enumerable:!1,configurable:!0}),e.prototype.setBeautyEffectOptions=function(e,r){return void 0===r&&(r={}),n(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return e&&this.manager.setEffectConfig(r),this.enabled===e?[3,6]:(this.manager.setEnableBeauty(e),this.enabled!==e&&this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" effect enabled "+e+"; options: "+JSON.stringify(r)),this.enabled=e,e?this.input?[4,this.startEffect()]:[3,2]:[3,3]);case 1:n.sent(),n.label=2;case 2:return[3,5];case 3:return[4,this.stopEffect()];case 4:n.sent(),n.label=5;case 5:n.label=6;case 6:return[2]}})})},e.prototype.startEffect=function(){return n(this,void 0,void 0,function(){var e,r,i=this;return o(this,function(s){switch(s.label){case 0:return this.isStarting=!0,this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" call start effect"),this.input?this.input&&this.output&&this.input!==this.output?(this.logger.warn(t.PUBLISH_SET_BEAUTY_EFFECT+" video effect is already enabled"),[2]):[4,this.startWebGLProcessor()]:(this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" start effect failed, input track is null"),[2]);case 1:return e=s.sent(),[4,this.updateOutput(e)];case 2:return s.sent(),this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" start effect success"),this.detector.startRecordBeautyEffectOutput(this.fps).then(function(e){!e.result&&i.onOverload&&i.onOverload({targetFPS:e.targetFPS,currentFPS:e.currentFPS})}),r=function(){return n(i,void 0,void 0,function(){var e,t,n;return o(this,function(o){switch(o.label){case 0:return this.enabled&&(this.animationFrameId=requestAnimationFrame(r)),e=Date.now(),t=1e3/this.fps,(n=this.lastRenderTime?e-this.lastRenderTime:t)>=t?(this.lastRenderTime=e-(n-t),this.videoEl&&this.videoEl.paused&&this.videoEl.play(),this.enabled&&this.videoEl?[4,this.manager.render(this.videoEl)]:[3,2]):[3,2];case 1:o.sent(),this.output&&this.output.requestFrame&&this.output.requestFrame(),this.detector.addFrame(),o.label=2;case 2:return[2]}})})},this.animationFrameId=requestAnimationFrame(r),document.addEventListener("visibilitychange",this.eventHandler.visibilitychange,!1),this.isStarting=!1,[2]}})})},e.prototype.stopEffect=function(){return n(this,void 0,void 0,function(){var e=this;return o(this,function(r){switch(r.label){case 0:return this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" call stop effect"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0),this.detector.stopRecordBeautyEffectOutput(),this.manager.release(),[4,this.updateOutput()];case 1:return r.sent(),void 0===this.removeDomTimer&&(this.removeDomTimer=window.setTimeout(function(){!1===e.enabled&&e.destroy()},18e4)),document.removeEventListener("visibilitychange",this.eventHandler.visibilitychange),[2]}})})},e.prototype.destroy=function(){this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" destroy hidden elements"),this.canvasEl&&this.canvasEl.remove(),this.videoEl&&this.videoEl.remove(),this.videoEl=this.canvasEl=void 0,this.removeDomTimer&&(clearTimeout(this.removeDomTimer),this.removeDomTimer=void 0)},e.prototype.startWebGLProcessor=function(){return n(this,void 0,void 0,function(){var e,r,n,i,s=this;return o(this,function(o){switch(o.label){case 0:return this.input?(this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" start webgl processor"),this.removeDomTimer&&(clearTimeout(this.removeDomTimer),this.removeDomTimer=void 0),this.canvasEl&&this.videoEl?[3,2]:(this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" create elements"),this.canvasEl&&(this.canvasEl.remove(),this.canvasEl=void 0),this.videoEl&&(this.videoEl.remove(),this.videoEl=void 0),this.canvasEl=document.createElement("canvas"),this.videoEl=document.createElement("video"),this.videoEl.setAttribute("autoplay",""),this.videoEl.setAttribute("muted",""),this.videoEl.muted=!0,this.videoEl.setAttribute("playsinline",""),this.videoEl.setAttribute("style","display:none"),this.videoEl.srcObject=new MediaStream([this.input]),e=new Promise(function(e){s.videoEl&&s.videoEl.addEventListener("playing",function t(){s.videoEl&&s.videoEl.removeEventListener("playing",t),e(void 0)})}),this.videoEl.play(),[4,e])):(this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" input track is null"),[2]);case 1:o.sent(),o.label=2;case 2:return r=this.input.getSettings(),n=r.width||this.videoEl.videoWidth,i=r.height||this.videoEl.videoHeight,r.frameRate&&this.fps!==r.frameRate&&(this.fps=r.frameRate,this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" set target fps: "+this.fps)),this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" beauty video processor: width "+r.width+" height "+r.height),n&&i?(this.canvasEl.width=n,this.canvasEl.height=i,this.videoEl.setAttribute("width",n.toString()),this.videoEl.setAttribute("height",i.toString()),this.manager.init(n,i,this.canvasEl),[2,this.canvasEl.captureStream().getVideoTracks()[0]]):(this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" resolution of track is wrong"),[2])}})})},e.prototype.setInput=function(e,r){return void 0===r&&(r=!1),n(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return e===this.input?[3,6]:e.kind!==this.kind?(this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" kind of track is not video"),[2]):(this.output&&this.input===this.output&&this.logger.error(t.PUBLISH_SET_BEAUTY_EFFECT+" input track is same as effect track"),this.logger.info(t.PUBLISH_SET_BEAUTY_EFFECT+" change input track"),r?this.input?[4,this.removeInput()]:[3,2]:[3,5]);case 1:n.sent(),n.label=2;case 2:return this.input=e,this.enabled&&!this.videoEl?[4,this.startEffect()]:[3,4];case 3:n.sent(),n.label=4;case 4:return[3,6];case 5:this.input=e,this.videoEl&&(this.videoEl.srcObject=new MediaStream([this.input])),n.label=6;case 6:return[2]}})})},e.prototype.removeInput=function(){return n(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return this.input=void 0,[4,this.stopEffect()];case 1:return e.sent(),[2]}})})},e.prototype.updateOutput=function(e){return n(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.output===e?[3,3]:(this._output=e,this.onOutputChange?[4,this.onOutputChange(this._output)]:[3,2]);case 1:t.sent(),t.label=2;case 2:t.label=3;case 3:return[2]}})})},e.prototype.onOutputChange=function(e){return n(this,void 0,void 0,function(){return o(this,function(e){return[2]})})},e.prototype.onOverload=function(e){},e}();t.default=u},608:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var i=r(6706),s=r(3529),a=r(4395),u=function(){function e(){}return e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){t.success&&(r[e+"SuccessCallback"]=t.success),t.error&&(r[e+"ErrorCallback"]=t.error)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,n,o){e.registerCallback(t,{success:function(t,o){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];e.dataReportEvent(r,n,t,o,i)}},o)},e.actionLogReportCallback=function(t,r,n,o,i){e.actionSuccessCallback(t,r)&&e.actionSuccessCallback(t,r)(n,o)},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",1013:"token03 format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(0===e)return{code:0,message:""};var r={code:0,message:"liveroom cmd error"};if(r.code=e,e>1e9){var n=t[e];r.message=n?"liveroom cmd error, code: "+e+", message: "+n:t[1e9]+e}else r.message=t[e]?t[e]+" code:"+e:"unknown error code:"+e;return r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return e>1e9&&(r.code=e-1e9+52e6),t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000004,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:t.code=63000005,t.message="zpush token expired",t.name="TOKEN_EXPIRED";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,n,o){switch(r){case"eventStart":e.eventStart(t,n);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,n,o[0]);break;case"addEventMsg":e.addEventMsg(t,n,o[0],o[1]);break;case"addEvent":e.addEvent(t,n);break;case"eventEnd":e.eventEnd(t,n);break;case"addMsgInfo":e.addMsgInfo(t,o[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,n){var o,i=[],s=[],a=[];r||(r=[]);for(var u=0;u<r.length;u++)if(r[u].anchor_id_name!=e&&r[u].user_id!=e){o=!1;for(var l=0;l<t.length;l++)if(r[u].stream_id===t[l].stream_id){r[u].extra_info!==t[l].extra_info&&a.push(r[u]),o=!0;break}o||i.push(r[u])}for(var c=0;c<t.length;c++){o=!1;for(var d=0;d<r.length;d++)if(t[c].stream_id===r[d].stream_id){o=!0;break}o||s.push(t[c])}for(t.splice(0),u=0;u<r.length;u++)t.push(r[u]);n(i,s,a)},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.uuid=function(e,t){var r,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(t=t||n.length,e)for(r=0;r<e;r++)o[r]=n[0|Math.random()*t];else{var i=void 0;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(i=0|16*Math.random(),o[r]=n[19==r?3&i|8:i])}return o.join("")},e.supportDetection=function(e,t,r,i){return n(this,void 0,void 0,function(){var n,s,a,u,l,c,d,h;return o(this,function(o){switch(o.label){case 0:return n={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e,errInfo:{}},i&&"screenSharing"===i?(t({result:e,errInfo:n.errInfo}),[2]):i&&"customCapture"!==i||(((s=document.createElement("video")).captureStream||s.mozCaptureStream)&&(n.customCapture=!0),"customCapture"!==i)?(a=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u="https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"),i&&"camera"!==i&&"microphone"!==i?[3,9]:a?u?(n.camera=!1,console.error("webrtc requires https or localhost"),[3,9]):[3,1]:[3,9]):(t({result:n.customCapture,errInfo:n.errInfo}),[2]);case 1:if(i&&"camera"!==i)return[3,5];o.label=2;case 2:return o.trys.push([2,4,,5]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 3:return(l=o.sent())&&(n.camera=!0)&&l.getTracks().forEach(function(e){return e.stop()}),[3,5];case 4:return c=o.sent(),n.errInfo.camera={name:c.name,message:c.message},console.error("camera devices detect error: ",c.name,c.message),[3,5];case 5:if(i&&"microphone"!==i)return[3,9];o.label=6;case 6:return o.trys.push([6,8,,9]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 7:return(d=o.sent())&&(n.microphone=!0)&&d.getTracks().forEach(function(e){return e.stop()}),[3,9];case 8:return h=o.sent(),n.errInfo.microphone={name:h.name,message:h.message},console.error("microphone devices detect error: ",h.name,h.message),[3,9];case 9:return"camera"===i||"microphone"===i?(t({result:n[i],errInfo:n.errInfo}),[2]):(this.supportVideoCodeType(function(e,r){i||(n.videoCodec.H264=e.H264,n.videoCodec.H265=e.H265,n.videoCodec.VP8=e.VP8,n.videoCodec.VP9=e.VP9,n.webRTC=e.webRTC),r&&("string"==typeof r?n.errInfo.extendedDate=r:n.errInfo.webRTC={name:r.name,message:r.message},console.error("videoCodec detect error: "+r)),t&&t(i?{result:e[i],errInfo:n.errInfo}:n)},r,i),[2])}})})},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(t){for(var r=[],n=[],o=[],i=0;i<t.length;i++){var s=t[i];"audioinput"===s.kind&&r.push({deviceName:s.label,deviceID:s.deviceId}),"audiooutput"===s.kind&&n.push({deviceName:s.label,deviceID:s.deviceId}),"videoinput"===s.kind&&o.push({deviceName:s.label,deviceID:s.deviceId})}e&&e({microphones:r,speakers:n,cameras:o})}).catch(function(e){console.error("enumerate devices wrong "+e),t&&t(s.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kEnumDevicesError)}):t&&t(s.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kBrowserNotSupportError)},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var n=0;n<r;n++){var o=parseInt(e[n]),i=parseInt(t[n]);if(o>i)return 1;if(o<i)return-1}return 0},e.isSupportLive=function(e,t){var r=wx.getSystemInfoSync().SDKVersion,n={code:0,msg:""};this.compareVersion(r,"1.7.0")<0&&(n={code:10001,msg:"\u5f53\u524d\u5fae\u4fe1\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u76f8\u5173\u7ec4\u4ef6"},e&&e(n)),wx.getSetting({success:function(t){var r=t.authSetting;r["scope.camera"]&&r["scope.record"]||(n={code:10002,msg:"\u9700\u8981\u6444\u50cf\u5934\u548c\u5f55\u97f3\u529f\u80fd\u7684\u6388\u6743"}),e&&e(n)},fail:function(e){console.error("get setting error",e),t&&t(e)}})},e.supportVideoCodeType=function(e,t,r){return n(this,void 0,void 0,function(){var n,i,s,u,l,c,d,h,p,f;return o(this,function(o){switch(o.label){case 0:return n={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1},r?1!==t||"VP8"!==r&&"H264"!==r?[3,2]:[4,(f=new a.CheckModule).checkSupportByType(r)]:[3,2];case 1:return"boolean"==typeof(i=o.sent())?(n[r]=i,[2,e(n)]):(n[r]=!1,[2,e(n,i)]);case 2:if("webRTC"!==r&&1!==t)return[3,7];o.label=3;case 3:return o.trys.push([3,5,,6]),[4,(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 4:return o.sent(),n.webRTC=!0,[3,6];case 5:return s=o.sent(),e&&e(n,s),[3,6];case 6:if("webRTC"===r)return[2,e(n)];o.label=7;case 7:if(1===t){for(u="",c=[],d=0,h=l=["VP8","H264"];d<h.length;d++)p=h[d],f=new a.CheckModule,c.push(f.checkSupportByType(p));return Promise.all(c).then(function(t){t.forEach(function(e,t){"boolean"==typeof e?n[l[t]]=!0:(n[l[t]]=!1,u=e)}),u?e(n,u):e(n)}),[2]}try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){if(n.webRTC=!0,t&&t.sdp){var o=t.sdp.split("\r\n");if(n.H264=o.some(function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1}),"H264"===r)return e(n);if(n.VP8=o.some(function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP8/")>-1}),"VP8"===r)return e(n);n.VP9=o.some(function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP9/")>-1}),n.H265=o.some(function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H265/")>-1}),e&&e(n)}})}catch(t){e&&e(n,t)}return[2]}})})},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},e.getSteamUpdateType=function(e){return 0==e?"DELETE":"ADD"},e.checkScreenParams=function(t,r){if("object"==typeof t&&void 0!==t.videoQuality&&!e.checkInteger(t.videoQuality))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number"),!1;if("object"==typeof t&&void 0!==t.sourceID&&"string"!=typeof t.sourceID)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," sourceID must be string"),!1;if("object"==typeof t&&4===t.videoQuality){if(void 0===t.bitRate)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.bitRate))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1;if(t.bitRate>10240)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps"),!1;if(void 0===t.frameRate)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.frameRate))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1;if(void 0===t.width)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width is required when videoQuality is 4"),!1;if(!e.checkInteger(t.width))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1;if(void 0===t.height)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height is required when videoQuality is 4"),!1;if(!e.checkInteger(t.height))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1}return!0},e.checkCameraParams=function(t,r){return t.width&&e.checkValidNumber(t.width)?t.height&&e.checkValidNumber(t.height)?t.frameRate&&e.checkValidNumber(t.frameRate)?!(!t.bitRate||!e.checkValidNumber(t.bitRate))||(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1):(r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1)},e.isParamEmpty=function(e){return null!=e&&""!==e},e.isTypeString=function(e){return"string"==typeof e},e.isTooLong=function(e,t){return!(e.length>=t)},e.isReDispatch=function(e){var t=e.message.match(/action:(\d+)/),r=t?Number(t[1]):NaN;return[s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kTTLOverTimeError,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kClientIPChangedError,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kTTLOverTimeError,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kClientIPChangedError].includes(e)||[6].includes(r)},e.arrAvg=function(e,t,r){return e.push(t),e.length>r&&e.shift(),e.reduce(function(e,t){return e+t})/e.length},e.getNetQuality=function(e,t,r){return void 0!==r?.15*this.calcQualityOfJitter(r)+.85*Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!1)):Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!0))},e.calcQualityOfRtt=function(e){return e<600?97-Math.pow(.09*e,1.1):18*Math.exp(.002*(600-e))},e.calcQualityOfJitter=function(e){return e<=50?98-Math.pow(e,1.15):i.QUALITY_CONSTANT.PoorMinQuality},e.calcQualityOfLostRate=function(e,t){if(t)return e<=55?99-Math.pow(.8*e,1.18):i.QUALITY_CONSTANT.PoorMinQuality;var r=100*e;return r<=40?96-Math.pow(r,1.22):i.QUALITY_CONSTANT.PoorMinQuality},e.quality2QualityGrade=function(e){return e>=i.QUALITY_CONSTANT.ExcellentMinQuality?i.QualityGrade.Excellent:e>=i.QUALITY_CONSTANT.GoodMinQuality?i.QualityGrade.Good:e>=i.QUALITY_CONSTANT.MiddleMinQuality?i.QualityGrade.Middle:e>=i.QUALITY_CONSTANT.PoorMinQuality?i.QualityGrade.Poor:i.QualityGrade.Die},e.checkAudioTrackIsActive=function(e){return!!e.enabled},e.checkVideoTrackIsActive=function(e){return!!e.enabled},e}();t.ClientUtil=u},6502:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryHandler=void 0;var r=function(){function e(){this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,n){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof n&&(this.RETRY_MAX_TIME_INTERVAL=n)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.RetryHandler=r},4767:function(e,t){"use strict";var r=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.SdpUtil=void 0;var n=function(){function e(){}return e.zegoSdp=function(e){var t=e.split("\r\n"),n=[],o=[];t.forEach(function(e){var t=e.match(/a=rtpmap:(\d+)\s+((H264\/90000)|(opus\/48000\/2))/);t&&t[1]&&t[2]&&("H264/90000"===t[2]&&n.push(t[1]),"opus/48000/2"===t[2]&&o.push(t[1]))});var i=[];return t.map(function(e){var t=!0,s=e.match(/((a=rtcp-fb:)|(a=rtpmap:)|(a=fmtp:))(\d+)/);if(s&&s[5]&&(r(r([],n),o).some(function(e){return e==s[5]})||(t=!1)),e.indexOf("m=video")>-1){var a=e.split(" ");e=r([a[0],a[1],a[2]],n).join(" ")}else e.indexOf("m=audio")>-1&&(a=e.split(" "),e=r([a[0],a[1],a[2]],o).join(" "));t&&i.push(e)}),i.join("\r\n")},e.getSDPByVideDecodeType=function(e,t,n){var o={str:"",arr:[],obj:{H264:[],H265:[],VP8:[],VP9:[],OTHER:[]}};if(!e.includes("m=video"))return e;var i=/m=video.+/.exec(e)[0];i=i.match(/[\s|\d]+/g)[1].replace(" ",""),o.str=i,o.arr=o.str.split(" "),o.arr.forEach(function(t){var r=new RegExp("a=rtpmap:"+t+".+").exec(e)[0];r.includes("H264")?o.obj.H264.push(t):r.includes("H265")?o.obj.H265.push(t):r.includes("VP8")?o.obj.VP8.push(t):r.includes("VP9")?o.obj.VP9.push(t):o.obj.OTHER.push(t)}),o.obj.OTHER.forEach(function(t){var r=new RegExp("a=fmtp:"+t+".+apt=(\\d+)").exec(e),n=r&&r[1];n&&(o.obj.H264.includes(n)?o.obj.H264.push(t):o.obj.H265.includes(n)?o.obj.H265.push(t):o.obj.VP8.includes(n)?o.obj.VP8.push(t):o.obj.VP9.includes(n)&&o.obj.VP9.push(t))});var s=[];if("VP9"===t?s=r(r(r([],o.obj.H265),o.obj.H264),o.obj.VP8):"VP8"===t?s=r(r(r([],o.obj.H265),o.obj.H264),o.obj.VP9):"H264"===t?s=r(r(r([],o.obj.H265),o.obj.VP8),o.obj.VP9):"H265"===t&&(s=r(r(r([],o.obj.VP8),o.obj.H264),o.obj.VP9)),n&&"H264"==t){var a=[];o.obj.H264.forEach(function(t){var r=new RegExp("a=fmtp:"+t+".+\\s\\n","g").exec(e);(null==r?void 0:r.find(function(e){return e.includes("profile-level-id=42e01f")}))||a.push(t)}),a.length==o.obj.H264.length&&(a=[]),s=s.concat(a)}return s.forEach(function(t){var r=o.arr.indexOf(t);o.arr.splice(r,1);var n=new RegExp("a=rtpmap:"+t+".+\\s\\n","g"),i=new RegExp("a=rtcp-fb:"+t+".+\\s\\n","g"),s=new RegExp("a=fmtp:"+t+".+\\s\\n","g");e=(e=(e=e.replace(n,"")).replace(i,"")).replace(s,"")}),e=e.replace(i,o.arr.join(" "))},e}();t.SdpUtil=n},5321:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},s=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWebRTC=void 0;var u=r(6706),l=r(608),c=r(7325),d=r(1089),h=r(3529),p=r(908),f=r(3409),g=r(7560),_=r(1547),m=i(r(5515)),v=r(3770),E=r(4865),T=r(361),y=r(5019),S=r(9595),C=r(9595),R=function(){function e(e,t,r,n){var o=this;void 0===n&&(n=0),this.mediaEleSources=[],this.logger=e,this.dataReport=t,this.ac=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext),this.checkAudioContext(),this.stateCenter=new c.StateCenter(this.logger,this.dataReport),this.stateCenter.clientType="webrtc",this.stateCenter.type=2===n?"PRIVATE":"PUBLIC",this.RTM=r,this.streamCenter=new f.ZegoStreamCenterWeb(this.logger,this.stateCenter,this.dataReport,this.RTM,this.ac,this.mediaEleSources),this.rtcModules=new p.RTCModules(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.RTM,this.ac),this.stateCenter.getSeq=u.getSeq,this.stateCenter.getReportSeq=u.getReportSeq,this.stateCenter.networkState=navigator?navigator.onLine?u.ENUM_NETWORK_STATE.online:u.ENUM_NETWORK_STATE.offline:u.ENUM_NETWORK_STATE.online,this.stateCenter.browser=m.browserDetails.browser,this.stateCenter.settingConfig=new C.ZegoSettingConfig,this.RTM.cloudSetting.setEnvVariable("sdk_version",u.PROTO_VERSION),this.RTM.cloudSetting.getSettingCache(S.RTC).then(function(e){o.logger.info(d.ZEGO_WEBRTC_ACTION.CONSTRUCTOR+" streamConfig "+JSON.stringify(e));var t=u.getReportSeq();o.dataReport.newReport(t,h.ZegoRTCLogEvent.kZegoTaskCloudSettingCache.event),o.dataReport.addMsgInfo(t,{files:[{name:S.RTC,content:null==e?void 0:e.setting,versions:null==e?void 0:e.versions}]}),o.dataReport.uploadReport(t),o.stateCenter.settingConfig.setSetting(null==e?void 0:e.setting)}).catch(function(e){o.logger.warn(d.ZEGO_WEBRTC_ACTION.CONSTRUCTOR+" streamConfig "+JSON.stringify(e))})}return e.prototype.checkAudioContext=function(){var e=this;if(this.ac&&"suspended"===this.ac.state){var t=function t(){e.ac.resume(),window.removeEventListener("click",t),window.removeEventListener("touchstart",t)};window.addEventListener("click",t),window.addEventListener("touchstart",t)}},e.prototype.mutePublishStreamVideo=function(e,t,r){return!1},e.prototype.mutePublishStreamAudio=function(e,t){return!1},e.prototype.mutePlayStreamVideo=function(e,t){return new Promise(function(e,t){console.error("should install advanced module"),e(!1)})},e.prototype.mutePlayStreamAudio=function(e,t){return new Promise(function(e,t){console.error("should install advanced module"),e(!1)})},e.prototype.muteMicrophone=function(e){return!1},e.prototype.isMicrophoneMuted=function(){return!this.streamCenter.isMicEnabled},e.prototype.setAudioOutput=function(e,t){return this.logger.info(d.ZEGO_WEBRTC_ACTION.SET_AUDIO_OUTPUT+" call"),"string"!=typeof t?(this.logger.error("audiooutput is not string"),!1):this.rtcModules.playModule.setStreamAudioOutput(e,t)},e.prototype.setCustomSignalUrl=function(e){if(this.logger.info(d.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" call: "+e),e&&0!=e.length){var t=!0;e.forEach(function(e){return 0!=e.indexOf("wss://")&&(t=!1)}),t?this.stateCenter.customUrl=e:this.logger.error(d.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" url is not correct")}else this.logger.error(d.ZEGO_WEBRTC_ACTION.SET_CUSTOM_SIGNAL_URL+" param error")},e.prototype.setGWNode=function(e){"string"==typeof e&&e.length>0&&(this.streamCenter.gwNode=e)},e.prototype.setQualityMonitorCycle=function(e){return"number"==typeof e&&e>=1e3?(this.streamCenter.setQualityMonitorCycle(e),!0):(this.logger.error("zc.sqmc.0 time must be number and bigger than 1000"),!1)},e.prototype.startPlayingStream=function(e,t,r){return this.logger.info(d.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.startPlayingStream(e,t,r)},e.prototype.stopPlayingStream=function(e){this.logger.info(d.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call by user"),this.rtcModules.playModule.stopPlayingStream(e)},e.prototype.setTurnOverTcpOnly=function(e){this.logger.info(d.ZEGO_WEBRTC_ACTION.SET_TURN_OVER_TCP_ONLY+" call "+e),"boolean"==typeof e?this.stateCenter.turnOverTcpOnly=e:this.logger.error("zc.p.stoto.0 param must be param")},e.prototype.createStream=function(e){return this.rtcModules.publishModule.createStream(e)},e.prototype.destroyStream=function(e){this.rtcModules.publishModule.destroyStream(e)},e.prototype.startPublishingStream=function(e,t,r,n){return this.logger.info(d.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.startPublishingStream(e,t,r,n)},e.prototype.activateSEIInsert=function(e){return console.error("should install advanced module"),!1},e.prototype.stopPublishingStream=function(e){return this.logger.info(d.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call by user"),this.rtcModules.publishModule.stopPublishingStream(e)},e.prototype.setVideoConfig=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.setVideoConfig(e,t):new Promise(function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})})},e.prototype.setAudioConfig=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.setAudioConfig(e,t):new Promise(function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})})},e.prototype.replaceTrack=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.replaceTrack(e,t):new Promise(function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})})},e.prototype.preloadEffect=function(e,t,r){void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.preloadEffect(e,t,r):console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757")},e.prototype.playEffect=function(e,t,r){void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.playEffect(e,t,r):console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757")},e.prototype.pauseEffect=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.pauseEffect(e,t):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.resumeEffect=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.resumeEffect(e,t):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.stopEffect=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopEffect(e,t):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.unloadEffect=function(e){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.unloadEffect(e):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.setEffectVolume=function(e,t,r){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.setEffectVolume(e,t,r):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.startMixingAudio=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.startMixingAudio(e,t):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.stopMixingAudio=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopMixingAudio(e,t):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.mixingBuffer=function(e,t,r,n){void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.mixingBuffer(e,t,r,n):console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757")},e.prototype.stopMixingBuffer=function(e,t){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopMixingBuffer(e,t):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.setMixingAudioVolume=function(e,t,r){return void 0!==this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.setMixingAudioVolume(e,t,r):(console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757"),!1)},e.prototype.checkSystemRequirements=function(t,r){var n=this,o=navigator&&navigator.mediaDevices&&(e.screenShotReady||"getDisplayMedia"in navigator.mediaDevices);return this.logger.info(d.ZEGO_WEBRTC_ACTION.CHECK_SUPPORT+" call"+navigator.userAgent),new Promise(function(e){var i=u.getReportSeq();n.dataReport.newReport(i,h.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.event);var s=r||"all",a=function(t){n.dataReport.addMsgInfo(i,{capability:h.ZegoRTCLogEvent.kZegoTaskCheckSystemRequirements.capability(t)}),n.dataReport.uploadReport(i);var r=n.stateCenter.checkList.indexOf(s);n.stateCenter.checkList.splice(r,1),e(t)};return["webRTC","customCapture","camera","microphone","screenSharing","H264","VP8","all"].includes(s)&&[0,1].includes(t)?n.stateCenter.checkList.includes(s)||n.stateCenter.checkList.includes("all")?a({result:!1,errInfo:{extendedDate:"The last test of the same type has not returned a result "}}):(n.stateCenter.checkList.push(s),void l.ClientUtil.supportDetection(o,a,t,r)):a({result:!1,errInfo:{extendedDate:"param error"}})})},e.prototype.enumDevices=function(e,t){return s(this,void 0,void 0,function(){var r,n,o,i,s,l,c,d,p,f,g,_,m,v=this;return a(this,function(a){switch(a.label){case 0:return this.logger.info("zc.ed.0 call"),[4,(r=function(){return new Promise(function(e,t){var r=u.getReportSeq();v.dataReport.newReport(r,h.ZegoRTCLogEvent.kZegoTaskEnumDevices.event),v.rtcModules.publishModule.recordDevices(function(t){var n=[],o=!0,i=!0;t.cameras.forEach(function(e){""===e.deviceID&&(o=!1),n.push({device:e.deviceName,type:0})}),t.microphones.forEach(function(e){""===e.deviceID&&(i=!1),n.push({device:e.deviceName,type:1})}),t.speakers.forEach(function(e){return n.push({device:e.deviceName,type:2})}),v.dataReport.addMsgInfo(r,{dev_list:h.ZegoRTCLogEvent.kZegoTaskEnumDevices.dev_list(n)}),v.dataReport.uploadReport(r),e({devices:t,enableCamera:o,enableMic:i})},function(e){v.dataReport.addMsgInfo(r,e),v.dataReport.uploadReport(r),t(e)})})})()];case 1:return n=a.sent(),o=n.enableCamera,i=n.enableMic,s=n.devices,e?(this.logger.info("zc.ed.0 check permission"),l={video:!0,audio:!0},"videoinput"===t?l.audio=!1:"audioinput"!==t&&"audiooutput"!==t||(l.video=!1),d=l.audio&&!i,(c=l.video&&!o)||d?(this.logger.info("zc.ed.0 need to get device permission. needCamera: "+c+", needMic: "+d),[4,navigator.mediaDevices.getUserMedia(l).catch(function(){})]):[3,4]):[3,4];case 2:return(p=a.sent())&&p.getTracks().forEach(function(e){e.stop()}),[4,r()];case 3:f=a.sent(),g=f.devices,_=f.enableCamera,m=f.enableMic,l.video&&!_&&this.logger.warn("zc.ed.0 get video device permission failed."),l.audio&&!m&&this.logger.warn("zc.ed.0 get audio device permission failed."),s=g,a.label=4;case 4:return[2,s]}})})},e.prototype.getCameras=function(){return s(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.enumDevices(!0,"videoinput")];case 1:return[2,e.sent().cameras]}})})},e.prototype.getMicrophones=function(){return s(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.enumDevices(!0,"audioinput")];case 1:return[2,e.sent().microphones]}})})},e.prototype.getSpeakers=function(){return s(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.enumDevices(!0,"audiooutput")];case 1:return[2,e.sent().speakers]}})})},e.prototype.getAudioInfo=function(e,t,r){},e.prototype.getSoundLevel=function(e,t,r){this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.getSoundLevel(e,t,r):console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757")},e.prototype.stopSoundLevel=function(e){this.rtcModules.audioMixModule?this.rtcModules.audioMixModule.stopSoundLevel(e):console.error("\u672a\u5f15\u5165\u6df7\u97f3\u6a21\u5757")},e.handleDataAvailable=function(t){t.data&&t.data.size>0&&e.recordedBlobs.push(t.data)},e.prototype.startRecord=function(e){},e.prototype.stopRecord=function(){},e.prototype.resumeRecord=function(){},e.prototype.pauseRecord=function(){},e.prototype.saveRecord=function(e){},e.prototype.takeSnapShot=function(e,t){},e.prototype.saveSnapShot=function(e,t){},e.prototype.useVideoDevice=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.useVideoDevice(e,t):new Promise(function(e,t){e({errorCode:-1,extendedData:"should install advanced module"})})},e.prototype.useAudioDevice=function(e,t){return this.rtcModules.advancedModule?this.rtcModules.advancedModule.useAudioDevice(e,t):(console.error("should use advanced module first"),new Promise(function(e,t){e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.getElectronScreenSources=function(){return this.rtcModules.publishModule.getElectronScreenSources()},e.prototype.setSoundLevelDelegate=function(e,t){this.logger.info("zc.ssd.0 call"),"boolean"==typeof e?t&&(!this.stateCenter.checkInteger(t)||t<100||t>3e3)?this.logger.error("zc.ssd.0 soundLevel interval must be integer number which is between 100 and 3000"):this.streamCenter.setSoundLevelDelegate(e,t):this.logger.error("zc.ssd.0 param 1 must be boolean")},e.prototype.on=function(e,t){return this.rtcModules.bindListener(e,t)},e.prototype.off=function(e,t){return this.rtcModules.deleteListener(e,t)},e.prototype.getVersion=function(){return u.PROTO_VERSION},e.prototype.setStreamExtraInfo=function(e,t){return new Promise(function(e,t){console.error("should use advanced module first"),t()})},e.prototype.addPublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.rtcModules.advancedModule?this.rtcModules.advancedModule.publishTarget({type:"addpush",streamID:e,pushUrl:t}):new Promise(function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})})},e.prototype.removePublishCdnUrl=function(e,t){return this.logger.info("zg.cm.apu call ",e,t),this.rtcModules.advancedModule?this.rtcModules.advancedModule.publishTarget({type:"delpush",streamID:e,pushUrl:t}):new Promise(function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})})},e.prototype.startMixerTask=function(e){return new Promise(function(e,t){console.error("\u672a\u5f15\u5165\u6df7\u6d41\u6a21\u5757"),t()})},e.prototype.setMixerTaskConfig=function(e){return new Promise(function(e,t){console.error("\u672a\u5f15\u5165\u6df7\u6d41\u6a21\u5757"),t()})},e.prototype.stopMixerTask=function(e){return new Promise(function(e,t){console.error("\u672a\u5f15\u5165\u6df7\u6d41\u6a21\u5757"),t()})},e.prototype.setCaptureVolume=function(e,t){return this.rtcModules.publishModule.setCaptureVolume(e,t)},e.prototype.getRoomInfo=function(){var e=this.stateCenter.roomList[0];return null==e?void 0:e.streamHandler.getRoomInfo()},e.use=function(t){switch(t.type){case"AudioMix":t.install(p.RTCModules,_.ZegoPublish);break;case"MixStream":t.install(e,g.StreamHandler,p.RTCModules);break;case"Advance":t.install(e,p.RTCModules,g.StreamHandler,v.ZegoPreview,E.PlayModule,T.PublishModule,_.ZegoPublish,y.ZegoSignal);break;case"BeautyEffect":t.install(e,v.ZegoPreview);break;case"RangeAudio":case"DataChannel":t.install(e)}},e.prototype.createRangeAudioInstance=function(){throw new Error("should use range audio module")},e.prototype.createRealTimeSequentialDataManager=function(e){throw new Error("should use datachannel module")},e.prototype.destroyRealTimeSequentialDataManager=function(e){throw new Error("should use datachannel module")},e.prototype.enableDataChannel=function(e){"boolean"==typeof e&&(this.streamCenter.isDataChannelEnabled=e)},e.prototype.addTrack=function(e,t){return new Promise(function(e,t){throw new Error("use advanced module first")})},e.prototype.removeTrack=function(e,t){return new Promise(function(e,t){throw new Error("use advanced module first")})},e.prototype.setBeautyEffect=function(e,t,r){return new Promise(function(e,t){console.error("should install video effect module and advanced module"),e({errorCode:-1,extendedData:"should install video effect module and advanced module"})})},e.prototype.checkAudioTrackIsActive=function(e){return MediaStreamTrack instanceof e&&"video"===e.kind?l.ClientUtil.checkAudioTrackIsActive(e):(this.logger.error("zc.caia.0 track type error"),!1)},e.prototype.checkVideoTrackIsActive=function(e){return MediaStreamTrack instanceof e&&"audio"===e.kind?l.ClientUtil.checkVideoTrackIsActive(e):(this.logger.error("zc.cvia.0 track type error"),!1)},e.screenShotReady=!1,e}();t.ZegoWebRTC=R,window.addEventListener("message",function(e){var t=e.data.type,r=e.origin;r!==window.location.origin&&console.warn("ScreenStream: you should discard foreign event from origin:",r),"SS_PING"===t&&(R.screenShotReady=!0)})},4395:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CheckModule=void 0;var i=r(4767),s=function(){function e(){var e=this;this.iceconnectionstatechangeTimes=0,this.isCheckAll=!1;var t=document.createElement("canvas");t.getContext("2d").fillStyle="rgba(255, 255, 255, 0)";try{this.localStream=t.captureStream()}catch(e){console.error("canvas captureStream error",e)}this.timer=setTimeout(function(){e.resolve("Detection timeout"),e.hangup()},5e3)}return e.prototype.checkSupportByType=function(e){return n(this,void 0,void 0,function(){var t,r,n=this;return o(this,function(o){switch(o.label){case 0:return this.checkType=e,t={},this.localPc=new RTCPeerConnection(t),this.remotePc=new RTCPeerConnection(t),r=new Promise(function(e){return n.resolve=e}),this.localPc.addEventListener("icecandidate",function(e){return n.onIceCandidate(n.localPc,e)}),this.remotePc.addEventListener("icecandidate",function(e){return n.onIceCandidate(n.remotePc,e)}),this.remotePc.addEventListener("iceconnectionstatechange",function(t){"connected"===n.remotePc.iceConnectionState&&(n.iceconnectionstatechangeResult=!0),2==++n.iceconnectionstatechangeTimes&&n.iceCandidate&&(clearTimeout(n.timer),n.resolve("connected"===n.remotePc.iceConnectionState||"The browser does not support "+e+" format"),n.hangup())}),this.localStream.getTracks().forEach(function(e){return n.localPc.addTrack(e,n.localStream)}),[4,this.check(e)];case 1:return o.sent(),[4,r];case 2:return[2,o.sent()]}})})},e.prototype.check=function(e){return n(this,void 0,void 0,function(){var t,r;return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.localPc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 1:return(t=n.sent()).sdp=i.SdpUtil.getSDPByVideDecodeType(t.sdp,e),this.onCreateOfferSuccess(t),[3,3];case 2:return r=n.sent(),this.onCreateSessionDescriptionError(r),[3,3];case 3:return[2]}})})},e.prototype.onCreateOfferSuccess=function(e){return n(this,void 0,void 0,function(){var t,r,n,i;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.localPc.setLocalDescription(e)];case 1:return o.sent(),[3,3];case 2:return t=o.sent(),this.onSetSessionDescriptionError(t),[2];case 3:return o.trys.push([3,5,,6]),[4,this.remotePc.setRemoteDescription(e)];case 4:return o.sent(),[3,6];case 5:return r=o.sent(),this.onSetSessionDescriptionError(r),[2];case 6:return o.trys.push([6,9,,10]),[4,this.remotePc.createAnswer()];case 7:return n=o.sent(),[4,this.onCreateAnswerSuccess(n)];case 8:return o.sent(),[3,10];case 9:return i=o.sent(),this.onCreateSessionDescriptionError(i),[2];case 10:return[2]}})})},e.prototype.onCreateAnswerSuccess=function(e){return n(this,void 0,void 0,function(){var t,r;return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.remotePc.setLocalDescription(e)];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),this.onSetSessionDescriptionError(t),[2];case 3:return n.trys.push([3,5,,6]),[4,this.localPc.setRemoteDescription(e)];case 4:return n.sent(),[3,6];case 5:return r=n.sent(),this.onSetSessionDescriptionError(r),[2];case 6:return[2]}})})},e.prototype.onIceCandidate=function(e,t){return n(this,void 0,void 0,function(){var r;return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getOtherPc(e).addIceCandidate(t.candidate)];case 1:return n.sent(),[3,3];case 2:return r=n.sent(),console.error(this.checkType,this.getPcName(e)+" addIceCandidate error",r),clearTimeout(this.timer),this.hangup(),this.resolve(r),[3,3];case 3:return"remotePc"===this.getPcName(e)&&t.candidate&&(this.iceCandidate=!0),this.iceconnectionstatechangeResult&&"localPc"===this.getPcName(e)&&(clearTimeout(this.timer),this.hangup(),this.resolve(!0)),[2]}})})},e.prototype.getOtherPc=function(e){return e===this.localPc?this.remotePc:this.localPc},e.prototype.getPcName=function(e){return e===this.localPc?"localPc":"remotePc"},e.prototype.onCreateSessionDescriptionError=function(e){console.error("Failed to create session description: "+e.toString()),clearTimeout(this.timer),this.hangup(),this.resolve(e)},e.prototype.onSetSessionDescriptionError=function(e){console.error("Failed to set session description: "+e.toString()),clearTimeout(this.timer),this.hangup(),this.resolve(e)},e.prototype.hangup=function(){this.localPc.close(),this.remotePc.close(),this.iceconnectionstatechangeTimes=0,this.localStream.getTracks().forEach(function(e){return e.stop()})},e}();t.CheckModule=s},8493:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryDispatchHandler=void 0;var i=r(6502),s=r(6706),a=r(1089),u=r(3529),l=r(2752),c=function(e){function t(t,r,n,o){var i=e.call(this)||this;return i.retryActiveCount=1,i.RETRY_MAX_TIME=90,i.logger=t,i.stateCenter=r,i.rtm=n,i.streamCenter=o,i}return o(t,e),t.prototype.initStream=function(e,t,r){this.streamID=e,this.playOption=t,this.isPublish=r},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry call "+this.streamID),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" has active, ignore"),!1;if(this.isOverTime)return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" retry over time, stop retry"),!1;if(!this.rtm.isLogin()){this.stopMaxTime(),this.invalid();var r=this.isPublish?this.streamCenter.publisherList[this.streamID]:this.streamCenter.playerList[this.streamID];r&&(r.isReDispatch=!0)}var n,o=this.retryActiveCount-1;if("PUBLIC"===this.stateCenter.type){var i=this.playOption&&2==this.playOption.resourceMode?1:0;n={stream_id:this.streamID,ptype:this.isPublish?"push":"pull",signals:this.streamCenter.getAllInUseUrl(),header_kvs:[{key:"grpc-metadata-push",value:this.playOption&&this.playOption.cdnUrl||""}],retry:o,center_ability:!0,dispatch_type:i}}else n={stream_id:this.streamID,dispatch_type:this.isPublish?1:2,stream_type:3,an_type:this.rtm.getAnType()};return this.retryTimer=setTimeout(function(){t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++;var e=t.streamCenter.getRoomByStreamID(t.streamID),r=t.rtm.service.sendMessage("webrtc_url",n,function(e,r){t.handleFetchWebRtcUrlRsp(e)},function(e,r){t.handleFetchWebRtcUrlRsp(e)},void 0,{sessionID:null==e?void 0:e.sessionID,roomID:null==e?void 0:e.roomID,roomSessionID:null==e?void 0:e.roomSessionID});t.isPublish&&r?t.streamCenter.publisherList[t.streamID]&&(t.streamCenter.publisherList[t.streamID].seq=r):r&&t.streamCenter.playerList[t.streamID]&&(t.streamCenter.playerList[t.streamID].seq=r)},"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info(a.ZEGO_WEBRTC_ACTION.RDH_ACTIVE+" call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){e.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_MAX_TIME+" "+e.streamID+" dispatch over max time "+e.RETRY_MAX_TIME+"s stop retry"),e.isOverTime=!0,e.invalid();var t=u.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError;t.message=t.message+" try max limit",e.isPublish?e.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,t):e.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e.streamID,t)},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.handleFetchWebRtcUrlRsp=function(e){if(e.code&&[l.errorCodeList.TIMEOUT.code].includes(e.code))this.active();else{if(e.code&&[l.errorCodeList.SOCKET_CLOSE.code].includes(e.code))return this.stopMaxTime(),this.invalid(),void(this.isPublish?this.streamCenter.publisherList[this.streamID].isReDispatch=!0:this.streamCenter.playerList[this.streamID].isReDispatch=!0);var t=e,r=t.body.stream_id,n=!1;if(this.isPublish&&(!this.streamCenter.publisherList[r]||t.header.seq!==this.streamCenter.publisherList[this.streamID].seq))return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if(!(this.isPublish||this.streamCenter.playerList[this.streamID]&&t.header.seq===this.streamCenter.playerList[this.streamID].seq))return this.logger.warn(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" seq is not match, ignore "+this.streamID),this.stopMaxTime(),void this.invalid();if("PUBLIC"===this.stateCenter.type){if(this.stateCenter.clientIP=t.body.clientip||"",0!==t.body.err_code&&2==t.body.need_action)return this.retryActiveInterval=t.body.action_delay/1e3||Math.floor(3*Math.random())+3,2==this.retryActiveCount&&((p=u.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError).message=p.message+(t.body.err_code?" server error:"+t.body.err_code:""),"push"===t.body.ptype?this.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.retry,r,p):this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.retry,r,p)),void this.active();if(0!==t.body.err_code&&1!==t.body.need_action&&![3102].includes(t.body.err_code))return this.retryActiveInterval=Math.floor(3*Math.random())+3,2==this.retryActiveCount&&((p=u.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError).message=p.message+(t.body.err_code?" server error:"+t.body.err_code:""),"push"===t.body.ptype?this.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.retry,r,p):this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.retry,r,p)),void this.active();if(this.stopMaxTime(),this.invalid(),t.body.urls&&Array.isArray(t.body.urls)&&t.body.urls.length>0?n=!0:this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),"push"===t.body.ptype&&this.streamCenter.publisherList[r]){if(!n)return void this.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,r,u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);var o=this.streamCenter.publisherList[r];this.stateCenter.publishStreamList[r]?(o.ttl=t.body.hosts_ttl?(new Date).getTime()+1e3*t.body.hosts_ttl:0,o.isCenterNode="boolean"==typeof t.body.is_center_node&&t.body.is_center_node,o.serverUrls=t.body.urls,this.streamCenter.startPublishingStream(r)):this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if("pull"==t.body.ptype&&this.streamCenter.playerList[r]){if(!n)return(p=u.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError).message=p.message+(t.body.err_code?" server error:"+t.body.err_code:""),3102===t.body.err_code&&(p=u.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayUnsupportedResourceMode),void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,r,p);(f=this.streamCenter.playerList[r]).ttl=t.body.hosts_ttl?(new Date).getTime()+1e3*t.body.hosts_ttl:0,f.isCenterNode="boolean"==typeof t.body.is_center_node&&t.body.is_center_node,f.serverUrls=t.body.urls,this.streamCenter.startPlayingStream(r,this.streamCenter.playSuccessCallBackList[r])}}else{this.stopMaxTime(),this.invalid();var i=[],c=t.body.stream_url_info&&t.body.stream_url_info.stream_url,d=t.body.stream_url_info&&t.body.stream_url_info.ip_infos,h=/^ws(s)?:\/\/(.*?)\//;if(t.body.stream_url_info&&c&&d?n=!0:this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" signal url is empty"),d&&d.forEach(function(e){var t=e.ip_address+":"+e.port;i.push(c.replace(h.exec(c)[2],t))}),this.isPublish&&this.streamCenter.publisherList[r]){if(!n)return void this.streamCenter.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,r,u.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError);o=this.streamCenter.publisherList[r],this.stateCenter.publishStreamList[r]?(o.serverUrls=i,this.streamCenter.startPublishingStream(r)):this.logger.error(a.ZEGO_WEBRTC_ACTION.RDH_WEBRTC_URL_RSP+" no streamid to publish")}else if(!this.isPublish&&this.streamCenter.playerList[r]){var p,f;if(!n)return(p=u.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError).message=p.message+(t.body.err_code?" server error:"+t.body.err_code:""),void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,r,p);(f=this.streamCenter.playerList[r]).serverUrls=i,this.streamCenter.startPlayingStream(r,this.streamCenter.playSuccessCallBackList[r])}}}},t}(i.RetryHandler);t.RetryDispatchHandler=c},6014:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryStreamHandler=void 0;var i=r(6706),s=r(6502),a=r(3529),u=r(1089),l=r(608),c=function(e){function t(t,r,n,o){var i=e.call(this)||this;return i.logger=t,i.stateCenter=r,i.streamCenter=n,i.isPublish=o,i.serverUrls=[],i}return o(t,e),t.prototype.initStream=function(e,t){this.streamID=e,this.serverUrls=t},t.prototype.activePublish=function(e){var t=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}var n=this.streamCenter.publisherList[this.streamID].publisher,o=this.serverUrls,s=n.signal?n.signal.server:"";o.forEach(function(e,r){return r<=o.indexOf(s)&&t.serverUrls.push(e)}),o.splice(0,o.indexOf(s)+1);var a=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout(function(){t.logger.warn("zc.tsh.a stream "+t.streamID+" connect signal server "+a),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++,t.streamCenter.connectPublishServer(t.streamID,a)},"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.activePull=function(e,t){var r=this;if(this.logger.info("zc.tsh.a retry call "+this.streamID),t&&(this.playStreamSuccess=t),this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline)return this.logger.info("zc.tsh.a network is broken, stop retry"),!1;if(this.retryTimer)return this.logger.info("zc.tsh.a has active, ignore"),!1;if(this.isOverTime)return this.logger.warn("zc.tsh.a retry over time, stop retry"),!1;if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var n=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n}var o=this.streamCenter.playerList[this.streamID].player,s=this.serverUrls,a=o.signal?o.signal.server:"";s.forEach(function(e,t){return t<=s.indexOf(a)&&r.serverUrls.push(e)}),s.splice(0,s.indexOf(a)+1);var u=this.serverUrls[this.retryActiveCount%this.serverUrls.length==0?this.serverUrls.length-1:this.retryActiveCount%this.serverUrls.length-1];return this.retryTimer=setTimeout(function(){r.logger.warn("zc.tsh.a stream "+r.streamID+" connect signal server "+u),r.retryTimer&&clearTimeout(r.retryTimer),r.retryTimer=null,r.retryActiveCount++,r.streamCenter.connectPlayServer(r.streamID,r.playStreamSuccess,u)},"number"==typeof e?e:1e3*this.retryActiveInterval),this.logger.info("zc.tsh.a call success"),!0},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){if(e.logger.warn(e.streamID+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.invalid(),e.isPublish){if(!e.streamCenter.publisherList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" publish no found");e.publishStateHandle(i.ENUM_PUBLISH_STATE_UPDATE.error,e.streamID,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishRetryTimeoutError,!0)}else{if(!e.streamCenter.playerList[e.streamID])return void e.logger.info("zc.tsh.smt streamID "+e.streamID+" play no found");e.playStateHandle(i.ENUM_PLAY_STATE_UPDATE.error,e.streamID,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRetryTimeoutError,!0)}},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.retryNextSignal=function(e){if(this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline)return!0;if(this.isPublish){var t=this.streamCenter.publisherList[this.streamID];if(t.publisher.state==i.ENUM_PUBLISH_STATE.stop&&[a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError.code,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError.code].includes(e.code))return!0;if(t.isCenterNode&&t.publisher.signal&&t.publisher.signal.websocket&&1==t.publisher.signal.websocket.readyState)return!1;if(!t.isCenterNode&&[a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError.code].includes(e.code)){var r=(n=e.message.match(/reason:(\d+)/))?n[1]:"";return!["26"].includes(r)}return!0}var n,o=this.streamCenter.playerList[this.streamID];return!((o.player.state!=i.ENUM_PLAY_STATE.stop||![a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError.code,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError.code].includes(e.code))&&(o.isCenterNode&&o.player.signal&&o.player.signal.websocket&&1==o.player.signal.websocket.readyState||!o.isCenterNode&&[a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError.code].includes(e.code)&&(r=(n=e.message.match(/reason:(\d+)/))?n[1]:"",["24","26","28"].includes(r))))},t.prototype.publishStateHandle=function(e,t,r,n){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" call "+t+" "+(r?r.code+"":""));var o=n||this.RETRY_MAX_TIME<3;if(!o&&r&&(l.ClientUtil.isReDispatch(r)||0==this.serverUrls.length))return this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPublishStateUpdate(e,t,r);var s=this.streamCenter.publisherList[t],c=s.publisher;if(!o&&r&&0!==r.code){!this.maxTimer&&!o&&this.startMaxTime(),this.stateCenter.publishStreamList[t].state=i.ENUM_PUBLISH_STREAM_STATE.retryPublish;var d=c.localStream,h=c.videoInfo,p=c.mediaStreamConfig,f=c.publishOption;if(0!=c.sessionId&&c.signal&&c.shouldSendCloseSession()&&(c.signal.sendCloseSession(i.getSeq(),c.sessionId,1),c.signal.removeSession(c.sessionId),c.closeSessionSignal=!0),c.resetPublish(),!o&&!this.retryNextSignal(r)){if(s.isCenterNode&&c.gwNodeTTL<(new Date).getTime()&&0!==c.gwNodeList.length)c.gwNode="",c.gwNodeList=[],c.gwNodeTTL=0;else if(s.isCenterNode){var g=c.gwNodeList.findIndex(function(e){return e==c.gwNode});c.gwNode=c.gwNodeList[++g%c.gwNodeList.length]}return void setTimeout(function(){c.startPublish(t,d,h,p,f)},3e3)}this.streamCenter.removeStreamFromSignal(!0,t)}if(o)return this.stopMaxTime(),this.invalid(),1===e&&c.resetPublish(),void this.streamCenter.onPublishStateUpdate(e,t,r);if(r&&0!==r.code&&this.activePublish(void 0)){var _=i.getReportSeq();this.streamCenter.dataReport.newReport(_),this.streamCenter.dataReport.addMsgInfo(_,{stream:a.ZegoRTCLogEvent.kZegoTaskRePublish.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(_,a.ZegoRTCLogEvent.kZegoTaskRePublish.event),this.streamCenter.onPublishStateUpdate(2,t,r)}this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISH_STATE_HANDLE+" end "+t)},t.prototype.playStateHandle=function(e,t,r,n){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" call "+t+" "+(r?r.code+"":""));var o=n||this.RETRY_MAX_TIME<3;if(!o&&r&&(l.ClientUtil.isReDispatch(r)||0==this.serverUrls.length))return this.stopMaxTime(),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,void this.streamCenter.onPlayStateUpdate(e,t,r);if(r&&0!==r.code){!this.maxTimer&&!o&&this.startMaxTime();var s=this.streamCenter.playerList[t],c=s.player,d=c.playOption;if(0!=c.sessionId&&c.signal&&c.shouldSendCloseSession()&&(c.signal.sendCloseSession(i.getSeq(),c.sessionId,1),c.signal.removeSession(c.sessionId),c.closeSessionSignal=!0),c.resetPlay(),!o&&!this.retryNextSignal(r)){if(s.isCenterNode&&c.gwNodeTTL<(new Date).getTime()&&0!==c.gwNodeList.length)c.gwNode="",c.gwNodeList=[],c.gwNodeTTL=0;else if(s.isCenterNode){var h=c.gwNodeList.findIndex(function(e){return e==c.gwNode});c.gwNode=c.gwNodeList[++h%c.gwNodeList.length]}return void setTimeout(function(){c.startPlay(t,c.getRemoteStreamSuc,d)},3e3)}this.streamCenter.removeStreamFromSignal(!1,t)}if(o)return this.stopMaxTime(),this.invalid(),void this.streamCenter.onPlayStateUpdate(e,t,r);if(r&&0!==r.code&&this.activePull(void 0)){var p=i.getReportSeq();this.streamCenter.dataReport.newReport(p),this.streamCenter.dataReport.addMsgInfo(p,{stream:a.ZegoRTCLogEvent.kZegoTaskRePlay.stream(this.streamID)}),this.streamCenter.dataReport.uploadReport(p,a.ZegoRTCLogEvent.kZegoTaskRePlay.event),this.streamCenter.onPlayStateUpdate(2,t,r)}this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAY_STATE_HANDLE+" end "+t)},t}(s.RetryHandler);t.RetryStreamHandler=c},908:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.RTCModules=void 0;var i=r(6706),s=r(3529),a=r(608),u=r(7560),l=r(361),c=r(4865),d=r(1089),h=r(2752),p=r(9595),f=function(){function e(e,t,r,n,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=n,this.rtm=o,this.ac=i,this.mediaEleSources=[],this.publishModule=new l.PublishModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.playModule=new c.PlayModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.initAdvance(),this.initAudioMix(),this.init()}return e.prototype.init=function(){this.bindWindowListener(),this.bindRTMListener(),this.bindStreamCenterHandler()},e.prototype.initAudioMix=function(){},e.prototype.initAdvance=function(){},e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i);window.addEventListener(t?"pagehide":"firefox"===this.stateCenter.browser?"beforeunload":"unload",function(){for(var t in window.event&&(window.event.cancelBubble=!0),e.streamCenter.publisherList)e.publishModule.stopPublishingStream(t);for(var t in e.streamCenter.playerList)e.playModule.stopPlayingStream(t)}),window.addEventListener("message",function(t){var r=t.data,n=r.type;"SS_DIALOG_SUCCESS"===n&&e.screenStreamFrom(r.streamId,r.canRequestAudioTrack,a.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)),"SS_DIALOG_CANCEL"===n&&a.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)(!1,null,n)}),window.addEventListener("offline",function(){for(var t in e.logger.info("zc.off.0 newtwork is broken"),e.stateCenter.networkState=i.ENUM_NETWORK_STATE.offline,e.streamCenter.publisherList)(r=e.streamCenter.publisherList[t].retryStreamHandler).startMaxTime(),r.invalid();for(var t in e.streamCenter.playerList){var r;(r=e.streamCenter.playerList[t].retryStreamHandler).startMaxTime(),r.invalid()}}),window.addEventListener("online",function(t){for(var r in e.logger.info("zc.on.0 network is online"),e.stateCenter.networkState=i.ENUM_NETWORK_STATE.online,e.streamCenter.publisherList){var n=e.streamCenter.publisherList[r].publisher,o=e.streamCenter.publisherList[r].retryStreamHandler;n.state==i.ENUM_PUBLISH_STATE.stop||n.stateNego!==i.ENUM_PUBLISH_STATE_NEGO.iceConnected?!o.isOverTime&&o.publishStateHandle(i.ENUM_PUBLISH_STATE_UPDATE.error,r,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNetworkBrokenError):n.state==i.ENUM_PUBLISH_STATE.publishing&&o.stopMaxTime()}for(var r in e.streamCenter.playerList){var a=e.streamCenter.playerList[r].player;o=e.streamCenter.playerList[r].retryStreamHandler,a.state==i.ENUM_PLAY_STATE.stop||a.stateNego!==i.ENUM_PLAY_STATE_NEGO.iceConnected?!o.isOverTime&&o.playStateHandle(i.ENUM_PLAY_STATE_UPDATE.error,r,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNetworkBrokenError):a.state==i.ENUM_PLAY_STATE.playing&&o.stopMaxTime()}}),window.addEventListener("visibilitychange",function(t){if(Object.keys(e.streamCenter.publisherList).length>0||Object.keys(e.streamCenter.playerList).length>0){var r=i.getReportSeq();e.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoVisibilityChange.event),e.dataReport.uploadReport(r)}})},e.prototype.bindRTMListener=function(){var e,t,r=this;this.rtm._on("_settingCanFetch",function(e){return n(r,void 0,void 0,function(){var e=this;return o(this,function(t){return this.rtm.cloudSetting.fetchSetting(p.RTC).then(function(t){e.logger.info("zc.scf stream config "+JSON.stringify(t)),e.rtm._on("_cloudSettingNotify",function(t,r){var n=i.getReportSeq();e.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskCloudSettingRefresh.event);var o=e.rtm.cloudSetting.getEnvVariables();e.dataReport.addMsgInfo(n,{params:o,files:[{name:t,content:r.setting,versions:r.versions}]}),e.dataReport.uploadReport(n)})}),[2]})})}),this.rtm._on("roomLoginResponse",function(e){r.logger.info("zc.rlr call "+JSON.stringify(e));var t=e.header.room_id;r.stateCenter.appid=r.rtm.getAppID(),r.stateCenter.idName=r.rtm.getUserID(),r.stateCenter.testEnvironment=r.rtm.isTestEnvironment(),r.stateCenter.isMultiRoom=r.rtm.getMultiRoom(),r.streamCenter.setSessionInfo(r.stateCenter.appid,r.stateCenter.idName,r.stateCenter.testEnvironment);var n=r.rtm.getToken(t),o=r.rtm.getSessionId(t),i=r.rtm.getRoomSessionID(t),s=r.stateCenter.getRoomByRoomID(t);if(!s){var a=new u.StreamHandler(r.logger,r.stateCenter,r.rtm,r.streamCenter,t);r.bindStreamHandler(a),r.stateCenter.roomList.push(s={roomID:t,streamHandler:a,sessionID:o,roomSessionID:i,token:n,isResetRoom:!1,streamList:[],streamInfoList:[]})}s.sessionID=o,s.roomSessionID=i,s.streamHandler.handleStreamStart(e,s),r.logger.info("zc.rlr end "+t)}),this.rtm._on("HBResponse",function(e){var t,n=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=r.stateCenter.getRoomByRoomID(n);"PUBLIC"===r.stateCenter.type&&(null==o||o.streamHandler.patchStreamList(e))}),this.rtm._on("_roomStateUpdate",function(e,t,n,o){if("DISCONNECTED"==t){r.logger.info("zc.rsu "+e+" disconnected "+(n?n+" ":"")+(o||""));var i=r.stateCenter.getRoomByRoomID(e);if(i){var s=r.stateCenter.roomList.findIndex(function(t){return t.roomID==e});i.isResetRoom=!0,i.streamHandler.reset(),r.streamCenter.reset(e),r.stateCenter.roomList.splice(s,1)}}else r.logger.info("zc.rsu "+e+" state: "+t)}),this.rtm._on("_tokenRenewed",function(e,t){r.logger.info("zc.tr roomID:"+t+" "+e);var n=r.stateCenter.getRoomByRoomID(t);n&&(n.token=e)}),this.rtm._on("_tokenExpired",function(e){var t,n;((null===(n=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.stop_stream)||void 0===n?void 0:n.stream_id_list)||[]).forEach(function(e){r.publishModule.stopPublishingStream(e,h.errorCodeList.TOKEN_EXPIRED)})}),this.rtm.service.on("stream",function(e){var t,n=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",o=r.stateCenter.getRoomByRoomID(n);o?o.streamHandler.handleStreamUpdateRsp(e):r.logger.error(d.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")}),null===(e=this.rtm.service)||void 0===e||e.on("push_stream_update",function(e){var t,n=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",o=r.stateCenter.getRoomByRoomID(n);o?o.streamHandler.handlePushStreamUpdateMsg(e):r.logger.error(d.ZEGO_WEBRTC_ACTION.ON_PUSH_STREAM_UPDATE+" room no found")}),null===(t=this.rtm.service)||void 0===t||t.on("zegochat_js.push_room_stream_update_req",function(e){var t,n=(null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id)||"",o=r.stateCenter.getRoomByRoomID(n);o?o.streamHandler.handlePriPushStreamUpdateMsg(e):r.logger.error(d.ZEGO_WEBRTC_ACTION.ON_STREAM+" room no found")})},e.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,n){var o=e.stateCenter.reportSeqList.startPlay[r],i=e.streamCenter.playerList[r];if(1==t&&i&&a.ClientUtil.isReDispatch(n)){var s=i.player,u=i.retryDispatchHandler,l=i.playOption;return 0!=s.sessionId&&s.signal&&s.shouldSendCloseSession()&&(s.signal.sendCloseSession(e.stateCenter.getSeq(),s.sessionId,1),s.signal.removeSession(s.sessionId),s.closeSessionSignal=!0),s.resetPlay(),u.stopMaxTime(),u.invalid(),u.initStream(r,l,!1),void(e.rtm.isLogin()?(u.startMaxTime(),u.active(0)):e.streamCenter.playerList[r].isReDispatch=!0)}i&&i.player&&(0==t||1==t)&&o&&(e.dataReport.eventEndWithMsgInfo(o,"PlayState",{type:t}),1==t&&n&&e.dataReport.addMsgInfo(o,n),e.dataReport.addMsgInfo(o,{session_id:i.player.sessionId}),e.dataReport.uploadReport(o),delete e.stateCenter.reportSeqList.startPlay[r]),1===t&&e.streamCenter.playErrorCallBackList[r]?(e.streamCenter.playErrorCallBackList[r]({errorCode:n&&n.code,extendedData:n&&n.message}),delete e.streamCenter.playErrorCallBackList[r],e.logger.info("zc.opsu.1 stop play called by sdk"),e.playModule.stopPlayingStream(r,n)):e.stateCenter.actionListener("playerStateUpdate",{state:a.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:n&&n.code,extendedData:n&&n.message})},this.streamCenter.onPublishStateUpdate=function(t,r,n){e.onPublishStateUpdateHandle(t,r,n)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)},this.streamCenter.onRemoteCameraStatusUpdate=function(t,r,n){var o=i.getReportSeq();e.dataReport.newReport(o,s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.event),e.dataReport.addMsgInfo(o,{stream:s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.stream(t),status:s.ZegoRTCLogEvent.kZegoTaskRemoteCameraUpdate.status(r)}),e.dataReport.uploadReport(o),e.stateCenter.actionListener("remoteCameraStatusUpdate",t,r),e.stateCenter.actionListener("_remoteCameraStatusUpdate",t,n)},this.streamCenter.onRemoteMicStatusUpdate=function(t,r,n){var o=i.getReportSeq();e.dataReport.newReport(o,s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.event),e.dataReport.addMsgInfo(o,{stream:s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.stream(t),status:s.ZegoRTCLogEvent.kZegoTaskRemoteMicUpdate.status(r)}),e.dataReport.uploadReport(o),e.stateCenter.actionListener("remoteMicStatusUpdate",t,r),e.stateCenter.actionListener("_remoteMicStatusUpdate",t,n)},this.streamCenter.onSoundLevelUpdate=function(t){e.stateCenter.actionListener("soundLevelUpdate",t)},this.streamCenter.onMicSoundLevelUpdate=function(t){e.stateCenter.actionListener("capturedSoundLevelUpdate",t)}},e.prototype.bindStreamHandler=function(e){var t=this;e.onStreamUpdated=function(e,r,n){var o;o=n.map("PRIVATE"===t.stateCenter.type?function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info,title:e.title,streamVer:e.stream_ver}}:function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo,urlsFLV:e.urlFlv,urlsRTMP:e.urlRtmp,urlsHLS:e.urlHls,urlsHttpsFLV:e.urlHttpsFlv,urlsHttpsHLS:e.urlHttpsHls}});var u={};if(0===r){var l=n.map(function(e){return{stream_id:e.streamID,code:i.STREAM_DELETE_REASON[e.closeType]&&i.STREAM_DELETE_REASON[e.closeType].code||0,description:i.STREAM_DELETE_REASON[e.closeType]&&i.STREAM_DELETE_REASON[e.closeType].description||"unknown"}});u.stream_delete_reason=l}var c=i.getReportSeq();if(t.dataReport.newReport(c,s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.event),t.dataReport.addMsgInfo(c,{stream_update_type:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.stream_update_type(1===r?"added":"deleted"),update_stream:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.update_stream(o)}),t.dataReport.uploadReport(c),t.stateCenter.actionListener("roomStreamUpdate",e,a.ClientUtil.getSteamUpdateType(r),o,Object.keys(u).length>0?JSON.stringify(u):""),t.stateCenter.actionListener("_streamUpdated",r,n),1===r){var d=[];o.forEach(function(e){e.extraInfo&&d.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})}),d.length>0&&t.stateCenter.actionListener("streamExtraInfoUpdate",e,d)}},e.onPublishStateUpdate=function(e,r,n){t.logger.info("zb.opsu ",r);var o=t.stateCenter.reportSeqList.startPublish[r],i=t.streamCenter.publisherList[r];i&&i.publisher&&(0==e||1==e)&&o&&(t.dataReport.eventEndWithMsgInfo(o,"PublishState",{type:e}),1==e&&t.dataReport.addMsgInfo(o,n),t.dataReport.addMsgInfo(o,{session_id:i.publisher.sessionId}),t.dataReport.uploadReport(o),delete t.stateCenter.reportSeqList.startPublish[r]),t.stateCenter.actionListener("publisherStateUpdate",{state:a.ClientUtil.getPublisherStateType(e),streamID:r,errorCode:n.code,extendedData:n.message})},e.onStreamExtraInfoUpdated=function(e,r){var n;n=r.map("PUBLIC"===t.stateCenter.type?function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}}:function(e){return{streamID:e.stream_id,user:{userID:e.user_id,userName:e.user_name},extraInfo:e.extra_info,title:e.title,streamVer:e.stream_ver}});var o=i.getReportSeq();t.dataReport.newReport(o,s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.event),t.dataReport.addMsgInfo(o,{update_stream:s.ZegoRTCLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.update_stream(n)}),t.dataReport.uploadReport(o),t.stateCenter.actionListener("streamExtraInfoUpdate",e,n)}},e.prototype.screenStreamFrom=function(e,t,r){var n={};n.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}},n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:window.screen.width,maxHeight:window.screen.height}},!t&&(n.audio=!1),navigator.mediaDevices.getUserMedia(n).then(function(e){r(!0,e)}).catch(function(e){r(!1,null,e)})},e.prototype.onPublishStateUpdateHandle=function(e,t,r){var n=this;this.logger.info("zc.opsuh.0 call");var o=this.streamCenter.publisherList[t],s=o.room;if(s)if(0==e)this.stateCenter.publishStreamList[t]&&([i.ENUM_PUBLISH_STREAM_STATE.tryPublish,i.ENUM_PUBLISH_STREAM_STATE.retryPublish].includes(this.stateCenter.publishStreamList[t].state)&&!s.streamList.find(function(e){return e.stream_id==t})?(this.stateCenter.publishStreamList[t].state=i.ENUM_PUBLISH_STREAM_STATE.update_info,s.streamHandler.updateStreamInfo(t,"PUBLIC"===this.stateCenter.type?i.ENUM_STREAM_SUB_CMD.liveBegin:i.ENUM_STREAM_CMD_PRI.liveBegin,this.stateCenter.publishStreamList[t].extra_info,function(e){"PRIVATE"===n.stateCenter.type&&n.stateCenter.publishStreamList[t]&&n.stateCenter.publishStreamList[t].state==i.ENUM_PUBLISH_STREAM_STATE.update_info&&(n.stateCenter.publishStreamList[t].state=i.ENUM_PUBLISH_STREAM_STATE.stop,s.streamHandler.onPublishStateUpdate(1,t,e),n.publishModule.stopPublishingStream(t))})):(this.stateCenter.publishStreamList[t].state=i.ENUM_PUBLISH_STREAM_STATE.publishing,this.WebrtcOnPublishStateUpdateHandle(e,t,r)));else{if(1==e&&o&&a.ClientUtil.isReDispatch(r)){var u=o.publisher,l=o.retryDispatchHandler,c=o.publishOption;return 0!=u.sessionId&&u.signal&&u.shouldSendCloseSession()&&(u.signal.sendCloseSession(this.stateCenter.getSeq(),u.sessionId,1),u.signal.removeSession(u.sessionId),u.closeSessionSignal=!0),u.resetPublish(),l.stopMaxTime(),l.invalid(),l.initStream(t,c,!0),void(this.rtm.isLogin()?(l.startMaxTime(),l.active(0)):this.streamCenter.publisherList[t].isReDispatch=!0)}s.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info("zc.opsuh.0 stop publish called by sdk"),this.publishModule.stopPublishingStream(t,r))}else this.logger.error("zc.opsuh.0 room not exist")},e.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){if(this.stateCenter.publishStreamList[t].state==i.ENUM_PUBLISH_STREAM_STATE.publishing){var n=this.streamCenter.getRoomByStreamID(t);n&&n.streamHandler.onPublishStateUpdate(e,t,r)}},e.prototype.bindListener=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error("zc.o.0 event "+e+" no found"),!1)},e.prototype.deleteListener=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error("zc.o.1 listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e}();t.RTCModules=f},4865:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayModule=void 0;var o=r(1089),i=r(6706),s=r(3529),a=r(608),u=function(){function e(e,t,r,n,o){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=n,this.rtm=o}return e.prototype.startPlayingStream=function(e,t,r){var n=this;return this.logger.info(o.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" call ",e),new Promise(function(o,i){return n._handlePlayStream(e,t,o,i,r)})},e.prototype._handlePlayStream=function(e,t,r,u,l){var c=this,d=i.getReportSeq();this.stateCenter.reportSeqList.startPlay[e]=d,this.dataReport.newReport(d,s.ZegoRTCLogEvent.kZegoTaskPlayStart.event);var h,p=function(t,r){c.logger.error(o.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM+" "+(r||t.message)),c.dataReport.uploadReport(d,void 0,t,r),delete c.stateCenter.reportSeqList.startPlay[e],u&&u(n(n({},t),{errorCode:t.code,extendedData:t.message+(r?" "+r:"")}))};if(void 0===e||"string"!=typeof e||""===e)return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"stream id type error"),!1;if(e.length>i.MAX_STREAM_ID_LENGTH)return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDToLongError,"stream id length limit "+i.MAX_STREAM_ID_LENGTH),!1;if(!a.ClientUtil.checkIllegalCharacters(e))return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError),!1;if(void 0!==t&&"object"!=typeof t)return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayParamError,"playOption must be object"),!1;if(this.stateCenter.customUrl&&0!=this.stateCenter.customUrl.length)this.logger.info("zc.p.sps.1 customUrl "+JSON.stringify(this.stateCenter.customUrl)),h=this.stateCenter.customUrl;else{var f=this.stateCenter.settingConfig.getSetting("signal_nodes",!0);f&&f instanceof Array&&f.length>0&&(h=f,this.logger.info("zc.p.sps.1 setting config signal_nodes "+JSON.stringify(f)))}if(h)return this.streamCenter.setPlayStateStart(e,t,l)?(this.streamCenter.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.playerList[e].serverUrls=h,this.streamCenter.startPlayingStream(e,function(e){r&&r(e)})):(p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1);if(this.dataReport.addMsgInfo(d,{stream:s.ZegoRTCLogEvent.kZegoTaskPlayStart.stream(e),playOption:s.ZegoRTCLogEvent.kZegoTaskPlayStart.playOption(t)}),this.rtm.service.isDisConnect())return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;this.stateCenter.pullLimited||(e=NaN+e),t&&t.videoCodec&&(t.videoCodec=t.videoCodec.toUpperCase());var g=this.stateCenter.settingConfig.getSetting("resource_mode",!0);if(g&&(this.logger.info(o.ZEGO_WEBRTC_ACTION.START_PLAYING_STREAM," setting resource_mode "+g),!t&&(t={}),t.resourceMode=g),!this.streamCenter.setPlayStateStart(e,t,l))return p(s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError,"cannot start play"),!1;this.streamCenter.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.playSuccessCallBackList[e]=function(e){r&&r(e)},u&&(this.streamCenter.playErrorCallBackList[e]=u);var _=this.streamCenter.playerList[e].retryDispatchHandler;return _.stopMaxTime(),_.invalid(),_.initStream(e,t,!1),_.startMaxTime(),_.active(0)},e.prototype.stopPlayingStream=function(e,t){var r;this.logger.info(o.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call",e);var n=i.getReportSeq();if(this.stateCenter.reportSeqList.stopPlay[e]=n,this.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskPlayStop.event),this.dataReport.addMsgInfo(n,{stream:s.ZegoRTCLogEvent.kZegoTaskPlayStop.stream(e)}),"string"!=typeof e||""===e)return this.logger.error(o.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" streamid must be string and not empty"),this.dataReport.uploadReport(n,void 0,s.ZegoRTCLogEvent.kZegoTaskPlayStop.error.kParamError,"stream id type error"),void delete this.stateCenter.reportSeqList.stopPlay[e];var a=this.streamCenter.playerList[e],u=a&&a.player&&a.player.state!==i.ENUM_PLAY_STATE.stop;for(var l in this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[l]===e){delete this.stateCenter.streamUrlMap[l];break}this.dataReport.addMsgInfo(n,{session_id:null===(r=null==a?void 0:a.player)||void 0===r?void 0:r.sessionId}),this.dataReport.uploadReport(n),u&&this.streamCenter.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.error,e,t||{code:0,message:""}),this.logger.debug(o.ZEGO_WEBRTC_ACTION.STOP_PLAYING_STREAM+" call success")},e.prototype.mutePlayStream=function(e,t,r){return new Promise(function(e,t){e(!1)})},e.prototype.setStreamAudioOutput=function(e,t){return!1},e}();t.PlayModule=u},5634:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayStreamQuality=void 0;var n=r(6706),o=r(1089),i=r(3529),s=r(608),a=function(){function e(e,t,r,o){this.player=t,this.logger=r,this.dataReport=o,this.playQualityList=[],this.maxQualityListCount=10,this.qualityTimer=null,this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,audioPacketsReceived:0,videoPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0},this.decodeStartTime=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=n.ENUM_PROBE_STATE.probed,this.probeTimer=null,this.probeTimeoutInterval=3e4,this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.cumulativeQuality={},this.audioBreakThreshold=200,this.videoBreakThreshold=500,this.videoBreak={breakStartTime:void 0,cumulativeBreakDuration:0,cumulativeDecodeDuration:0,decodeStartTime:void 0,decodeEndTime:void 0,totalDuration:0,noBreakNoDecodeDuration:0,resumeRecv:!0},this.audioBreak={breakStartTime:void 0,cumulativeBreakDuration:0,cumulativeDecodeDuration:0,decodeStartTime:void 0,decodeEndTime:void 0,totalDuration:0,noBreakNoDecodeDuration:0,resumeRecv:!0},this.lastSampleTime=0,this.videoBreakReport={breakDuration:0,breakCancelDuration:0,decodeTime:0},this.audioBreakReport={breakDuration:0,breakCancelDuration:0,decodeTime:0},this.totalQuality={totalSquaredInterFrameDelay:0,totalInterFrameDelay:0,framesDecode:0,totalSamplesReceived:0,concealedSamples:0,audioBytesReceived:0},this.currentSecondQuality={totalSquaredInterFrameDelay:0,totalInterFrameDelay:0,framesDecode:0,totalSamplesReceived:0,concealedSamples:0},this.onBreakEnd=function(e,t,r,n){if(void 0===n&&(n="video"),t.breakStartTime){var o=e-t.breakStartTime;o>=r&&(t.cumulativeBreakDuration+=o),t.breakStartTime=void 0}},this.p2pNetStats={p2pLostRate:0,p2pRTT:0},this.sampleTimes=0,this.qualitySampleInterval=1e3,this.qualityTimeInterval=e}return Object.defineProperty(e.prototype,"streamId",{get:function(){return this.player.streamId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.player.sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peerID",{get:function(){return this.player.peerID},enumerable:!1,configurable:!0}),e.prototype.getPlayStats=function(e,t){var r=this;if(null!=e){var a=this.sampleTimes%parseInt((this.qualityTimeInterval/this.qualitySampleInterval).toString())==0;parseInt((this.qualityTimeInterval/this.qualitySampleInterval).toString()),a&&this.getP2PNetStats();for(var u,l=document.querySelectorAll("video, audio"),c=0;c<l.length;c++)l[c].srcObject===this.player.playStream&&(u=l[c]);var d={sampleTimeWindow:this.qualityTimeInterval,audioFractionLost:0,audioPacketsLost:0,audioPacketsLostRate:0,audioBitrate:0,audioLevel:0,audioSendLevel:0,audioSamplingRate:0,audioCodec:"opus",audioQuality:0,audioFPS:0,videoQuality:0,videoPacketsLost:0,videoPacketsLostRate:0,videoBitrate:0,videoFPS:0,playData:0,nackCount:0,pliCount:0,audioJitter:0,videoFractionLost:0,videoFramesDecoded:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoFramesDropped:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,audioMuteState:this.player.audioMuteState,videoMuteState:this.player.videoMuteState,muted:u?u.muted:void 0,paused:u?u.paused:void 0,volume:u?u.volume:void 0,sinkId:u?u.sinkId:void 0},h=this.lastPlayStats.time,p=0,f=0,g=0,_=0,m=0,v=0,E=0,T=null,y=null;e.forEach(function(e){["ssrc","inbound-rtp"].includes(e.type)&&("video"==e.mediaType||e.id.indexOf("VideoStream")>=0)&&(T=e),("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("audio"==e.mediaType||e.id.indexOf("AudioStream")>=0)&&(y=e)});var S=function(e,t,n,i,s,a,u,l,c){if(void 0===l&&(l=u),void 0===c&&(c="video"),s>1e3&&(s=1e3),i.breakStartTime)if(n)0===t?(e-i.breakStartTime>=22e3&&r.onBreakEnd(e,i,s,c),a.breakDuration+=1e3):u>=s?u<500?u+l<1e3?(r.onBreakEnd(e-(1e3-l),i,s,c),i.breakStartTime=e-u,a.breakDuration+=l+u,a.decodeTime+=1e3-(l+u)):(r.onBreakEnd(e-1e3+l,i,s,c),i.breakStartTime=e-1e3+l,a.breakDuration+=1e3):u>=500&&(r.onBreakEnd(e-u,i,s,c),i.breakStartTime=e-u,a.breakDuration+=1e3):l<=s?(r.onBreakEnd(e-1e3+l,i,s,c),i.breakStartTime=void 0,a.breakDuration+=l,a.decodeTime+=1e3-l):a.breakDuration+=1e3;else{i.resumeRecv=!1;var d=e-1e3,h=d-i.breakStartTime;h<=0&&(r.logger.error(o.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" breakCancelDuration less than 0.  ("+i.breakStartTime+", "+d+")"),h=0),i.breakStartTime=void 0,i.noBreakNoDecodeDuration+=h,a.breakCancelDuration+=h}else n?0===t?i.resumeRecv?(i.breakStartTime=e-1e3,a.breakDuration+=1e3):i.noBreakNoDecodeDuration+=1e3:l>s?i.resumeRecv?(i.breakStartTime=e-l,a.breakDuration+=l,a.decodeTime+=1e3-l):i.noBreakNoDecodeDuration+=1e3:a.decodeTime+=1e3:i.decodeStartTime&&(0===t?(i.resumeRecv=!1,i.noBreakNoDecodeDuration+=1e3):a.decodeTime+=1e3);n&&t&&(i.resumeRecv=!0)},C=(new Date).getTime(),R=function(e,t){return e>t?e-t:0};if(this.lastSampleTime||(this.lastSampleTime=C-1e3),T){var b=T.totalInterFrameDelay,I=T.framesDecoded,k=T.totalSquaredInterFrameDelay,O=R(I,this.totalQuality.framesDecode);this.totalQuality.framesDecode=I;var L=R(b,this.totalQuality.totalInterFrameDelay);this.totalQuality.totalInterFrameDelay=b;var P=R(k,this.totalQuality.totalSquaredInterFrameDelay);this.totalQuality.totalSquaredInterFrameDelay=k;var A=(P-Math.pow(L,2)/(O||1))/(O||1);A=A>0?A:-A;var N=parseInt((1e3/(O+1)).toString()),M=1e3*Math.sqrt(A),w=L/(O||1)*1e3||N,D=(w=parseInt((w>1e3?1e3:w).toString()))+M;D=parseInt((D>1e3?1e3:D).toString()),O>0&&0===this.player.cameraStatus&&!this.videoBreak.decodeStartTime&&(this.videoBreak.decodeStartTime=C-1e3),this.videoBreak.decodeStartTime&&S(C,O,0===this.player.cameraStatus&&this.player.playMediaStatus.video,this.videoBreak,this.videoBreakThreshold,this.videoBreakReport,w,D)}if(y){var U=y.totalSamplesReceived,x=y.concealedSamples,B=y.bytesReceived,Z=R(U,this.totalQuality.totalSamplesReceived);this.totalQuality.totalSamplesReceived=U;var G=R(x,this.totalQuality.concealedSamples);this.totalQuality.concealedSamples=x;var H=R(B,this.totalQuality.audioBytesReceived);this.totalQuality.audioBytesReceived=B;var W=parseInt((G/(Z||1)*1e3).toString());H>0&&0===this.player.micStatus&&!this.audioBreak.decodeStartTime&&(this.audioBreak.decodeStartTime=C-1e3),this.audioBreak.decodeStartTime&&S(C,H,0===this.player.micStatus&&this.player.playMediaStatus.audio,this.audioBreak,this.audioBreakThreshold,this.audioBreakReport,W,W,"audio")}if(t&&t.result().forEach(function(e){a&&("ssrc"==e.type&&(e.names().indexOf("googBandwidthLimitedResolution")>=0&&(d.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),e.names().indexOf("codecImplementationName")>=0&&(d.codecImplementationName=e.stat("codecImplementationName")),"video"==e.stat("mediaType")&&(e.names().indexOf("googCodecName")>=0&&(d.videoCodecName=e.stat("googCodecName")),e.names().indexOf("googCurrentDelayMs")>=0&&(E=e.stat("googCurrentDelayMs"))),"audio"==e.stat("mediaType")&&(e.names().indexOf("googCodecName")>=0&&(d.audioCodecName=e.stat("googCodecName")),e.names().indexOf("googCurrentDelayMs")>=0&&(v=e.stat("googCurrentDelayMs"))),e.names().indexOf("googCpuLimitedResolution")>=0&&(d.googCpuLimitedResolution=e.stat("googCpuLimitedResolution"))),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(d.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth")))}),a){e.forEach(function(e){if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("audio"==e.mediaType||e.id.indexOf("AudioStream")>=0)){0!=h&&(d.audioBitrate=8*(e.bytesReceived-r.lastPlayStats.audioBytesReceived)/(e.timestamp-h),(o=e.packetsLost-r.lastPlayStats.audioPacketsLost)>0&&(f=o/(o+e.packetsReceived-r.lastPlayStats.audioPacketsReceived))),d.audioBitrate<0&&(d.audioBitrate=0),d.audioJitter=e.jitter,e.packetsLost>0&&(d.audioPacketsLost=e.packetsLost),d.audioFractionLost=e.fractionLost;var t=e.packetsLost-r.lastPlayStats.audioPacketsLost;d.audioFPS=(e.packetsReceived-r.lastPlayStats.audioPacketsReceived)/(e.timestamp-h)*1e3,d.audioPacketsLostRate=t>0?t/(e.packetsReceived-r.lastPlayStats.audioPacketsReceived+t):0,r.lastPlayStats.audioBytesReceived=e.bytesReceived,e.packetsLost>0&&(r.lastPlayStats.audioPacketsLost=e.packetsLost),r.lastPlayStats.audioPacketsReceived=e.packetsReceived,r.lastPlayStats.audioTime=e.timestamp,r.lastPlayStats.time=e.timestamp,r.lastPlayStats.audioBitrate=d.audioBitrate,_=e.jitter}else if(("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("video"==e.mediaType||e.id.indexOf("VideoStream")>=0)){var o;0!=h&&(d.videoBitrate=8*(e.bytesReceived-r.lastPlayStats.videoBytesReceived)/(e.timestamp-h),d.videoFPS=1e3*(e.framesDecoded-r.lastPlayStats.framesDecoded)/(e.timestamp-h),(o=e.packetsLost-r.lastPlayStats.videoPacketsLost)>0&&(g=o/(o+e.packetsReceived-r.lastPlayStats.videoPacketsReceived))),d.videoBitrate<0&&(d.videoBitrate=0),d.videoFPS<0&&(d.videoFPS=0),d.nackCount=e.nackCount,d.pliCount=e.pliCount,d.videoFractionLost=e.fractionLost,d.videoFramesDecoded=e.framesDecoded,e.packetsLost>0&&(d.videoPacketsLost=e.packetsLost),d.videoPacketsLostRate=(t=e.packetsLost-r.lastPlayStats.videoPacketsLost)>0?t/(e.packetsReceived-r.lastPlayStats.videoPacketsReceived+t):0,r.lastPlayStats.videoBytesReceived=e.bytesReceived,r.lastPlayStats.framesDecoded=e.framesDecoded,e.packetsLost>0&&(r.lastPlayStats.videoPacketsLost=e.packetsLost),r.lastPlayStats.videoPacketsReceived=e.packetsReceived,r.lastPlayStats.videoTime=e.timestamp,r.lastPlayStats.time=e.timestamp,m=e.jitter}else if("track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0)||e.frameWidth){if(d.frameHeight=e.frameHeight,d.frameWidth=e.frameWidth,0===h||r.lastPlayStats.frameHeight===e.frameHeight&&r.lastPlayStats.frameWidth===e.frameWidth)0===h&&(r.lastPlayStats.frameHeight=e.frameHeight,r.lastPlayStats.frameWidth=e.frameWidth);else{var s=n.getReportSeq();r.dataReport.newReport(s,i.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.event),r.dataReport.addMsgInfo(s,{session_id:i.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.session_id(r.sessionId),w:i.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.w(e.frameWidth),h:i.ZegoRTCLogEvent.kZegoTaskVideoPlaySize.h(e.frameHeight)}),!r.player.isProbe&&r.dataReport.uploadReport(s),r.lastPlayStats.frameHeight=e.frameHeight,r.lastPlayStats.frameWidth=e.frameWidth}0!=h&&(d.videoTransferFPS=1e3*(e.framesReceived-r.lastPlayStats.framesReceived)/(e.timestamp-h),d.videoFramesDropped=e.framesDropped-r.lastPlayStats.framesDropped),d.videoTransferFPS<0&&(d.videoTransferFPS=0),d.videoFramesDropped<0&&(d.videoFramesDropped=0),r.lastPlayStats.framesReceived=e.framesReceived,r.lastPlayStats.framesDropped=e.framesDropped}else"track"==e.type&&("audio"==e.kind||e.id.indexOf("audio")>=0)?(d.audioLevel=e.audioLevel,d.audioSendLevel=e.totalAudioEnergy,d.audioSamplingRate=e.totalSamplesDuration):"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(d.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(d.currentRoundTripTime=e.currentRoundTripTime,p=1e3*d.currentRoundTripTime))}),this.lastPlayStats.googCurrentDelayMs=Number(v)||Number(E)||0,g=isNaN(g)||g<0?0:g,m=isNaN(m)||m<0?0:m,f=isNaN(f)||f<0?0:f,_=isNaN(_)||_<0?0:_;var F=s.ClientUtil.getNetQuality(p,g,m),q=s.ClientUtil.getNetQuality(p,f,_);d.audioQuality=h>0?s.ClientUtil.quality2QualityGrade(F):0,d.videoQuality=h>0?s.ClientUtil.quality2QualityGrade(q):0;var V=Math.min(F,q);this.netQuality=V,d.peerToPeerDelay=isNaN(this.p2pNetStats.p2pRTT)?0:parseInt((this.p2pNetStats.p2pRTT/2+this.lastPlayStats.googCurrentDelayMs).toString()),d.peerToPeerPacketLostRate=this.p2pNetStats.p2pLostRate,h>0&&V<=n.QUALITY_CONSTANT.MiddleMinQuality&&C>this.probeTime+this.probeInterval&&(this.logger.info(o.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+V+" start net probe"),this.probeState=n.ENUM_PROBE_STATE.tryProbe,this.player.streamCenter.startNetProbe(!1,this.player,this.player.gwNodeList),this.probeTime=C),this.uploadPlayQuality(d,C);var j={video:{videoBitrate:d.videoBitrate,videoFPS:d.videoFPS,videoTransferFPS:d.videoTransferFPS,videoFramesDecoded:d.videoFramesDecoded,videoFramesDropped:d.videoFramesDropped,videoPacketsLost:d.videoPacketsLost,videoPacketsLostRate:d.videoPacketsLostRate,videoQuality:d.videoQuality,frameHeight:d.frameHeight,frameWidth:d.frameWidth,muteState:d.videoMuteState},audio:{audioBitrate:d.audioBitrate,audioCodec:d.audioCodec,audioJitter:d.audioJitter,audioLevel:d.audioLevel,audioPacketsLost:d.audioPacketsLost,audioPacketsLostRate:d.audioPacketsLostRate,audioQuality:d.audioQuality,audioSamplingRate:d.audioSamplingRate,audioSendLevel:d.audioSendLevel,muteState:d.audioMuteState,audioFPS:d.audioFPS},nackCount:d.nackCount,pliCount:d.pliCount,totalRoundTripTime:d.totalRoundTripTime,playData:d.playData,currentRoundTripTime:d.currentRoundTripTime,peerToPeerDelay:d.peerToPeerDelay,peerToPeerPacketLostRate:(d.peerToPeerPacketLostRate||0)/255,sampleTimeWindow:d.sampleTimeWindow};void 0!==d.muted&&(j.muted=d.muted,j.paused=d.paused,j.volume=d.volume,j.sinkId=d.sinkId),void 0!==d.videoCodecName&&(j.video.googCodecName=d.videoCodecName,j.audio.googCodecName=d.audioCodecName,j.codecImplementationName=d.codecImplementationName,j.googAvailableSendBandwidth=d.googAvailableSendBandwidth),0!=h&&this.player.onPlayQualityUpdate(this.streamId,j)}}},e.prototype.uploadPlayQuality=function(e,t){if(this.qualityUpload&&this.player.signal.isServerConnected()){var r=t;(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="play",e.stream_id=this.streamId,e.timeStamp=parseInt((r/1e3).toString()),e.video_break_duration=this.videoBreakReport.breakDuration,e.video_break_cancel_duration=this.videoBreakReport.breakCancelDuration,e.video_decode_time=this.videoBreakReport.decodeTime,this.videoBreakReport.breakCancelDuration=0,this.videoBreakReport.breakDuration=0,this.videoBreakReport.decodeTime=0,e.audio_break_duration=this.audioBreakReport.breakDuration,e.audio_break_cancel_duration=this.audioBreakReport.breakCancelDuration,e.audio_decode_time=this.audioBreakReport.decodeTime,this.audioBreakReport.breakCancelDuration=0,this.audioBreakReport.breakDuration=0,this.audioBreakReport.decodeTime=0,e.real_sampling_interval=r-this.lastSampleTime,this.lastSampleTime=r,this.logger.info(o.ZEGO_WEBRTC_ACTION.PLAYER_UPLOAD_PLAYER_QUALITY+" "+this.streamId+" upload"+JSON.stringify(e)),this.player.streamCenter.updateQuality(1,e),this.qualityUploadLastTime=r)}},e.prototype.getP2PNetStats=function(){var e=this;this.player.signal.getP2PNetStats(n.getSeq(),this.sessionId,this.peerID,function(t,r,n){var o=n.p2p_rtt;e.p2pNetStats.p2pLostRate=n.p2p_lost_rate||0,e.p2pNetStats.p2pRTT=o||0},function(e){})},e.prototype.setPlayQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info(o.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" startTimer"),this.clearPlayQualityTimer(),this.getP2PNetStats(),this.qualityTimer=setInterval(function(){e.sampleTimes++;var t=e.player.peerConnection;if(t){var r=[t.getStats(null)];"chrome"==e.player.stateCenter.browser&&r.push(new Promise(function(e,r){t.getStats(function(t){return e(t)},function(e){return r(e)})})),Promise.all(r).then(function(t){e.getPlayStats(t[0],t[1])}).catch(function(t){e.logger.error(o.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" "+e.streamId+" getStats error "+t.toString())})}},1e3),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0})},e.prototype.clearPlayQualityTimer=function(){if(null!=this.qualityTimer){clearInterval(this.qualityTimer),this.qualityTimer=null;var e=(new Date).getTime();this.lastSampleTime=0,this.sampleTimes=0,this.totalQuality={totalSquaredInterFrameDelay:0,totalInterFrameDelay:0,framesDecode:0,totalSamplesReceived:0,concealedSamples:0,audioBytesReceived:0};var t=function(t,r,n,o,i){if(void 0===i&&(i="video"),n=n>1e3?1e3:n,r.breakDuration=0,r.breakCancelDuration=0,r.decodeTime=0,t.decodeStartTime){var s=e,a=s-t.decodeStartTime;if(t.decodeStartTime=void 0,t.totalDuration+=a,t.breakStartTime){var u=s-t.breakStartTime;t.breakStartTime=void 0,o?u>n&&(t.cumulativeBreakDuration+=u):t.noBreakNoDecodeDuration+=u}var l=t.cumulativeBreakDuration,c=t.totalDuration-t.cumulativeBreakDuration-t.noBreakNoDecodeDuration;return t.cumulativeDecodeDuration=c,{cumulativeBreakDuration:l,cumulativeDecodeDuration:c}}return{cumulativeBreakDuration:0,cumulativeDecodeDuration:0}};t(this.videoBreak,this.videoBreakReport,this.videoBreakThreshold,0===this.player.cameraStatus&&this.player.playMediaStatus.video),t(this.audioBreak,this.audioBreakReport,this.audioBreakThreshold,0===this.player.micStatus&&this.player.playMediaStatus.audio,"audio")}this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,videoPacketsReceived:0,audioPacketsReceived:0,framesDecoded:0,framesDropped:0,framesReceived:0,audioBitrate:0}},e.prototype.startProbeTimeout=function(){var e=this;this.probeTimer=setTimeout(function(){e.logger.error(o.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" probe timeout"),e.player.playStateUpdateError(i.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kProbeTimeOutError)},this.probeTimeoutInterval)},e.prototype.stopProbeTimeout=function(){this.probeTimer&&(clearTimeout(this.probeTimer),this.probeTimer=null)},e}();t.PlayStreamQuality=a},3849:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPlayWeb=void 0;var o=r(6706),i=r(4767),s=r(608),a=r(3529),u=r(1089),l=r(5634),c=function(){function e(e,t,r,n,i,s,a){this.state=o.ENUM_PLAY_STATE.stop,this.candidateInfo=[],this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop,this.playQualityList=[],this.maxQualityListCount=10,this.reportSeq=NaN,this.streamReportSeq=o.getSeq(),this.videoSizeCallback=!1,this.remoteStream=null,this.playStream=null,this.playOption={},this.playMediaStatus={video:!0,audio:!0},this.closeSessionSignal=!1,this.stateNego=o.ENUM_PLAY_STATE_NEGO.stop,this.negoTimer=null,this.negoInterval=25e3,this.cameraStatus=0,this.micStatus=0,this.hasSentStreamStatus=!1,this.playEvent=!1,this.gotStreamStatus=!1,this.soundLevel=0,this.mic=null,this.script=null,this.beginTime=0,this.firstFrameTime=0,this.resourceMode=0,this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.isPeer=!1,this.peerFailCount=0,this.isProbe=!1,this.peerID=0,this.isRecvClientInfo=!1,this.audioMuteState="0",this.videoMuteState="0",this.first_pkt=!0,this.next_sn=[],this.pkt_list=[],this.onDataChannelList=[],this.iceDisconnectedMaxTime=15e3,this.logger=e,this.signal=t,this.dataReport=r,this.streamCenter=i,this.ac=s,this.stateCenter=a,this.dataReport.newReport(this.streamReportSeq),this.dataReport.addMsgInfo(this.streamReportSeq,{abs_time:Date.now()}),this.qualityHandler=new l.PlayStreamQuality(n,this,this.logger,this.dataReport),this.resourceMode=this.stateCenter.settingConfig.getSetting("resource_mode")}return Object.defineProperty(e.prototype,"probeState",{get:function(){return this.qualityHandler.probeState},set:function(e){this.qualityHandler.probeState=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"netQuality",{get:function(){return this.qualityHandler.netQuality},set:function(e){this.qualityHandler.netQuality=e},enumerable:!1,configurable:!0}),e.prototype.startPlay=function(e,t,r){var n=this;if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" called ",e),this.playEvent=!1,this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e){this.streamId=e,this.getRemoteStreamSuc=t,this.playOption=r||{},this.playMediaStatus={video:void 0===this.playOption.video||!!this.playOption.video,audio:void 0===this.playOption.audio||!!this.playOption.audio},r&&r.videoCodec&&(this.playOption.videoCodec=r.videoCodec);var o=this.stateCenter.settingConfig.getSetting("play_video_codec",!0);o&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" setting play_video_codec "+o),this.playOption.videoCodec=o),this.dataReport.addMsgInfo(this.reportSeq,{audio_activate:a.ZegoRTCLogEvent.kZegoTaskPlayStart.audio_activate(1==this.playOption.audio?1:0==this.playOption.audio?0:1),video_activate:a.ZegoRTCLogEvent.kZegoTaskPlayStart.video_activate(1==this.playOption.video?1:0==this.playOption.video?0:1)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout(function(){n.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" waiting timeout"),n.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNegoTimeoutError)},this.negoInterval),this.isProbe&&this.qualityHandler.startProbeTimeout()}else this.logger.warn(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" streamId is null")},e.prototype.onCreatePlaySessionSuccess=function(e){var t=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" success");var r=[];if(e.turn_server){var n=e.turn_server,o=this.stateCenter.turnOverTcpOnly,i=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);i&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" setting udp_or_tcp "+i),o="tcp"===i),o&&(n=n.replace("udp","tcp")),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" turn over tcp "+n),r.push(n)}e.stun_server&&r.push(e.stun_server);var s={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" username: "+e.turn_username),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" credential: "+e.turn_auth_key),this.createOffer(s),this.signal.registerPushCallback("MediaDescPush",this.sessionId,function(e,r,n){t.onRecvMediaDesc(e,r,n)}),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,function(e,r,n){t.onRecvCandidateInfo(e,r,n)}),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(e,r,n){t.onRecvCloseSession(e,r,n)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(e,r,n){t.onRecvResetSession(e,r,n)}),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,function(e,r,n){t.gotStreamStatus=!0,t.streamStatus=n,t.playStream&&t.onRecvStreamStatus(n)}),this.signal.registerPushCallback("PlayEventPush",this.sessionId,function(e,r,n){t.onRecvPlayEvent(e,r,n)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(e,r,n){t.onRecvClientInfo(e,r,n)}),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" call success")},e.prototype.createOffer=function(e){var t=this;this.peerConnection=new RTCPeerConnection(e),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)},this.peerConnection.ontrack=function(e){t.onGotRemoteStream(e.streams[0])},this.streamCenter.isDataChannelEnabled&&(this.dataChannel=this.peerConnection.createDataChannel(this.streamId),this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=function(e){t.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+t.streamId+" data channel open")},this.dataChannel.onmessage=function(e){if(t.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+t.streamId+" data channel onmessage"),e.data instanceof Blob){var r=new FileReader,n={};r.readAsArrayBuffer(e.data),r.onload=function(){n.data=r.result,t.onReceivedDataChannel(n)}}else t.onReceivedDataChannel(e)});var r={offerToReceiveAudio:1,offerToReceiveVideo:1};this.playOption&&!1===this.playOption.video&&(r.offerToReceiveVideo=0),this.playOption&&!1===this.playOption.audio&&(r.offerToReceiveAudio=0),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(r)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(r).then(function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.dataReport.eventEnd(t.streamReportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)},function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateOffer",{error:e.toString()}),t.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS+" "+t.streamId+" create offer error "+e.toString()),t.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCreateOfferError,!0)})},e.prototype.createSession=function(e){var t=this;this.sessionSeq=o.getSeq();var r=this.streamId;1==this.streamCenter.testEnvironment&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId);var n=this.stateCenter.settingConfig.getSetting("gw_nodes");if(n&&n instanceof Array&&n.length>0&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" setting "+JSON.stringify(n)),this.gwNodeList=n,this.gwNode=this.gwNodeList[0]||this.gwNode),this.isPeer){this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp");var i=this.stateCenter.settingConfig.getSetting("l3_play_buffer_ms");this.signal.createSessionWithSdp({seq:this.sessionSeq,type:this.isProbe?2:1,mode:0,streamId:r,strAuthParam:this.playOption&&this.playOption.streamParams||"",sdp:e.sdp,serverHost:this.gwNode,playBufLevel:2==this.resourceMode?i:void 0},function(e,r,n){t.handleCreateSessionWithSdpResp(e,r,n)},function(r,n){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:r}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:r}),!t.isProbe&&r==o.SEND_MSG_TIMEOUT&&t.peerFailCount<2?(t.peerFailCount++,t.createSession(e)):!t.isProbe&&r==o.SEND_MSG_TIMEOUT&&t.peerFailCount>=2?(t.isPeer=!1,t.streamCenter.isPeer=!1,t.createSession()):t.playStateUpdateError(r==o.SEND_MSG_TIMEOUT?a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)})}else this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,1,0,r,this.playOption&&this.playOption.streamParams,this.gwNode,function(e,r,n){t.handleCreateSessionResp(e,r,n)},function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:e}),t.playStateUpdateError(e==o.SEND_MSG_TIMEOUT?a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionTimeoutError:a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)});this.state=o.ENUM_PLAY_STATE.waitingSessionRsp,this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" called success"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.start},e.prototype.handleCreateSessionResp=function(e,t,r){var n=r.turn_server,o=n.split("?")[0]&&n.split("?")[0].slice(5),i=this.streamCenter.server.split("?"),s=i[1]&&i[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+o+"/"+s+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+o+"/"+s+"/"+this.streamId}),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,0!==r.result?(this.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" "+this.streamId+" create error"),this.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.dataReport.addMsgInfo(this.reportSeq,{session_id:a.ZegoRTCLogEvent.kZegoTaskPlayStart.session_id(this.sessionId)}),this.onCreatePlaySessionSuccess(r))):this.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_START_PLAY+" seq is not match.")},e.prototype.handleCreateSessionWithSdpResp=function(e,t,r){var n=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" sessionId:"+t),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t}),0!==r.result?(this.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session failed "+r.result),this.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSessionRequestError)):(this.sessionId=t,this.sessionToken=r.session_token,this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" create session success ",this.streamId),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(e,t,r){n.onRecvCloseSession(e,t,r)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(e,t,r){n.onRecvResetSession(e,t,r)}),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,function(e,t,r){n.gotStreamStatus=!0,n.streamStatus=r,n.playStream&&n.onRecvStreamStatus(r)}),this.signal.registerPushCallback("PlayEventPush",this.sessionId,function(e,t,r){n.onRecvPlayEvent(e,t,r)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(e,t,r){n.onRecvClientInfo(e,t,r)}),this.signal.registerPushCallback("NetQualityProbeRsp",this.sessionId,function(e,t,r){n.onRecvPlayEvent(e,t,r)}),this.signal.registerPushCallback("NetQualityInfoPush",this.sessionId,function(e,t,r){n.onRecvNetQualityInfo(e,t,r)}),this.onGetRemoteOfferSuccess(r.sdp))):this.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP+" seq is not match.")},e.prototype.onCreateOfferSuccess=function(e){var t=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),e.sdp=e.sdp.replace(/sendrecv/g,"recvonly"),e.sdp=e.sdp.replace(/useinbandfec=/,"stereo=1;useinbandfec=");var r=e.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)?e.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)[0]:null;if(r){var n=r.replace(/recvonly/,"sendrecv");e.sdp=e.sdp.replace(r,n)}var o=e.sdp.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(102).*)/);if(null!==o){var s=o[3];e.sdp=e.sdp.replace(s,s+";sps-pps-idr-in-keyframe=1")}this.playOption.videoCodec&&(e.sdp=i.SdpUtil.getSDPByVideDecodeType(e.sdp,this.playOption.videoCodec)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(e).then(function(){t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription"),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription"),t.onSetLocalDescriptionSuccess(e)},function(e){t.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CREATE_OFFER_SUCCESS+" "+t.streamId+" set error "+e.toString()),t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription",{error:e.toString()}),t.dataReport.eventEnd(t.streamReportSeq,"SetLocalDescription",{error:e.toString()}),t.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetLocalDescError,!0)})},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),this.isPeer)this.createSession(e);else{var r={sdp:e.sdp};2==this.resourceMode&&(r.min_play_buf_level_ms=500),this.answerSeq=o.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.answerSeq,this.sessionId,0,r,function(e,r,n){t.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" sendMediaDesc resp"),t.answerSeq==e&&t.sessionId==r?(t.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" send success stateNego:waiterAnswer"),t.stateNego=o.ENUM_PLAY_STATE_NEGO.waiterAnswer,t.dataReport.eventEnd(t.reportSeq,"SendMediaDesc"),t.dataReport.eventEnd(t.streamReportSeq,"SendMediaDesc"),t.state=o.ENUM_PLAY_STATE.waitingServerAnswer):t.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" seq or sessionId is not equal "+t.answerSeq+" "+e,0+t.sessionId+" "+r)},function(e,r){t.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+t.streamId+" failed to send "+e),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendMediaDesc",{error:e}),t.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaDescError)}),this.state=o.ENUM_PLAY_STATE.waitingOfferRsp}},e.prototype.onRecvMediaDesc=function(e,t,r){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received ",r),this.stateNego=o.ENUM_PLAY_STATE_NEGO.waitingCandidate,this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.state===o.ENUM_PLAY_STATE.waitingServerAnswer?(this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),this.onGetRemoteOfferSuccess(r.sdp)):this.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSuccess=function(e){var t,r=this,n={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription");var i=this.stateCenter.turnOverTcpOnly,s=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);s&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" setting udp_or_tcp "+s),i="tcp"===s),i&&(null===(t=n.sdp.match(/candidate.*/g))||void 0===t||t.forEach(function(e){var t=e.replace(/udp/,"tcp");n.sdp=n.sdp.replace(e,t)})),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" remoteSdp ",n.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(n)).then(function(){r.dataReport.eventEnd(r.reportSeq,"SetRemoteDescription"),r.dataReport.eventEnd(r.streamReportSeq,"SetRemoteDescription"),r.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set success")},function(e){r.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+r.streamId+" set remote error "+e.toString()),r.dataReport.eventEndWithMsg(r.reportSeq,"SetRemoteDescription",{error:e.toString()}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),r.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kSetRemoteDescError,!0)}),this.state=o.ENUM_PLAY_STATE.waitingServerICE,this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_MEDIA_DESC+" "+this.streamId+" call success")},e.prototype.onRecvCandidateInfo=function(e,t,r){var n=this;if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "),this.state==o.ENUM_PLAY_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var i=0;i<r.infos.length;i++){var s={sdpMid:r.infos[i].sdpMid,sdpMLineIndex:r.infos[i].sdpMLineIndex,candidate:r.infos[i].candidate};this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" candidate "+s.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(s)).then(function(){n.logger.debug(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+n.streamId+" add success")},function(e){n.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+n.streamId+" add error "+e.toString()),n.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError,!0)})}this.state=o.ENUM_PLAY_STATE.connecting,this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" call success")}else this.logger.warn(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvPlayEvent=function(e,t,r){if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" received"),!0===this.playEvent&&0==r.event){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_PLAY_EVENT+" "+this.streamId+" retry: "+this.streamId);var n=this.streamId,i=this.playOption;this.signal.sendCloseSession(o.getSeq(),this.sessionId,1),this.resetPlay(),this.startPlay(n,this.getRemoteStreamSuc,i)}else this.playEvent=!0},e.prototype.onRecvClientInfo=function(e,t,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id,this.isProbe&&this.stateNego==o.ENUM_PLAY_STATE_NEGO.iceConnected&&this.signal.sendNetProbe(o.getSeq(),this.sessionId,this.peerID,function(){},function(){}),this.isRecvClientInfo=!0},e.prototype.onRecvNetQualityInfo=function(e,t,r){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" call"),this.qualityHandler.stopProbeTimeout();var n=0,i=r.lossrate,a=r.rtt;this.peerID===r.peer_id&&null!=typeof i&&null!=typeof a||(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_NET_QUALITY_INFO+" local peerID:"+this.peerID+" remote peerID:"+r.peer_id+" lossrate:"+i+" rtt:"+a),n=1),this.signal.sendNetQualityInfoPushAck(o.getSeq(),this.sessionId,this.peerID,n),0==n&&"number"==typeof i&&"number"==typeof a?this.onCalNetQualityResult(0,s.ClientUtil.getNetQuality(a,i)):this.onCalNetQualityResult(1)},e.prototype.onIceCandidate=function(e){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" called"),null!=e.candidate&&(this.logger.debug(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate "+e.candidate.candidate),this.state<o.ENUM_PLAY_STATE.connecting||this.state==o.ENUM_PLAY_STATE.stop?(this.logger.debug(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" cached"),this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex})):(this.logger.debug(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CANDIDATE+" "+this.streamId+" send"),this.sendCandidateInfo([{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}])))},e.prototype.onConnectionStateChange=function(e){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+e.target.signalingState)},e.prototype.onIceConnectionStateChange=function(e){var t=this;if(this.state!=o.ENUM_PLAY_STATE.stop&&null!=this.peerConnection)if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState){if(this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceConnected,this.isProbe&&this.isPeer&&this.isRecvClientInfo)return this.signal.sendNetProbe(o.getSeq(),this.sessionId,this.peerID,function(){},function(){}),void(null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null));for(var r in null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.dataReport.addEvent(this.reportSeq,"IceConnected"),this.dataReport.addEvent(this.streamReportSeq,"IceConnected"),this.state!=o.ENUM_PLAY_STATE.playing&&(this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.getRemoteStreamSuc&&this.getRemoteStreamSuc(this.playStream)),this.state=o.ENUM_PLAY_STATE.playing,this.dataReport.eventStart(this.reportSeq,"PlayState"),this.dataReport.eventStart(this.streamReportSeq,"PlayState"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[r].publisher.state==o.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.stop){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,1),this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.start;break}if(!this.isProbe&&this.qualityHandler.setPlayQualityTimer(),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.isPeer&&(this.peerFailCount=0),0==this.firstFrameTime){this.firstFrameTime=(new Date).getTime()-this.beginTime;var n=o.getReportSeq();this.dataReport.newReport(n,a.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.event),this.dataReport.addMsgInfo(n,{session_id:a.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.session_id(this.sessionId),fft_consumed:a.ZegoRTCLogEvent.kZegoTaskPlayDecodeFirstVideoFrame.fft_consumed(this.firstFrameTime)}),!this.isProbe&&this.dataReport.uploadReport(n)}}else"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceClosed,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceFailed,this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.stateNego=o.ENUM_PLAY_STATE_NEGO.iceDisconnected,this.logger.warn(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+" ice disconnected"),this.iceDisconnectedTimer||(this.iceDisconnectedTimer=setTimeout(function(){t.checkPlayConnectionFailedState("disconnected")},this.iceDisconnectedMaxTime)))},e.prototype.checkPlayConnectionFailedState=function(e){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE+"  state "+this.state+" connectionState "+e),this.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kMediaConnectionError)},e.prototype.resetPlay=function(){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_RESET_PLAY+" "+this.streamId+" call"),this.state=o.ENUM_PLAY_STATE.stop,this.playEvent=!1,this.isRecvClientInfo=!1,null!=this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.qualityHandler.stopProbeTimeout(),this.qualityHandler.clearPlayQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId),this.signal.unregisterPushCallback("NetQualityProbeRsp",this.sessionId),this.signal.unregisterPushCallback("NetQualityInfoPush",this.sessionId)),this.sessionSeq=0,this.answerSeq=0,this.videoSizeCallback=!1,this.stopSoundLevel()},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var n=JSON.parse(JSON.stringify(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));this.negoTimer&&clearTimeout(this.negoTimer),this.playStateUpdateError(n)}else this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_CLOSE_SESSION+" "+this.streamId+" "+JSON.stringify(r)),this.signal.sendCloseSessionAck(e,this.sessionId,0);var n=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},o=n.action?n.action:null,i=1*r.reason,s=JSON.parse(JSON.stringify(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlaySessionClosedError));s.message+=" reason:"+i+" "+(o?" action:"+o:""),this.negoTimer&&clearTimeout(this.negoTimer);var l=![4,8,10,11,12,14,24,26,27,28].includes(i)&&![2,5,6].includes(o);this.playStateUpdateError(s,l)},e.prototype.onRecvStreamStatus=function(e){if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call"),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" status camera_status: "+e.camera_status+" mic_status: "+e.mic_status),(!this.hasSentStreamStatus||this.cameraStatus!==e.camera_status)&&this.onRemoteCameraStatusUpdate(this.streamId,this.getCameraMicStatus(e.camera_status),e.camera_status),(!this.hasSentStreamStatus||this.micStatus!==e.mic_status)&&this.onRemoteMicStatusUpdate(this.streamId,this.getCameraMicStatus(e.mic_status),e.mic_status),this.hasSentStreamStatus=!0,this.cameraStatus=e.camera_status,this.micStatus=e.mic_status,this.videoMuteState=0===e.camera_status?"0":"1",this.audioMuteState=0===e.mic_status?"0":"1","boolean"==typeof this.playOption.video)this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" has set video option, ignore stream status");else{var t=this.playStream;if(0!==e.camera_status&&20!==e.camera_status?t.getVideoTracks().forEach(function(e){e.enabled=!1,e.stop(),t.removeTrack(e)}):0===t.getVideoTracks().length&&t.addTrack(this.remoteStream.clone().getVideoTracks()[0]),"safari"===this.stateCenter.browser)for(var r=document.querySelectorAll("video, audio"),n=0;n<r.length;n++)r[n].srcObject===this.playStream&&(r[n].srcObject=this.playStream)}this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_RECV_STREAM_STATUS+" "+this.streamId+" call success")},e.prototype.onGotRemoteStream=function(e){var t=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" called "+e),e?(this.playStream?(this.playStream.getTracks().forEach(function(e){return t.playStream.removeTrack(e)}),e.clone().getTracks().forEach(function(e){return t.playStream.addTrack(e)})):this.playStream=e.clone(),this.audioMuteState=this.playStream.getAudioTracks().length>0?"0":"1",this.videoMuteState=this.playStream.getVideoTracks().length>0?"0":"1",this.remoteStream=e,this.gotStreamStatus&&this.onRecvStreamStatus(this.streamStatus),this.dataReport.addEvent(this.reportSeq,"GetRemoteStream"),this.streamCenter.soundLevelDelegate&&!this.isProbe&&this.startSoundLevel()):this.logger.warn(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_GOT_REMOTE_STREAM+" "+this.streamId+" remote stream is empty")},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(e=e.filter(function(e){return!(e.candidate.indexOf("tcp")>0)&&(!!e.candidate||void 0)}))||e.length<1?this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==o.ENUM_PLAY_STATE_NEGO.iceConnected&&(this.stateNego=o.ENUM_PLAY_STATE_NEGO.sendCandidate),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(o.getSeq(),this.sessionId,e,function(e,r,n){t.logger.debug(u.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")},function(e,r){t.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.playStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kCandidateError)}))},e.prototype.shouldSendCloseSession=function(){return this.state!=o.ENUM_PLAY_STATE_UPDATE.stop&&this.state!=o.ENUM_PLAY_STATE.waitingSessionRsp},e.prototype.playStateUpdateError=function(e,t){this.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" call ",this.streamId,JSON.stringify(e)),this.isProbe?this.onCalNetQualityResult(1):this.streamId&&this.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,this.streamId,e,t),this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_STATE_ERROR+" "+this.streamId+" ended")},e.prototype.getCameraMicStatus=function(e){return 0==e?"OPEN":"MUTE"},e.prototype.onPlayStateUpdate=function(e,t,r,n){},e.prototype.onPlayQualityUpdate=function(e,t){},e.prototype.onRemoteCameraStatusUpdate=function(e,t,r){},e.prototype.onRemoteMicStatusUpdate=function(e,t,r){},e.prototype.stopPlay=function(){var e;for(var t in this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_STOP_PLAY+" "+this.streamId+" called"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[t].publisher.state==o.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.start){this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),this.sessionId,0),this.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop;break}this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(o.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PlayState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPlay"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.resetPlay();var r=this.qualityHandler,i=r.videoBreak,s=r.audioBreak,a=2===this.resourceMode?"l3":"rtc",l=((e={})[a+"_a_break_time"]=s.cumulativeBreakDuration,e[a+"_a_decode_time"]=s.cumulativeDecodeDuration,e[a+"_v_break_time"]=i.cumulativeBreakDuration,e[a+"_v_decode_time"]=i.cumulativeDecodeDuration,e);this.dataReport.addMsgInfo(this.streamReportSeq,n({itemtype:"RTCPlayStream",cdn_a_break_time:0,cdn_a_decode_time:0,cdn_v_break_time:0,cdn_v_decode_time:0,l3_a_break_time:0,l3_a_decode_time:0,l3_v_break_time:0,l3_v_decode_time:0,rtc_a_break_time:0,rtc_a_decode_time:0,rtc_v_break_time:0,rtc_v_decode_time:0},l)),!this.isProbe&&this.dataReport.uploadReport(this.streamReportSeq,"RTCPlayStream")},e.prototype.onDisconnect=function(e){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_ON_DISCONNECT+" "+this.streamId+" call"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.playStateUpdateError(e||a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError,!!e)},e.prototype.startSoundLevel=function(){var e=this;if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" call streamID: "+this.streamId),!this.isProbe)if(this.remoteStream&&0!=this.remoteStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.remoteStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),n=0,o=0;o<r.length;o++)n<r[o]&&(n=r[o]);e.soundLevel=100*n},this.ac.resume()}catch(e){this.logger.error(u.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" get sound level failed "+e)}}else this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_START_SOUND_LEVEL+" "+this.streamId+" remote stream no found")},e.prototype.stopSoundLevel=function(){this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.onCalNetQualityResult=function(e,t){},e.prototype.onReceivedDataChannel=function(e){var t,r,n=this,o=new Uint8Array(e.data,0,10),i=e.data.byteLength-10,s=new Uint8Array(e.data,10,i);if(1==o[0]){var a=o[1],u=o[2]<<8|o[3],l=o[4]<<8|o[5],c=(new Date).getTime();if(this.first_pkt&&(this.next_sn[0]=u==l?u:l,this.first_pkt=!1),this.pkt_list.push({sn:u,sn0:l,recv_ts:c,flags:a,payload_len:i,payloadArray:s}),this.pkt_list.sort(this.compareShort),u==this.next_sn[0]){var d=this.pkt_list.filter(function(e){return e.sn0==l});if(d.sort(this.compareShort),null!=d.find(function(e){return 1&e.flags})&&d.length==this.compareShort(u,l)+1){for(var h=0,p=new ArrayBuffer(65536),f=0;f<d.length;f++)new Uint8Array(p).set(d[f].payloadArray,h),h+=d[f].payload_len;null===(t=this.onDataChannelList)||void 0===t||t.forEach(function(e){e(p,h,n.streamId)}),this.pkt_list=[],this.first_pkt=!0}this.next_sn[0]++}else for(var g=function(){var e=_.pkt_list.filter(function(e){return e.sn0==n.pkt_list[0].sn0});if(e.sort(_.compareShort),null!=e.find(function(e){return 1&e.flags})&&e.length==_.compareShort(e[e.length-1].sn,e[0].sn0)+1){for(var t=0,o=new ArrayBuffer(65536),i=0;i<e.length;i++)new Uint8Array(o).set(e[i].payloadArray,t),t+=e[i].payload_len;_.next_sn[0]=e[0].sn0+e.length,null===(r=_.onDataChannelList)||void 0===r||r.forEach(function(e){e(o,t,n.streamId)}),_.pkt_list=[],_.first_pkt=!0}else if(c-e[0].ts<4e3){var s=e[0].sn0;for(i=0;i<e.length&&s==e[i].sn;i++)s++;return _.next_sn[0]=s,"break"}for(i=0;i<e.length;i++)_.pkt_list.shift()},_=this;this.pkt_list.length>0&&"break"!==g(););}},e.prototype.compareShort=function(e,t){var r=new Uint16Array(1);r[0]=e-t;var n=new Int16Array(1);return n[0]=r[0],n[0]},e}();t.ZegoPlayWeb=c},361:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PublishModule=void 0;var o=r(1089),i=r(6706),s=r(3529),a=r(608),u=r(2752),l=r(3770),c=r(5321),d=function(){function e(e,t,r,n,o){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=n,this.rtm=o,this.recordDevices()}return e.prototype.createStream=function(e){var t=this;return this.logger.info(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" call"),e&&e.camera&&e.camera.audioBitRate&&(e.camera.audioBitrate=e.camera.audioBitRate),e&&e.camera&&e.camera.bitrate&&(e.camera.bitRate=e.camera.bitrate),e&&e.screen&&"object"==typeof e.screen&&e.screen.bitrate&&(e.screen.bitRate=e.screen.bitrate),e&&e.custom&&e.custom.bitrate&&(e.custom.bitRate=e.custom.bitrate),new Promise(function(r,u){var l="camera",d=i.getReportSeq();t.dataReport.newReport(d,s.ZegoRTCLogEvent.kZegoTaskCreateStream.event);var h=function(e){var n=t.streamCenter.checkPreview(e),o=e;if(n&&navigator.userAgent){var i=navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?) like mac os/);i&&i[1]&&i[1].includes("15_1")&&(o=t.getStreamThroughCanvas(e),n.localStream=o)}if(0==o.getAudioTracks().length){var s=t.streamCenter.ac.createMediaStreamDestination(),a=s?s.stream:null,u=a?a.getAudioTracks()[0]:null;u&&(u.enabled=!1,o.addTrack(u),n&&(n.hasEmptyAudioTrack=!0))}t.dataReport.uploadReport(d),!t.stateCenter.deviceInfos&&t.recordDevices(),r(o),t.streamCenter.activeSoundLevel()},p=function(e,r){void 0===r&&(r=""),t.dataReport.addMsgInfo(d,{error:e.code,message:e.message+r}),t.dataReport.uploadReport(d),u({code:e.code,msg:e.message+r})};if("https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" https or localhost required "),void p({code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError.message+" https or localhost required"});if(e&&e.screen){if(l="screen",!a.ClientUtil.checkScreenParams(e.screen,p))return;var f=t.stateCenter.browser,g=t.streamCenter.getScreenConstrains(e.screen);t.dataReport.addMsgInfo(d,{stream_type:s.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("screen"),screen:s.ZegoRTCLogEvent.kZegoTaskCreateStream.screen(g)});var _=function(e){t.streamCenter.createScreenPreviewer(e,g)&&h(e),e.getVideoTracks()[0].onended=function(){var r=i.getReportSeq();t.dataReport.newReport(r),t.dataReport.uploadReport(r,s.ZegoRTCLogEvent.kZegoTaskScreenSharingEnded),e&&t.stopPreview(e),t.stateCenter.actionListener("screenSharingEnded",e)}};"firefox"==f||"object"==typeof e.screen&&"firefox"==e.screen.type?t.startScreenShotFirFox("screen",g,function(e,t,r){e?t&&_(t):r&&p(r)}):"chrome"==f&&c.ZegoWebRTC.screenShotReady||"object"==typeof e.screen&&"shot"==e.screen.type?t.startScreenShotChrome(function(r,n,i){r?(t.logger.info(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" using extension"),n&&_(n)):(i&&t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" extension "+i),"SS_DIALOG_CANCEL"===i||"object"==typeof e.screen&&"shot"==e.screen.type?i&&p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):t.startScreenSharing(g,function(e,r,n){e?r&&_(r):(t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" "+n),n&&p(n))}))}):"Electron"==f||"object"==typeof e.screen&&"Electron"==e.screen.type?t.startScreenShotElectron(g,function(e,t,r){e?t&&_(t):r&&p(r)}):t.startScreenSharing(g,function(e,t,r){e?t&&_(t):r&&p(r)})}else{if(e&&"object"==typeof e.camera&&void 0!==e.camera.videoQuality&&!a.ClientUtil.checkInteger(e.camera.videoQuality))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" videoQuality must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number");if(e&&e.camera&&e.camera.audioBitrate){if(!a.ClientUtil.checkInteger(e.camera.audioBitrate))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.camera.audioBitrate<6)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot less 6 kbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.camera.audioBitrate>510)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" audioBitrate cannot greater than 510 kbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps");t.stateCenter.audioBitRate=1e3*e.camera.audioBitrate}if(e&&e.camera&&e.camera.bitRate){if("number"!=typeof e.camera.bitRate)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.camera.bitRate>10240)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.camera&&void 0!==e.camera.channelCount&&!a.ClientUtil.checkInteger(e.camera.channelCount))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" channelCount must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must be integer number");if(e&&e.camera&&4===e.camera.videoQuality&&!a.ClientUtil.checkCameraParams(e.camera,p))return;if(e&&e.custom&&e.custom.bitRate){if(!a.ClientUtil.checkInteger(e.custom.bitRate))return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number");if(e.custom.bitRate>10240)return t.logger.error(o.ZEGO_WEBRTC_ACTION.CREATE_STREAM+" bitrate cannot greater than 10 Mbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps")}if(e&&e.custom&&e.custom.audioBitrate){if(!a.ClientUtil.checkInteger(e.custom.audioBitrate))return t.logger.error("ze.cs.0 audioBitrate must be integer number"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate must be integer number");if(e.custom.audioBitrate<6)return t.logger.error("ze.cs.0 audioBitrate cannot less 6 kbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot less 6 kbps");if(e.custom.audioBitrate>510)return t.logger.error("ze.cs.0 audioBitrate cannot greater than 510 kbps"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," audioBitrate cannot greater than 510 kbps")}if(e&&e.custom&&void 0!==e.custom.channelCount&&1!==e.custom.channelCount&&2!==e.custom.channelCount)return t.logger.error("ze.cs.0 channelCount must number 1 or 2"),void p(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," channelCount must number 1 or 2");var m={};if(e&&e.camera)l="camera",m=e.camera,t.dataReport.addMsgInfo(d,{stream_type:s.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("camera"),camera:s.ZegoRTCLogEvent.kZegoTaskCreateStream.camera(e.camera)}),"boolean"!=typeof m.video&&(m.video=!0),"boolean"!=typeof m.audio&&(m.audio=!0);else if(e&&e.custom){l="custom",m=e.custom;var v=e.custom.source instanceof MediaStream?"MediaStream":"HTMLElement";t.dataReport.addMsgInfo(d,{stream_type:s.ZegoRTCLogEvent.kZegoTaskCreateStream.stream_type("custom"),custom:s.ZegoRTCLogEvent.kZegoTaskCreateStream.custom(n(n({},e.custom),{source:v}))})}t.startPreview(m,l,h,p)}})},e.prototype.destroyStream=function(e){this.logger.info(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" call");var t=i.getReportSeq();if(this.dataReport.newReport(t),!(e instanceof MediaStream))return this.logger.error(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" localStream is not mediaStream or tracks is null"),this.dataReport.addMsgInfo(t,s.ZegoRTCLogEvent.kZegoTaskDestroyStream.error.kLocalStreamError),void this.dataReport.uploadReport(t,s.ZegoRTCLogEvent.kZegoTaskDestroyStream.event);e instanceof MediaStream&&0==e.getTracks().length&&this.logger.info(o.ZEGO_WEBRTC_ACTION.DESTROY_STREAM+" tracks is null"),this.stopPreview(e),this.dataReport.uploadReport(t,s.ZegoRTCLogEvent.kZegoTaskDestroyStream.event)},e.prototype.startPublishingStream=function(e,t,r,n){this.logger.info(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" call ",e);var u,l=!0,c="",d=i.getReportSeq();this.stateCenter.reportSeqList.startPublish[e]=d,this.dataReport.newReport(d,s.ZegoRTCLogEvent.kZegoTaskPublishStart.event),l&&void 0===e&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+(c="stream id required")),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),!l||e&&"string"==typeof e||(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="stream id type wrong")),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&e.length>i.MAX_STREAM_ID_LENGTH&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="stream id length limit")),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&!a.ClientUtil.checkIllegalCharacters(e)&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="stream ID contains illegal characters")),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError),l&&(!t||t instanceof MediaStream&&0==t.getTracks().length)&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="localStream wrong")),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError);var h=this.streamCenter.checkPreview(t);if(l&&!h&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+(c="stream is not from zego")),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoPreviewError),(null==h?void 0:h.isVideoEffectStarting)&&(c=(u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishEffectIsStarting).message,this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+c),l=!1),l&&void 0!==r&&"object"!=typeof r&&(l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c="publishOption must be object"),l&&void 0!==r&&void 0!==r.streamParams&&"string"!=typeof r.streamParams&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption streamParams must be string"),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c=" publishOption streamParams must be string"),l&&void 0!==r&&void 0!==r.extraInfo&&"string"!=typeof r.extraInfo&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption extraInfo must be string"),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c=" publishOption extraInfo must be string"),l&&void 0!==r&&void 0!==r.videoCodec&&"string"!=typeof r.videoCodec&&(this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" publishOption videoCodec must be string"),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c=" publishOption videoCodec must be string"),!l||!this.stateCenter.isMultiRoom||r&&"string"==typeof r.roomID&&""!=r.roomID||(l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishParamError,c=" roomID is need if set multi room"),r&&r.videoCodec&&(r.videoCodec=r.videoCodec.toUpperCase()),l&&this.rtm.service.isDisConnect()&&(this.logger.error("zc.p.sps.1 not login"),l=!1,u=s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNoLoginError),!l)throw this.logger.error(o.ZEGO_WEBRTC_ACTION.START_PUBLISHING_STREAM+" "+c),this.dataReport.uploadReport(d,void 0,u,c),delete this.stateCenter.reportSeqList.startPublish[e],{errorCode:null==u?void 0:u.code,extendedData:c};r||(r={}),this.dataReport.addMsgInfo(d,{stream:s.ZegoRTCLogEvent.kZegoTaskPublishStart.stream(e),publishOption:s.ZegoRTCLogEvent.kZegoTaskPublishStart.publishOption(r)}),r.audioBitRate=this.stateCenter.audioBitRate;var p,f=r.roomID?r.roomID:this.stateCenter.roomList[0]?this.stateCenter.roomList[0].roomID:"",g=this.stateCenter.getRoomByRoomID(f);if(!g)return this.logger.error("zc.p.sps.1 room no found"),!1;if(this.dataReport.addMsgInfo(d,{publish_room_id:f,isMulti:this.stateCenter.isMultiRoom}),this.stateCenter.customUrl&&0!=this.stateCenter.customUrl.length)this.logger.info("zc.p.sps.1 customUrl "+JSON.stringify(this.stateCenter.customUrl)),p=this.stateCenter.customUrl;else{var _=this.stateCenter.settingConfig.getSetting("signal_nodes",!0);_&&_ instanceof Array&&_.length>0&&(p=_,this.logger.info("zc.p.sps.1 setting config signal_nodes "+JSON.stringify(_)))}if(p)return this.stateCenter.publishStreamList[e]={state:i.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.streamCenter.setPublishStateStart(g,e,t,r,n)?(g.streamHandler.onPublishStateUpdate(i.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""}),this.streamCenter.publisherList[e].serverUrls=p,this.streamCenter.startPublishingStream(e)):(this.logger.info("zc.p.sps.1 cannot start publish"),!1);if(!this.streamCenter.setPublishStateStart(g,e,t,r,n))return this.logger.error("zc.p.sps.1 cannot start publish"),!1;this.stateCenter.publishStreamList[e]={state:i.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},this.logger.info("zc.p.sps.1 start publish"),g.streamHandler.onPublishStateUpdate(i.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""});var m=this.streamCenter.publisherList[e].retryDispatchHandler;return m.stopMaxTime(),m.invalid(),m.initStream(e,r,!0),m.startMaxTime(),m.active(0)},e.prototype.activateSEIInsert=function(e,t,r){return void 0===r&&(r=0),!1},e.prototype.stopPublishingStream=function(e,t){var r;this.logger.info(o.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" call ",e+(t?t.toString():""));var n=i.getReportSeq();if(this.stateCenter.reportSeqList.stopPublish[e]=n,this.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskPublishStop.event),this.dataReport.addMsgInfo(n,{streamID:s.ZegoRTCLogEvent.kZegoTaskPublishStop.stream(e)}),"string"!=typeof e||""==e)return this.logger.error(o.ZEGO_WEBRTC_ACTION.STOP_PUBLISHING_STREAM+" streamID must be string and not empty"),this.dataReport.uploadReport(n,void 0,s.ZegoRTCLogEvent.kZegoTaskPublishStop.error.kParamError,"stream id type error"),delete this.stateCenter.reportSeqList.stopPublish[e],!1;var a=this.streamCenter.publisherList[e],u=this.streamCenter.getRoomByStreamID(e),l=a&&a.publisher&&a.publisher.state!==i.ENUM_PUBLISH_STATE.stop;if(this.streamCenter.stopPublishingStream(e),this.stateCenter.publishStreamList[e]){if(this.stateCenter.publishStreamList[e].state>=i.ENUM_PUBLISH_STREAM_STATE.update_info&&u){t&&1102018===t.code||u.streamHandler.updateStreamInfo(e,"PUBLIC"===this.stateCenter.type?i.ENUM_STREAM_SUB_CMD.liveEnd:i.ENUM_STREAM_CMD_PRI.liveEnd);for(var c=0;c<u.streamList.length;c++)if(u.streamList[c].stream_id==e){u.streamList.splice(c--,1);break}}delete this.stateCenter.publishStreamList[e]}return this.dataReport.addMsgInfo(n,{session_id:null===(r=null==a?void 0:a.publisher)||void 0===r?void 0:r.sessionId}),this.dataReport.uploadReport(n),u&&l&&u.streamHandler.onPublishStateUpdate(i.ENUM_PUBLISH_STATE_UPDATE.error,e,t||{code:0,message:""}),!0},e.prototype.setCaptureVolume=function(e,t){var r=this;return new Promise(function(n){var i;r.logger.info(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call");var a=function(e){r.logger.error(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" "+e),n({errorCode:s.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.code,extendedData:JSON.stringify({fail_reason:s.ZegoRTCLogEvent.kZegoSetCaptureVolume.error.kParamError.message+" "+e})})},u=r.streamCenter.ac,l=r.streamCenter.checkPreview(e);if(e instanceof MediaStream&&l)if(0!=e.getAudioTracks().length)if("number"!=typeof t||t<0||t>100)a(" volume must be number between 0 to 100");else{if(l.gainNode)l.gainNode.gain.value=t/100;else{var c=u.createMediaStreamSource(e),d=u.createGain(),h=u.createMediaStreamDestination();c.connect(d),d.connect(h);var p=h.stream.getAudioTracks()[0];for(var f in r.streamCenter.publisherList){var g=r.streamCenter.publisherList[f];if(g.localStream==e){var _=null===(i=g.publisher.peerConnection)||void 0===i?void 0:i.getSenders().find(function(e){return e.track&&"audio"===e.track.kind});_&&(_.replaceTrack(p),g.localStream.removeTrack(g.publisher.localStream.getAudioTracks()[0]),g.localStream.addTrack(p));break}}var m=e.getAudioTracks()[0];m&&(p.enabled=m.enabled,e.removeTrack(m)),e.addTrack(p),l.gainNode=d,l.gainNode.gain.value=t/100}u.resume(),n({errorCode:0,extendedData:""}),r.logger.info(o.ZEGO_WEBRTC_ACTION.PUBLISH_SET_CAPTURE_VOLUME+" call success")}else a(" stream audioTrack no found");else a(" stream must be created by zego")})},e.prototype.getElectronScreenSources=function(){var e=this;return new Promise(function(t,r){var n=window.require("electron");n||(e.logger.error("zc.gess.0 Electron is not exist"),r({message:"Electron is not exist"})),n.desktopCapturer.getSources({types:["window","screen"]}).then(function(e){var r=e.map(function(e){return{id:e.id,name:e.name,thumbnail:e.thumbnail}});t(r)}).catch(function(t){e.logger.error("zc.gess.0 "+t),r(t)})})},e.prototype.startScreenShotChrome=function(e){if(c.ZegoWebRTC.screenShotReady)window.postMessage({type:"SS_UI_REQUEST",text:"start"},"*"),a.ClientUtil.registerCallback("screenShare",{success:e},this.stateCenter.callbackList);else{var t='zc.b.ss Please install the extension:1. Go to chrome://extensions  2. Check: "Enable Developer mode   3. Click: "Load the unpacked extension... 4. Choose "extension" folder from the repository 5. Reload this page';this.logger.error(t),e(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+t})}},e.prototype.startScreenSharing=function(e,t){var r=this;"getDisplayMedia"in navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia({audio:e.audio,video:{frameRate:e.frameRate,width:e.width,height:e.height}}).then(function(e){t(!0,e)}).catch(function(e){r.logger.error("zc.b.sss "+e),e.message&&"permission denied"==e.message.toLowerCase()?t(!1,null,s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenCancelError):t(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})}):(this.logger.error("zc.b.sss brower does not support getDisplayMedia"),t(!1,null,s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError))},e.prototype.startScreenShotFirFox=function(e,t,r){var n=this;navigator.mediaDevices.getUserMedia({video:{frameRate:t.frameRate,bitRate:t.bitRate,width:t.width,height:t.height,mediaSource:e},audio:t.audio}).then(function(e){r(!0,e)}).catch(function(e){n.logger.error("ze.ssf.1 "+e),r(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})})},e.prototype.startScreenShotElectron=function(e,t){var r=this;if(!window.require("electron"))return this.logger.error("ze.sse.1 Electron is not exist"),void t(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" Electron is not exist"});var n={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e.sourceID,maxWidth:window.screen.width,maxHeight:window.screen.height}},audio:!1};navigator.mediaDevices.getUserMedia(n).then(function(e){t(!0,e)}).catch(function(e){r.logger.error("ze.sse.1 "+e),t(!1,null,{code:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.code,message:s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kScreenFailedError.message+" "+e})})},e.prototype.startPreview=function(e,t,r,n){var o=this,i=null;return i=new l.ZegoPreview(this.logger,this.streamCenter.ac,this.stateCenter,this.streamCenter,t),this.streamCenter.previewStreamList.push(i),i.startPreview(e,function(n){o.streamCenter.soundLevelDelegate&&(null==i||i.startSoundLevel()),"camera"===t&&(null==i?void 0:i.micTrack)&&(i.micTrack.enabled=o.streamCenter.isMicEnabled),(null==e?void 0:e.videoOptimizationMode)&&o.streamCenter.setVideoTrackContentHint(n,null==e?void 0:e.videoOptimizationMode),o.logger.debug("zsc.sp.0 call success"),!o.stateCenter.deviceInfos&&o.recordDevices(),r&&r(n)},function(e){o.streamCenter.previewStreamList=o.streamCenter.previewStreamList.filter(function(e){return e!==i}),n&&n(e)}),!0},e.prototype.stopPreview=function(e){if(!e)return this.logger.warn("zsc.sp.0 localStream null"),!1;for(var t in this.streamCenter.publisherList)this.streamCenter.publisherList[t].localStream===e&&(this.streamCenter.publisherList[t].localStream=null);var r=this.streamCenter.checkPreview(e);return r?(r.previewSuc&&(r.stopPreview(),this.streamCenter.removePreview(r)),!0):(this.logger.warn("zsc.sp.0 no preview"),!1)},e.prototype.recordDevices=function(e,t){var r,n=this;this.logger.info("zsc.rd.0 call"),a.ClientUtil.getDevices(function(t){n.stateCenter.deviceInfos={microphones:t.microphones,speakers:t.speakers,cameras:t.cameras},e&&e(t)},function(e){n.logger.warn("zsc.rd.0 getDevices err:",e),t&&t(e)}),void 0!==(null===(r=navigator.mediaDevices)||void 0===r?void 0:r.ondevicechange)&&(navigator.mediaDevices.ondevicechange=null,navigator.mediaDevices.ondevicechange=function(e){n.logger.info("zsc.rd.0 devicechange"),n.stateCenter.deviceChangeTimer&&(clearTimeout(n.stateCenter.deviceChangeTimer),n.stateCenter.deviceChangeTimer=null),n.stateCenter.deviceChangeTimer=setTimeout(function(){a.ClientUtil.getDevices(function(e){for(var t=[],r=function(r){var o=n.stateCenter.deviceInfos.cameras[r];e.cameras.find(function(e){return e.deviceID===o.deviceID})||t.push(o)},o=0;o<n.stateCenter.deviceInfos.cameras.length;o++)r(o);n.stateCenter.deviceStateOut=!1;var a=!1;t.length>0&&(a=!0),t.forEach(function(e){for(var t in n.streamCenter.publisherList){var r=n.streamCenter.publisherList[t],o=r.publisher;r.localStream&&r.cameraLabel===e.deviceName&&(a=!1,o.sendStreamStatus(-6,o.mic_status),n.stateCenter.actionListener("_deviceError",u.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.deviceName,"camera"),n.stateCenter.actionListener("deviceError",u.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,e.deviceName)),r.localStream&&0===r.localStream.getAudioTracks().length&&(a=!1)}var l=i.getReportSeq();n.dataReport.newReport(l,s.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),n.dataReport.addMsgInfo(l,{interrupt:0}),n.dataReport.uploadReport(l),n.stateCenter.actionListener("videoDeviceStateChanged","DELETE",e)}),a&&(n.stateCenter.deviceStateOut=!0),n.stateCenter.deviceInfos.microphones.filter(function(t){return!e.microphones.find(function(e){return e.deviceID===t.deviceID})}).forEach(function(e){for(var t in n.streamCenter.publisherList){var r=n.streamCenter.publisherList[t],o=r.publisher;r.localStream&&(r.microLabel===e.deviceName||r.microLabel.includes(e.deviceName))&&(o.sendStreamStatus(o.camera_status,-6),n.stateCenter.actionListener("_deviceError",u.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,n.streamCenter.publisherList[t].microLabel,"micro"),n.stateCenter.actionListener("deviceError",u.errorCodeList.DEVICE_ERROR_TYPE_UNPLUGGED.code,n.streamCenter.publisherList[t].microLabel))}var a=i.getReportSeq();n.dataReport.newReport(a,s.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),n.dataReport.addMsgInfo(a,{interrupt:0}),n.dataReport.uploadReport(a),n.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Input",e)});var l=n.stateCenter.deviceInfos.speakers.filter(function(t){return!e.speakers.find(function(e){return e.deviceID===t.deviceID})}),c=e.cameras.filter(function(e){return!n.stateCenter.deviceInfos.cameras.find(function(t){return t.deviceID===e.deviceID})}),d=e.microphones.filter(function(e){return!n.stateCenter.deviceInfos.microphones.find(function(t){return t.deviceID===e.deviceID})}),h=e.speakers.filter(function(e){return!n.stateCenter.deviceInfos.speakers.find(function(t){return t.deviceID===e.deviceID})});l.forEach(function(e){var t=i.getReportSeq();n.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),n.dataReport.addMsgInfo(t,{reason:s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("delete"),device:s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(e)}),n.dataReport.uploadReport(t),n.stateCenter.actionListener("audioDeviceStateChanged","DELETE","Output",e)}),c.forEach(function(e){var t=i.getReportSeq();n.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),n.dataReport.addMsgInfo(t,{interrupt:1}),n.dataReport.uploadReport(t),n.stateCenter.actionListener("videoDeviceStateChanged","ADD",e)}),d.forEach(function(e){var t=i.getReportSeq();n.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskDeviceInterrupt.event),n.dataReport.addMsgInfo(t,{interrupt:1}),n.dataReport.uploadReport(t),n.stateCenter.actionListener("audioDeviceStateChanged","ADD","Input",e)}),h.forEach(function(e){var t=i.getReportSeq();n.dataReport.newReport(t,s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.event),n.dataReport.addMsgInfo(t,{reason:s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.reason("add"),device:s.ZegoRTCLogEvent.kZegoTaskAudioOutputChanged.device(e)}),n.dataReport.uploadReport(t),n.stateCenter.actionListener("audioDeviceStateChanged","ADD","Output",e)}),n.stateCenter.deviceInfos={microphones:e.microphones,speakers:e.speakers,cameras:e.cameras}},function(e){n.logger.warn("zsc.rd.0 getDevices err:",e)})},500)})},e.prototype.getStreamThroughCanvas=function(e){if(0==e.getVideoTracks().length)return e;var t=document.createElement("video"),r=document.createElement("canvas"),n=r.getContext("2d");t.setAttribute("style","display:none"),r.setAttribute("style","display:none"),t.setAttribute("muted",""),t.muted=!0,t.setAttribute("autoplay",""),t.autoplay=!0,t.setAttribute("playsinline",""),document.body.append(t),document.body.append(r),t.srcObject=e;var o=function o(){null==n||n.drawImage(t,0,0,r.width,r.height),window.requestAnimationFrame(o),t.srcObject=e};t.oncanplay=function(){r.width=t.videoWidth,r.height=t.videoHeight,t.play(),o()};var i=r.captureStream(15),s=i.getVideoTracks()[0],a=s.stop;if(s.stop=function(){a.call(s),o(),t.remove(),r.width=0,r.remove()},e instanceof MediaStream&&e.getAudioTracks().length){var u=e.getAudioTracks()[0];i.addTrack(u)}return i},e}();t.PublishModule=d},3770:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPreview=void 0;var s=r(6706),a=r(3529),u=r(1089),l=function(){function e(e,t,r,n,o){var i=this;this.logger=e,this.ac=t,this.stateCenter=r,this.streamCenter=n,this.previewType=o,this.localStream=null,this.videoInfo={},this.previewSuc=!1,this.soundLevel=0,this.hasEmptyAudioTrack=!1,this.script=null,this.mic=null,this._audioTrack=null,this._videoTrack=null,this.cloneVideoTrack=null,this.originVideoTrack=null,this.activateSEIConfig=null,this.isAudioEnabled=!0,this.gainNode=null,this.cameraMaxResolution={},this.enableMicrophoneOnly=function(e,t){var r;if(!i.localStream)return i.logger.error("zp.em.2 no localStream"),!1;var n=null===(r=t.checkPublish(i.localStream))||void 0===r?void 0:r.publisher;if(n){var o=n.camera_status,s=i.isAudioEnabled&&e?0:20;n.camera_status===o&&n.mic_status===s||n.sendStreamStatus(o,s)}return i.micTrack?(i.micTrack.enabled=i.isAudioEnabled&&e,i.logger.debug("zp.emo.2 call success"),!0):(i.logger.info("zp.emo.2 no micTrack"),!0)}}return Object.defineProperty(e.prototype,"audioTrack",{get:function(){var e;return this._audioTrack||(null===(e=this.localStream)||void 0===e?void 0:e.getAudioTracks()[0])||null},set:function(e){this._audioTrack=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoTrack",{get:function(){var e;return this._videoTrack||(null===(e=this.localStream)||void 0===e?void 0:e.getVideoTracks()[0])||null},set:function(e){this._videoTrack=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"micTrack",{get:function(){return"camera"===this.previewType&&this.audioTrack||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isVideoEffectStarting",{get:function(){return!!this.videoEffect&&this.videoEffect.isStarting},enumerable:!1,configurable:!0}),e.prototype.getMediaStreamConstraints=function(e,t){var r={audio:null,video:null};if(r.audio=!0,r.video={width:640,height:480,frameRate:15,bitRate:this.stateCenter.settingConfig.getSetting("camera_video_bitrate")},e.audio?void 0===e.audioInput&&void 0===e.ANS&&void 0===e.AGC&&void 0===e.AEC&&void 0===e.channelCount?(r.audio={},r.audio.noiseSuppression=this.stateCenter.settingConfig.getSetting("ANS"),r.audio.autoGainControl=this.stateCenter.settingConfig.getSetting("AGC"),r.audio.echoCancellation=this.stateCenter.settingConfig.getSetting("AEC"),r.audio.channelCount=1):(r.audio={},null!=e.audioInput&&(r.audio.deviceId={exact:e.audioInput}),void 0!==e.ANS&&(r.audio.noiseSuppression=e.ANS),void 0!==e.AGC&&(r.audio.autoGainControl=e.AGC),void 0!==e.AEC&&(r.audio.echoCancellation=e.AEC),void 0!==e.channelCount&&(r.audio.channelCount=e.channelCount)):!1===e.audio&&(r.audio=!1),e.video){var n=640,o=480,i=15,a=this.stateCenter.settingConfig.getSetting("camera_video_bitrate");if(1===e.videoQuality?(n=s.ENUM_RESOLUTION_TYPE.LOW.width,o=s.ENUM_RESOLUTION_TYPE.LOW.height,i=s.ENUM_RESOLUTION_TYPE.LOW.frameRate,a=s.ENUM_RESOLUTION_TYPE.LOW.bitRate):2===e.videoQuality?(n=s.ENUM_RESOLUTION_TYPE.MEDIUM.width,o=s.ENUM_RESOLUTION_TYPE.MEDIUM.height,i=s.ENUM_RESOLUTION_TYPE.MEDIUM.frameRate,a=s.ENUM_RESOLUTION_TYPE.MEDIUM.bitRate):3===e.videoQuality?(n=s.ENUM_RESOLUTION_TYPE.HIGH.width,o=s.ENUM_RESOLUTION_TYPE.HIGH.height,i=s.ENUM_RESOLUTION_TYPE.HIGH.frameRate,a=s.ENUM_RESOLUTION_TYPE.HIGH.bitRate):4===e.videoQuality?(n=e.width,o=e.height,i=e.frameRate,a=e.bitRate||this.stateCenter.settingConfig.getSetting("camera_video_bitrate")):this.logger.info("zp.gmsc.2 use default"),t&&(e.width&&(n=e.width),e.height&&(o=e.height),e.frameRate&&(i=e.frameRate),e.bitRate&&(a=e.bitRate)),!1===e.horizontal){var u=o;o=n,n=u}!0===e.isSwitch&&(u=o,o=n,n=u),r.video={width:n,height:o,frameRate:i,bitRate:a},null!=e.facingMode?r.video.facingMode=e.facingMode:null!=e.videoInput&&null!=e.videoInput&&""!=e.videoInput&&(r.video.deviceId={exact:e.videoInput}),this.logger.info("zp.gmsc.2 width: "+n+" height: "+o+" rate: "+i)}else!1===e.video&&(e.audioBitrate&&(r.video={}),r.video=!1);return r},e.prototype.startPreview=function(e,t,r){return o(this,void 0,void 0,function(){var o,s,u,l,c,d,h,p=this;return i(this,function(i){return this.logger.debug("zp.sv.2 called"),this.mediaStreamConfig=e,void 0===navigator.mediaDevices||null==navigator.mediaDevices.getUserMedia?(r&&r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError),[2]):e.source instanceof MediaStream?(o=e.source.getVideoTracks(),s=o.length>0?o[0].getSettings():{width:0,height:0,frameRate:0},this.logger.debug("zp.sv.2 use external media stream"),this.previewSuc=!0,this.localStream=e.source,this.initMediaTrack(e.source),this.videoInfo={width:s.width,height:s.height,frameRate:s.frameRate,bitRate:e.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),startBitrate:e.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode"),channelCount:e.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*e.audioBitrate||48e3},t&&t(this.localStream),[2]):e.source instanceof HTMLMediaElement?((u=this.captureStream(e.source,e))?(this.videoInfo.bitRate=e.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),this.previewSuc=!0,this.initMediaTrack(u),t&&t(u)):r&&r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kBrowserNotSupportError),[2]):((l=this.getMediaStreamConstraints(e)).audio&&(c=this.stateCenter.settingConfig.getSetting("AEC",!0),d=this.stateCenter.settingConfig.getSetting("AGC",!0),h=this.stateCenter.settingConfig.getSetting("ANS",!0),"boolean"==typeof c&&(this.logger.info("zp.sv.2 setting AEC "+c),l.audio.echoCancellation=c),"boolean"==typeof d&&(this.logger.info("zp.sv.2 setting AGC "+d),l.audio.autoGainControl=d),"boolean"==typeof h&&(this.logger.info("zp.sv.2 setting ANS "+h),l.audio.noiseSuppression=h)),this.videoInfo=n({},l.video),this.videoInfo?(this.videoInfo.audioBitrate=1e3*e.audioBitrate||48e3,this.videoInfo.startBitrate=e.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode")):e.audioBitrate&&(this.videoInfo={audioBitrate:1e3*e.audioBitrate||48e3}),this.mediaStreamConfig.video=!!l.video,this.mediaStreamConfig.audio=!!l.audio,this.logger.info("zp.sv.2 ",JSON.stringify(l)),e.unlimitedCaptureResolution&&l.video.width&&(l.video.width={ideal:4096},l.video.height={ideal:2160},this.logger.info("zp.sv.2 ","capture max resolution of camera")),navigator.mediaDevices.getUserMedia(l).then(function(r){p.logger.info("zp.sv.2 success"),p.localStream=r,p.previewSuc=!0,p.initMediaTrack(r),p.videoInfo&&(p.videoInfo.channelCount=e.channelCount||(p.audioTrack&&p.audioTrack.getSettings?p.audioTrack.getSettings().channelCount:1)),t&&t(r)},function(e){if(p.logger.info("zp.sv.2 failed ",e.name," ",e.message),r){var t=a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kGetUserMediaError;t.message=t.message+" "+e.name+" "+e.message,"NotAllowedError"===e.name||"SecurityError"===e.name?(t=n({},a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceNoAllowedError)).message=e.name+": "+t.message:"NotReadableError"===e.name?(t=n({},a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceNoReadableError)).message=e.name+": "+t.message:"OverconstrainedError"===e.name&&((t=n({},a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kDeviceOverConstrainedError)).message=e.name+": "+t.message+(e.constraint?". such as "+e.constraint:"")),r(t)}}),[2])})})},e.prototype.captureStream=function(e,t){if(!e)return this.logger.info("zp.cs.2 no local video"),null;var r;if(e.captureStream)r=e.captureStream(),this.logger.debug("zp.cs.2 captureStream");else{if(!e.mozCaptureStream)return this.logger.info("zp.cs.2 don't support"),null;r=e.mozCaptureStream(),this.logger.debug("zp.cs.2 mozCaptureStream")}return 0==r.getTracks().length?(this.logger.error("zp.cs.2 external capture tracks no found"),null):(this.localStream=r,this.videoInfo={width:e.videoWidth,height:e.videoHeight,frameRate:0,bitRate:t.bitRate||this.stateCenter.settingConfig.getSetting("custom_video_bitrate"),channelCount:t.channelCount||(this.audioTrack&&this.audioTrack.getSettings?this.audioTrack.getSettings().channelCount:1),audioBitrate:1e3*t.audioBitrate||48e3,startBitrate:t.startBitrate||this.stateCenter.settingConfig.getSetting("bitrate_mode")},this.logger.debug("zp.cs.2 called success"),this.localStream)},e.prototype.stopPreview=function(){var e,t,r,n;this.logger.info("zp.sv.2.1 called"),this.localStream&&(this.videoEffect&&(this.videoEffect.setBeautyEffectOptions(!1),this.videoEffect.destroy()),null===(e=this.cloneVideoTrack)||void 0===e||e.stop(),null===(t=this.originVideoTrack)||void 0===t||t.stop(),null===(r=this.videoTrack)||void 0===r||r.stop(),null===(n=this.audioTrack)||void 0===n||n.stop(),this.localStream.getTracks().reverse().forEach(function(e){return e.stop()}),this.localStream=null,this.videoInfo={})},e.prototype.enableMicrophone=function(e,t){return!1},e.prototype.enableCamera=function(e,t,r){return!1},e.prototype.startSoundLevel=function(){var e=this;if(this.localStream&&0!=this.localStream.getAudioTracks().length){this.script&&this.script.disconnect()&&(this.script=null),this.mic&&this.mic.disconnect()&&(this.mic=null);try{this.mic=this.ac.createMediaStreamSource(this.localStream),this.script=this.ac.createScriptProcessor(4096,1,1),this.mic.connect(this.script),this.script.connect(this.ac.destination),this.script.onaudioprocess=function(t){for(var r=t.inputBuffer.getChannelData(0),n=0,o=0;o<r.length;o++)n<r[o]&&(n=r[o]);e.soundLevel=100*n},this.ac.resume()}catch(e){this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" get sound level failed "+e)}}},e.prototype.stopSoundLevel=function(){this.soundLevel=0,this.script&&this.script.disconnect(),this.mic&&this.mic.disconnect(),this.script=null,this.mic=null},e.prototype.restartSoundLevel=function(){this.streamCenter.soundLevelDelegate?(this.stopSoundLevel(),this.startSoundLevel()):this.stopSoundLevel()},e.prototype.setBeautyEffect=function(e,t){return o(this,void 0,void 0,function(){return i(this,function(e){return[2]})})},e.prototype.replacePreviewTrack=function(e,t){void 0===t&&(t=!1)},e.prototype.initMediaTrack=function(e){e.getVideoTracks().length>0&&(this.videoTrack=e.getVideoTracks()[0],this.originVideoTrack=this.videoTrack),e.getAudioTracks().length>0&&(this.audioTrack=e.getAudioTracks()[0])},e}();t.ZegoPreview=l},1547:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPublish=void 0;var o=r(6706),i=r(4767),s=r(608),a=r(3529),u=r(1089),l=function(){function e(e,t,r,n,i,s,a,u,l){this.state=o.ENUM_PUBLISH_STATE.stop,this.sessionId=0,this.sessionToken="",this.candidateInfo=[],this.qualityTimer=null,this.publishQualityList=[],this.maxQualityListCount=10,this.lastPublishStats={},this.reportSeq=NaN,this.streamReportSeq=o.getSeq(),this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.qualitySeq=0,this.videoInfo={width:0,height:0,frameRate:0,bitRate:0,channelCount:1,audioBitrate:48e3},this.mediaStreamConfig=null,this.offerSeq=0,this.audioMixList=[],this.arrayBufferMap={},this.effectList=[],this.peerConnection=null,this.qualityCount=0,this.closeSessionSignal=!1,this.channelCount=1,this.localSdpOrder=[],this.remoteSdpOrder=[],this.videoCodec="H264",this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.stop,this.negoInterval=25e3,this.publishEvent=!1,this.cameraState="on",this.microState="on",this.gwNode="",this.gwNodeList=[],this.gwNodeTTL=0,this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[],this.isPeer=!1,this.peerFailCount=0,this.peerID=0,this.netQuality=0,this.probeTime=0,this.probeInterval=6e4,this.probeState=o.ENUM_PROBE_STATE.probed,this.iceDisconnectedMaxTime=15e3,this.isUpdateSDP=!1,this.toBeReplacedTracks={},this.send_seq=0,this.dataChannelState=0,this.first_pkt=!0,this.next_sn=[],this.pkt_list=[],this.camera_status=2,this.mic_status=2,this.streamId=e,this.logger=t,this.dataReport=r,this.qualityTimeInterval=n,this.ac=s,this.mediaEleSources=a,this.streamCenter=i,this.stateCenter=u,this.dataReport.newReport(this.streamReportSeq),this.videoCodec=this.stateCenter.settingConfig.getSetting("publish_video_codec")}return Object.defineProperty(e.prototype,"previewer",{get:function(){return this.streamCenter.checkPreview(this.localStream)},enumerable:!1,configurable:!0}),e.prototype.publishStateUpdateError=function(e,t){this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  call ",this.streamId,JSON.stringify(e)),this.streamId&&this.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,this.streamId,e,t),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_STATE_ERROR+"  ended")},e.prototype.resetPublish=function(){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_RESET_PUBLISH+"   "+this.streamId+" call"),this.state=o.ENUM_PUBLISH_STATE.stop,this.publishEvent=!1,null==this.peerConnection&&null==this.peerConnection||(this.peerConnection.close(),this.peerConnection=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.clearPublishQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId),this.signal.unregisterPushCallback("SessionResetPush",this.sessionId),this.signal.unregisterPushCallback("PublishEventPush",this.sessionId),this.signal.unregisterPushCallback("ClientInfoPush",this.sessionId)),this.sessionSeq=0,this.offerSeq=0,this.candidateInfo=[],this.publishQualityList=[],this.qualityUploadLastTime=0,this.resetEncBitrate(),this.isUpdateSDP=!1},e.prototype.clearPublishQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPublishStats={},this.qualityCount=0},e.prototype.shouldSendCloseSession=function(){return this.state!=o.ENUM_PUBLISH_STATE.stop&&this.state!=o.ENUM_PUBLISH_STATE.waitingSessionRsp},e.prototype.startPublish=function(e,t,r,n,o){var i,s=this;if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+e+" called"),this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),e){var l;this.localStream=t,this.mediaStreamConfig=n,this.channelCount=n.channelCount,this.publishOption=o||{},navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&n&&(n.externalCapture||n.externalMediaStream)&&(this.localStream.onaddtrack=function(){var e,t,r,n;s.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+s.streamId+" Track added");var o=[];(null===(e=s.previewer)||void 0===e?void 0:e.videoTrack)&&o.push(null===(t=s.previewer)||void 0===t?void 0:t.videoTrack);var i=s.localStream.getAudioTracks();if(o.length>1)null==(a=null===(r=s.peerConnection)||void 0===r?void 0:r.getSenders().find(function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===o[1].kind}))||a.replaceTrack(o[1]),s.localStream.removeTrack(o[0]);else if(i.length>1){var a;null==(a=null===(n=s.peerConnection)||void 0===n?void 0:n.getSenders().find(function(e){var t;return(null===(t=e.track)||void 0===t?void 0:t.kind)===i[1].kind}))||a.replaceTrack(i[1]),s.localStream.removeTrack(i[0])}}),r&&(this.videoInfo=r),o&&o.videoCodec&&(this.videoCodec=o.videoCodec);var c=null===(i=this.previewer)||void 0===i?void 0:i.previewType;switch(c){case"camera":l=this.stateCenter.settingConfig.getSetting("camera_video_bitrate",!0);break;case"screen":l=this.stateCenter.settingConfig.getSetting("screen_video_bitrate",!0);break;case"custom":l=this.stateCenter.settingConfig.getSetting("custom_video_bitrate",!0)}l&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting "+c+" "+l),this.videoInfo.bitRate=l);var d=this.stateCenter.settingConfig.getSetting("bitrate_mode",!0);d&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting bitrate_mode "+d),this.videoInfo.startBitrate=d);var h=this.stateCenter.settingConfig.getSetting("publish_video_codec",!0);h&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting publish_video_codec "+h),this.videoCodec=h),this.dataReport.addMsgInfo(this.reportSeq,{video_en_codec_id:a.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_codec_id("VP8"==this.videoCodec?2:0),audio_c_channel_count:a.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_c_channel_count(2==this.channelCount?2:1),audio_en_bps:a.ZegoRTCLogEvent.kZegoTaskPublishStart.audio_en_bps(this.videoInfo.audioBitrate),aec_level:a.ZegoRTCLogEvent.kZegoTaskPublishStart.aec_level(1==n.AEC?2:0==n.AEC?0:2),ans_level:a.ZegoRTCLogEvent.kZegoTaskPublishStart.ans_level(1==n.ANS?2:0==n.ANS?0:2),agc:a.ZegoRTCLogEvent.kZegoTaskPublishStart.agc(1==n.AGC?2:0==n.AGC?0:2),traffic_control_min_video_bitrate:a.ZegoRTCLogEvent.kZegoTaskPublishStart.traffic_control_min_video_bitrate(this.videoInfo.bitRate)}),this.isPeer?this.createOffer():this.createSession(),this.negoTimer=setTimeout(function(){s.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" waiting timeout"),s.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishNegoTimeoutError)},this.negoInterval)}else this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+e+" streamId is null")},e.prototype.activateSEIInsert=function(e,t){return new Promise(function(e,t){e(!1)})},e.prototype.createSession=function(e){var t=this;this.sessionSeq=o.getSeq();var r=this.streamId;1==this.streamCenter.testEnvironment&&(r="zegotest-"+this.streamCenter.appid+"-"+this.streamId);var n=this.stateCenter.settingConfig.getSetting("gw_nodes");n&&n instanceof Array&&n.length>0&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" setting "+JSON.stringify(n)),this.gwNodeList=n,this.gwNode=this.gwNodeList[0]||this.gwNode),this.isPeer?(this.dataReport.eventStart(this.reportSeq,"CreateSessionWithSdp"),this.dataReport.eventStart(this.streamReportSeq,"CreateSessionWithSdp"),this.signal.createSessionWithSdp({seq:this.sessionSeq,type:0,mode:0,streamId:r,videoInfo:this.videoInfo,strAuthParam:this.publishOption&&this.publishOption.streamParams||"",sdp:e.sdp,serverHost:this.gwNode},function(e,r,n){t.handleCreateSessionWithSdpResp(e,r,n)},function(r,n){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:r}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:r}),r==o.SEND_MSG_TIMEOUT&&t.peerFailCount<2?(t.peerFailCount++,t.createSession(e)):r==o.SEND_MSG_TIMEOUT&&t.peerFailCount>=2?(t.isPeer=!1,t.streamCenter.isPeer=!1,t.createSession()):t.publishStateUpdateError(r==o.SEND_MSG_TIMEOUT?a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)})):(this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.dataReport.eventStart(this.streamReportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,0,0,r,this.publishOption&&this.publishOption.streamParams,this.gwNode,function(e,r,n){t.handleCreateSessionResp(e,r,n)},function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateSession",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"CreateSession",{error:e}),t.publishStateUpdateError(e==o.SEND_MSG_TIMEOUT?a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionTimeoutError:a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)})),this.state=o.ENUM_PUBLISH_STATE.waitingSessionRsp,this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" called success"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.start},e.prototype.handleCreateSessionResp=function(e,t,r){var n=r.turn_server,o=n.split("?")[0]&&n.split("?")[0].slice(5),i=this.streamCenter.server.split("?"),s=i[1]&&i[1].slice(2);this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+o+"/"+s+"/"+this.streamId}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSession",{sessionId:r.session_id,url:"webrtc://"+o+"/"+s+"/"+this.streamId}),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" sessionId:"+r.session_id),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,0!==r.result?(this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session failed "+r.result),this.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError)):(this.sessionId=r.session_id,this.sessionToken=r.session_token,this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" create session success "+this.sessionId),this.dataReport.addMsgInfo(this.reportSeq,{session_id:a.ZegoRTCLogEvent.kZegoTaskPublishStart.session_id(this.sessionId)}),this.onCreatePublishSessionSuccess(r))):this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" "+this.streamId+" seq is not match.")},e.prototype.handleCreateSessionWithSdpResp=function(e,t,r){var n=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" sessionId:"+t),this.sessionSeq==e?(this.gwNodeList=r.gw_nodes&&r.gw_nodes.length>0?r.gw_nodes:this.gwNodeList,this.gwNode=r.gw_nodes&&r.gw_nodes.length>0?this.gwNodeList[0]:this.gwNode,this.gwNodeTTL=r.gw_nodes_ttl?(new Date).getTime()+1e3*r.gw_nodes_ttl:this.gwNodeTTL,this.stateCenter.clientIP=r.clientip?r.clientip:this.stateCenter.clientIP,this.dataReport.eventEndWithMsg(this.streamReportSeq,"CreateSessionWithSdp",{sessionId:t}),this.dataReport.eventEndWithMsg(this.reportSeq,"CreateSessionWithSdp",{sessionId:t}),0!==r.result?(this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" create session failed "+r.result),this.publishStateUpdateError({code:a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.code,message:a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSessionRequestError.message+" result:"+r.result})):(this.sessionId=t,this.sessionToken=r.session_token,this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" get remote session success "+this.streamId),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(e,t,r){n.onRecvCloseSession(e,t,r)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(e,t,r){n.onRecvResetSession(e,t,r)}),this.signal.registerPushCallback("PublishEventPush",this.sessionId,function(e,t,r){n.onRecvPublishEvent(e,t,r)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(e,t,r){n.onRecvClientInfo(e,t,r)}),this.signal.registerPushCallback("MediaDescUpdatePush",this.sessionId,function(e,t,r){n.onRecvUpdateMediaDescription(e,t,r)}),this.onGetRemoteOfferSuccess(r.sdp))):this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_PUBLISH+" seq is not match.")},e.prototype.onCreatePublishSessionSuccess=function(e){var t=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" called");var r=[];if(e.turn_server){var n=e.turn_server,o=this.stateCenter.turnOverTcpOnly,i=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);i&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" setting udp_or_tcp "+i),o="tcp"===i),o&&(n=n.replace("udp","tcp")),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" over tcp "+n),r.push(n)}e.stun_server&&r.push(e.stun_server);var s={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" username: "+e.turn_username),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" credential: "+e.turn_auth_key),this.createOffer(s),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,function(e,r,n){t.onRecvCandidateInfo(e,r,n)}),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,function(e,r,n){t.onRecvCloseSession(e,r,n)}),this.signal.registerPushCallback("MediaDescPush",this.sessionId,function(e,r,n){t.onRecvMediaDescription(e,r,n)}),this.signal.registerPushCallback("SessionResetPush",this.sessionId,function(e,r,n){t.onRecvResetSession(e,r,n)}),this.signal.registerPushCallback("PublishEventPush",this.sessionId,function(e,r,n){t.onRecvPublishEvent(e,r,n)}),this.signal.registerPushCallback("ClientInfoPush",this.sessionId,function(e,r,n){t.onRecvClientInfo(e,r,n)}),this.signal.registerPushCallback("MediaDescUpdatePush",this.sessionId,function(e,r,n){t.onRecvUpdateMediaDescription(e,r,n)}),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" call success")},e.prototype.createOffer=function(e){var t,r,n=this;this.peerConnection=new RTCPeerConnection(e),this.peerConnection.onicecandidate=function(e){n.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){n.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){n.onIceConnectionStateChange(e)},this.streamCenter.isDataChannelEnabled&&(this.dataChannel=this.peerConnection.createDataChannel(this.streamId),this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=function(e){n.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+n.streamId+" data channel open"),n.dataChannelState=1},this.dataChannel.onclose=function(e){n.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+n.streamId+" data channel close ")});var o=[],i=[];this.localStream&&(this.localStream.getTracks().forEach(function(e){var t;null===(t=n.peerConnection)||void 0===t||t.addTrack(e,n.localStream)}),(null===(t=this.previewer)||void 0===t?void 0:t.videoTrack)&&(o=[null===(r=this.previewer)||void 0===r?void 0:r.videoTrack]),i=this.localStream.getAudioTracks(),o.length>0&&this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" video device: "+o[0].label),i.length>0&&this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" audio device: "+i[0].label));var s={offerToReceiveAudio:i.length>0?1:0,offerToReceiveVideo:o.length>0?1:0};this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+this.streamId+" createOffer: "+JSON.stringify(s)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.dataReport.eventStart(this.streamReportSeq,"CreateOffer"),this.peerConnection.createOffer(s).then(function(e){n.dataReport.eventEnd(n.reportSeq,"CreateOffer"),n.dataReport.eventEnd(n.streamReportSeq,"CreateOffer"),n.onCreateOfferSuccess(e)},function(e){n.dataReport.eventEndWithMsg(n.reportSeq,"CreateOffer",{error:e.toString()}),n.dataReport.eventEndWithMsg(n.streamReportSeq,"CreateOffer",{error:e.toString()}),n.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS+" "+n.streamId+" create offer error "+e.toString()),n.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCreateOfferError,!0)})},e.prototype.onCreateOfferSuccess=function(e,t,r,n){var o,s=this;t&&(this.isUpdateSDP=!0,n&&(this.updateSDPCallBack=n)),this.videoInfo.bitRate>0&&(e.sdp=this.updateBandwidthRestriction(e.sdp,this.videoInfo.bitRate)),e.sdp=e.sdp.replace(/sendrecv/g,"sendonly");var l=e.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)?e.sdp.match(/m=application[\s\S]+datachannel[\s\S]+/)[0]:null;if(l){var c=l.replace(/sendonly/,"sendrecv");e.sdp=e.sdp.replace(l,c)}e.sdp=e.sdp.replace(/useinbandfec=\d+/,(this.videoInfo.audioBitrate?"maxaveragebitrate="+this.videoInfo.audioBitrate:"")+(2===this.videoInfo.channelCount?";stereo=1":"")),this.localSdpOrder=e.sdp.match(/m=(.\w*)\s/g)||[],this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" local sdp revert "+this.localSdpOrder.join("")),e.sdp=i.SdpUtil.getSDPByVideDecodeType(e.sdp,this.videoCodec,!0),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+this.streamId+" localSdp2 "+e.sdp.substr(e.sdp.length/2)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetLocalDescription"),null===(o=this.peerConnection)||void 0===o||o.setLocalDescription(e).then(function(){s.dataReport.eventEnd(s.reportSeq,"SetLocalDescription"),s.dataReport.eventEnd(s.streamReportSeq,"SetLocalDescription"),s.onSetLocalDescriptionSuccess(e,r)},function(e){s.dataReport.eventEndWithMsg(s.reportSeq,"SetLocalDescription",{error:e.toString()}),s.dataReport.eventEndWithMsg(s.streamReportSeq,"SetLocalDescription",{error:e.toString()}),s.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CREATE_OFFER_SUCCESS+" "+s.streamId+" error "+e.toString()),s.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetLocalDescError,!0)})},e.prototype.updateBandwidthRestriction=function(e,t){var r="AS";return"firefox"===this.stateCenter.browser&&(t=1e3*(t>>>0),r="TIAS"),-1===e.indexOf("b="+r+":")?e.replace(/(m=video.*\r\nc=IN.*\r\n)/g,"$1b="+r+":"+t+"\r\n"):(e=e.replace(new RegExp("b="+r+":.*\r\n","g"),"b="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n","")},e.prototype.onSetLocalDescriptionSuccess=function(e,t){var r=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" success"),!this.isUpdateSDP&&(this.state=o.ENUM_PUBLISH_STATE.waitingOfferRsp),t&&(this.videoInfo=n(n({},this.videoInfo),t));var i={sdp:e.sdp,width:this.videoInfo.width,height:this.videoInfo.height,frameRate:this.videoInfo.frameRate,video_min_kpbs:this.videoInfo.bitRate,video_max_kpbs:this.videoInfo.bitRate,audio_kpbs:48,keyframe_intv:2};if(this.offerSeq=o.getSeq(),this.isUpdateSDP){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" update sdp");var s=n(n({},i),{seq:this.sessionSeq,peerID:this.peerID,type:0});return this.dataReport.eventStart(this.reportSeq,"SendMediaDescUpdate"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDescUpdate"),void this.signal.sendMediaDescUpdateReq(this.offerSeq,this.sessionId,s,function(e,t,r){},function(e,t){r.dataReport.eventEndWithMsg(r.reportSeq,"SendMediaDescUpdate",{error:e}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SendMediaDescUpdate",{error:e}),r.updateSDPCallBack&&r.updateSDPCallBack(-1),r.publishStateUpdateError(e==o.SEND_MSG_TIMEOUT?a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kUpdateMediaDescriptionTimeOut:a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kUpdateMediaDescriptionError)})}this.isPeer?this.createSession(e):(this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.dataReport.eventStart(this.streamReportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.offerSeq,this.sessionId,0,i,function(e,t,n){r.offerSeq==e&&r.sessionId==t?(r.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+r.streamId+" send success"),r.dataReport.eventEndWithMsg(r.reportSeq,"SendMediaDesc",{mediaDescription:{width:i.width,height:i.height,frameRate:i.frameRate,video_min_kpbs:i.video_min_kpbs,video_max_kpbs:i.video_max_kpbs,audio_kpbs:i.audio_kpbs,keyframe_intv:i.keyframe_intv}}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SendMediaDesc",{mediaDescription:{width:i.width,height:i.height,frameRate:i.frameRate,video_min_kpbs:i.video_min_kpbs,video_max_kpbs:i.video_max_kpbs,audio_kpbs:i.audio_kpbs,keyframe_intv:i.keyframe_intv}}),r.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+r.streamId+" send success stateNego:waiterAnswer"),r.stateNego=o.ENUM_PUBLISH_STATE_NEGO.waiterAnswer,r.state=o.ENUM_PUBLISH_STATE.waitingServerAnswer):r.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+r.streamId+" seq or sessionId is not equal")},function(e,t){r.dataReport.eventEndWithMsg(r.reportSeq,"SendMediaDesc",{error:e}),r.dataReport.eventEndWithMsg(r.streamReportSeq,"SendMediaDesc",{error:e}),r.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)}),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS+" "+this.streamId+" call success"))},e.prototype.onRecvUpdateMediaDescription=function(e,t,r){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_UPDATE_MEDIA_DESC+" "+this.streamId+" received"),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_UPDATE_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.dataReport.addEvent(this.reportSeq,"RecvUpdateMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvUpdateMediaDesc"),this.signal.sendUpdateMediaDescAck(e,this.sessionId,0,this.peerID),1==r.type?this.onGetRemoteOfferSuccess(r.sdp):this.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)},e.prototype.onRecvMediaDescription=function(e,t,r){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received"),this.state==o.ENUM_PUBLISH_STATE.waitingServerAnswer?(this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.waitingCandidate,this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" received stateNego:waitingCandidate"),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.dataReport.addEvent(this.streamReportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),1==r.type?this.onGetRemoteOfferSuccess(r.sdp):this.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaDescError)):this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_MEDIA_DESC+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSuccess=function(e){var t,r,n,i,s,l,c=this;this.videoInfo.audioBitrate&&48e3!==this.videoInfo.audioBitrate&&(e=e.replace(/maxaveragebitrate=(\d+)/,"maxaveragebitrate="+this.videoInfo.audioBitrate)),this.remoteSdpOrder=e.match(/m=(.\w*)\s/g)||[],this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+NaN+this.remoteSdpOrder.join(""));var d=this.stateCenter.turnOverTcpOnly,h=this.stateCenter.settingConfig.getSetting("udp_or_tcp",!0);if(h&&(this.logger.info("zp.oro.0 setting udp_or_tcp "+h),d="tcp"===h),d&&(null===(t=e.match(/candidate.*/g))||void 0===t||t.forEach(function(t){var r=t.replace(/udp/,"tcp");e=e.replace(t,r)})),this.logger.info("zp.oro.0 "+this.streamId+" sdp revert "+this.localSdpOrder.join("")+" "+this.remoteSdpOrder.join("")),this.localSdpOrder.join()!==this.remoteSdpOrder.join()&&this.localSdpOrder.length==this.remoteSdpOrder.length){var p=new RegExp("[\\s\\S]*"+this.remoteSdpOrder[0]).exec(e)[0].replace(this.remoteSdpOrder[0],""),f=[],g="";this.localSdpOrder.forEach(function(t){var r=c.remoteSdpOrder.findIndex(function(e){return e==t}),n=new RegExp(t+"[\\s\\S]*"+(c.remoteSdpOrder[r+1]||"")).exec(e)[0].replace(c.remoteSdpOrder[r+1],""),o=/a=mid:(\w)/.exec(n)[1];f.push(o),g+=n||""}),e=p.replace(/a=group:BUNDLE.*/,"a=group:BUNDLE "+f.join(" "))+g,this.localSdpOrder=[],this.remoteSdpOrder=[]}var _=e.match(/m=video(.|\r|\n)*a=rtpmap(.|\r|\n)*(a=fmtp:(\d+).*)/);if("chrome"==this.stateCenter.browser){var m=0;if(this.videoInfo.bitRate&&"target"===this.videoInfo.startBitrate&&(m=this.videoInfo.bitRate),null!==_&&m){var v=_[3];e=-1!==v.indexOf("apt=")?e.replace(v,"a=fmtp:96 x-google-start-bitrate="+m+"\n"+v):e.replace(v,v+";x-google-start-bitrate="+m)}}if(this.videoInfo.bitRate>0){var E=/b=AS.*(\r\n|\n)/.test(e);e=E?e.replace(/AS:(\d+)/,"AS:"+this.videoInfo.bitRate):e.replace(/m=video.*(\r\n|\n)c=.*(\r\n|\n)/,"$&b=AS:"+this.videoInfo.bitRate+"\n");var T=null===(r=this.peerConnection)||void 0===r?void 0:r.getSenders().find(function(e){return e.track&&"video"===e.track.kind});if(T&&T.getParameters&&T.setParameters){var y=T.getParameters();y.encodings&&0!=y.encodings.length||(y.encodings=[{}]),y.encodings[0].maxBitrate=1e3*this.videoInfo.bitRate;var S=this.lastPublishStats.frameWidth,C=(null===(i=null===(n=this.previewer)||void 0===n?void 0:n.cameraMaxResolution)||void 0===i?void 0:i.maxWidth)||0,R=null===(s=this.previewer)||void 0===s?void 0:s.videoInfo.width,b=S?Math.min(C,S):C;if(C&&R){var I=Math.max(b/R,1);y.encodings[0].scaleResolutionDownBy=I}T.setParameters(y)}}this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" remoteSdp:",e);var k={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.dataReport.eventStart(this.streamReportSeq,"SetRemoteDescription"),null===(l=this.peerConnection)||void 0===l||l.setRemoteDescription(new RTCSessionDescription(k)).then(function(){c.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+c.streamId+" set success"),c.dataReport.eventEnd(c.reportSeq,"SetRemoteDescription"),c.dataReport.eventEnd(c.streamReportSeq,"SetRemoteDescription"),c.stateNego==o.ENUM_PUBLISH_STATE_NEGO.iceConnected&&c.updateSDPCallBack&&(c.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+c.streamId+" update sdp success"),c.updateSDPCallBack(0),c.updateSDPCallBack=void 0,c.isUpdateSDP=!1)},function(e){c.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+c.streamId+" failed: "+e.toString()),c.dataReport.eventEndWithMsg(c.reportSeq,"SetRemoteDescription",{error:e.toString()}),c.dataReport.eventEndWithMsg(c.streamReportSeq,"SetRemoteDescription",{error:e.toString()}),c.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kSetRemoteDescError,!0)}),this.state=o.ENUM_PUBLISH_STATE.waitingServerICE,this.logger.debug(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_GET_REMOTE_DESCRIPTION+" "+this.streamId+" call success")},e.prototype.onIceConnectionStateChange=function(e){var t=this;this.state!=o.ENUM_PUBLISH_STATE.stop&&null!=this.peerConnection&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState?(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" connected state "+this.state),this.dataReport.eventEnd(this.reportSeq,"IceConnected"),this.dataReport.eventEnd(this.streamReportSeq,"IceConnected"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceConnected,this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" "+this.streamId+" stateNego:iceConnected"),this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.iceDisconnectedTimer&&(clearTimeout(this.iceDisconnectedTimer),this.iceDisconnectedTimer=null),this.publishEvent?this.publishSuccess():(this.firstGetStatsTimer&&clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null,this.firstGetStatsTimer=setTimeout(function(){var e;t.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats state "+t.state),t.state!==o.ENUM_PUBLISH_STATE.publishing&&(null===(e=t.peerConnection)||void 0===e||e.getStats().then(function(e){t.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" get first stats suc"),e.size>0&&t.publishSuccess()}))},1e3))):"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceClosed,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceFailed,this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.logger.warn(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" ice disconnected "),this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.iceDisconnected,this.iceDisconnectedTimer||(this.iceDisconnectedTimer=setTimeout(function(){t.checkPublishConnectionFailedState("disconnected")},this.iceDisconnectedMaxTime))))},e.prototype.onIceCandidate=function(e){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+e.candidate),e.candidate&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CANDIDATE+" "+this.streamId+" candidate"+e.candidate.candidate),this.state<o.ENUM_PUBLISH_STATE.connecting||this.state==o.ENUM_PUBLISH_STATE.stop?this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}):this.sendCandidateInfo([{candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex}]))},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" called"),!(e=e.filter(function(e){return e.candidate.indexOf("relay")>0}))||e.length<1?this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.dataReport.eventStart(this.streamReportSeq,"SendIceCandidate"),this.stateNego!==o.ENUM_PUBLISH_STATE_NEGO.iceConnected&&(this.stateNego=o.ENUM_PUBLISH_STATE_NEGO.sendCandidate),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+this.streamId+" stateNego:sendCandidate"),this.signal.sendCandidateInfo(o.getSeq(),this.sessionId,e,function(e,r,n){t.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate"),t.dataReport.eventEnd(t.streamReportSeq,"SendIceCandidate")},function(e,r){t.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_SEND_CANDIDATE_INFO+" "+t.streamId+" failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.dataReport.eventEndWithMsg(t.streamReportSeq,"SendIceCandidate",{error:e}),t.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError)}))},e.prototype.onConnectionStateChange=function(e){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_CONNECTION_STATE_CHANGE+" "+this.streamId+" called "+e.target.signalingState)},e.prototype.onRecvCandidateInfo=function(e,t,r){var n,i=this;if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" received "+JSON.stringify(r.infos)),this.state==o.ENUM_PUBLISH_STATE.waitingServerICE){this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.dataReport.addEvent(this.streamReportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var s=0;s<r.infos.length;s++){var l={sdpMid:r.infos[s].sdpMid,sdpMLineIndex:r.infos[s].sdpMLineIndex,candidate:r.infos[s].candidate};this.logger.debug(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+""+this.streamId+" candidate "+l.candidate),null===(n=this.peerConnection)||void 0===n||n.addIceCandidate(new RTCIceCandidate(l)).then(function(){i.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add success")},function(e){i.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+i.streamId+" add error "+e.toString()),i.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kCandidateError,!0)})}this.state=o.ENUM_PUBLISH_STATE.connecting,this.dataReport.eventStart(this.reportSeq,"IceConnected"),this.dataReport.eventStart(this.streamReportSeq,"IceConnected")}else this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CANDIDATE_INFO+" "+this.streamId+" current state "+this.state+" not allowed")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLOSE_SESSION+""+this.streamId+" "+JSON.stringify(r)),this.dataReport.addEvent(this.reportSeq,"RecvCloseSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var n=r.err_info?JSON.parse(r.err_info.toLowerCase()):{},o=n.action?n.action:null,i=1*r.reason,s=JSON.parse(JSON.stringify(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError));s.message+=" reason:"+i+" "+(o?" action:"+o:""),1011===n.err&&(s=a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaServerForbidError),1014===n.err&&(s=a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishTokenExpiredError),this.negoTimer&&clearTimeout(this.negoTimer);var l=![4,8,10,11,12,14,26,27].includes(i)&&![2,5,6].includes(o);this.publishStateUpdateError(s,l)},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" received "),t==this.sessionId){this.signal.sendCloseSessionAck(e,this.sessionId,0);var n=a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kPublishSessionClosedError;this.negoTimer&&clearTimeout(this.negoTimer),this.publishStateUpdateError(n)}else this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_RESET_SESSION+" "+this.streamId+" cannot find session")},e.prototype.onRecvPublishEvent=function(e,t,r){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_PUBLISH_EVENT+" "+this.streamId+" received"),this.publishEvent=!0,this.firstGetStatsTimer&&(clearTimeout(this.firstGetStatsTimer),this.firstGetStatsTimer=null),this.stateNego===o.ENUM_PUBLISH_STATE_NEGO.iceConnected&&0==r.event&&this.publishSuccess()},e.prototype.onRecvClientInfo=function(e,t,r){this.stateCenter.clientIP!==r.clientip&&this.logger.warn(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_RECV_CLIENT_INFO+" client ip changed "+this.stateCenter.clientIP+" "+r.clientip),this.stateCenter.clientIP=r.clientip,this.peerID=r.peer_id;var n=this.previewer;if(n&&null!==n.activateSEIConfig){var o=null==n?void 0:n.activateSEIConfig;this.activateSEIInsert(o.action,o.infoType)}},e.prototype.checkPublishConnectionFailedState=function(e){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE+" streamID "+this.streamId," state "+this.state+" connectionState "+e),this.publishStateUpdateError(a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kMediaConnectionError)},e.prototype.setPublishQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+this.streamId+" called"),this.clearPublishQualityTimer(),this.qualityTimer=setInterval(function(){e.peerConnectionGetStats()},this.qualityTimeInterval),this.lastPublishStats={audioPacketsLost:0,videoPacketsLost:0,videoPacketsSent:0,audioPacketsSent:0,audioRetransmittedPacketsSent:0,videoTime:(new Date).getTime(),audioTime:(new Date).getTime(),time:0,audioBytesSent:0,videoBytesSent:0,framesEncoded:0,framesSent:0,videoRetransmittedPacketsSent:0},this.qualitySeq=o.getSeq(),this.qualityCount=0)},e.prototype.peerConnectionGetStats=function(e){var t=this;if(this.peerConnection){var r=[this.peerConnection.getStats(null)];"chrome"==this.stateCenter.browser&&r.push(new Promise(function(e,r){var n;null===(n=t.peerConnection)||void 0===n||n.getStats(function(t){return e(t)},function(e){return r(e)})})),Promise.all(r).then(function(r){var n=t.getPublishStats(r[0],r[1]);e&&e(n,r[0],r[1])}).catch(function(e){t.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_SET_PLAYER_QUALITY_TIMER+" "+t.streamId+" getStats error "+e.toString())})}},e.prototype.getPublishStats=function(e,t){var r,n=this;if(e){for(var i,l=document.querySelectorAll("video, audio"),c=0;c<l.length;c++)l[c].srcObject===this.localStream&&(i=l[c]);var d=this.streamCenter.checkPreview(this.localStream),h={audioCodec:"opus",audioTargetBitrate:this.videoInfo.audioBitrate/1e3||0,audioBitrate:0,videoTargetBitrate:this.videoInfo.bitRate||0,videoTargetFPS:this.videoInfo.frameRate||0,videoBitrate:0,audioFPS:0,audioLevel:0,audioInputLevel:0,audioPacketsLost:0,audioPacketsLostRate:0,sendLevel:0,samplingRate:0,videoFPS:0,nackCount:0,pliCount:0,audioQuality:0,videoQuality:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoPacketsLost:0,videoPacketsLostRate:0,totalRoundTripTime:0,currentRoundTripTime:0,googBandwidthLimitedResolution:void 0,videoCodecName:"",audioCodecName:"",googCpuLimitedResolution:void 0,googAvailableSendBandwidth:0,googActualEncBitrate:0,googTargetEncBitrate:0,googFrameWidthInput:0,googFrameHeightInput:0,googFrameRateInput:0,codecImplementationName:"",videoMuteState:(null===(r=null==d?void 0:d.videoTrack)||void 0===r?void 0:r.enabled)?"0":"1",audioMuteState:this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks()[0].enabled?"0":"1",muted:i?i.muted:void 0,paused:i?i.paused:void 0,volume:i?i.volume:void 0,sinkId:i?i.sinkId:void 0},p=this.lastPublishStats.time,f=0,g=0,_=0,m=0,v=0,E=0;e.forEach(function(e){if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"audio"==e.mediaType)0!=p&&(h.audioBitrate=8*(e.bytesSent-n.lastPublishStats.audioBytesSent)/(e.timestamp-p),h.audioFPS=(e.packetsSent-(e.retransmittedPacketsSent-n.lastPublishStats.audioRetransmittedPacketsSent)-n.lastPublishStats.audioPacketsSent)/(e.timestamp-p)*1e3,_=(e.retransmittedPacketsSent-n.lastPublishStats.audioRetransmittedPacketsSent)/(e.packetsSent-n.lastPublishStats.audioPacketsSent)),h.audioBitrate<0&&(h.audioBitrate=0),n.lastPublishStats.audioBytesSent=e.bytesSent,n.lastPublishStats.time=e.timestamp,n.lastPublishStats.audioPacketsSentTimeStamp=e.packetsSent-n.lastPublishStats.audioPacketsSent,n.lastPublishStats.audioPacketsSent=e.packetsSent,n.lastPublishStats.audioRetransmittedPacketsSent=e.retransmittedPacketsSent;else if(("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"video"==e.mediaType)0!=p&&(h.videoBitrate=8*(e.bytesSent-n.lastPublishStats.videoBytesSent)/(e.timestamp-p),h.videoFPS=1e3*(e.framesEncoded-n.lastPublishStats.framesEncoded)/(e.timestamp-p),m=(e.retransmittedPacketsSent-n.lastPublishStats.videoRetransmittedPacketsSent)/(e.packetsSent-n.lastPublishStats.videoPacketsSent)),h.videoBitrate<0&&(h.videoBitrate=0),h.videoFPS<0&&(h.videoFPS=0),h.nackCount=e.nackCount,h.pliCount=e.pliCount,n.lastPublishStats.videoBytesSent=e.bytesSent,n.lastPublishStats.framesEncoded=e.framesEncoded,n.lastPublishStats.time=e.timestamp,n.lastPublishStats.videoPacketsSentTimeStamp=e.packetsSent-n.lastPublishStats.videoPacketsSent,n.lastPublishStats.videoPacketsSent=e.packetsSent,n.lastPublishStats.videoRetransmittedPacketsSent=e.retransmittedPacketsSent;else if("remote-inbound-rtp"==e.type&&"video"==e.kind){e.packetsLost>0&&(h.videoPacketsLost=e.packetsLost);var t=e.packetsLost-n.lastPublishStats.videoPacketsLost;h.videoPacketsLostRate=t>0?t/n.lastPublishStats.videoPacketsSentTimeStamp:0,e.packetsLost>0&&(n.lastPublishStats.videoPacketsLost=e.packetsLost),n.lastPublishStats.videoTime=e.timestamp,g=1e3*e.roundTripTime,E=e.jitter}else if("remote-inbound-rtp"==e.type&&"audio"==e.kind){e.packetsLost>0&&(h.audioPacketsLost=e.packetsLost);var r=e.packetsLost-n.lastPublishStats.audioPacketsLost;h.audioPacketsLostRate=r>0?r/n.lastPublishStats.audioPacketsSentTimeStamp:0,e.packetsLost>0&&(n.lastPublishStats.audioPacketsLost=e.packetsLost),n.lastPublishStats.audioTime=e.timestamp,f=1e3*e.roundTripTime,v=e.jitter}else if("media-source"==e.type&&("audio"==e.kind||e.id.toLowerCase().indexOf("audio")>=0))h.audioLevel=e.audioLevel,h.sendLevel=e.totalAudioEnergy,h.audioInputLevel=32767*e.totalAudioEnergy,h.samplingRate=e.totalSamplesDuration;else if("track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0||e.frameWidth)){if(h.frameHeight=e.frameHeight,h.frameWidth=e.frameWidth,0===p||n.lastPublishStats.frameHeight===e.frameHeight&&n.lastPublishStats.frameWidth===e.frameWidth)0===p&&(n.lastPublishStats.frameHeight=e.frameHeight,n.lastPublishStats.frameWidth=e.frameWidth);else{var i=o.getReportSeq();n.dataReport.newReport(i,a.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.event),n.dataReport.addMsgInfo(i,{session_id:a.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.session_id(n.sessionId),w:a.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.w(e.frameWidth),h:a.ZegoRTCLogEvent.kZegoTaskVideoCaptureSize.h(e.frameHeight)}),n.dataReport.uploadReport(i),n.lastPublishStats.frameHeight=e.frameHeight,n.lastPublishStats.frameWidth=e.frameWidth}0!=p&&(h.videoTransferFPS=1e3*(e.framesSent-n.lastPublishStats.framesSent)/(e.timestamp-p)),h.videoTransferFPS<0&&(h.videoTransferFPS=0),n.lastPublishStats.framesSent=e.framesSent}else"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(h.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(h.currentRoundTripTime=e.currentRoundTripTime))}),t&&t.result().forEach(function(e){"ssrc"==e.type&&e.names().indexOf("googBandwidthLimitedResolution")>=0&&(h.googBandwidthLimitedResolution=e.stat("googBandwidthLimitedResolution")),"ssrc"==e.type&&"video"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(h.videoCodecName=e.stat("googCodecName")),"ssrc"==e.type&&"audio"==e.stat("mediaType")&&e.names().indexOf("googCodecName")>=0&&(h.audioCodecName=e.stat("googCodecName")),"ssrc"==e.type&&e.names().indexOf("googCpuLimitedResolution")>=0&&(h.googCpuLimitedResolution=e.stat("googCpuLimitedResolution")),"ssrc"==e.type&&e.names().indexOf("googFrameWidthInput")>=0&&(h.googFrameWidthInput=e.stat("googFrameWidthInput")),"ssrc"==e.type&&e.names().indexOf("googFrameHeightInput")>=0&&(h.googFrameHeightInput=e.stat("googFrameHeightInput")),"ssrc"==e.type&&e.names().indexOf("googFrameRateInput")>=0&&(h.googFrameRateInput=e.stat("googFrameRateInput")),"ssrc"==e.type&&e.names().indexOf("codecImplementationName")>=0&&(h.codecImplementationName=e.stat("codecImplementationName")),"VideoBwe"==e.type&&e.names().indexOf("googAvailableSendBandwidth")>=0&&(h.googAvailableSendBandwidth=e.stat("googAvailableSendBandwidth")),"VideoBwe"==e.type&&e.names().indexOf("googActualEncBitrate")>=0&&(h.googActualEncBitrate=e.stat("googActualEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googTargetEncBitrate")>=0&&(h.googTargetEncBitrate=e.stat("googTargetEncBitrate")),"VideoBwe"==e.type&&e.names().indexOf("googRetransmitBitrate")>=0&&(h.googRetransmitBitrate=e.stat("googRetransmitBitrate"))}),"chrome"===this.stateCenter.browser&&this.handleEncBitrate(Number.parseInt(h.googTargetEncBitrate),Number.parseInt(h.googActualEncBitrate),Number.parseInt(h.googRetransmitBitrate)),g=isNaN(g)||g<0?0:g,m=isNaN(m)||m<0?0:m,E=isNaN(E)||E<0?0:E,f=isNaN(f)||f<0?0:f,_=isNaN(_)||_<0?0:_,v=isNaN(v)||v<0?0:v;var T=s.ClientUtil.getNetQuality(g,m,E),y=s.ClientUtil.getNetQuality(f,_,v);h.videoQuality=p>0?s.ClientUtil.quality2QualityGrade(T):0,h.audioQuality=p>0?s.ClientUtil.quality2QualityGrade(y):0;var S=Math.min(T,y);this.netQuality=S,p>0&&S<=o.QUALITY_CONSTANT.MiddleMinQuality&&(new Date).getTime()>this.probeTime+this.probeInterval&&(this.logger.info(u.ZEGO_WEBRTC_ACTION.PLAYER_SET_PLAYER_QUALITY_TIMER+" netQuality "+S+" start net probe"),this.probeState=o.ENUM_PROBE_STATE.tryProbe,this.streamCenter.startNetProbe(!0,this,this.gwNodeList),this.probeTime=(new Date).getTime());var C={video:{videoBitrate:h.videoBitrate,videoFPS:h.videoFPS,videoTransferFPS:h.videoTransferFPS,frameHeight:h.frameHeight,frameWidth:h.frameWidth,muteState:h.videoMuteState,videoQuality:h.videoQuality,videoPacketsLost:h.videoPacketsLost,videoPacketsLostRate:h.videoPacketsLostRate},audio:{audioBitrate:h.audioBitrate,audioCodec:h.audioCodec,muteState:h.audioMuteState,audioQuality:h.audioQuality,audioPacketsLost:h.audioPacketsLost,audioPacketsLostRate:h.audioPacketsLostRate,audioFPS:h.audioFPS},nackCount:h.nackCount,pliCount:h.pliCount,totalRoundTripTime:h.totalRoundTripTime,currentRoundTripTime:h.currentRoundTripTime};return void 0!==h.videoPacketsLost&&(C.video.videoPacketsLost=h.videoPacketsLost,C.video.videoPacketsLostRate=h.videoPacketsLostRate,C.audio.audioPacketsLost=h.audioPacketsLost,C.audio.audioPacketsLostRate=h.audioPacketsLostRate),void 0!==h.muted&&(C.muted=h.muted,C.paused=h.paused,C.volume=h.volume,C.sinkId=h.sinkId),void 0!==h.googBandwidthLimitedResolution&&(C.googBandwidthLimitedResolution=h.googBandwidthLimitedResolution,C.video.googCodecName=h.videoCodecName,C.audio.googCodecName=h.audioCodecName,C.googCpuLimitedResolution=h.googCpuLimitedResolution,C.googFrameWidthInput=h.googFrameWidthInput,C.googFrameHeightInput=h.googFrameHeightInput,C.googFrameRateInput=h.googFrameRateInput,C.codecImplementationName=h.codecImplementationName,C.googAvailableSendBandwidth=h.googAvailableSendBandwidth,C.googActualEncBitrate=h.googActualEncBitrate,C.googTargetEncBitrate=h.googTargetEncBitrate),0!==p&&(this.uploadPublishQuality(h),this.onPublishQualityUpdate(this.streamId,C,e,t)),C}},e.prototype.uploadPublishQuality=function(e){if(this.qualityUpload&&this.signal.isServerConnected()){var t=(new Date).getTime();(0==this.qualityUploadLastTime||t-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="publish",e.stream_id=this.streamId,e.timeStamp=parseInt(Math.round(t/1e3).toString()),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_UPLOAD_PUBLISH_QUALITY+" "+this.streamId+" upload"+JSON.stringify(e)),this.streamCenter.updateQuality(0,e),this.qualityUploadLastTime=t)}},e.prototype.stopPublish=function(){if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_PUBLISH+"  .1 "+this.streamId+" called"),Object.keys(this.streamCenter.publisherList).length=1)for(var e in this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==o.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.start&&(this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),t.sessionId,0),t.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.stop)}this.stopMixingAudio(),this.stopMixingBuffer(),this.stopEffect(),this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(o.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.streamReportSeq,"PublishState",{state:this.state+""}),this.dataReport.addEvent(this.streamReportSeq,"StopPublish"),this.dataReport.addMsgExt(this.streamReportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.addMsgInfo(this.streamReportSeq,{itemtype:"RTCPublishStream"}),this.dataReport.uploadReport(this.streamReportSeq,"RTCPublishStream"),this.resetPublish()},e.prototype.onPublishStateUpdate=function(e,t,r,n){},e.prototype.onPublishQualityUpdate=function(e,t,r,n){},e.prototype.onDisconnect=function(e){this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" call"),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_ON_DISCONNECT+" "+this.streamId+" websocket disconnect"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),this.publishStateUpdateError(e||a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kWebsocketDisconnectedError,!!e)},e.prototype.playEffect=function(e,t,r,n){},e.prototype.pauseEffect=function(e){},e.prototype.resumeEffect=function(e){},e.prototype.stopEffect=function(e){},e.prototype.setEffectVolume=function(e,t){},e.prototype.startMixingAudio=function(e){},e.prototype.stopMixingAudio=function(e){},e.prototype.mixingBuffer=function(e,t,r){},e.prototype.stopMixingBuffer=function(e){},e.prototype.setMixingAudioVolume=function(e,t){},e.prototype.publishSuccess=function(){var e;if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call"),this.isUpdateSDP&&this.updateSDPCallBack)return this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" "+this.streamId+" update sdp success"),this.updateSDPCallBack(0),this.updateSDPCallBack=void 0,void(this.isUpdateSDP=!1);for(var t in this.state!=o.ENUM_PUBLISH_STATE.publishing&&this.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.start,this.streamId,{code:0,message:""},!0),this.isPeer&&(this.peerFailCount=0),this.state=o.ENUM_PUBLISH_STATE.publishing,this.dataReport.eventStart(this.reportSeq,"PublishState"),this.dataReport.eventStart(this.streamReportSeq,"PublishState"),this.streamCenter.playerList){var r=this.streamCenter.playerList[t].player;r.state==o.ENUM_PLAY_STATE.playing&&r.broadcasterStatus==o.ENUM_BROADCASTER_STATUS.stop&&(this.signal&&this.signal.sendBroadcasterStatus(o.getSeq(),r.sessionId,1),r.broadcasterStatus=o.ENUM_BROADCASTER_STATUS.start)}this.setPublishQualityTimer();var n=2,i=2,s=null===(e=this.previewer)||void 0===e?void 0:e.videoTrack,a=0!==this.localStream.getAudioTracks().length&&this.localStream.getAudioTracks()[0];s&&!0===s.enabled&&(n=0),a&&!0===a.enabled&&(i=0),this.sendStreamStatus(n,i),this.streamCenter.soundLevelDelegate&&this.previewer&&this.previewer.startSoundLevel(),this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_PUBLISH_SUCCESS+" call success")},e.prototype.startSoundLevel=function(){var e;if(this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" call streamID: "+this.streamId),this.localStream&&0!=this.localStream.getAudioTracks().length)try{null===(e=this.previewer)||void 0===e||e.startSoundLevel()}catch(e){this.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" get sound level failed "+e)}else this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_START_SOUND_LEVEL+" "+this.streamId+" local stream no found")},e.prototype.stopSoundLevel=function(){var e;this.logger.info(u.ZEGO_WEBRTC_ACTION.PUBLISHER_STOP_SOUND_LEVEL+" call streamID: "+this.streamId),null===(e=this.previewer)||void 0===e||e.stopSoundLevel()},e.prototype.rebackMic=function(){var e,t=this;if(this.peerConnection&&this.micTrack instanceof MediaStreamTrack&&0==this.audioMixList.length&&0==Object.keys(this.arrayBufferMap).length&&0==this.effectList.length){var r=null===(e=this.peerConnection)||void 0===e?void 0:e.getSenders().find(function(e){var r,n;return(null===(r=e.track)||void 0===r?void 0:r.kind)===(null===(n=t.micTrack)||void 0===n?void 0:n.kind)});r&&(r.replaceTrack(this.micTrack),this.localStream.removeTrack(this.localStream.getAudioTracks()[0]),this.localStream.addTrack(this.micTrack))}},e.prototype.handleEncBitrate=function(e,t,r){var n,o=this,i=1e3*this.videoInfo.bitRate,a=0;if(t>0){this.needIncMax||this.gotMax||(this.probeCount++,t>=.75*e?(this.probeCount>=10&&this.initFitCnt>=.6*this.probeCount&&(this.gotMax=!0,this.targetRate=i),this.initFitCnt++):this.probeCount>=10&&this.initFitCnt/this.probeCount<.3&&(this.needIncMax=!0));var l=s.ClientUtil.arrAvg(this.totalBitrateArray,t,10);this.needIncMax&&(l>=1.05*i?this.targetRate>i&&(this.targetRate-=l>e?l-e:l-i,this.targetRate=Math.max(this.targetRate,i),this.targetRate=Math.min(this.targetRate,2*i),a=this.targetRate):l<.8*i&&(0===this.targetRate&&(this.targetRate=e),this.targetRate=this.targetRate>=i?this.targetRate+.08*i:1.05*this.targetRate,this.targetRate=Math.min(this.targetRate,2*i),a=this.targetRate))}if(r>0&&r<i){var c=s.ClientUtil.arrAvg(this.totalRetransRateArray,r,5);this.needIncMax?c+t>1.05*i&&(this.targetRate-=c+t-i,this.targetRate=Math.max(this.targetRate,i-c),a=this.targetRate):a=this.targetRate-c}else this.targetRate<i&&(this.targetRate=i,a=this.targetRate);if(a>0){a=s.ClientUtil.arrAvg(this.totalTargetRateArray,a,5);var d=null===(n=this.peerConnection)||void 0===n?void 0:n.getSenders().find(function(e){return e.track&&"video"===e.track.kind});if(!d)return;var h=d.getParameters();h.encodings||(h.encodings=[{}]),h.encodings[0].maxBitrate=a,d.setParameters(h).catch(function(e){o.logger.error(u.ZEGO_WEBRTC_ACTION.PUBLISHER_HANDLE_ENC_BITRATE+" "+e)})}},e.prototype.resetEncBitrate=function(){this.needIncMax=!1,this.probeCount=0,this.gotMax=!1,this.initFitCnt=0,this.targetRate=0,this.totalBitrateArray=[],this.totalTargetRateArray=[],this.totalRetransRateArray=[]},e.prototype.replacePublishedTrack=function(e,t){return void 0===t&&(t=!1),{errorCode:-1,extendedData:"should install advanced module first"}},e.prototype.sendStreamStatus=function(e,t,r){var n=this;void 0===r&&(r=0),this.camera_status=e,this.mic_status=t,r++,this.signal.sendStreamStatus(o.getSeq(),this.sessionId,e,t,this.streamId,function(){n.camera_status===e&&n.mic_status===t&&r<=1&&n.sendStreamStatus(e,t,r)})},e}();t.ZegoPublish=l},5019:function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSignal=void 0;var o=r(6706),i=r(1089),s=r(2752),a=function(){function e(e,t){this.sendDataMap={},this.sendDataList=new o.LinkedList,this.sendDataCheckOnceCount=100,this.signalSeq=0,this.pushCallback={},this.sessionInfos={},this.tryHeartbeatCount=0,this.heartbeatInterval=1e4,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.checkMessageList=["ActivateVideoPlayStreamReq","ActivateAudioPlayStreamReq","CreateSessionReq","CreateSessionWithSdpReq","ActivateSEIInsertReq","StreamStatusNotify","MediaDescUpdateReq"],this.tryConnectCount=1,this.tryConnectTimer=null,this.tryConnectInterval=3e3,this.state=o.ENUM_CONNECT_STATE.disconnect,this.tokenType=0,this.browser=this.getBrowserAndVersion(),this.platform=navigator.platform,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.logger=e,this.stateCenter=t,this.stateCenter.streamConnectTime&&(this.tryConnectInterval=this.stateCenter.streamConnectTime)}return e.prototype.getBrowserAndVersion=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+([\d\.]+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\bOPR|Edge\/([\d\.]+)/))?{name:"Opera",version:e[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/([\d+\.]+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})},e.prototype.setSessionInfo=function(e,t){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SET_SESSION_INFO+" call"),this.appid=e+"",this.userid=t},e.prototype.onDisconnect=function(e,t){},e.prototype.onUpdateHeartBeatInterval=function(e){},e.prototype.resetConnectTimer=function(){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CONNECT_TIMER+" call"),clearTimeout(this.tryConnectTimer),this.tryConnectTimer=null,this.tryConnectCount=0},e.prototype.bindWebSocketHandle=function(){var e=this;this.tryHeartbeatCount=0,this.tryConnectInterval=this.stateCenter.streamConnectTime?this.stateCenter.streamConnectTime:3e3,this.websocket.onmessage=function(t){var r=JSON.parse(t.data);e.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= ",r.header.cmd),e.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" signmsg= "+JSON.stringify(r)),r.header.appid==e.appid&&r.header.user_id===e.userid?e.handleServerPush(r):e.logger.warn(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" check header failed")},this.websocket.onclose=function(t){e.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" close msg = "+JSON.stringify(t.code?t.code:t)),e.state!=o.ENUM_CONNECT_STATE.disconnect&&(e.resetConnectTimer(),e.startConnectTimer(function(t){1008===t&&e.disconnectCallback(s.errorCodeList.TOKEN_EXPIRED)}),e.resetCheckMessage())},this.websocket.onerror=function(t){e.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_BIND_WEBSOCKET_HANDLE+" msg = "+JSON.stringify(t))}},e.prototype.resetCheckMessage=function(){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_RESET_CHECK_MESSAGE+" call"),clearTimeout(this.sendDataCheckTimer),this.sendDataCheckTimer=null;for(var e=this.sendDataList.getFirst();null!=e;)this.sendDataList.remove(e),e._data.error&&e._data.error(o.SEND_MSG_RESET,e._data.seq),e=this.sendDataList.getFirst();this.sendDataMap={}},e.prototype.handleServerPush=function(e){switch(e.header.cmd){case"LoginRsp":this.handleRespondData("LoginReq",e);break;case"CreateSessionRsp":this.handleRespondData("CreateSessionReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"CreateSessionWithSdpRsp":this.handleRespondData("CreateSessionWithSdpReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"MediaDescRsp":this.handleRespondData("MediaDescReq",e);break;case"CandidateInfoRsp":this.handleRespondData("CandidateInfoReq",e);break;case"CloseSessionRsp":this.handleRespondData("CloseSessionReq",e),this.removeSession(e.header.session_id);break;case"ClientHBRsp":this.handleRespondData("ClientHBReq",e);break;case"MediaDescPush":case"CandidateInfoPush":this.handlePushData(e);break;case"CloseSessionPush":this.handlePushData(e),this.removeSession(e.header.session_id);break;case"QualityReportRsp":this.handleRespondData("QualityReportReq",e);break;case"SessionResetPush":this.handlePushResetSessionData(e);break;case"StreamStatusNotifyPush":case"PublishEventPush":case"PlayEventPush":case"ClientInfoPush":this.handlePushData(e);break;case"ActivateVideoPlayStreamRsp":this.handleRespondData("ActivateVideoPlayStreamReq",e);break;case"ActivateAudioPlayStreamRsp":this.handleRespondData("ActivateAudioPlayStreamReq",e);break;case"NetQualityProbeRsp":this.handleRespondData("NetQualityProbeReq",e);break;case"NetQualityInfoPush":this.handlePushData(e);break;case"ActivateSEIInsertRsp":this.handleRespondData("ActivateSEIInsertReq",e);break;case"StreamStatusNotifyAck":this.handleRespondData("StreamStatusNotify",e);break;case"Peer2PeerNetStatsGetRsp":this.handleRespondData("Peer2PeerNetStatsGetReq",e);break;case"MediaDescUpdateRsp":this.handleRespondData("MediaDescUpdateReq",e);case"MediaDescUpdatePush":this.handlePushData(e)}},e.prototype.disconnectCallback=function(e){this.connectCallback&&(this.connectCallback(-1,this.server,void 0),this.connectCallback=null);var t=this.server;this.disconnectServer(),this.onDisconnect(t,e)},e.prototype.updateToken=function(){var e=this;this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_UPDATE_TOKEN+" call");var t={token:this.token,tokenType:this.tokenType,roomid:this.roomID,anchorname:this.stateCenter.anchor_info.anchor_id,sdkversion:o.PROTO_VERSION,osinfo:navigator.appVersion};if(0!=Object.keys(this.sessionInfos).length){var r=[];for(var n in this.sessionInfos){var s=parseInt(n);r.push({session_id:s,session_token:this.sessionInfos[s].token})}t.sessions=r}this.sendMessageWithCallback("LoginReq",this.stateCenter.getSeq(),0,t,function(t,r,n){if(0==n.result){e.token=n.token,e.tokenType=n.tokenType;var o={report:n.report,report_interval:n.report_interval_ms};n.negoInterval&&(e.negoInterval=n.negoInterval),n.negoTryCount&&(e.negoTryCount=n.negoTryCount),n.negoTryMaxCount&&(e.negoTryMaxCount=n.negoTryMaxCount),null!=e.connectCallback&&(e.connectCallback(0,e.server,o),e.connectCallback=null),e.checkMessageTimeout()}else null!=e.connectCallback&&(e.connectCallback(n.result,e.server,{error:n.strError}),e.connectCallback=null)},function(){null!=e.connectCallback&&(e.connectCallback(-1,e.server,void 0),e.connectCallback=null)})},e.prototype.sendMessageWithCallback=function(e,t,r,n,s,a){if(this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" call "+e),!this.websocket||1!==this.websocket.readyState)return this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" connect not establish"),void(a&&a(o.SEND_MSG_TIMEOUT,t));var u={header:this.getHeader(e,t,r),body:n};null==s&&(s=null),null==a&&(a=null);var l={seq:t,deleted:!1,cmd:e,time:(new Date).getTime(),success:s,error:a},c=this.sendDataList.push(l);this.sendDataMap[l.seq]=c;var d=JSON.stringify(u);this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" "+d),this.websocket.send(d),this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE_WITH_CALLBACK+" success")},e.prototype.getHeader=function(e,t,r){return this.globalHeader={version:"1.0.1",cmd:e,appid:this.appid+"",seq:t,user_id:this.userid,session_id:r},this.globalHeader},e.prototype.connectServer=function(e,t,r,n){var s=this;if(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+r),this.roomID=e,this.token=t,this.server=r,this.state=o.ENUM_CONNECT_STATE.connecting,this.connectCallback=n,this.websocket&&1===this.websocket.readyState)this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket is connected"),this.resetConnectTimer(),this.state=o.ENUM_CONNECT_STATE.connected;else{this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" need new websocket");try{this.websocket&&(this.logger.warn(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" close error websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.websocket=new WebSocket(this.server),this.websocket.onopen=function(){s.resetConnectTimer(),s.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket open call"),s.bindWebSocketHandle(),s.updateToken(),s.state=o.ENUM_CONNECT_STATE.connected},this.websocket.onclose=function(e){s.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket close call  "+JSON.stringify(e))},this.websocket.onerror=function(e){s.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket onerror call  "+JSON.stringify(e))}}catch(e){this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" websocket error "+e)}}this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CONNECT_SERVER+" "+this.tryConnectInterval),this.tryConnectTimer=setTimeout(function(){s.startConnectTimer(n)},this.tryConnectInterval)},e.prototype.startConnectTimer=function(e){if(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" call"),this.tryConnectCount>=o.MAX_TRY_CONNECT_COUNT)return this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" beyond "+this.server+"max limit"),void this.disconnectCallback();this.websocket&&1===this.websocket.readyState?(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_START_CONNECT_TIMER+" websocket is connected"),this.resetConnectTimer()):(this.tryConnectCount+=1,this.connectServer(this.roomID,this.token,this.server,e))},e.prototype.disconnectServer=function(){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_DISCONNECT_SERVER+" call"),this.connectCallback=null,this.resetCheckMessage(),this.resetConnectTimer(),this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.token="",this.sessionInfos={},this.tokenType=0,this.tryHeartbeatCount=0,this.tryConnectCount=0,this.state=o.ENUM_CONNECT_STATE.disconnect},e.prototype.isServerConnected=function(){return!(!this.websocket||1!==this.websocket.readyState)},e.prototype.createSession=function(e,t,r,n,s,a,u,l){void 0===s&&(s=""),void 0===a&&(a=""),this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+n);var c="";o.PROTO_VERSION.split(".").forEach(function(e,t){return c+=1==e.length&&1==t?"0"+e:e}),this.sendMessageWithCallback("CreateSessionReq",e,0,{type:t,stream_id:n,platform:this.platform,browser:this.browser.name,version:this.browser.version,app_id:this.appid,negotiate_mode:r,strAuthParam:s,sdk_version:1*c,turn_server_host:"string"==typeof a?a:""},u,l)},e.prototype.createSessionWithSdp=function(e,t,r){var n=e.seq,s=e.type,a=e.streamId,u=e.strAuthParam,l=e.sdp,c=e.serverHost,d=e.playBufLevel;this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CREATE_SESSION+" call: "+a);var h="";o.PROTO_VERSION.split(".").forEach(function(e,t){return h+=1==e.length&&1==t?"0"+e:e});var p={type:s,app_id:this.appid,stream_id:a,sdp:l,user_id:this.userid,platform:this.platform,browser:this.browser.name,sdk_vers:parseInt(h),clientIp:"",media_server_host:"string"==typeof c?c:"",strAuthParam:u};d&&(p.min_play_buf_level_ms=d),this.sendMessageWithCallback("CreateSessionWithSdpReq",n,0,p,t,r)},e.prototype.sendMediaDescUpdateReq=function(e,t,r,n,o){this.sendMessageWithCallback("MediaDescUpdateReq",e,t,{peer_id:r.peerID,type:r.type,sdp:r.sdp,width:r.width,height:r.height,framerate:r.frameRate,video_min_kpbs:r.video_min_kpbs,video_max_kpbs:r.video_max_kpbs,audio_kpbs:r.audio_kpbs,keyframe_intv:r.keyframe_intv},n,o)},e.prototype.removeSession=function(e){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_REMOVE_SESSION+" call"+e),this.sessionInfos[e]&&delete this.sessionInfos[e]},e.prototype.sendCloseSession=function(e,t,r,n,o){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_REMOVE_SESSION+" call: "+t);var s={reason:r};this.removeSession(t),this.sendMessageWithCallback("CloseSessionReq",e,t,s,n,o)},e.prototype.sendMessage=function(e,t,r,n){if(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" call "+e),this.websocket&&1===this.websocket.readyState){var o={header:this.getHeader(e,t,r),body:n},s=JSON.stringify(o);this.websocket.send(s),this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" success")}else this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MESSAGE+" connect not establish")},e.prototype.handleRespondData=function(e,t){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" call");var r=this.sendDataMap[t.header.seq];if(null!=r){var n=r._data;n.cmd!==e?this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" command is not match"):n.success&&n.success(t.header.seq,t.header.session_id,t.body),delete this.sendDataMap[t.header.seq],this.sendDataList.remove(r)}else{if("CloseSessionRsp"==t.header.cmd)return;this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_RESPOND_DATA+" cannot find data "+e)}},e.prototype.addSession=function(e,t){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ADD_SESSION+" call"+e),this.sessionInfos[e]={token:t}},e.prototype.handlePushData=function(e){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" call "+e.header.cmd+" session "+e.header.session_id);var t=this.pushCallback[e.header.cmd+e.header.session_id];t?t.callback&&t.callback(e.header.seq,e.header.session_id,e.body):this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_DATA+" no callbackData "+e.header.cmd+" session: "+e.header.session_id)},e.prototype.handlePushResetSessionData=function(e){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" call ");var t=[];if(0==e.body.cResetType)t=Object.keys(this.sessionInfos);else if(1==e.body.cResetType)for(var r=0;r<e.body.session_ids.length;r++)t.push(e.body.session_ids[r]);if(this.sendResetSessionAck(e.header.seq,0,0),0!=t.length)for(var n=0;n<t.length;n++){var o=this.pushCallback[e.header.cmd+t[n]];null==o?this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no callbackData "+t[n]):o.callback&&o.callback(e.header.seq,t[n],e.body)}else this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA+" no session to callback")},e.prototype.sendMediaDesc=function(e,t,r,n,o,s){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC+" call: "+t);var a={type:r,sdp:n.sdp};null!=n.width&&(a.width=n.width),null!=n.height&&(a.height=n.height),null!=n.frameRate&&(a.framerate=n.frameRate),null!=n.video_min_kpbs&&(a.video_min_kpbs=n.video_min_kpbs),null!=n.video_max_kpbs&&(a.video_max_kpbs=n.video_max_kpbs),null!=n.audio_kpbs&&(a.audio_kpbs=n.audio_kpbs),null!=n.keyframe_intv&&(a.keyframe_intv=n.keyframe_intv),null!=n.min_play_buf_level_ms&&(a.min_play_buf_level_ms=n.min_play_buf_level_ms),this.sendMessageWithCallback("MediaDescReq",e,t,a,o,s)},e.prototype.sendCandidateInfo=function(e,t,r,n,o){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO+" call: "+t);for(var s=[],a=0;a<r.length;a++)s.push({candidate:r[a].candidate,sdpMid:r[a].sdpMid,sdpMLineIndex:r[a].sdpMLineIndex});this.sendMessageWithCallback("CandidateInfoReq",e,t,{infos:s},n,o)},e.prototype.sendMediaDescAck=function(e,t,r){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC_ACK+" call: "+t),this.sendMessage("MediaDescAck",e,t,{result:r})},e.prototype.sendUpdateMediaDescAck=function(e,t,r,n){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_MEDIA_DESC_ACK+" call: "+t),this.sendMessage("MediaDescUpdateAck",e,t,{peer_id:n,result:r})},e.prototype.sendCandidateInfoAck=function(e,t,r){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CANDIDATE_INFO_ACK+" call: "+t),this.sendMessage("CandidateInfoAck",e,t,{result:r})},e.prototype.sendCloseSessionAck=function(e,t,r){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_CLOSE_SESSION_ACK+" call: "+t),this.sendMessage("CloseSessionAck",e,t,{result:r})},e.prototype.sendResetSessionAck=function(e,t,r){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_RESET_SESSION_ACK+" call: "+t),this.sendMessage("SessionResetAck",e,t,{result:r})},e.prototype.registerPushCallback=function(e,t,r){r&&"function"==typeof r&&(this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_REGISTER_PUSH_CALLBACK+" set callback "+t),this.pushCallback[e+t]={callback:r})},e.prototype.unregisterPushCallback=function(e,t){delete this.pushCallback[e+t]},e.prototype.checkMessageTimeout=function(){for(var e=this,t=this.sendDataList.getFirst(),r=(new Date).getTime(),n=0,s=0,a=0;null!=t&&!(t._data.time+this.sendDataTimeout>r);)if(delete this.sendDataMap[t._data.seq],this.sendDataList.remove(t),++s,-1!=this.checkMessageList.indexOf(t._data.cmd)){if(null==t._data.error||this.sendDataDropTimeout>0&&t._data.time+this.sendDataDropTimeout<r?++a:(this.logger.warn(i.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" error cmd = "+t._data.cmd),t._data.error&&t._data.error(o.SEND_MSG_TIMEOUT,t._data.seq)),++n>=this.sendDataCheckOnceCount)break;t=this.sendDataList.getFirst()}else t=this.sendDataList.getFirst();this.sendDataCheckTimer=setTimeout(function(){e.checkMessageTimeout()},this.sendDataCheckInterval),0==s&&0==a||this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_CHECK_MESSAGE_TIMEOUT+" call success, state: timeout="+s+" drop="+a)},e.prototype.sendHeartbeat=function(){var e=this;if(this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+"call tryHeartbeatCount:"+this.tryHeartbeatCount),0!=Object.keys(this.sessionInfos).length)if(this.state===o.ENUM_CONNECT_STATE.connected){if(++this.tryHeartbeatCount>o.MAX_TRY_HEARTBEAT_COUNT)return this.logger.error(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" heartbeat try limit"),void this.disconnectCallback();var t=[];for(var r in this.sessionInfos)t.push(parseInt(r));var n={session_ids:t};this.sendMessageWithCallback("ClientHBReq",this.stateCenter.getSeq(),0,n,function(t,r,n){e.heartbeatInterval!=n.hb_interval&&(e.heartbeatInterval=n.hb_interval,e.onUpdateHeartBeatInterval(n.hb_interval)),e.tryHeartbeatCount=0},function(e,t){})}else this.logger.warn(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" state error");else this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_HEARTBEAT+" no need to heartbeat")},e.prototype.QualityReport=function(e,t,r,o,s){this.logger.debug(i.ZEGO_WEBRTC_ACTION.SIGNAL_QUALITY_REPORT+" call");var a={streams:[n(n({},r),{aid:t})]};this.sendMessageWithCallback("QualityReportReq",e,t,a,o,s)},e.prototype.sendStreamStatus=function(e,t,r,n,s,a){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" call "+t);var u={mic_status:n,camera_status:r};this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_STREAM_STATUS+" stream "+(s||"")+" status "+JSON.stringify(u)),this.sendMessageWithCallback("StreamStatusNotify",e,t,u,function(){},function(e){e===o.SEND_MSG_TIMEOUT&&a&&a()})},e.prototype.ActivatePlayVideoStream=function(e,t,r,n,o){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" call");var s={active:r?0:1,layer:0};this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM+" activate video "+JSON.stringify(s)),this.sendMessageWithCallback("ActivateVideoPlayStreamReq",e,t,s,n,o)},e.prototype.ActivatePlayAudioStream=function(e,t,r,n,o){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" call");var s={active:r?0:1,layer:0};this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM+" activate audio "+JSON.stringify(s)),this.sendMessageWithCallback("ActivateAudioPlayStreamReq",e,t,s,n,o)},e.prototype.sendBroadcasterStatus=function(e,t,r){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_BROADCAST_STATUS+" call "+t),this.sendMessage("BroadcasterStatusNotify",e,t,{status:r})},e.prototype.sendNetProbe=function(e,t,r,n,o){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+t),this.sendMessageWithCallback("NetQualityProbeReq",e,t,{peer_id:r,action:1},n,o)},e.prototype.sendNetQualityInfoPushAck=function(e,t,r,n){this.logger.info(i.ZEGO_WEBRTC_ACTION.SIGNAL_SEND_NET_PROBE+" call "+t),this.sendMessage("NetQualityInfoAck",e,t,{peer_id:r,result:n})},e.prototype.activateSEIInsert=function(e,t,r,n,o,i,s){},e.prototype.getP2PNetStats=function(e,t,r,n,o){this.sendMessageWithCallback("Peer2PeerNetStatsGetReq",e,t,{peer_id:r},n,o)},e}();t.ZegoSignal=a},3409:function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenterWeb=void 0;var s=r(6706),a=r(3770),u=r(1547),l=r(5740),c=r(6706),d=r(5019),h=r(3849),p=r(6014),f=r(8493),g=r(2752),_=r(3529),m=r(2990),v=function(e){function t(t,r,n,o,i,s){var a=e.call(this)||this;return a.logger=t,a.stateCenter=r,a.dataReport=n,a.rtm=o,a.ac=i,a.mediaEleSources=s,a.testEnvironment=!1,a.heartbeatTimer=null,a.heartbeatInterval=1e4,a.qualityTimerInterval=3e3,a.previewStreamList=[],a.signalList={},a.chargeInfos={itemtype:"ChargeInfos",timestamp_begin:0,timestamp_end:0,timestamp_diff_flag:0,timestamp_diff:0,infos:[]},a.chargeInfosTimer=null,a.chargeInfosInterval=6e4,a.chargeInfoSeq=0,a.soundLevelDelegate=!1,a.soundLevelInterval=1e3,a.isPeer=!0,a.probeList={},a.isMicEnabled=!0,a.isDataChannelEnabled=!1,a.publishQualityInfos=[],a.playQualityInfos=[],a.qualityUploadTimestamp=0,a.qualityHeadTimestamp=0,a.gwNode="",a.playerList={},a.publisherList={},a.playSuccessCallBackList={},a.playErrorCallBackList={},a.tryCountConnectInterval=3e3,a.checkMessageTimeout=function(){for(var e in a.signalList)a.signalList[e].signal&&a.signalList[e].signal.checkMessageTimeout()},a.getAllInUseUrl=function(){var e=[];for(var t in a.signalList)e.push(t);return e},a.onDisconnectHandle=function(e,t){if(a.logger.info("zsc.od.0 call"),a.signalList[e]){for(var r=a.signalList[e],n=0;n<r.publishConnectedList.length;n++){var o=a.publisherList[r.publishConnectedList[n]];o&&o.publisher&&o.publisher.onDisconnect(t)}for(n=0;n<r.playConnectedList.length;n++){var i=a.playerList[r.playConnectedList[n]];i&&i.player&&i.player.onDisconnect(t)}delete a.signalList[e],a.stopSignalHeartbeat(),a.stopChargeInfosUpload(),a.stopSoundLevel()}},"PRIVATE"==a.stateCenter.type&&(a.isPeer=!1),a}return o(t,e),Object.defineProperty(t.prototype,"cameraPreviewStream",{get:function(){return this.previewStreamList.find(function(e){return"camera"===e.previewType})},enumerable:!1,configurable:!0}),t.prototype.onSignalDisconnected=function(e){},t.prototype.setQualityMonitorCycle=function(e){var t=this;return this.logger.debug("zsc.qmc.0 timeInterval "+e),0==Object.keys(this.publisherList).length?this.qualityTimerInterval=e:Object.keys(this.publisherList).forEach(function(r){t.publisherList[r].publisher.qualityTimeInterval=e,t.publisherList[r].publisher.setPublishQualityTimer()}),!0},t.prototype.setSessionInfo=function(e,t,r){this.logger.debug("zsc.ssi.0 called"),this.appid=e,this.userid=t,this.testEnvironment=r},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onUpdateHeartBeatIntervalHandle=function(e){e!=this.heartbeatInterval&&(this.logger.debug("zsc.uhb.0 update "+e),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatInterval=e,this.startSignalHeartbeat())},t.prototype.setPublishStateStart=function(e,t,r,n,o){var i,a,l=this;if(this.logger.info("zsc.pss.0 call "+t),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.0 network offline"),!1;var d=this.publisherList[t],h=this.stateCenter.reportSeqList.startPublish[t];if(this.dataReport.eventStart(h,"setPublishState"),d)return this.logger.error("zsc.pss.0 publisher already exist"),this.dataReport.eventEndWithMsgInfo(h,"setPublishState",{message:"publisher already exist"}),this.dataReport.uploadReport(h,void 0,_.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kIsPublishing),delete this.stateCenter.reportSeqList.startPublish[t],!1;var g=new u.ZegoPublish(t,this.logger,this.dataReport,this.qualityTimerInterval,this,this.ac,this.mediaEleSources,this.stateCenter,r);g.state=c.ENUM_PUBLISH_STATE.start,g.isPeer=this.isPeer,g.reportSeq=this.stateCenter.reportSeqList.startPublish[t];var m=g.previewer,v=null===(i=null==m?void 0:m.videoTrack)||void 0===i?void 0:i.label,E=r.getAudioTracks()[0]&&r.getAudioTracks()[0].label,T=null===(a=null==m?void 0:m.videoTrack)||void 0===a?void 0:a.getSettings().deviceId,y=r.getAudioTracks()[0]&&r.getAudioTracks()[0].getSettings().deviceId,S=new p.RetryStreamHandler(this.logger,this.stateCenter,this,!0);return this.publisherList[t]={seq:0,room:e,localStream:r,publisher:g,serverUrls:[],ttl:0,isCenterNode:!0,streamID:t,publishOption:n,cameraLabel:v||"",microLabel:E||"",cameraDeviceId:T||"",microDeviceId:y||"",deviceStateCount:0,retryStreamHandler:S,retryDispatchHandler:new f.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this),isDataChannel:o},g.onPublishStateUpdate=function(e,r,n,o){var i=l.publisherList[r];i?S.publishStateHandle(e,i.streamID,n,o):l.logger.error("zsc.psuh.0 cannot find publish "+t)},g.onPublishQualityUpdate=function(e,r){var n=l.publisherList[e];n?(l.stateCenter.deviceStateOut&&0===r.audio.audioBitrate?(n.deviceStateCount++,n.deviceStateCount>=2&&(n.deviceStateCount=0,l.stateCenter.deviceStateOut=!1,l.logger.warn("zsc.pss.0 publish audio error by device"))):n.deviceStateCount=0,l.onPublishQualityUpdate(n.streamID,r)):l.logger.error("zsc.psuh.0 cannot find publish "+t)},this.dataReport.eventStart(g.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(g.streamReportSeq,"GetSignalUrl"),!0},t.prototype.startPublishingStream=function(e){this.logger.info("zsc.sps.0 call");var t=this.publisherList[e];if(!t)return this.logger.error("zsc.sps.0 publisher don't exist"),!1;var r=t.publisher;if(this.dataReport.eventEndWithMsg(r.reportSeq,"GetSignalUrl",{urls:t.serverUrls,is_center:t.isCenterNode}),this.dataReport.eventEndWithMsg(r.streamReportSeq,"GetSignalUrl",{urls:t.serverUrls,is_center:t.isCenterNode}),!t.serverUrls||0===t.serverUrls.length)return t.retryStreamHandler.publishStateHandle(c.ENUM_PUBLISH_STATE_UPDATE.error,e,g.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.0 server don't have signal url"),!1;var n=t.serverUrls.indexOf(this.server);-1!==n&&(t.serverUrls.splice(n,1),t.serverUrls.unshift(this.server));var o=t.retryStreamHandler;return o.invalid(),o.init(this.stateCenter.streamRetryTime),o.initStream(e,t.serverUrls),o.activePublish(0)},t.prototype.updateWaitingList=function(e,t,r,n,o){t?e.publishWaitingList.push({streamID:r,success:n,error:o}):e.playWaitingList.push({streamID:r,success:n,error:o})},t.prototype.publishStream=function(e){var t=this.publisherList[e].publisher;if(t){var r=null,n=null,o=this.publisherList[e].publishOption,i=this.checkPreview(this.publisherList[e].localStream);i?(r=i.localStream,n=i.videoInfo,this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.startPublish[e],{cap_w:_.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_w(i.videoInfo.width),cap_h:_.ZegoRTCLogEvent.kZegoTaskPublishStart.cap_h(i.videoInfo.height),w:_.ZegoRTCLogEvent.kZegoTaskPublishStart.w(i.videoInfo.width),h:_.ZegoRTCLogEvent.kZegoTaskPublishStart.h(i.videoInfo.height),video_en_fps:_.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_fps(i.videoInfo.frameRate),video_en_bps:_.ZegoRTCLogEvent.kZegoTaskPublishStart.video_en_bps(i.videoInfo.bitRate)}),r?(this.logger.info("zsc.ps.0 call success"),t.gwNodeTTL<(new Date).getTime()&&!this.gwNode?(t.gwNode="",t.gwNodeList=[],t.gwNodeTTL=0):this.gwNode&&(t.gwNode=this.gwNode),t.startPublish(e,r,n,i.mediaStreamConfig,o)):this.logger.error("zsc.ps.0 no localStream found")):this.logger.error("zsc.ps.0 no preview found")}else this.logger.info("zsc.ps.0 publisher don't exist")},t.prototype.connectPublishServer=function(e,t){var r=this,n=this.publisherList[e];return n?(this.dataReport.eventStart(n.publisher.reportSeq,"ConnectServer"),this.dataReport.eventStart(n.publisher.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(e,!0,t,function(e,t,n){var o=r.publisherList[e];if(o){var i=o.publisher;if(i){r.dataReport.eventEndWithMsg(i.reportSeq,"ConnectServer",{result:0,server:n}),r.dataReport.eventEndWithMsg(i.streamReportSeq,"ConnectServer",{result:0,server:n});var s=t.tokenInfo;r.logger.info("zsc.cps.0 update token success"),s&&s.report&&(i.qualityUpload=s.report,i.qualityUploadInterval=s.report_interval),i.signal=t.signal,r.server=n,r.publishStream(e),r.getTokenSuccess()}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")},function(e,t){r.logger.error("zsc.cps.0 "+e+" connect fail "+t);var n=r.publisherList[e];if(n){var o=n.publisher;if(o){r.dataReport.eventEndWithMsg(o.reportSeq,"ConnectServer",{result:t}),r.dataReport.uploadReport(o.reportSeq),delete r.stateCenter.reportSeqList.startPublish[e];var s=i({},g.errorCodeList.CONNECT_FAILED);s.message=s.message+" "+t,1008===t&&(s=g.errorCodeList.TOKEN_EXPIRED),n.retryStreamHandler.publishStateHandle(c.ENUM_PUBLISH_STATE_UPDATE.error,e,s,1008==t)}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")}),!0):(this.logger.error("zsc.cps.0 publisher don't exist"),!1)},t.prototype.getTokenSuccess=function(){this.logger.debug("zsc.gts.0 call")},t.prototype.stopPublishingStream=function(e){var t=this.publisherList[e];if(t){var r=t.retryStreamHandler;for(var n in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[n].publishWaitingList=this.signalList[n].publishWaitingList.filter(function(t){return t.streamID!==e});delete this.publisherList[e],t.publisher&&(t.publisher.stopPublish(),delete t.publisher),this.removeStreamFromSignal(!0,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),this.logger.debug("zsc.sps.0.1 call success")}else this.logger.warn("zsc.sps.0.1 publisher don't exist")},t.prototype.connectWithReuseSignalServer=function(e,t,r,n,o){var i=this;this.logger.info("zsc.crss.0 begin "+r);var s=null;if(this.signalList[r])(s=this.signalList[r]).state==c.ENUM_SIGNAL_STATE.connected?(this.logger.info("zsc.crss.0 already connected "+r+" streamId: "+e),t?s.publishConnectedList.push(e):s.playConnectedList.push(e),n(e,s,r)):s.state==c.ENUM_SIGNAL_STATE.connecting&&(this.logger.info("zsc.crss.0 signal is connecting "+r+" streamId: "+e),this.updateWaitingList(s,t,e,n,o));else{this.logger.info("zsc.crss.0 new signal "+r+" streamId: "+e);var a=new d.ZegoSignal(this.logger,this.stateCenter);a.setSessionInfo(this.appid,this.userid),a.onUpdateHeartBeatInterval=this.onUpdateHeartBeatIntervalHandle.bind(this),a.onDisconnect=this.onDisconnectHandle;var u=this.publisherList[e]?this.publisherList[e]:this.playerList[e]?this.playerList[e]:null,l=null==u?void 0:u.retryStreamHandler;if(this.stateCenter.streamConnectTime)a.tryConnectInterval=this.stateCenter.streamConnectTime;else if(l&&l.retryActiveCount){var h=l.retryActiveCount*(l.retryActiveCount-1)/2+2;a.tryConnectInterval=1e3*(h=h>c.MAX_RETRY_CONNECT_INTERVAL?c.MAX_RETRY_CONNECT_INTERVAL:h)}this.signalList[r]={signal:a,state:c.ENUM_SIGNAL_STATE.connecting,publishWaitingList:[],playWaitingList:[],publishConnectedList:[],playConnectedList:[],tokenInfo:null},this.updateWaitingList(this.signalList[r],t,e,n,o);var p=null==u?void 0:u.room.token,f=null==u?void 0:u.room.roomID;this.logger.info("zsc.crss.0 "+p),a.connectServer(f||this.stateCenter.roomList[0].roomID,p||this.stateCenter.roomList[0].token,r,function(e,t,n){s=i.signalList[r];var o,a,u=0;if(0!=e){for(i.logger.info("zsc.crss.0 connect failed "+t),u=0;u<s.publishWaitingList.length;u++)(o=s.publishWaitingList[u]).error&&o.error(o.streamID,e);for(u=0;u<s.playWaitingList.length;u++)(a=s.playWaitingList[u]).error&&a.error(a.streamID,e);delete i.signalList[r]}else{for(i.logger.debug("zsc.crss.0 connected success "+t),s.state=c.ENUM_SIGNAL_STATE.connected,s.tokenInfo=n,u=0;u<s.publishWaitingList.length;u++)(o=s.publishWaitingList[u]).success&&o.success(o.streamID,s,t),s.publishConnectedList.push(o.streamID);for(u=0;u<s.playWaitingList.length;u++)(a=s.playWaitingList[u]).success&&a.success(a.streamID,s,t),s.playConnectedList.push(a.streamID);s.publishWaitingList=[],s.playWaitingList=[],null==i.heartbeatTimer&&i.startSignalHeartbeat(),null==i.chargeInfosTimer&&i.startChargeInfosUpload(),i.activeSoundLevel()}})}},t.prototype.setPlayStateStart=function(e,t,r){var n=this;if(this.logger.info("zsc.pss.1 call "+e),this.stateCenter.networkState==s.ENUM_NETWORK_STATE.offline)return this.logger.error("zsc.pss.1 network offline"),!1;var o=this.playerList[e],i=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(i,"setPlayState"),o)return this.logger.error("zsc.pss.1 player already exist"),this.dataReport.eventEndWithMsgInfo(i,"setPlayState",{message:"player already exist"}),this.dataReport.uploadReport(i,void 0,_.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kIsPlaying),delete this.stateCenter.reportSeqList.startPlay[e],!1;var a=this.getPlayRoom(e)||this.stateCenter.roomList[0];if(!a)return this.logger.error("zsc.pss.1 not login room"),this.dataReport.eventEndWithMsgInfo(i,"setPlayState",{message:"not login room"}),this.dataReport.uploadReport(i,void 0,_.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError),!1;var u=new h.ZegoPlayWeb(this.logger,null,this.dataReport,this.qualityTimerInterval,this,this.ac,this.stateCenter);t&&[0,2,3].includes(t.resourceMode)&&(u.resourceMode=t.resourceMode),this.dataReport.addMsgInfo(i,{resourceMode:u.resourceMode,play_room_id:a.roomID,isMulti:this.stateCenter.isMultiRoom}),u.state=c.ENUM_PLAY_STATE.start,u.isPeer=this.isPeer,u.reportSeq=this.stateCenter.reportSeqList.startPlay[e],u.beginTime=(new Date).getTime();var l=new p.RetryStreamHandler(this.logger,this.stateCenter,this,!1);return this.playerList[e]={seq:0,room:a,player:u,signal:null,serverUrls:[],ttl:0,isCenterNode:!0,streamID:e,playOption:t,retryStreamHandler:l,retryDispatchHandler:new f.RetryDispatchHandler(this.logger,this.stateCenter,this.rtm,this),isDataChannel:r},u.onPlayStateUpdate=function(e,t,r,o){var i=n.playerList[t];i?l.playStateHandle(e,i.streamID,r,o):n.logger.error("zsc.pss.1 cannot find play "+t)},u.onPlayQualityUpdate=function(e,t){var r=n.playerList[e];r?n.onPlayQualityUpdate(r.streamID,t):n.logger.error("zsc.pss.1 cannot find play "+e)},u.onRemoteCameraStatusUpdate=function(e,t,r){var o=n.playerList[e];o?n.onRemoteCameraStatusUpdate(o.streamID,t,r):n.logger.error("zsc.pss.1 cannot find play "+e)},u.onRemoteMicStatusUpdate=function(e,t,r){var o=n.playerList[e];o?n.onRemoteMicStatusUpdate(o.streamID,t,r):n.logger.error("zsc.pss.1 cannot find play "+e)},this.dataReport.eventStart(u.reportSeq,"GetSignalUrl"),this.dataReport.eventStart(u.streamReportSeq,"GetSignalUrl"),!0},t.prototype.onRemoteMicStatusUpdate=function(e,t,r){},t.prototype.onRemoteCameraStatusUpdate=function(e,t,r){},t.prototype.startPlayingStream=function(e,t){this.logger.info("zsc.sps.1 start play called");var r=this.playerList[e];if(!r)return this.logger.error("zsc.sps.1 player don't exist"),!1;var n=r.player;if(this.dataReport.eventEndWithMsg(n.reportSeq,"GetSignalUrl",{urls:r.serverUrls}),this.dataReport.eventEndWithMsg(n.streamReportSeq,"GetSignalUrl",{urls:r.serverUrls}),0==r.serverUrls.length)return r.retryStreamHandler.playStateHandle(c.ENUM_PLAY_STATE_UPDATE.error,e,g.errorCodeList.DISPATCH_ERROR),this.logger.info("zsc.sps.1 server don't have signal url"),!1;var o=r.serverUrls.indexOf(this.server);-1!==o&&(r.serverUrls.splice(o,1),r.serverUrls.unshift(this.server));var i=r.retryStreamHandler;return i.invalid(),i.init(this.stateCenter.streamRetryTime),i.initStream(e,r.serverUrls),i.activePull(0,t)},t.prototype.connectPlayServer=function(e,t,r){var n=this,o=this.playerList[e];return o?(this.dataReport.eventStart(o.player.reportSeq,"ConnectServer"),this.dataReport.eventStart(o.player.streamReportSeq,"ConnectServer"),this.connectWithReuseSignalServer(e,!1,r,function(e,r,o){var i=n.playerList[e];if(i){var s=i.player;if(s){n.dataReport.eventEndWithMsg(s.reportSeq,"ConnectServer",{result:0,server:o}),n.dataReport.eventEndWithMsg(s.streamReportSeq,"ConnectServer",{result:0,server:o});var a=r.tokenInfo;n.logger.info("zsc.cps.1 update token success"),a&&a.report&&(s.qualityHandler.qualityUpload=a.report,s.qualityHandler.qualityUploadInterval=a.report_interval),s.signal=r.signal,n.server=o,n.playStream(e,t),n.getTokenSuccess()}else n.logger.error("zsc.cps.1 checkplayer don't exist")}else n.logger.error("zsc.cps.1 after connect player don't exist")},function(t,r){var o=n.playerList[t];if(o){n.dataReport.eventEndWithMsg(o.player.reportSeq,"ConnectServer",{result:r}),!o.player.isProbe&&n.dataReport.uploadReport(o.player.reportSeq),delete n.stateCenter.reportSeqList.startPlay[e];var s=i({},g.errorCodeList.CONNECT_FAILED);s.message=s.message+" "+r,1008===r&&(s=g.errorCodeList.TOKEN_EXPIRED),o.retryStreamHandler.playStateHandle(c.ENUM_PLAY_STATE_UPDATE.error,t,s,1008==r)}else n.logger.error("zsc.cps.1 after connect player don't exist")}),!0):(this.logger.error("zsc.cps.1 player don't exist"),!1)},t.prototype.playStream=function(e,t){var r=this.playerList[e].player;r?(this.logger.info("zsc.ps.1 call success"),r.gwNodeTTL<(new Date).getTime()&&!this.gwNode?(r.gwNode="",r.gwNodeList=[],r.gwNodeTTL=0):this.gwNode&&(r.gwNode=this.gwNode),r.startPlay(e,t,this.playerList[e].playOption)):this.logger.warn("zsc.ps.1 player don't exist")},t.prototype.stopSignalHeartbeat=function(){this.logger.debug("zsc.ssh.1 call");var e=0;for(var t in this.signalList)e+=1;this.heartbeatTimer&&0==e&&(this.logger.info("zsc.ssh.1 stop"),clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},t.prototype.removeStreamFromSignal=function(e,t){var r=[];for(var n in this.signalList){var o=this.signalList[n];if(e){for(var i=0;i<o.publishConnectedList.length;i++)if(o.publishConnectedList[i]===t){this.logger.debug("zsc.rsfs.0 found from publish"),o.publishConnectedList.splice(i,1);break}for(i=0;i<o.publishWaitingList.length;i++)if(o.publishWaitingList[i].streamID===t){this.logger.debug("zsc.rsfs.0 found from publish"),o.publishWaitingList.splice(i,1);break}}else{for(var s=0;s<o.playConnectedList.length;s++)if(o.playConnectedList[s]===t){this.logger.debug("zsc.rsfs.0 found from play"),o.playConnectedList.splice(s,1);break}for(s=0;s<o.playWaitingList.length;s++)if(o.playWaitingList[s].streamID===t){this.logger.debug("zsc.rsfs.0 found from play"),o.playWaitingList.splice(s,1);break}}0==o.publishConnectedList.length&&0==o.playConnectedList.length&&0==o.publishWaitingList.length&&0==o.playWaitingList.length&&(o.signal.disconnectServer(),r.push(n))}for(var a=0;a<r.length;a++)delete this.signalList[r[a]],this.server==r[a]&&(this.server="")},t.prototype.stopPlayingStream=function(e){var t=this.playerList[e];if(t){var r=t.retryStreamHandler;for(var n in r&&(r.stopMaxTime(),r.invalid()),this.signalList)this.signalList[n].playWaitingList=this.signalList[n].playWaitingList.filter(function(t){return t.streamID!==e});delete this.playerList[e],t.player&&(t.player.stopPlay(),delete t.player),this.removeStreamFromSignal(!1,e),this.stopSignalHeartbeat(),this.stopChargeInfosUpload(),this.stopSoundLevel(),delete this.playSuccessCallBackList[e],delete this.playErrorCallBackList[e],this.logger.debug("zsc.sps.1.1 call success")}else this.logger.info("zsc.sps.1.1 player don't exist")},t.prototype.reset=function(e){for(var t in this.publisherList)(this.publisherList[t].room.roomID==e||!e)&&this.stopPublishingStream(t);var r=function(t){var r=n.playerList[t].room;if(r.roomID!=e||!r.streamList.find(function(e){return e.stream_id==t})&&1!=n.stateCenter.roomList.length){if(r.roomID==e&&n.stateCenter.roomList.length>1){var o=n.stateCenter.roomList.find(function(t){return t.roomID!==e});o?n.playerList[t].room=o:n.stopPlayingStream(t)}}else n.stopPlayingStream(t)},n=this;for(var o in this.playerList)r(o);0==Object.keys(this.publisherList).length&&0==Object.keys(this.playerList).length&&(this.probeList={}),this.publishQualityInfos=[],this.playQualityInfos=[],this.qualityHeadTimestamp=0,this.qualityUploadTimestamp=0,this.qualityWebsocket&&(this.qualityWebsocket.close(),this.qualityWebsocket=void 0)},t.prototype.startSignalHeartbeat=function(){var e=this;this.logger.debug("zsc.ssh.0 call"),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatTimer=setTimeout(function(){e.checkSignalHeartbeat()},this.heartbeatInterval)},t.prototype.startChargeInfosUpload=function(){var e=this;this.logger.debug("zsc.sciu.0 call"),this.chargeInfosTimer&&(clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null),this.chargeInfosTimer=setTimeout(function(){e.checkChargeInfos()},this.chargeInfosInterval)},t.prototype.checkChargeInfos=function(){this.logger.debug("zsc.cci.0 call");var e={is_publishing:0,play_max_audio_bitrate:0,play_stream_resolution_infos:[]};for(var t in this.chargeInfos.timestamp_begin=(new Date).getTime(),this.publisherList){this.publisherList[t].publisher.state===c.ENUM_PUBLISH_STATE.publishing&&(e.is_publishing=1);break}e.play_max_audio_bitrate=0;var r=function(t){var r=n.playerList[t].player.playStream,o=r&&0!==r.getVideoTracks().length?r.getVideoTracks()[0].getSettings():void 0,i={video_width:o&&o.width?o.width:0,video_height:o&&o.height?o.height:0,count:1};if(!e.play_stream_resolution_infos.find(function(e){return e.video_width==i.video_width&&e.video_height==i.video_height&&(e.count++,!0)})&&e.play_stream_resolution_infos.push(i),0==i.video_width&&0==i.video_height){var s=1e3*n.playerList[t].player.qualityHandler.lastPlayStats.audioBitrate;s>e.play_max_audio_bitrate&&(e.play_max_audio_bitrate=s)}},n=this;for(var o in this.playerList)r(o);0!==this.chargeInfos.timestamp_end?(this.chargeInfos.timestamp_diff=this.chargeInfos.timestamp_begin-this.chargeInfos.timestamp_end,this.chargeInfos.timestamp_diff_flag=1):(this.chargeInfos.timestamp_diff=0,this.chargeInfos.timestamp_diff_flag=0),this.chargeInfos.timestamp_end=(new Date).getTime(),this.chargeInfos.infos=[e],0!==e.play_stream_resolution_infos.length&&this.logger.report(this.chargeInfos),this.chargeInfosTimer&&this.startChargeInfosUpload()},t.prototype.checkSignalHeartbeat=function(){for(var e in this.logger.debug("zsc.csh.0 call"),this.signalList)this.signalList[e].signal&&this.signalList[e].signal.sendHeartbeat();this.heartbeatTimer&&this.startSignalHeartbeat()},t.prototype.stopChargeInfosUpload=function(){this.logger.debug("zsc.sciu.0 call");var e=0;for(var t in this.signalList)e+=1;this.chargeInfosTimer&&0==e&&(this.logger.info("zsc.sciu.0 stop"),clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null)},t.prototype.getPublisher=function(e){var t=null;return this.publisherList[e]&&this.publisherList[e].publisher&&(t=this.publisherList[e].publisher),t},t.prototype.checkPreview=function(e){for(var t=0;t<this.previewStreamList.length;t++)if(this.previewStreamList[t].localStream===e)return this.previewStreamList[t];return null},t.prototype.checkPublish=function(e){for(var t in this.publisherList)if(this.publisherList[t].localStream==e)return this.publisherList[t];return null},t.prototype.removePreview=function(e){for(var t=0;t<this.previewStreamList.length;t++)if(this.previewStreamList[t]===e){this.previewStreamList.splice(t,1);break}},t.prototype.onPlayerStreamUrlUpdate=function(e,t,r){},t.prototype.getScreenConstrains=function(e){var t={};if("boolean"==typeof e&&e)t={audio:!1,frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:this.stateCenter.settingConfig.getSetting("screen_video_bitrate")||c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};else if("object"==typeof e){switch(e.videoQuality){case 1:t={frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.LOW.frameRate,bitRate:c.ENUM_SCREEM_RESOLUTION_TYPE.LOW.bitRate};break;case 3:t={frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.frameRate,bitRate:c.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.bitRate};break;case 4:t={frameRate:e.frameRate,bitRate:e.bitRate,width:e.width,height:e.height};break;case 2:t={frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};break;default:t={frameRate:c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:this.stateCenter.settingConfig.getSetting("screen_video_bitrate")||c.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate}}t.audio="boolean"==typeof e.audio&&e.audio,t=i(i({},e),t)}return t},t.prototype.createScreenPreviewer=function(e,t){var r=new a.ZegoPreview(this.logger,this.ac,this.stateCenter,this,"screen"),n=e.getVideoTracks()[0].getSettings();return this.previewStreamList.push(r),r.mediaStreamConfig=t,e.getAudioTracks().length>0&&(r.audioTrack=e.getAudioTracks()[0]),r.localStream=e,r.videoInfo={width:n.width,height:n.height,frameRate:n.frameRate||15,bitRate:(null==t?void 0:t.bitRate)||1e3,startBitrate:(null==t?void 0:t.startBitrate)||this.stateCenter.settingConfig.getSetting("bitrate_mode")},r.previewSuc=!0,r.previewType="screen",(null==t?void 0:t.videoOptimizationMode)&&this.setVideoTrackContentHint(e,null==t?void 0:t.videoOptimizationMode),r},t.prototype.setSoundLevelDelegate=function(e,t){for(var r in this.logger.info("zsc.ssd.0 call"),t&&(this.soundLevelInterval=t),this.soundLevelDelegate=e,this.previewStreamList){var n=this.previewStreamList[r];e?n.startSoundLevel():n.stopSoundLevel()}for(var r in this.playerList){var o=this.playerList[r].player;e?o.startSoundLevel():o.stopSoundLevel()}e?(this.logger.info("zsc.ssd.0 start getting sound"),this.activeSoundLevel()):(this.logger.info("zsc.ssd.0 stop getting sound"),this.soundLevelTimer&&clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null,this.soundLevelInterval=1e3)},Object.defineProperty(t.prototype,"hasRemoteStream",{get:function(){return Object.keys(this.signalList).length>0},enumerable:!1,configurable:!0}),t.prototype.activeSoundLevel=function(){!this.soundLevelTimer&&this.soundLevelDelegate&&this.startSoundLevel()},t.prototype.startSoundLevel=function(){var e=this;this.soundLevelTimer&&(clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null),this.soundLevelDelegate&&(this.hasRemoteStream&&this.checkSoundLevel(),this.checkMicSoundLevel(),this.soundLevelTimer=setTimeout(function(){e.startSoundLevel()},this.soundLevelInterval))},t.prototype.checkSoundLevel=function(){this.logger.debug("zsc.csl.0 call");var e=[];for(var t in this.publisherList){var r=0,n=this.publisherList[t].publisher,o=n.previewer;o&&(r=o.soundLevel),e.push({streamID:this.getBackStreamId(n.streamId),soundLevel:r,type:"push"})}for(var t in this.playerList){var i=this.playerList[t].player;i.streamId&&!i.isProbe&&e.push({streamID:this.getBackStreamId(i.streamId),soundLevel:i.soundLevel,type:"pull"})}this.soundLevelDelegate&&e.length>0&&this.onSoundLevelUpdate(e)},t.prototype.checkMicSoundLevel=function(){this.cameraPreviewStream&&this.soundLevelDelegate&&this.onMicSoundLevelUpdate(this.cameraPreviewStream.soundLevel)},t.prototype.getBackStreamId=function(e){return this.testEnvironment&&e?e.replace("zegotest-"+this.appid+"-",""):e},t.prototype.onSoundLevelUpdate=function(e){},t.prototype.onMicSoundLevelUpdate=function(e){},t.prototype.stopSoundLevel=function(){this.soundLevelTimer&&!this.hasRemoteStream&&0===this.previewStreamList.length&&(this.logger.info("zsc.ssl.0 stop"),clearTimeout(this.soundLevelTimer),this.soundLevelTimer=null)},t.prototype.startNetProbe=function(e,t,r){var n=this,o=s.getReportSeq();if(this.dataReport.newReport(o,_.ZegoRTCLogEvent.kZegoNetProbe.event),this.isPeer){var i=!0;0==r.length&&(i=!1,r=e?this.publisherList[t.streamId].serverUrls:this.playerList[t.streamId].serverUrls),r.forEach(function(r){if(!(n.probeList[r]&&n.probeList[r].timeStamp+9e5<(new Date).getTime()||t.probeState==c.ENUM_PROBE_STATE.probed)){var o="zegoprobe-"+(new Date).getTime();n.setPlayStateStart(o);var s=n.playerList[o]?n.playerList[o].player:null;s&&(s.isProbe=!0,i?(s.gwNode=r,s.signal=t.signal,s.startPlay(o,function(){})):n.connectPlayServer(o,function(){},r),s.onCalNetQualityResult=function(i,a){n.logger.info("zc.ocnqr.0 "+s.gwNode+" "+i+" "+a),n.probeList[r]={result:i,netQuality:a,timeStamp:(new Date).getTime()},t.gwNode==r||t.signal.server==r?t.netQuality=a:n.handleCalNetQualityResult(e,i,a,t,r),n.stopPlayingStream(o)})}}),this.dataReport.addMsgInfo(o,{netQuality:t.netQuality,nodeList:r}),this.dataReport.uploadReport(o)}else this.dataReport.uploadReport(o,void 0,{code:-1,message:"not support peer"})},t.prototype.handleCalNetQualityResult=function(e,t,r,n,o){if(this.logger.info("zc.hcqr.0 "+n.netQuality+" probe "+r+" "+o),0===t){var i=s.getReportSeq();this.dataReport.newReport(i,_.ZegoRTCLogEvent.kZegoNetProbeResult.event);var a=!1;if(r>Math.max(75,n.netQuality+20)&&n.probeState==c.ENUM_PROBE_STATE.tryProbe)if(a=!0,e){var u=n,l=u.streamId,d=u.localStream,h=u.videoInfo,p=u.mediaStreamConfig,f=u.publishOption;0!=u.sessionId&&u.signal&&u.shouldSendCloseSession()&&(u.signal.sendCloseSession(this.stateCenter.getSeq(),u.sessionId,1),u.signal.removeSession(u.sessionId),u.closeSessionSignal=!0),u.resetPublish(),this.publisherList[l].isCenterNode?(u.gwNode=o,u.startPublish(l,d,h,p,f)):this.connectPublishServer(l,o)}else{var g=n,m=(l=g.streamId,g.getRemoteStreamSuc),v=g.playOption;0!=g.sessionId&&g.signal&&g.shouldSendCloseSession()&&(g.signal.sendCloseSession(this.stateCenter.getSeq(),g.sessionId,1),g.signal.removeSession(g.sessionId),g.closeSessionSignal=!0),g.resetPlay(),this.playerList[l].isCenterNode?(g.gwNode=o,g.startPlay(l,m,v)):this.connectPlayServer(l,m,o)}else a=!1,this.logger.warn("zc.hcqr.0 "+n.netQuality+" probe "+r+" "+o);this.dataReport.addMsgInfo(i,{isSwitch:a,isPublish:e,streamID:n.streamId,result:t,node:o,netQuality:n.netQuality,probeNetQuality:r}),this.dataReport.uploadReport(i),n.probeState=c.ENUM_PROBE_STATE.probed}},t.prototype.getRoomByStreamID=function(e){return this.publisherList[e]?this.publisherList[e].room:this.playerList[e]?this.playerList[e].room:void 0},t.prototype.setVideoTrackContentHint=function(e,t){if("string"==typeof t){var r=t.toLowerCase();if(["default","motion","detail","text"].includes(r)){var n=e.getVideoTracks()[0];n?"contentHint"in n?(this.logger.info("zc.svtch "+r),n.contentHint="default"==r?"":r):this.logger.warn("zc.svtch mediaStreamTrack contentHint attribute not supported"):this.logger.warn("zc.svtch video track no found")}else this.logger.warn("zc.svtch videoOptimizationMode wrong")}else this.logger.warn("zc.svtch videoOptimizationMode type wrong")},t.prototype.getPlayRoom=function(e){return this.stateCenter.roomList.find(function(t){return!!t.streamList.find(function(t){return t.stream_id==e})})},t.prototype.getQualityHead=function(e,t){var r=new Uint8Array(12);r[0]=0,r[1]=12,r[2]=e.length>>8,r[3]=e.length-(r[2]<<8),r[4]=t.length>>24,r[5]=t.length-(r[4]<<24)>>16,r[6]=t.length-(r[4]<<24)-(r[5]<<16)>>8,r[7]=t.length-(r[4]<<24)-(r[5]<<16)-(r[6]<<8);var n=Math.ceil((new Date).getTime()/1e3);return r[8]=n>>24,r[9]=n-(r[8]<<24)>>16,r[10]=n-(r[8]<<24)-(r[9]<<16)>>8,r[11]=n-(r[8]<<24)-(r[9]<<16)-(r[10]<<8),r},t.prototype.streamQualityUpload=function(){var e,t=this;if(Object.keys(this.publisherList).length>0||Object.keys(this.playerList).length>0){var r={publish_quality_infos:this.publishQualityInfos,play_quality_infos:this.playQualityInfos},n=m.logreport.SpeedLogHead.create({version:1,timestamp:this.qualityHeadTimestamp,event:0,app_id:this.stateCenter.appid,user_id:this.stateCenter.idName,biz_type:1}),o=m.logreport.QualityEvent.create(r),i=m.logreport.SpeedLogHead.encode(n).finish(),s=m.logreport.QualityEvent.encode(o).finish(),a=this.getQualityHead(i,s),u=new Uint8Array(12+i.length+s.length);u.set(a),u.set(i,12),u.set(s,12+i.length);var l=null===(e=this.logger.url)||void 0===e?void 0:e.split("/")[2];if(!l)return;if(this.qualityWebsocket&&2!=this.qualityWebsocket.readyState&&3!=this.qualityWebsocket.readyState)1==this.qualityWebsocket.readyState&&this.qualityWebsocket.send(u);else{var c=this.stateCenter.idName;this.qualityWebsocket=new WebSocket("wss://"+l+"/ws/report/stream?appid="+this.stateCenter.appid+"&product=rtc&token="+encodeURIComponent(this.stateCenter.roomList[0].token)+"&id_name="+c),this.qualityWebsocket.onopen=function(){var e;null===(e=t.qualityWebsocket)||void 0===e||e.send(u)}}}},t.prototype.updateQuality=function(e,t){var r=this,n=(new Date).getTime();0!==this.qualityUploadTimestamp&&n-this.qualityUploadTimestamp>6e4||this.publishQualityInfos.join("").length+this.playQualityInfos.join().length>8e3?(this.publishQualityInfos.forEach(function(e){return e.timestamp_offset_end=Math.round(n/1e3)-r.qualityHeadTimestamp}),this.playQualityInfos.forEach(function(e){return e.timestamp_offset_end=Math.round(n/1e3)-r.qualityHeadTimestamp}),this.streamQualityUpload(),this.publishQualityInfos=[],this.playQualityInfos=[],this.qualityHeadTimestamp=Math.round((new Date).getTime()/1e3),this.qualityUploadTimestamp=n):0==this.qualityHeadTimestamp&&(this.qualityHeadTimestamp=Math.round((new Date).getTime()/1e3),this.qualityUploadTimestamp=n),0==e?this.handlePublishQualityData(t):this.handlePlayQualityData(t)},t.prototype.handlePublishQualityData=function(e){var t=this.publishQualityInfos.find(function(t){return t.stream_id==e.stream_id&&t.video_width==e.frameWidth&&t.video_height==e.frameHeight});if(!t){var r=this.getRoomByStreamID(e.stream_id);t={timestamp_offset_begin:Math.abs(Number(e.timeStamp-this.qualityHeadTimestamp)),timestamp_offset_end:0,stream_id:e.stream_id,session_id:r?Number(r.sessionID):0,video_width:e.frameWidth,video_height:e.frameHeight,infos:[],room_id:r?r.roomID:"",evnvironment:1,room_session_id:r?Number(r.roomSessionID):0,resource_type:2},this.publishQualityInfos.push(t)}t.infos.push({audio_bitrate:Math.round(e.audioBitrate)||0,video_bitrate:Math.round(e.videoBitrate)||0,video_capture_fps:Math.round(10*e.videoFPS)||0,video_network_fps:Math.round(10*e.videoTransferFPS)||0,uplink_plr:e.audioPacketsLostRate,rtt:Math.round(e.currentRoundTripTime),audio_network_fps:Math.round(10*e.audioFPS),captured_sound_level:Math.round(e.audioLevel),sample_time_window:Math.round(e.sampleTimeWindow/10)})},t.prototype.handlePlayQualityData=function(e){var t,r=this.playQualityInfos.find(function(t){return t.stream_id==e.stream_id&&t.video_width==e.frameWidth&&t.video_height==e.frameHeight});if(!r){var n=this.getRoomByStreamID(e.stream_id),o=null===(t=this.playerList[e.stream_id])||void 0===t?void 0:t.player;r={timestamp_offset_begin:Math.abs(Number(e.timeStamp-this.qualityHeadTimestamp)),timestamp_offset_end:0,stream_id:e.stream_id,session_id:n?Number(n.sessionID):0,video_width:e.frameWidth,video_height:e.frameHeight,infos:[],room_id:n?n.roomID:"",room_session_id:n?Number(n.roomSessionID):0,resource_type:null==o?void 0:o.resourceMode},this.playQualityInfos.push(r)}r.infos.push({audio_bitrate:Math.round(e.audioBitrate)||0,video_bitrate:Math.round(e.videoBitrate)||0,video_network_fps:Math.round(10*e.videoFPS)||0,downlink_plr:Math.round(e.audioPacketsLostRate)||0,audio_network_fps:Math.round(10*e.audioFPS)||0,audio_break_duration:Math.round(e.audio_break_duration/10),video_break_duration:Math.round(e.video_break_duration/10),rtt:e.currentRoundTripTime,rendered_sound_level:Math.round(e.audioLevel),audio_break_cancel_duration:Math.round(e.audio_break_cancel_duration/10),video_break_cancel_duration:Math.round(e.video_break_cancel_duration/10),audio_decode_time:Math.round(e.audio_decode_time/10),video_decode_time:Math.round(e.video_decode_time/10),real_sampling_interval:Math.round(e.real_sampling_interval/10),video_frames_decoded:Math.round(e.videoFramesDecoded)||0,video_frames_dropped:Math.round(e.videoFramesDropped)||0,sample_time_window:Math.round(e.sampleTimeWindow/10),peer_to_peer_plr:e.peerToPeerPacketLostRate,peer_to_peer_delay:e.peerToPeerDelay})},t}(l.ZegoStreamCenter);t.ZegoStreamCenterWeb=v},2990:function(e,t,r){"use strict";var n,o=r(2100),i=o.Reader,s=o.Writer,a=o.util,u=o.roots.default||(o.roots.default={});u.logreport=((n={}).SpeedLogHead=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t,r;return e.prototype.version=0,e.prototype.signature=a.newBuffer([]),e.prototype.timestamp=0,e.prototype.event=0,e.prototype.app_id=0,e.prototype.user_id="",e.prototype.biz_type=0,e.prototype.device_id="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(8).uint32(e.version),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(18).bytes(e.signature),null!=e.timestamp&&Object.hasOwnProperty.call(e,"timestamp")&&t.uint32(24).uint32(e.timestamp),null!=e.event&&Object.hasOwnProperty.call(e,"event")&&t.uint32(32).uint32(e.event),null!=e.app_id&&Object.hasOwnProperty.call(e,"app_id")&&t.uint32(40).uint32(e.app_id),null!=e.user_id&&Object.hasOwnProperty.call(e,"user_id")&&t.uint32(50).string(e.user_id),null!=e.biz_type&&Object.hasOwnProperty.call(e,"biz_type")&&t.uint32(56).uint32(e.biz_type),null!=e.device_id&&Object.hasOwnProperty.call(e,"device_id")&&t.uint32(66).string(e.device_id),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.SpeedLogHead;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.version=e.uint32();break;case 2:n.signature=e.bytes();break;case 3:n.timestamp=e.uint32();break;case 4:n.event=e.uint32();break;case 5:n.app_id=e.uint32();break;case 6:n.user_id=e.string();break;case 7:n.biz_type=e.uint32();break;case 8:n.device_id=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.version&&e.hasOwnProperty("version")&&!a.isInteger(e.version)?"version: integer expected":null!=e.signature&&e.hasOwnProperty("signature")&&!(e.signature&&"number"==typeof e.signature.length||a.isString(e.signature))?"signature: buffer expected":null!=e.timestamp&&e.hasOwnProperty("timestamp")&&!a.isInteger(e.timestamp)?"timestamp: integer expected":null!=e.event&&e.hasOwnProperty("event")&&!a.isInteger(e.event)?"event: integer expected":null!=e.app_id&&e.hasOwnProperty("app_id")&&!a.isInteger(e.app_id)?"app_id: integer expected":null!=e.user_id&&e.hasOwnProperty("user_id")&&!a.isString(e.user_id)?"user_id: string expected":null!=e.biz_type&&e.hasOwnProperty("biz_type")&&!a.isInteger(e.biz_type)?"biz_type: integer expected":null!=e.device_id&&e.hasOwnProperty("device_id")&&!a.isString(e.device_id)?"device_id: string expected":null},e.fromObject=function(e){if(e instanceof u.logreport.SpeedLogHead)return e;var t=new u.logreport.SpeedLogHead;return null!=e.version&&(t.version=e.version>>>0),null!=e.signature&&("string"==typeof e.signature?a.base64.decode(e.signature,t.signature=a.newBuffer(a.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.timestamp&&(t.timestamp=e.timestamp>>>0),null!=e.event&&(t.event=e.event>>>0),null!=e.app_id&&(t.app_id=e.app_id>>>0),null!=e.user_id&&(t.user_id=String(e.user_id)),null!=e.biz_type&&(t.biz_type=e.biz_type>>>0),null!=e.device_id&&(t.device_id=String(e.device_id)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.version=0,t.bytes===String?r.signature="":(r.signature=[],t.bytes!==Array&&(r.signature=a.newBuffer(r.signature))),r.timestamp=0,r.event=0,r.app_id=0,r.user_id="",r.biz_type=0,r.device_id=""),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),null!=e.signature&&e.hasOwnProperty("signature")&&(r.signature=t.bytes===String?a.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature),null!=e.timestamp&&e.hasOwnProperty("timestamp")&&(r.timestamp=e.timestamp),null!=e.event&&e.hasOwnProperty("event")&&(r.event=e.event),null!=e.app_id&&e.hasOwnProperty("app_id")&&(r.app_id=e.app_id),null!=e.user_id&&e.hasOwnProperty("user_id")&&(r.user_id=e.user_id),null!=e.biz_type&&e.hasOwnProperty("biz_type")&&(r.biz_type=e.biz_type),null!=e.device_id&&e.hasOwnProperty("device_id")&&(r.device_id=e.device_id),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.ProtoVersion=(t={},(r=Object.create(t))[t[0]="PROTO_VERSION"]=0,r[t[1]="PROTO_VERSION1"]=1,r[t[2]="PROTO_VERSION2"]=2,r[t[3]="PROTO_VERSION3"]=3,r[t[4]="PROTO_VERSION4"]=4,r[t[5]="PROTO_VERSION5"]=5,r[t[6]="PROTO_VERSION6"]=6,r),e.Event=function(){var e={},t=Object.create(e);return t[e[0]="QUALITY_EVENT"]=0,t[e[100]="NO_BILLING_EVENT"]=100,t[e[300]="DETECT_QUALITY_EVENT"]=300,t}(),e.BizType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="LIVE"]=1,t[e[2]="RTV"]=2,t}(),e}(),n.SpeedLogRsp=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.code=0,e.prototype.message="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(18).string(e.message),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.SpeedLogRsp;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.code=e.uint32();break;case 2:n.message=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.code&&e.hasOwnProperty("code")&&!a.isInteger(e.code)?"code: integer expected":null!=e.message&&e.hasOwnProperty("message")&&!a.isString(e.message)?"message: string expected":null},e.fromObject=function(e){if(e instanceof u.logreport.SpeedLogRsp)return e;var t=new u.logreport.SpeedLogRsp;return null!=e.code&&(t.code=e.code>>>0),null!=e.message&&(t.message=String(e.message)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.code=0,r.message=""),null!=e.code&&e.hasOwnProperty("code")&&(r.code=e.code),null!=e.message&&e.hasOwnProperty("message")&&(r.message=e.message),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),n.QualityEvent=function(){function e(e){if(this.publish_quality_infos=[],this.play_quality_infos=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t,r;return e.prototype.hardware_infos=null,e.prototype.publish_quality_infos=a.emptyArray,e.prototype.play_quality_infos=a.emptyArray,e.prototype.network_type=0,e.prototype.charge_infos=null,e.prototype.client_type=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.hardware_infos&&Object.hasOwnProperty.call(e,"hardware_infos")&&u.logreport.HardwareInfos.encode(e.hardware_infos,t.uint32(10).fork()).ldelim(),null!=e.publish_quality_infos&&e.publish_quality_infos.length)for(var r=0;r<e.publish_quality_infos.length;++r)u.logreport.PublishQualityInfos.encode(e.publish_quality_infos[r],t.uint32(18).fork()).ldelim();if(null!=e.play_quality_infos&&e.play_quality_infos.length)for(r=0;r<e.play_quality_infos.length;++r)u.logreport.PlayQualityInfos.encode(e.play_quality_infos[r],t.uint32(26).fork()).ldelim();return null!=e.network_type&&Object.hasOwnProperty.call(e,"network_type")&&t.uint32(32).uint32(e.network_type),null!=e.charge_infos&&Object.hasOwnProperty.call(e,"charge_infos")&&u.logreport.ChargeInfos.encode(e.charge_infos,t.uint32(42).fork()).ldelim(),null!=e.client_type&&Object.hasOwnProperty.call(e,"client_type")&&t.uint32(800).uint32(e.client_type),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.QualityEvent;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.hardware_infos=u.logreport.HardwareInfos.decode(e,e.uint32());break;case 2:n.publish_quality_infos&&n.publish_quality_infos.length||(n.publish_quality_infos=[]),n.publish_quality_infos.push(u.logreport.PublishQualityInfos.decode(e,e.uint32()));break;case 3:n.play_quality_infos&&n.play_quality_infos.length||(n.play_quality_infos=[]),n.play_quality_infos.push(u.logreport.PlayQualityInfos.decode(e,e.uint32()));break;case 4:n.network_type=e.uint32();break;case 5:n.charge_infos=u.logreport.ChargeInfos.decode(e,e.uint32());break;case 100:n.client_type=e.uint32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.hardware_infos&&e.hasOwnProperty("hardware_infos")&&(r=u.logreport.HardwareInfos.verify(e.hardware_infos)))return"hardware_infos."+r;if(null!=e.publish_quality_infos&&e.hasOwnProperty("publish_quality_infos")){if(!Array.isArray(e.publish_quality_infos))return"publish_quality_infos: array expected";for(var t=0;t<e.publish_quality_infos.length;++t)if(r=u.logreport.PublishQualityInfos.verify(e.publish_quality_infos[t]))return"publish_quality_infos."+r}if(null!=e.play_quality_infos&&e.hasOwnProperty("play_quality_infos")){if(!Array.isArray(e.play_quality_infos))return"play_quality_infos: array expected";for(t=0;t<e.play_quality_infos.length;++t){var r;if(r=u.logreport.PlayQualityInfos.verify(e.play_quality_infos[t]))return"play_quality_infos."+r}}return null!=e.network_type&&e.hasOwnProperty("network_type")&&!a.isInteger(e.network_type)?"network_type: integer expected":null!=e.charge_infos&&e.hasOwnProperty("charge_infos")&&(r=u.logreport.ChargeInfos.verify(e.charge_infos))?"charge_infos."+r:null!=e.client_type&&e.hasOwnProperty("client_type")&&!a.isInteger(e.client_type)?"client_type: integer expected":null},e.fromObject=function(e){if(e instanceof u.logreport.QualityEvent)return e;var t=new u.logreport.QualityEvent;if(null!=e.hardware_infos){if("object"!=typeof e.hardware_infos)throw TypeError(".logreport.QualityEvent.hardware_infos: object expected");t.hardware_infos=u.logreport.HardwareInfos.fromObject(e.hardware_infos)}if(e.publish_quality_infos){if(!Array.isArray(e.publish_quality_infos))throw TypeError(".logreport.QualityEvent.publish_quality_infos: array expected");t.publish_quality_infos=[];for(var r=0;r<e.publish_quality_infos.length;++r){if("object"!=typeof e.publish_quality_infos[r])throw TypeError(".logreport.QualityEvent.publish_quality_infos: object expected");t.publish_quality_infos[r]=u.logreport.PublishQualityInfos.fromObject(e.publish_quality_infos[r])}}if(e.play_quality_infos){if(!Array.isArray(e.play_quality_infos))throw TypeError(".logreport.QualityEvent.play_quality_infos: array expected");for(t.play_quality_infos=[],r=0;r<e.play_quality_infos.length;++r){if("object"!=typeof e.play_quality_infos[r])throw TypeError(".logreport.QualityEvent.play_quality_infos: object expected");t.play_quality_infos[r]=u.logreport.PlayQualityInfos.fromObject(e.play_quality_infos[r])}}if(null!=e.network_type&&(t.network_type=e.network_type>>>0),null!=e.charge_infos){if("object"!=typeof e.charge_infos)throw TypeError(".logreport.QualityEvent.charge_infos: object expected");t.charge_infos=u.logreport.ChargeInfos.fromObject(e.charge_infos)}return null!=e.client_type&&(t.client_type=e.client_type>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.publish_quality_infos=[],r.play_quality_infos=[]),t.defaults&&(r.hardware_infos=null,r.network_type=0,r.charge_infos=null,r.client_type=0),null!=e.hardware_infos&&e.hasOwnProperty("hardware_infos")&&(r.hardware_infos=u.logreport.HardwareInfos.toObject(e.hardware_infos,t)),e.publish_quality_infos&&e.publish_quality_infos.length){r.publish_quality_infos=[];for(var n=0;n<e.publish_quality_infos.length;++n)r.publish_quality_infos[n]=u.logreport.PublishQualityInfos.toObject(e.publish_quality_infos[n],t)}if(e.play_quality_infos&&e.play_quality_infos.length)for(r.play_quality_infos=[],n=0;n<e.play_quality_infos.length;++n)r.play_quality_infos[n]=u.logreport.PlayQualityInfos.toObject(e.play_quality_infos[n],t);return null!=e.network_type&&e.hasOwnProperty("network_type")&&(r.network_type=e.network_type),null!=e.charge_infos&&e.hasOwnProperty("charge_infos")&&(r.charge_infos=u.logreport.ChargeInfos.toObject(e.charge_infos,t)),null!=e.client_type&&e.hasOwnProperty("client_type")&&(r.client_type=e.client_type),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.ResourceType=(t={},(r=Object.create(t))[t[0]="UNKNOWN"]=0,r[t[1]="CDN"]=1,r[t[2]="RTC"]=2,r[t[3]="L3"]=3,r),e}(),n.HardwareInfos=function(){function e(e){if(this.infos=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.timestamp_offset_begin=0,e.prototype.timestamp_offset_end=0,e.prototype.infos=a.emptyArray,e.prototype.sys_mem_total=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.timestamp_offset_begin&&Object.hasOwnProperty.call(e,"timestamp_offset_begin")&&t.uint32(8).uint32(e.timestamp_offset_begin),null!=e.timestamp_offset_end&&Object.hasOwnProperty.call(e,"timestamp_offset_end")&&t.uint32(16).uint32(e.timestamp_offset_end),null!=e.infos&&e.infos.length)for(var r=0;r<e.infos.length;++r)u.logreport.HardwareInfo.encode(e.infos[r],t.uint32(26).fork()).ldelim();return null!=e.sys_mem_total&&Object.hasOwnProperty.call(e,"sys_mem_total")&&t.uint32(32).uint32(e.sys_mem_total),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.HardwareInfos;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.timestamp_offset_begin=e.uint32();break;case 2:n.timestamp_offset_end=e.uint32();break;case 3:n.infos&&n.infos.length||(n.infos=[]),n.infos.push(u.logreport.HardwareInfo.decode(e,e.uint32()));break;case 4:n.sys_mem_total=e.uint32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.timestamp_offset_begin&&e.hasOwnProperty("timestamp_offset_begin")&&!a.isInteger(e.timestamp_offset_begin))return"timestamp_offset_begin: integer expected";if(null!=e.timestamp_offset_end&&e.hasOwnProperty("timestamp_offset_end")&&!a.isInteger(e.timestamp_offset_end))return"timestamp_offset_end: integer expected";if(null!=e.infos&&e.hasOwnProperty("infos")){if(!Array.isArray(e.infos))return"infos: array expected";for(var t=0;t<e.infos.length;++t){var r=u.logreport.HardwareInfo.verify(e.infos[t]);if(r)return"infos."+r}}return null!=e.sys_mem_total&&e.hasOwnProperty("sys_mem_total")&&!a.isInteger(e.sys_mem_total)?"sys_mem_total: integer expected":null},e.fromObject=function(e){if(e instanceof u.logreport.HardwareInfos)return e;var t=new u.logreport.HardwareInfos;if(null!=e.timestamp_offset_begin&&(t.timestamp_offset_begin=e.timestamp_offset_begin>>>0),null!=e.timestamp_offset_end&&(t.timestamp_offset_end=e.timestamp_offset_end>>>0),e.infos){if(!Array.isArray(e.infos))throw TypeError(".logreport.HardwareInfos.infos: array expected");t.infos=[];for(var r=0;r<e.infos.length;++r){if("object"!=typeof e.infos[r])throw TypeError(".logreport.HardwareInfos.infos: object expected");t.infos[r]=u.logreport.HardwareInfo.fromObject(e.infos[r])}}return null!=e.sys_mem_total&&(t.sys_mem_total=e.sys_mem_total>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.infos=[]),t.defaults&&(r.timestamp_offset_begin=0,r.timestamp_offset_end=0,r.sys_mem_total=0),null!=e.timestamp_offset_begin&&e.hasOwnProperty("timestamp_offset_begin")&&(r.timestamp_offset_begin=e.timestamp_offset_begin),null!=e.timestamp_offset_end&&e.hasOwnProperty("timestamp_offset_end")&&(r.timestamp_offset_end=e.timestamp_offset_end),e.infos&&e.infos.length){r.infos=[];for(var n=0;n<e.infos.length;++n)r.infos[n]=u.logreport.HardwareInfo.toObject(e.infos[n],t)}return null!=e.sys_mem_total&&e.hasOwnProperty("sys_mem_total")&&(r.sys_mem_total=e.sys_mem_total),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),n.PublishQualityInfos=function(){function e(e){if(this.infos=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.timestamp_offset_begin=0,e.prototype.timestamp_offset_end=0,e.prototype.stream_id="",e.prototype.session_id=0,e.prototype.video_width=0,e.prototype.video_height=0,e.prototype.ipv4=0,e.prototype.ipv6="",e.prototype.resource_type=0,e.prototype.infos=a.emptyArray,e.prototype.room_id="",e.prototype.evnvironment=0,e.prototype.ap="",e.prototype.session="",e.prototype.room_session_id=a.Long?a.Long.fromBits(0,0,!0):0,e.prototype.protocol_type=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.timestamp_offset_begin&&Object.hasOwnProperty.call(e,"timestamp_offset_begin")&&t.uint32(8).uint32(e.timestamp_offset_begin),null!=e.timestamp_offset_end&&Object.hasOwnProperty.call(e,"timestamp_offset_end")&&t.uint32(16).uint32(e.timestamp_offset_end),null!=e.stream_id&&Object.hasOwnProperty.call(e,"stream_id")&&t.uint32(26).string(e.stream_id),null!=e.session_id&&Object.hasOwnProperty.call(e,"session_id")&&t.uint32(32).uint32(e.session_id),null!=e.video_width&&Object.hasOwnProperty.call(e,"video_width")&&t.uint32(40).uint32(e.video_width),null!=e.video_height&&Object.hasOwnProperty.call(e,"video_height")&&t.uint32(48).uint32(e.video_height),null!=e.ipv4&&Object.hasOwnProperty.call(e,"ipv4")&&t.uint32(56).uint32(e.ipv4),null!=e.ipv6&&Object.hasOwnProperty.call(e,"ipv6")&&t.uint32(66).string(e.ipv6),null!=e.resource_type&&Object.hasOwnProperty.call(e,"resource_type")&&t.uint32(72).uint32(e.resource_type),null!=e.infos&&e.infos.length)for(var r=0;r<e.infos.length;++r)u.logreport.PublishQualityInfo.encode(e.infos[r],t.uint32(82).fork()).ldelim();return null!=e.room_id&&Object.hasOwnProperty.call(e,"room_id")&&t.uint32(90).string(e.room_id),null!=e.evnvironment&&Object.hasOwnProperty.call(e,"evnvironment")&&t.uint32(104).uint32(e.evnvironment),null!=e.ap&&Object.hasOwnProperty.call(e,"ap")&&t.uint32(114).string(e.ap),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(122).string(e.session),null!=e.room_session_id&&Object.hasOwnProperty.call(e,"room_session_id")&&t.uint32(128).uint64(e.room_session_id),null!=e.protocol_type&&Object.hasOwnProperty.call(e,"protocol_type")&&t.uint32(136).uint32(e.protocol_type),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.PublishQualityInfos;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.timestamp_offset_begin=e.uint32();break;case 2:n.timestamp_offset_end=e.uint32();break;case 3:n.stream_id=e.string();break;case 4:n.session_id=e.uint32();break;case 5:n.video_width=e.uint32();break;case 6:n.video_height=e.uint32();break;case 7:n.ipv4=e.uint32();break;case 8:n.ipv6=e.string();break;case 9:n.resource_type=e.uint32();break;case 10:n.infos&&n.infos.length||(n.infos=[]),n.infos.push(u.logreport.PublishQualityInfo.decode(e,e.uint32()));break;case 11:n.room_id=e.string();break;case 13:n.evnvironment=e.uint32();break;case 14:n.ap=e.string();break;case 15:n.session=e.string();break;case 16:n.room_session_id=e.uint64();break;case 17:n.protocol_type=e.uint32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.timestamp_offset_begin&&e.hasOwnProperty("timestamp_offset_begin")&&!a.isInteger(e.timestamp_offset_begin))return"timestamp_offset_begin: integer expected";if(null!=e.timestamp_offset_end&&e.hasOwnProperty("timestamp_offset_end")&&!a.isInteger(e.timestamp_offset_end))return"timestamp_offset_end: integer expected";if(null!=e.stream_id&&e.hasOwnProperty("stream_id")&&!a.isString(e.stream_id))return"stream_id: string expected";if(null!=e.session_id&&e.hasOwnProperty("session_id")&&!a.isInteger(e.session_id))return"session_id: integer expected";if(null!=e.video_width&&e.hasOwnProperty("video_width")&&!a.isInteger(e.video_width))return"video_width: integer expected";if(null!=e.video_height&&e.hasOwnProperty("video_height")&&!a.isInteger(e.video_height))return"video_height: integer expected";if(null!=e.ipv4&&e.hasOwnProperty("ipv4")&&!a.isInteger(e.ipv4))return"ipv4: integer expected";if(null!=e.ipv6&&e.hasOwnProperty("ipv6")&&!a.isString(e.ipv6))return"ipv6: string expected";if(null!=e.resource_type&&e.hasOwnProperty("resource_type")&&!a.isInteger(e.resource_type))return"resource_type: integer expected";if(null!=e.infos&&e.hasOwnProperty("infos")){if(!Array.isArray(e.infos))return"infos: array expected";for(var t=0;t<e.infos.length;++t){var r=u.logreport.PublishQualityInfo.verify(e.infos[t]);if(r)return"infos."+r}}return null!=e.room_id&&e.hasOwnProperty("room_id")&&!a.isString(e.room_id)?"room_id: string expected":null!=e.evnvironment&&e.hasOwnProperty("evnvironment")&&!a.isInteger(e.evnvironment)?"evnvironment: integer expected":null!=e.ap&&e.hasOwnProperty("ap")&&!a.isString(e.ap)?"ap: string expected":null!=e.session&&e.hasOwnProperty("session")&&!a.isString(e.session)?"session: string expected":null!=e.room_session_id&&e.hasOwnProperty("room_session_id")&&!(a.isInteger(e.room_session_id)||e.room_session_id&&a.isInteger(e.room_session_id.low)&&a.isInteger(e.room_session_id.high))?"room_session_id: integer|Long expected":null!=e.protocol_type&&e.hasOwnProperty("protocol_type")&&!a.isInteger(e.protocol_type)?"protocol_type: integer expected":null},e.fromObject=function(e){if(e instanceof u.logreport.PublishQualityInfos)return e;var t=new u.logreport.PublishQualityInfos;if(null!=e.timestamp_offset_begin&&(t.timestamp_offset_begin=e.timestamp_offset_begin>>>0),null!=e.timestamp_offset_end&&(t.timestamp_offset_end=e.timestamp_offset_end>>>0),null!=e.stream_id&&(t.stream_id=String(e.stream_id)),null!=e.session_id&&(t.session_id=e.session_id>>>0),null!=e.video_width&&(t.video_width=e.video_width>>>0),null!=e.video_height&&(t.video_height=e.video_height>>>0),null!=e.ipv4&&(t.ipv4=e.ipv4>>>0),null!=e.ipv6&&(t.ipv6=String(e.ipv6)),null!=e.resource_type&&(t.resource_type=e.resource_type>>>0),e.infos){if(!Array.isArray(e.infos))throw TypeError(".logreport.PublishQualityInfos.infos: array expected");t.infos=[];for(var r=0;r<e.infos.length;++r){if("object"!=typeof e.infos[r])throw TypeError(".logreport.PublishQualityInfos.infos: object expected");t.infos[r]=u.logreport.PublishQualityInfo.fromObject(e.infos[r])}}return null!=e.room_id&&(t.room_id=String(e.room_id)),null!=e.evnvironment&&(t.evnvironment=e.evnvironment>>>0),null!=e.ap&&(t.ap=String(e.ap)),null!=e.session&&(t.session=String(e.session)),null!=e.room_session_id&&(a.Long?(t.room_session_id=a.Long.fromValue(e.room_session_id)).unsigned=!0:"string"==typeof e.room_session_id?t.room_session_id=parseInt(e.room_session_id,10):"number"==typeof e.room_session_id?t.room_session_id=e.room_session_id:"object"==typeof e.room_session_id&&(t.room_session_id=new a.LongBits(e.room_session_id.low>>>0,e.room_session_id.high>>>0).toNumber(!0))),null!=e.protocol_type&&(t.protocol_type=e.protocol_type>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.infos=[]),t.defaults){if(r.timestamp_offset_begin=0,r.timestamp_offset_end=0,r.stream_id="",r.session_id=0,r.video_width=0,r.video_height=0,r.ipv4=0,r.ipv6="",r.resource_type=0,r.room_id="",r.evnvironment=0,r.ap="",r.session="",a.Long){var n=new a.Long(0,0,!0);r.room_session_id=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.room_session_id=t.longs===String?"0":0;r.protocol_type=0}if(null!=e.timestamp_offset_begin&&e.hasOwnProperty("timestamp_offset_begin")&&(r.timestamp_offset_begin=e.timestamp_offset_begin),null!=e.timestamp_offset_end&&e.hasOwnProperty("timestamp_offset_end")&&(r.timestamp_offset_end=e.timestamp_offset_end),null!=e.stream_id&&e.hasOwnProperty("stream_id")&&(r.stream_id=e.stream_id),null!=e.session_id&&e.hasOwnProperty("session_id")&&(r.session_id=e.session_id),null!=e.video_width&&e.hasOwnProperty("video_width")&&(r.video_width=e.video_width),null!=e.video_height&&e.hasOwnProperty("video_height")&&(r.video_height=e.video_height),null!=e.ipv4&&e.hasOwnProperty("ipv4")&&(r.ipv4=e.ipv4),null!=e.ipv6&&e.hasOwnProperty("ipv6")&&(r.ipv6=e.ipv6),null!=e.resource_type&&e.hasOwnProperty("resource_type")&&(r.resource_type=e.resource_type),e.infos&&e.infos.length){r.infos=[];for(var o=0;o<e.infos.length;++o)r.infos[o]=u.logreport.PublishQualityInfo.toObject(e.infos[o],t)}return null!=e.room_id&&e.hasOwnProperty("room_id")&&(r.room_id=e.room_id),null!=e.evnvironment&&e.hasOwnProperty("evnvironment")&&(r.evnvironment=e.evnvironment),null!=e.ap&&e.hasOwnProperty("ap")&&(r.ap=e.ap),null!=e.session&&e.hasOwnProperty("session")&&(r.session=e.session),null!=e.room_session_id&&e.hasOwnProperty("room_session_id")&&(r.room_session_id="number"==typeof e.room_session_id?t.longs===String?String(e.room_session_id):e.room_session_id:t.longs===String?a.Long.prototype.toString.call(e.room_session_id):t.longs===Number?new a.LongBits(e.room_session_id.low>>>0,e.room_session_id.high>>>0).toNumber(!0):e.room_session_id),null!=e.protocol_type&&e.hasOwnProperty("protocol_type")&&(r.protocol_type=e.protocol_type),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),n.PlayQualityInfos=function(){function e(e){if(this.infos=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.timestamp_offset_begin=0,e.prototype.timestamp_offset_end=0,e.prototype.stream_id="",e.prototype.session_id=0,e.prototype.video_width=0,e.prototype.video_height=0,e.prototype.ipv4=0,e.prototype.ipv6="",e.prototype.resource_type=0,e.prototype.infos=a.emptyArray,e.prototype.room_id="",e.prototype.session="",e.prototype.room_session_id=a.Long?a.Long.fromBits(0,0,!0):0,e.prototype.protocol_type=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.timestamp_offset_begin&&Object.hasOwnProperty.call(e,"timestamp_offset_begin")&&t.uint32(8).uint32(e.timestamp_offset_begin),null!=e.timestamp_offset_end&&Object.hasOwnProperty.call(e,"timestamp_offset_end")&&t.uint32(16).uint32(e.timestamp_offset_end),null!=e.stream_id&&Object.hasOwnProperty.call(e,"stream_id")&&t.uint32(26).string(e.stream_id),null!=e.session_id&&Object.hasOwnProperty.call(e,"session_id")&&t.uint32(32).uint32(e.session_id),null!=e.video_width&&Object.hasOwnProperty.call(e,"video_width")&&t.uint32(40).uint32(e.video_width),null!=e.video_height&&Object.hasOwnProperty.call(e,"video_height")&&t.uint32(48).uint32(e.video_height),null!=e.ipv4&&Object.hasOwnProperty.call(e,"ipv4")&&t.uint32(56).uint32(e.ipv4),null!=e.ipv6&&Object.hasOwnProperty.call(e,"ipv6")&&t.uint32(66).string(e.ipv6),null!=e.resource_type&&Object.hasOwnProperty.call(e,"resource_type")&&t.uint32(72).uint32(e.resource_type),null!=e.infos&&e.infos.length)for(var r=0;r<e.infos.length;++r)u.logreport.PlayQualityInfo.encode(e.infos[r],t.uint32(82).fork()).ldelim();return null!=e.room_id&&Object.hasOwnProperty.call(e,"room_id")&&t.uint32(90).string(e.room_id),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.room_session_id&&Object.hasOwnProperty.call(e,"room_session_id")&&t.uint32(112).uint64(e.room_session_id),null!=e.protocol_type&&Object.hasOwnProperty.call(e,"protocol_type")&&t.uint32(120).uint32(e.protocol_type),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.PlayQualityInfos;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.timestamp_offset_begin=e.uint32();break;case 2:n.timestamp_offset_end=e.uint32();break;case 3:n.stream_id=e.string();break;case 4:n.session_id=e.uint32();break;case 5:n.video_width=e.uint32();break;case 6:n.video_height=e.uint32();break;case 7:n.ipv4=e.uint32();break;case 8:n.ipv6=e.string();break;case 9:n.resource_type=e.uint32();break;case 10:n.infos&&n.infos.length||(n.infos=[]),n.infos.push(u.logreport.PlayQualityInfo.decode(e,e.uint32()));break;case 11:n.room_id=e.string();break;case 13:n.session=e.string();break;case 14:n.room_session_id=e.uint64();break;case 15:n.protocol_type=e.uint32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.timestamp_offset_begin&&e.hasOwnProperty("timestamp_offset_begin")&&!a.isInteger(e.timestamp_offset_begin))return"timestamp_offset_begin: integer expected";if(null!=e.timestamp_offset_end&&e.hasOwnProperty("timestamp_offset_end")&&!a.isInteger(e.timestamp_offset_end))return"timestamp_offset_end: integer expected";if(null!=e.stream_id&&e.hasOwnProperty("stream_id")&&!a.isString(e.stream_id))return"stream_id: string expected";if(null!=e.session_id&&e.hasOwnProperty("session_id")&&!a.isInteger(e.session_id))return"session_id: integer expected";if(null!=e.video_width&&e.hasOwnProperty("video_width")&&!a.isInteger(e.video_width))return"video_width: integer expected";if(null!=e.video_height&&e.hasOwnProperty("video_height")&&!a.isInteger(e.video_height))return"video_height: integer expected";if(null!=e.ipv4&&e.hasOwnProperty("ipv4")&&!a.isInteger(e.ipv4))return"ipv4: integer expected";if(null!=e.ipv6&&e.hasOwnProperty("ipv6")&&!a.isString(e.ipv6))return"ipv6: string expected";if(null!=e.resource_type&&e.hasOwnProperty("resource_type")&&!a.isInteger(e.resource_type))return"resource_type: integer expected";if(null!=e.infos&&e.hasOwnProperty("infos")){if(!Array.isArray(e.infos))return"infos: array expected";for(var t=0;t<e.infos.length;++t){var r=u.logreport.PlayQualityInfo.verify(e.infos[t]);if(r)return"infos."+r}}return null!=e.room_id&&e.hasOwnProperty("room_id")&&!a.isString(e.room_id)?"room_id: string expected":null!=e.session&&e.hasOwnProperty("session")&&!a.isString(e.session)?"session: string expected":null!=e.room_session_id&&e.hasOwnProperty("room_session_id")&&!(a.isInteger(e.room_session_id)||e.room_session_id&&a.isInteger(e.room_session_id.low)&&a.isInteger(e.room_session_id.high))?"room_session_id: integer|Long expected":null!=e.protocol_type&&e.hasOwnProperty("protocol_type")&&!a.isInteger(e.protocol_type)?"protocol_type: integer expected":null},e.fromObject=function(e){if(e instanceof u.logreport.PlayQualityInfos)return e;var t=new u.logreport.PlayQualityInfos;if(null!=e.timestamp_offset_begin&&(t.timestamp_offset_begin=e.timestamp_offset_begin>>>0),null!=e.timestamp_offset_end&&(t.timestamp_offset_end=e.timestamp_offset_end>>>0),null!=e.stream_id&&(t.stream_id=String(e.stream_id)),null!=e.session_id&&(t.session_id=e.session_id>>>0),null!=e.video_width&&(t.video_width=e.video_width>>>0),null!=e.video_height&&(t.video_height=e.video_height>>>0),null!=e.ipv4&&(t.ipv4=e.ipv4>>>0),null!=e.ipv6&&(t.ipv6=String(e.ipv6)),null!=e.resource_type&&(t.resource_type=e.resource_type>>>0),e.infos){if(!Array.isArray(e.infos))throw TypeError(".logreport.PlayQualityInfos.infos: array expected");t.infos=[];for(var r=0;r<e.infos.length;++r){if("object"!=typeof e.infos[r])throw TypeError(".logreport.PlayQualityInfos.infos: object expected");t.infos[r]=u.logreport.PlayQualityInfo.fromObject(e.infos[r])}}return null!=e.room_id&&(t.room_id=String(e.room_id)),null!=e.session&&(t.session=String(e.session)),null!=e.room_session_id&&(a.Long?(t.room_session_id=a.Long.fromValue(e.room_session_id)).unsigned=!0:"string"==typeof e.room_session_id?t.room_session_id=parseInt(e.room_session_id,10):"number"==typeof e.room_session_id?t.room_session_id=e.room_session_id:"object"==typeof e.room_session_id&&(t.room_session_id=new a.LongBits(e.room_session_id.low>>>0,e.room_session_id.high>>>0).toNumber(!0))),null!=e.protocol_type&&(t.protocol_type=e.protocol_type>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.infos=[]),t.defaults){if(r.timestamp_offset_begin=0,r.timestamp_offset_end=0,r.stream_id="",r.session_id=0,r.video_width=0,r.video_height=0,r.ipv4=0,r.ipv6="",r.resource_type=0,r.room_id="",r.session="",a.Long){var n=new a.Long(0,0,!0);r.room_session_id=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.room_session_id=t.longs===String?"0":0;r.protocol_type=0}if(null!=e.timestamp_offset_begin&&e.hasOwnProperty("timestamp_offset_begin")&&(r.timestamp_offset_begin=e.timestamp_offset_begin),null!=e.timestamp_offset_end&&e.hasOwnProperty("timestamp_offset_end")&&(r.timestamp_offset_end=e.timestamp_offset_end),null!=e.stream_id&&e.hasOwnProperty("stream_id")&&(r.stream_id=e.stream_id),null!=e.session_id&&e.hasOwnProperty("session_id")&&(r.session_id=e.session_id),null!=e.video_width&&e.hasOwnProperty("video_width")&&(r.video_width=e.video_width),null!=e.video_height&&e.hasOwnProperty("video_height")&&(r.video_height=e.video_height),null!=e.ipv4&&e.hasOwnProperty("ipv4")&&(r.ipv4=e.ipv4),null!=e.ipv6&&e.hasOwnProperty("ipv6")&&(r.ipv6=e.ipv6),null!=e.resource_type&&e.hasOwnProperty("resource_type")&&(r.resource_type=e.resource_type),e.infos&&e.infos.length){r.infos=[];for(var o=0;o<e.infos.length;++o)r.infos[o]=u.logreport.PlayQualityInfo.toObject(e.infos[o],t)}return null!=e.room_id&&e.hasOwnProperty("room_id")&&(r.room_id=e.room_id),null!=e.session&&e.hasOwnProperty("session")&&(r.session=e.session),null!=e.room_session_id&&e.hasOwnProperty("room_session_id")&&(r.room_session_id="number"==typeof e.room_session_id?t.longs===String?String(e.room_session_id):e.room_session_id:t.longs===String?a.Long.prototype.toString.call(e.room_session_id):t.longs===Number?new a.LongBits(e.room_session_id.low>>>0,e.room_session_id.high>>>0).toNumber(!0):e.room_session_id),null!=e.protocol_type&&e.hasOwnProperty("protocol_type")&&(r.protocol_type=e.protocol_type),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),n.ChargeInfos=function(){function e(e){if(this.infos=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.timestamp_offset_begin=0,e.prototype.timestamp_offset_end=0,e.prototype.timestamp_diff_flag=0,e.prototype.timestamp_diff=0,e.prototype.room_id="",e.prototype.infos=a.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.timestamp_offset_begin&&Object.hasOwnProperty.call(e,"timestamp_offset_begin")&&t.uint32(8).uint32(e.timestamp_offset_begin),null!=e.timestamp_offset_end&&Object.hasOwnProperty.call(e,"timestamp_offset_end")&&t.uint32(16).uint32(e.timestamp_offset_end),null!=e.timestamp_diff_flag&&Object.hasOwnProperty.call(e,"timestamp_diff_flag")&&t.uint32(24).uint32(e.timestamp_diff_flag),null!=e.timestamp_diff&&Object.hasOwnProperty.call(e,"timestamp_diff")&&t.uint32(32).uint32(e.timestamp_diff),null!=e.room_id&&Object.hasOwnProperty.call(e,"room_id")&&t.uint32(42).string(e.room_id),null!=e.infos&&e.infos.length)for(var r=0;r<e.infos.length;++r)u.logreport.ChargeInfo.encode(e.infos[r],t.uint32(802).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.ChargeInfos;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.timestamp_offset_begin=e.uint32();break;case 2:n.timestamp_offset_end=e.uint32();break;case 3:n.timestamp_diff_flag=e.uint32();break;case 4:n.timestamp_diff=e.uint32();break;case 5:n.room_id=e.string();break;case 100:n.infos&&n.infos.length||(n.infos=[]),n.infos.push(u.logreport.ChargeInfo.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.timestamp_offset_begin&&e.hasOwnProperty("timestamp_offset_begin")&&!a.isInteger(e.timestamp_offset_begin))return"timestamp_offset_begin: integer expected";if(null!=e.timestamp_offset_end&&e.hasOwnProperty("timestamp_offset_end")&&!a.isInteger(e.timestamp_offset_end))return"timestamp_offset_end: integer expected";if(null!=e.timestamp_diff_flag&&e.hasOwnProperty("timestamp_diff_flag")&&!a.isInteger(e.timestamp_diff_flag))return"timestamp_diff_flag: integer expected";if(null!=e.timestamp_diff&&e.hasOwnProperty("timestamp_diff")&&!a.isInteger(e.timestamp_diff))return"timestamp_diff: integer expected";if(null!=e.room_id&&e.hasOwnProperty("room_id")&&!a.isString(e.room_id))return"room_id: string expected";if(null!=e.infos&&e.hasOwnProperty("infos")){if(!Array.isArray(e.infos))return"infos: array expected";for(var t=0;t<e.infos.length;++t){var r=u.logreport.ChargeInfo.verify(e.infos[t]);if(r)return"infos."+r}}return null},e.fromObject=function(e){if(e instanceof u.logreport.ChargeInfos)return e;var t=new u.logreport.ChargeInfos;if(null!=e.timestamp_offset_begin&&(t.timestamp_offset_begin=e.timestamp_offset_begin>>>0),null!=e.timestamp_offset_end&&(t.timestamp_offset_end=e.timestamp_offset_end>>>0),null!=e.timestamp_diff_flag&&(t.timestamp_diff_flag=e.timestamp_diff_flag>>>0),null!=e.timestamp_diff&&(t.timestamp_diff=e.timestamp_diff>>>0),null!=e.room_id&&(t.room_id=String(e.room_id)),e.infos){if(!Array.isArray(e.infos))throw TypeError(".logreport.ChargeInfos.infos: array expected");t.infos=[];for(var r=0;r<e.infos.length;++r){if("object"!=typeof e.infos[r])throw TypeError(".logreport.ChargeInfos.infos: object expected");t.infos[r]=u.logreport.ChargeInfo.fromObject(e.infos[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.infos=[]),t.defaults&&(r.timestamp_offset_begin=0,r.timestamp_offset_end=0,r.timestamp_diff_flag=0,r.timestamp_diff=0,r.room_id=""),null!=e.timestamp_offset_begin&&e.hasOwnProperty("timestamp_offset_begin")&&(r.timestamp_offset_begin=e.timestamp_offset_begin),null!=e.timestamp_offset_end&&e.hasOwnProperty("timestamp_offset_end")&&(r.timestamp_offset_end=e.timestamp_offset_end),null!=e.timestamp_diff_flag&&e.hasOwnProperty("timestamp_diff_flag")&&(r.timestamp_diff_flag=e.timestamp_diff_flag),null!=e.timestamp_diff&&e.hasOwnProperty("timestamp_diff")&&(r.timestamp_diff=e.timestamp_diff),null!=e.room_id&&e.hasOwnProperty("room_id")&&(r.room_id=e.room_id),e.infos&&e.infos.length){r.infos=[];for(var n=0;n<e.infos.length;++n)r.infos[n]=u.logreport.ChargeInfo.toObject(e.infos[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),n.HardwareInfo=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.sys_cpu_used=0,e.prototype.app_cpu_used=0,e.prototype.sys_mem_used=0,e.prototype.app_mem_used=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.sys_cpu_used&&Object.hasOwnProperty.call(e,"sys_cpu_used")&&t.uint32(8).uint32(e.sys_cpu_used),null!=e.app_cpu_used&&Object.hasOwnProperty.call(e,"app_cpu_used")&&t.uint32(16).uint32(e.app_cpu_used),null!=e.sys_mem_used&&Object.hasOwnProperty.call(e,"sys_mem_used")&&t.uint32(24).uint32(e.sys_mem_used),null!=e.app_mem_used&&Object.hasOwnProperty.call(e,"app_mem_used")&&t.uint32(32).uint32(e.app_mem_used),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.HardwareInfo;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.sys_cpu_used=e.uint32();break;case 2:n.app_cpu_used=e.uint32();break;case 3:n.sys_mem_used=e.uint32();break;case 4:n.app_mem_used=e.uint32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.sys_cpu_used&&e.hasOwnProperty("sys_cpu_used")&&!a.isInteger(e.sys_cpu_used)?"sys_cpu_used: integer expected":null!=e.app_cpu_used&&e.hasOwnProperty("app_cpu_used")&&!a.isInteger(e.app_cpu_used)?"app_cpu_used: integer expected":null!=e.sys_mem_used&&e.hasOwnProperty("sys_mem_used")&&!a.isInteger(e.sys_mem_used)?"sys_mem_used: integer expected":null!=e.app_mem_used&&e.hasOwnProperty("app_mem_used")&&!a.isInteger(e.app_mem_used)?"app_mem_used: integer expected":null},e.fromObject=function(e){if(e instanceof u.logreport.HardwareInfo)return e;var t=new u.logreport.HardwareInfo;return null!=e.sys_cpu_used&&(t.sys_cpu_used=e.sys_cpu_used>>>0),null!=e.app_cpu_used&&(t.app_cpu_used=e.app_cpu_used>>>0),null!=e.sys_mem_used&&(t.sys_mem_used=e.sys_mem_used>>>0),null!=e.app_mem_used&&(t.app_mem_used=e.app_mem_used>>>0),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.sys_cpu_used=0,r.app_cpu_used=0,r.sys_mem_used=0,r.app_mem_used=0),null!=e.sys_cpu_used&&e.hasOwnProperty("sys_cpu_used")&&(r.sys_cpu_used=e.sys_cpu_used),null!=e.app_cpu_used&&e.hasOwnProperty("app_cpu_used")&&(r.app_cpu_used=e.app_cpu_used),null!=e.sys_mem_used&&e.hasOwnProperty("sys_mem_used")&&(r.sys_mem_used=e.sys_mem_used),null!=e.app_mem_used&&e.hasOwnProperty("app_mem_used")&&(r.app_mem_used=e.app_mem_used),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),n.PublishQualityInfo=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.audio_bitrate=0,e.prototype.video_bitrate=0,e.prototype.video_capture_fps=0,e.prototype.video_network_fps=0,e.prototype.uplink_plr=0,e.prototype.rtt=0,e.prototype.audio_network_fps=0,e.prototype.captured_sound_level=0,e.prototype.sample_time_window=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.audio_bitrate&&Object.hasOwnProperty.call(e,"audio_bitrate")&&t.uint32(8).uint32(e.audio_bitrate),null!=e.video_bitrate&&Object.hasOwnProperty.call(e,"video_bitrate")&&t.uint32(16).uint32(e.video_bitrate),null!=e.video_capture_fps&&Object.hasOwnProperty.call(e,"video_capture_fps")&&t.uint32(24).uint32(e.video_capture_fps),null!=e.video_network_fps&&Object.hasOwnProperty.call(e,"video_network_fps")&&t.uint32(32).uint32(e.video_network_fps),null!=e.uplink_plr&&Object.hasOwnProperty.call(e,"uplink_plr")&&t.uint32(40).uint32(e.uplink_plr),null!=e.rtt&&Object.hasOwnProperty.call(e,"rtt")&&t.uint32(48).uint32(e.rtt),null!=e.audio_network_fps&&Object.hasOwnProperty.call(e,"audio_network_fps")&&t.uint32(56).uint32(e.audio_network_fps),null!=e.captured_sound_level&&Object.hasOwnProperty.call(e,"captured_sound_level")&&t.uint32(64).uint32(e.captured_sound_level),null!=e.sample_time_window&&Object.hasOwnProperty.call(e,"sample_time_window")&&t.uint32(800).uint32(e.sample_time_window),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.PublishQualityInfo;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.audio_bitrate=e.uint32();break;case 2:n.video_bitrate=e.uint32();break;case 3:n.video_capture_fps=e.uint32();break;case 4:n.video_network_fps=e.uint32();break;case 5:n.uplink_plr=e.uint32();break;case 6:n.rtt=e.uint32();break;case 7:n.audio_network_fps=e.uint32();break;case 8:n.captured_sound_level=e.uint32();break;case 100:n.sample_time_window=e.uint32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.audio_bitrate&&e.hasOwnProperty("audio_bitrate")&&!a.isInteger(e.audio_bitrate)?"audio_bitrate: integer expected":null!=e.video_bitrate&&e.hasOwnProperty("video_bitrate")&&!a.isInteger(e.video_bitrate)?"video_bitrate: integer expected":null!=e.video_capture_fps&&e.hasOwnProperty("video_capture_fps")&&!a.isInteger(e.video_capture_fps)?"video_capture_fps: integer expected":null!=e.video_network_fps&&e.hasOwnProperty("video_network_fps")&&!a.isInteger(e.video_network_fps)?"video_network_fps: integer expected":null!=e.uplink_plr&&e.hasOwnProperty("uplink_plr")&&!a.isInteger(e.uplink_plr)?"uplink_plr: integer expected":null!=e.rtt&&e.hasOwnProperty("rtt")&&!a.isInteger(e.rtt)?"rtt: integer expected":null!=e.audio_network_fps&&e.hasOwnProperty("audio_network_fps")&&!a.isInteger(e.audio_network_fps)?"audio_network_fps: integer expected":null!=e.captured_sound_level&&e.hasOwnProperty("captured_sound_level")&&!a.isInteger(e.captured_sound_level)?"captured_sound_level: integer expected":null!=e.sample_time_window&&e.hasOwnProperty("sample_time_window")&&!a.isInteger(e.sample_time_window)?"sample_time_window: integer expected":null},e.fromObject=function(e){if(e instanceof u.logreport.PublishQualityInfo)return e;var t=new u.logreport.PublishQualityInfo;return null!=e.audio_bitrate&&(t.audio_bitrate=e.audio_bitrate>>>0),null!=e.video_bitrate&&(t.video_bitrate=e.video_bitrate>>>0),null!=e.video_capture_fps&&(t.video_capture_fps=e.video_capture_fps>>>0),null!=e.video_network_fps&&(t.video_network_fps=e.video_network_fps>>>0),null!=e.uplink_plr&&(t.uplink_plr=e.uplink_plr>>>0),null!=e.rtt&&(t.rtt=e.rtt>>>0),null!=e.audio_network_fps&&(t.audio_network_fps=e.audio_network_fps>>>0),null!=e.captured_sound_level&&(t.captured_sound_level=e.captured_sound_level>>>0),null!=e.sample_time_window&&(t.sample_time_window=e.sample_time_window>>>0),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.audio_bitrate=0,r.video_bitrate=0,r.video_capture_fps=0,r.video_network_fps=0,r.uplink_plr=0,r.rtt=0,r.audio_network_fps=0,r.captured_sound_level=0,r.sample_time_window=0),null!=e.audio_bitrate&&e.hasOwnProperty("audio_bitrate")&&(r.audio_bitrate=e.audio_bitrate),null!=e.video_bitrate&&e.hasOwnProperty("video_bitrate")&&(r.video_bitrate=e.video_bitrate),null!=e.video_capture_fps&&e.hasOwnProperty("video_capture_fps")&&(r.video_capture_fps=e.video_capture_fps),null!=e.video_network_fps&&e.hasOwnProperty("video_network_fps")&&(r.video_network_fps=e.video_network_fps),null!=e.uplink_plr&&e.hasOwnProperty("uplink_plr")&&(r.uplink_plr=e.uplink_plr),null!=e.rtt&&e.hasOwnProperty("rtt")&&(r.rtt=e.rtt),null!=e.audio_network_fps&&e.hasOwnProperty("audio_network_fps")&&(r.audio_network_fps=e.audio_network_fps),null!=e.captured_sound_level&&e.hasOwnProperty("captured_sound_level")&&(r.captured_sound_level=e.captured_sound_level),null!=e.sample_time_window&&e.hasOwnProperty("sample_time_window")&&(r.sample_time_window=e.sample_time_window),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),n.PlayQualityInfo=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.audio_bitrate=0,e.prototype.video_bitrate=0,e.prototype.video_network_fps=0,e.prototype.audio_break_count=0,e.prototype.video_break_count=0,e.prototype.downlink_plr=0,e.prototype.peer_to_peer_plr=0,e.prototype.peer_to_peer_delay=0,e.prototype.audio_network_fps=0,e.prototype.audio_break_duration=0,e.prototype.video_break_duration=0,e.prototype.audio_break_rate=0,e.prototype.video_break_rate=0,e.prototype.audio_break_cancel=0,e.prototype.video_break_cancel=0,e.prototype.rtt=0,e.prototype.rendered_sound_level=0,e.prototype.audio_break_cancel_duration=0,e.prototype.video_break_cancel_duration=0,e.prototype.audio_decode_time=0,e.prototype.video_decode_time=0,e.prototype.real_sampling_interval=0,e.prototype.mos=0,e.prototype.audio_decode_fps=0,e.prototype.video_decode_fps=0,e.prototype.video_frames_decoded=0,e.prototype.video_frames_dropped=0,e.prototype.sample_time_window=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.audio_bitrate&&Object.hasOwnProperty.call(e,"audio_bitrate")&&t.uint32(8).uint32(e.audio_bitrate),null!=e.video_bitrate&&Object.hasOwnProperty.call(e,"video_bitrate")&&t.uint32(16).uint32(e.video_bitrate),null!=e.video_network_fps&&Object.hasOwnProperty.call(e,"video_network_fps")&&t.uint32(24).uint32(e.video_network_fps),null!=e.audio_break_count&&Object.hasOwnProperty.call(e,"audio_break_count")&&t.uint32(32).uint32(e.audio_break_count),null!=e.video_break_count&&Object.hasOwnProperty.call(e,"video_break_count")&&t.uint32(40).uint32(e.video_break_count),null!=e.downlink_plr&&Object.hasOwnProperty.call(e,"downlink_plr")&&t.uint32(48).uint32(e.downlink_plr),null!=e.peer_to_peer_plr&&Object.hasOwnProperty.call(e,"peer_to_peer_plr")&&t.uint32(56).uint32(e.peer_to_peer_plr),null!=e.peer_to_peer_delay&&Object.hasOwnProperty.call(e,"peer_to_peer_delay")&&t.uint32(64).uint32(e.peer_to_peer_delay),null!=e.audio_network_fps&&Object.hasOwnProperty.call(e,"audio_network_fps")&&t.uint32(72).uint32(e.audio_network_fps),null!=e.audio_break_duration&&Object.hasOwnProperty.call(e,"audio_break_duration")&&t.uint32(80).uint32(e.audio_break_duration),null!=e.video_break_duration&&Object.hasOwnProperty.call(e,"video_break_duration")&&t.uint32(88).uint32(e.video_break_duration),null!=e.audio_break_rate&&Object.hasOwnProperty.call(e,"audio_break_rate")&&t.uint32(96).uint32(e.audio_break_rate),null!=e.video_break_rate&&Object.hasOwnProperty.call(e,"video_break_rate")&&t.uint32(104).uint32(e.video_break_rate),null!=e.audio_break_cancel&&Object.hasOwnProperty.call(e,"audio_break_cancel")&&t.uint32(112).uint32(e.audio_break_cancel),null!=e.video_break_cancel&&Object.hasOwnProperty.call(e,"video_break_cancel")&&t.uint32(120).uint32(e.video_break_cancel),null!=e.rtt&&Object.hasOwnProperty.call(e,"rtt")&&t.uint32(128).uint32(e.rtt),null!=e.rendered_sound_level&&Object.hasOwnProperty.call(e,"rendered_sound_level")&&t.uint32(136).uint32(e.rendered_sound_level),null!=e.audio_break_cancel_duration&&Object.hasOwnProperty.call(e,"audio_break_cancel_duration")&&t.uint32(144).uint32(e.audio_break_cancel_duration),null!=e.video_break_cancel_duration&&Object.hasOwnProperty.call(e,"video_break_cancel_duration")&&t.uint32(152).uint32(e.video_break_cancel_duration),null!=e.audio_decode_time&&Object.hasOwnProperty.call(e,"audio_decode_time")&&t.uint32(160).uint32(e.audio_decode_time),null!=e.video_decode_time&&Object.hasOwnProperty.call(e,"video_decode_time")&&t.uint32(168).uint32(e.video_decode_time),null!=e.real_sampling_interval&&Object.hasOwnProperty.call(e,"real_sampling_interval")&&t.uint32(176).uint32(e.real_sampling_interval),null!=e.mos&&Object.hasOwnProperty.call(e,"mos")&&t.uint32(184).int32(e.mos),null!=e.audio_decode_fps&&Object.hasOwnProperty.call(e,"audio_decode_fps")&&t.uint32(192).uint32(e.audio_decode_fps),null!=e.video_decode_fps&&Object.hasOwnProperty.call(e,"video_decode_fps")&&t.uint32(200).uint32(e.video_decode_fps),null!=e.video_frames_decoded&&Object.hasOwnProperty.call(e,"video_frames_decoded")&&t.uint32(208).uint32(e.video_frames_decoded),null!=e.video_frames_dropped&&Object.hasOwnProperty.call(e,"video_frames_dropped")&&t.uint32(216).uint32(e.video_frames_dropped),null!=e.sample_time_window&&Object.hasOwnProperty.call(e,"sample_time_window")&&t.uint32(800).uint32(e.sample_time_window),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof i||(e=i.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new u.logreport.PlayQualityInfo;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.audio_bitrate=e.uint32();break;case 2:n.video_bitrate=e.uint32();break;case 3:n.video_network_fps=e.uint32();break;case 4:n.audio_break_count=e.uint32();break;case 5:n.video_break_count=e.uint32();break;case 6:n.downlink_plr=e.uint32();break;case 7:n.peer_to_peer_plr=e.uint32();break;case 8:n.peer_to_peer_delay=e.uint32();break;case 9:n.audio_network_fps=e.uint32();break;case 10:n.audio_break_duration=e.uint32();break;case 11:n.video_break_duration=e.uint32();break;case 12:n.audio_break_rate=e.uint32();break;case 13:n.video_break_rate=e.uint32();break;case 14:n.audio_break_cancel=e.uint32();break;case 15:n.video_break_cancel=e.uint32();break;case 16:n.rtt=e.uint32();break;case 17:n.rendered_sound_level=e.uint32();break;case 18:n.audio_break_cancel_duration=e.uint32();break;case 19:n.video_break_cancel_duration=e.uint32();break;case 20:n.audio_decode_time=e.uint32();break;case 21:n.video_decode_time=e.uint32();break;case 22:n.real_sampling_interval=e.uint32();break;case 23:n.mos=e.int32();break;case 24:n.audio_decode_fps=e.uint32();break;case 25:n.video_decode_fps=e.uint32();break;case 26:n.video_frames_decoded=e.uint32();break;case 27:n.video_frames_dropped=e.uint32();break;case 100:n.sample_time_window=e.uint32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof i||(e=new i(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.audio_bitrate&&e.hasOwnProperty("audio_bitrate")&&!a.isInteger(e.audio_bitrate)?"audio_bitrate: integer expected":null!=e.video_bitrate&&e.hasOwnProperty("video_bitrate")&&!a.isInteger(e.video_bitrate)?"video_bitrate: integer expected":null!=e.video_network_fps&&e.hasOwnProperty("video_network_fps")&&!a.isInteger(e.video_network_fps)?"video_network_fps: integer expected":null!=e.audio_break_count&&e.hasOwnProperty("audio_break_count")&&!a.isInteger(e.audio_break_count)?"audio_break_count: integer expected":null!=e.video_break_count&&e.hasOwnProperty("video_break_count")&&!a.isInteger(e.video_break_count)?"video_break_count: integer expected":null!=e.downlink_plr&&e.hasOwnProperty("downlink_plr")&&!a.isInteger(e.downlink_plr)?"downlink_plr: integer expected":null!=e.peer_to_peer_plr&&e.hasOwnProperty("peer_to_peer_plr")&&!a.isInteger(e.peer_to_peer_plr)?"peer_to_peer_plr: integer expected":null!=e.peer_to_peer_delay&&e.hasOwnProperty("peer_to_peer_delay")&&!a.isInteger(e.peer_to_peer_delay)?"peer_to_peer_delay: integer expected":null!=e.audio_network_fps&&e.hasOwnProperty("audio_network_fps")&&!a.isInteger(e.audio_network_fps)?"audio_network_fps: integer expected":null!=e.audio_break_duration&&e.hasOwnProperty("audio_break_duration")&&!a.isInteger(e.audio_break_duration)?"audio_break_duration: integer expected":null!=e.video_break_duration&&e.hasOwnProperty("video_break_duration")&&!a.isInteger(e.video_break_duration)?"video_break_duration: integer expected":null!=e.audio_break_rate&&e.hasOwnProperty("audio_break_rate")&&!a.isInteger(e.audio_break_rate)?"audio_break_rate: integer expected":null!=e.video_break_rate&&e.hasOwnProperty("video_break_rate")&&!a.isInteger(e.video_break_rate)?"video_break_rate: integer expected":null!=e.audio_break_cancel&&e.hasOwnProperty("audio_break_cancel")&&!a.isInteger(e.audio_break_cancel)?"audio_break_cancel: integer expected":null!=e.video_break_cancel&&e.hasOwnProperty("video_break_cancel")&&!a.isInteger(e.video_break_cancel)?"video_break_cancel: integer expected":null!=e.rtt&&e.hasOwnProperty("rtt")&&!a.isInteger(e.rtt)?"rtt: integer expected":null!=e.rendered_sound_level&&e.hasOwnProperty("rendered_sound_level")&&!a.isInteger(e.rendered_sound_level)?"rendered_sound_level: integer expected":null!=e.audio_break_cancel_duration&&e.hasOwnProperty("audio_break_cancel_duration")&&!a.isInteger(e.audio_break_cancel_duration)?"audio_break_cancel_duration: integer expected":null!=e.video_break_cancel_duration&&e.hasOwnProperty("video_break_cancel_duration")&&!a.isInteger(e.video_break_cancel_duration)?"video_break_cancel_duration: integer expected":null!=e.audio_decode_time&&e.hasOwnProperty("audio_decode_time")&&!a.isInteger(e.audio_decode_time)?"audio_decode_time: integer expected":null!=e.video_decode_time&&e.hasOwnProperty("video_decode_time")&&!a.isInteger(e.video_decode_time)?"video_decode_time: integer expected":null!=e.real_sampling_interval&&e.hasOwnProperty("real_sampling_interval")&&!a.isInteger(e.real_sampling_interval)?"real_sampling_interval: integer expected":null!=e.mos&&e.hasOwnProperty("mos")&&!a.isInteger(e.mos)?"mos: integer expected":null!=e.audio_decode_fps&&e.hasOwnProperty("audio_decode_fps")&&!a.isInteger(e.audio_decode_fps)?"audio_decode_fps: integer expected":null!=e.video_decode_fps&&e.hasOwnProperty("video_decode_fps")&&!a.isInteger(e.video_decode_fps)?"video_decode_fps: integer expected":null!=e.video_frames_decoded&&e.hasOwnProperty("video_frames_decoded")&&!a.isInteger(e.video_frames_decoded)?"video_frames_decoded: integer expected":null!=e.video_frames_dropped&&e.hasOwnProperty("video_frames_dropped")&&!a.isInteger(e.video_frames_dropped)?"video_frames_dropped: integer expected":null!=e.sample_time_window&&e.hasOwnProperty("sample_time_window")&&!a.isInteger(e.sample_time_window)?"sample_time_window: integer expected":null},e.fromObject=function(e){if(e instanceof u.logreport.PlayQualityInfo)return e;var t=new u.logreport.PlayQualityInfo;return null!=e.audio_bitrate&&(t.audio_bitrate=e.audio_bitrate>>>0),null!=e.video_bitrate&&(t.video_bitrate=e.video_bitrate>>>0),null!=e.video_network_fps&&(t.video_network_fps=e.video_network_fps>>>0),null!=e.audio_break_count&&(t.audio_break_count=e.audio_break_count>>>0),null!=e.video_break_count&&(t.video_break_count=e.video_break_count>>>0),null!=e.downlink_plr&&(t.downlink_plr=e.downlink_plr>>>0),null!=e.peer_to_peer_plr&&(t.peer_to_peer_plr=e.peer_to_peer_plr>>>0),null!=e.peer_to_peer_delay&&(t.peer_to_peer_delay=e.peer_to_peer_delay>>>0),null!=e.audio_network_fps&&(t.audio_network_fps=e.audio_network_fps>>>0),null!=e.audio_break_duration&&(t.audio_break_duration=e.audio_break_duration>>>0),null!=e.video_break_duration&&(t.video_break_duration=e.video_break_duration>>>0),null!=e.audio_break_rate&&(t.audio_break_rate=e.audio_break_rate>>>0),null!=e.video_break_rate&&(t.video_break_rate=e.video_break_rate>>>0),null!=e.audio_break_cancel&&(t.audio_break_cancel=e.audio_break_cancel>>>0),null!=e.video_break_cancel&&(t.video_break_cancel=e.video_break_cancel>>>0),null!=e.rtt&&(t.rtt=e.rtt>>>0),null!=e.rendered_sound_level&&(t.rendered_sound_level=e.rendered_sound_level>>>0),null!=e.audio_break_cancel_duration&&(t.audio_break_cancel_duration=e.audio_break_cancel_duration>>>0),null!=e.video_break_cancel_duration&&(t.video_break_cancel_duration=e.video_break_cancel_duration>>>0),null!=e.audio_decode_time&&(t.audio_decode_time=e.audio_decode_time>>>0),null!=e.video_decode_time&&(t.video_decode_time=e.video_decode_time>>>0),null!=e.real_sampling_interval&&(t.real_sampling_interval=e.real_sampling_interval>>>0),null!=e.mos&&(t.mos=0|e.mos),null!=e.audio_decode_fps&&(t.audio_decode_fps=e.audio_decode_fps>>>0),null!=e.video_decode_fps&&(t.video_decode_fps=e.video_decode_fps>>>0),null!=e.video_frames_decoded&&(t.video_frames_decoded=e.video_frames_decoded>>>0),null!=e.video_frames_dropped&&(t.video_frames_dropped=e.video_frames_dropped>>>0),null!=e.sample_time_window&&(t.sample_time_window=e.sample_time_window>>>0),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.audio_bitrate=0,r.video_bitrate=0,r.video_network_fps=0,r.audio_break_count=0,r.video_break_count=0,r.downlink_plr=0,r.peer_to_peer_plr=0,r.peer_to_peer_delay=0,r.audio_network_fps=0,r.audio_break_duration=0,r.video_break_duration=0,r.audio_break_rate=0,r.video_break_rate=0,r.audio_break_cancel=0,r.video_break_cancel=0,r.rtt=0,r.rendered_sound_level=0,r.audio_break_cancel_duration=0,r.video_break_cancel_duration=0,r.audio_decode_time=0,r.video_decode_time=0,r.real_sampling_interval=0,r.mos=0,r.audio_decode_fps=0,r.video_decode_fps=0,r.video_frames_decoded=0,r.video_frames_dropped=0,r.sample_time_window=0),null!=e.audio_bitrate&&e.hasOwnProperty("audio_bitrate")&&(r.audio_bitrate=e.audio_bitrate),null!=e.video_bitrate&&e.hasOwnProperty("video_bitrate")&&(r.video_bitrate=e.video_bitrate),null!=e.video_network_fps&&e.hasOwnProperty("video_network_fps")&&(r.video_network_fps=e.video_network_fps),null!=e.audio_break_count&&e.hasOwnProperty("audio_break_count")&&(r.audio_break_count=e.audio_break_count),null!=e.video_break_count&&e.hasOwnProperty("video_break_count")&&(r.video_break_count=e.video_break_count),null!=e.downlink_plr&&e.hasOwnProperty("downlink_plr")&&(r.downlink_plr=e.downlink_plr),null!=e.peer_to_peer_plr&&e.hasOwnProperty("peer_to_peer_plr")&&(r.peer_to_peer_plr=e.peer_to_peer_plr),null!=e.peer_to_peer_delay&&e.hasOwnProperty("peer_to_peer_delay")&&(r.peer_to_peer_delay=e.peer_to_peer_delay),null!=e.audio_network_fps&&e.hasOwnProperty("audio_network_fps")&&(r.audio_network_fps=e.audio_network_fps),null!=e.audio_break_duration&&e.hasOwnProperty("audio_break_duration")&&(r.audio_break_duration=e.audio_break_duration),null!=e.video_break_duration&&e.hasOwnProperty("video_break_duration")&&(r.video_break_duration=e.video_break_duration),null!=e.audio_break_rate&&e.hasOwnProperty("audio_break_rate")&&(r.audio_break_rate=e.audio_break_rate),null!=e.video_break_rate&&e.hasOwnProperty("video_break_rate")&&(r.video_break_rate=e.video_break_rate),null!=e.audio_break_cancel&&e.hasOwnProperty("audio_break_cancel")&&(r.audio_break_cancel=e.audio_break_cancel),null!=e.video_break_cancel&&e.hasOwnProperty("video_break_cancel")&&(r.video_break_cancel=e.video_break_cancel),null!=e.rtt&&e.hasOwnProperty("rtt")&&(r.rtt=e.rtt),null!=e.rendered_sound_level&&e.hasOwnProperty("rendered_sound_level")&&(r.rendered_sound_level=e.rendered_sound_level),null!=e.audio_break_cancel_duration&&e.hasOwnProperty("audio_break_cancel_duration")&&(r.audio_break_cancel_duration=e.audio_break_cancel_duration),null!=e.video_break_cancel_duration&&e.hasOwnProperty("video_break_cancel_duration")&&(r.video_break_cancel_duration=e.video_break_cancel_duration),null!=e.audio_decode_time&&e.hasOwnProperty("audio_decode_time")&&(r.audio_decode_time=e.audio_decode_time),null!=e.video_decode_time&&e.hasOwnProperty("video_decode_time")&&(r.video_decode_time=e.video_decode_time),null!=e.real_sampling_interval&&e.hasOwnProperty("real_sampling_interval")&&(r.real_sampling_interval=e.real_sampling_interval),null!=e.mos&&e.hasOwnProperty("mos")&&(r.mos=e.mos),null!=e.audio_decode_fps&&e.hasOwnProperty("audio_decode_fps")&&(r.audio_decode_fps=e.audio_decode_fps),null!=e.video_decode_fps&&e.hasOwnProperty("video_decode_fps")&&(r.video_decode_fps=e.video_decode_fps),null!=e.video_frames_decoded&&e.hasOwnProperty("video_frames_decoded")&&(r.video_frames_decoded=e.video_frames_decoded),null!=e.video_frames_dropped&&e.hasOwnProperty("video_frames_dropped")&&(r.video_frames_dropped=e.video_frames_dropped),null!=e.sample_time_window&&e.hasOwnProperty("sample_time_window")&&(r.sample_time_window=e.sample_time_window),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),n),e.exports=u},5515:function(e){e.exports=function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){return o(t[s][1][e]||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var i=void 0,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,r){"use strict";var n=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=n},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=n.log,l=n.detectBrowser(e),c={browserDetails:l,commonShim:u,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(l.browser){case"chrome":if(!o||!o.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;r("adapter.js shimming chrome."),c.browserShim=o,o.shimGetUserMedia(e),o.shimMediaStream(e),o.shimPeerConnection(e),o.shimOnTrack(e),o.shimAddTrackRemoveTrack(e),o.shimGetSendersWithDtmf(e),o.shimGetStats(e),o.shimSenderReceiverGetStats(e),o.fixNegotiationNeeded(e),u.shimRTCIceCandidate(e),u.shimConnectionState(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e),u.removeAllowExtmapMixed(e);break;case"firefox":if(!s||!s.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=s,s.shimGetUserMedia(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),u.shimRTCIceCandidate(e),u.shimConnectionState(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e);break;case"edge":if(!i||!i.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),c;r("adapter.js shimming edge."),c.browserShim=i,i.shimGetUserMedia(e),i.shimGetDisplayMedia(e),i.shimPeerConnection(e),i.shimReplaceTrack(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=a,a.shimRTCIceServerUrls(e),a.shimCreateOfferLegacy(e),a.shimCallbacksAPI(e),a.shimLocalStreamsAPI(e),a.shimRemoteStreamsAPI(e),a.shimTrackEventTransceiver(e),a.shimGetUserMedia(e),u.shimRTCIceCandidate(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e),u.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return c};var n=l(e("./utils")),o=l(e("./chrome/chrome_shim")),i=l(e("./edge/edge_shim")),s=l(e("./firefox/firefox_shim")),a=l(e("./safari/safari_shim")),u=l(e("./common_shim"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var o;o=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var i=new Event("track");i.track=n.track,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],r.dispatchEvent(i)}),t.stream.getTracks().forEach(function(n){var o;o=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var i=new Event("track");i.track=n,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],r.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else s.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e})},r.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===t.kind?e.createDTMFSender(t):null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var o=r.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){o.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},r.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){var o=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var s=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var u=function(e){i[1](a(s(e)))};return t.apply(this,[u,arguments[0]])}return new Promise(function(e,r){t.apply(o,[function(t){e(a(s(t)))},r])}).then(r,n)}}},r.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s.filterStats(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=o.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),s.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s.filterStats(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,o=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?o=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?o=!0:n=e),e.track===t}),o||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}},r.shimAddTrackRemoveTrackWithNative=a,r.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return a(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var o=new e.MediaStream(t.getTracks());this._streams[t.id]=o,this._reverseStreams[o.id]=t,t=o}n.apply(this,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var n=l(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(t){return l(e,t)})}});var i=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=c(this,arguments[0]),i.apply(this,arguments)):i.apply(this,arguments)};var u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=u.get.apply(this);return""===e.type?e:l(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach(function(n){t._streams[n].getTracks().find(function(t){return e.track===t})&&(r=t._streams[n])}),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function l(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t];r=r.replace(new RegExp(e._streams[n.id].id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function c(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:r})}},r.shimPeerConnection=function(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},r.fixNegotiationNeeded=function(e){s.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function a(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=this.getSenders();r.apply(this,arguments);var o=this.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(o)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),o.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(function(t){var n=r.video&&r.video.width,o=r.video&&r.video.height;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:r.video&&r.video.frameRate||3}},n&&(r.video.mandatory.maxWidth=n),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var r=o.detectBrowser(e),s=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var o="object"===n(e[r])?e[r]:{ideal:e[r]};void 0!==o.exact&&"number"==typeof o.exact&&(o.min=o.max=o.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==o.ideal){t.optional=t.optional||[];var s={};"number"==typeof o.ideal?(s[i("min",r)]=o.ideal,t.optional.push(s),(s={})[i("max",r)]=o.ideal,t.optional.push(s)):(s[i("",r)]=o.ideal,t.optional.push(s))}void 0!==o.exact&&"number"!=typeof o.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=o.exact):["min","max"].forEach(function(e){void 0!==o[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=o[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,o){if(r.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===n(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===n(e.video)){var u=e.video.facingMode;u=u&&("object"===(void 0===u?"undefined":n(u))?u:{ideal:u});var l=r.version<66;if(u&&("user"===u.exact||"environment"===u.exact||"user"===u.ideal||"environment"===u.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||l)){delete e.video.facingMode;var c=void 0;if("environment"===u.exact||"environment"===u.ideal?c=["back","rear"]:"user"!==u.exact&&"user"!==u.ideal||(c=["front"]),c)return t.mediaDevices.enumerateDevices().then(function(t){var r=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return e.label.toLowerCase().includes(t)})});return!r&&t.length&&c.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=u.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=s(e.video),i("chrome: "+JSON.stringify(e)),o(e)})}e.video=s(e.video)}return i("chrome: "+JSON.stringify(e)),o(e)},u=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=(function(e,r,n){a(e,function(e){t.webkitGetUserMedia(e,r,function(e){n&&n(u(e))})})}).bind(t),t.mediaDevices.getUserMedia){var l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(u(e))})})}}}};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")),i=o.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),o=i.default.parseCandidate(e.candidate),s=Object.assign(r,o);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,s.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},r.shimMaxMessageSize=function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=s.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=i.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=i.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},o=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},a=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var o=i.default.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},u=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r(arguments[0])){var e=n(arguments[0]),t=o(e),i=a(arguments[0],e),s=void 0;s=0===t&&0===i?Number.POSITIVE_INFINITY:0===t||0===i?Math.max(t,i):Math.min(t,i);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return s}}),this._sctp=l}return u.apply(this,arguments)}}},r.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},s.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e})}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],o=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},r.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}},r.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),r.apply(this,arguments)}}}};var o,i=(o=e("sdp"))&&o.__esModule?o:{default:o},s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,u.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),s.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},r.shimReplaceTrack=function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var i,s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),a=e("./filtericeservers"),u=(i=e("rtcpeerconnection-shim"))&&i.__esModule?i:{default:i}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof t;return o&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r}),delete e.url,e.urls=o?t[0]:t,!!t.length}})};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return o.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(e){var t=s.detectBrowser(e);if("object"===(void 0===e?"undefined":n(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return i.apply(this,[e||null]).then(function(e){if(t.version<53&&!r)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(r,n)}}},r.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},r.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r}),s.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},r.shimRemoveStream=function(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;s.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)})})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=o.detectBrowser(e),r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){o.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":n(e))&&"object"===n(e.audio)&&(e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","mozAutoGainControl"),s(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},i&&i.prototype.getSettings){var u=i.prototype.getSettings;i.prototype.getSettings=function(){var e=u.apply(this,arguments);return s(e,"mozAutoGainControl","autoGainControl"),s(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var l=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":n(e))&&(e=JSON.parse(JSON.stringify(e)),s(e,"autoGainControl","mozAutoGainControl"),s(e,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[e])}}}};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach(function(n){return t.call(r,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach(function(e){n.includes(e.track)&&t.removeTrack(e)})}})}},r.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,o=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=o.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};var u=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=u,t.setRemoteDescription=u=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=u=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n}}},r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(i(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}).bind(t))},r.shimConstraints=i,r.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var s=e.iceServers[i];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,n.push(s)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function i(e){return e&&void 0!==e.video?Object.assign({},e,{video:o.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=s,r.wrapPeerConnectionEvent=function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,o=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return o.apply(this,arguments);var i=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=i,o.apply(this,[e,i])};var i=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return i.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},r.log=function(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=s(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=s(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=s(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=s(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r},r.compactObject=function e(t){return"object"!==(void 0===t?"undefined":n(t))?t:Object.keys(t).reduce(function(r,o){var i="object"===n(t[o]),s=i?e(t[o]):t[o],a=i&&!Object.keys(s).length;return void 0===s||a?r:Object.assign(r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},o,s))},{})},r.walkStats=a,r.filterStats=function(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var i=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)}),i.forEach(function(t){e.forEach(function(r){r.type===n&&r.trackId===t.id&&a(e,r,o)})}),o};var o=!0,i=!0;function s(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function a(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(function(n){n.endsWith("Id")?a(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(function(t){a(e,e.get(t),r)})}))}},{}],16:[function(e,t,r){"use strict";var n=e("sdp");function o(e,t,r,o,i){var s=n.writeRtpDescription(e.kind,t);if(s+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":i||"active"),s+="a=mid:"+e.mid+"\r\n",s+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var u="msid:"+(o?o.id:"-")+" "+a+"\r\n";s+="a="+u,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+u,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+u,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s}function i(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},o=function(e,t,r,o){var i=n(e.parameters.apt,r),s=n(t.parameters.apt,o);return i&&s&&i.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(n){for(var i=0;i<t.codecs.length;i++){var s=t.codecs[i];if(n.name.toLowerCase()===s.name.toLowerCase()&&n.clockRate===s.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&s.parameters.apt&&!o(n,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(n.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var o=t.headerExtensions[n];if(e.uri===o.uri){r.headerExtensions.push(o);break}}}),r}function s(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function a(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}function u(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,r,n,o){var i=new Event("track");i.track=r,i.receiver=n,i.transceiver={receiver:n},i.streams=o,e.setTimeout(function(){t._dispatchEvent("track",i)})}var c=function(r){var o=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){o[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o="string"==typeof n;return o&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)}),delete e.url,e.urls=o?n[0]:n,!!n.length}})}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var s=r.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(c.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(c.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),c.prototype.onicecandidate=null,c.prototype.onaddstream=null,c.prototype.ontrack=null,c.prototype.onremovestream=null,c.prototype.onsignalingstatechange=null,c.prototype.oniceconnectionstatechange=null,c.prototype.onconnectionstatechange=null,c.prototype.onicegatheringstatechange=null,c.prototype.onnegotiationneeded=null,c.prototype.ondatachannel=null,c.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},c.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},c.prototype.getConfiguration=function(){return this._config},c.prototype.getLocalStreams=function(){return this.localStreams},c.prototype.getRemoteStreams=function(){return this.remoteStreams},c.prototype._createTransceiver=function(e,t){var r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();r.iceTransport=n.iceTransport,r.dtlsTransport=n.dtlsTransport}return t||this.transceivers.push(r),r},c.prototype.addTrack=function(t,r){if(this._isClosed)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw u("InvalidAccessError","Track already exists.");for(var o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(n=this.transceivers[o]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},c.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),n.getTracks().forEach(function(e){r.addTrack(e,n)})}},c.prototype.removeTrack=function(t){if(this._isClosed)throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find(function(e){return e.rtpSender===t});if(!r)throw u("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},c.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var r=t.getSenders().find(function(t){return t.track===e});r&&t.removeTrack(r)})},c.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},c.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},c.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var o=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(o,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;o.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},o.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),o},c.prototype._gather=function(t,r){var o=this,i=this.transceivers[r].iceGatherer;if(!i.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),i.onlocalcandidate=function(e){if(!(o.usingBundle&&r>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,u=!a||0===Object.keys(a).length;if(u)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment;var l=n.writeCandidate(a);s.candidate=Object.assign(s.candidate,n.parseCandidate(l)),s.candidate.candidate=l,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var c=n.getMediaSections(o._localDescription.sdp);c[s.candidate.sdpMLineIndex]+=u?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",o._localDescription.sdp=n.getDescription(o._localDescription.sdp)+c.join("");var d=o.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==o.iceGatheringState&&(o.iceGatheringState="gathering",o._emitGatheringStateChange()),u||o._dispatchEvent("icecandidate",s),d&&(o._dispatchEvent("icecandidate",new Event("icecandidate")),o.iceGatheringState="complete",o._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){i.onlocalcandidate(e)})},0)}},c.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},c.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},c.prototype._transceive=function(e,r,o){var s=i(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),o&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),s.encodings=e.recvEncodingParameters.length?e.recvEncodingParameters:[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},c.prototype.setLocalDescription=function(e){var t,r,o=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(u("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,o.signalingState)||o._isClosed)return Promise.reject(u("InvalidStateError","Can not set local "+e.type+" in state "+o.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach(function(e,t){var r=n.parseRtpParameters(e);o.transceivers[t].localCapabilities=r}),o.transceivers.forEach(function(e,t){o._gather(e.mid,t)});else if("answer"===e.type){t=n.splitSections(o._remoteDescription.sdp),r=t.shift();var a=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach(function(e,t){var s=o.transceivers[t],u=s.iceGatherer,l=s.iceTransport,c=s.dtlsTransport,d=s.localCapabilities,h=s.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length||s.rejected)){var p=n.getIceParameters(e,r),f=n.getDtlsParameters(e,r);a&&(f.role="server"),o.usingBundle&&0!==t||(o._gather(s.mid,t),"new"===l.state&&l.start(u,p,a?"controlling":"controlled"),"new"===c.state&&c.start(f));var g=i(d,h);o._transceive(s,g.codecs.length>0,!1)}})}return o._localDescription={type:e.type,sdp:e.sdp},o._updateSignalingState("offer"===e.type?"have-local-offer":"stable"),Promise.resolve()},c.prototype.setRemoteDescription=function(o){var c=this;if(-1===["offer","answer"].indexOf(o.type))return Promise.reject(u("TypeError",'Unsupported type "'+o.type+'"'));if(!s("setRemoteDescription",o.type,c.signalingState)||c._isClosed)return Promise.reject(u("InvalidStateError","Can not set remote "+o.type+" in state "+c.signalingState));var d={};c.remoteStreams.forEach(function(e){d[e.id]=e});var h=[],p=n.splitSections(o.sdp),f=p.shift(),g=n.matchPrefix(f,"a=ice-lite").length>0,_=n.matchPrefix(f,"a=group:BUNDLE ").length>0;c.usingBundle=_;var m=n.matchPrefix(f,"a=ice-options:")[0];return c.canTrickleIceCandidates=!!m&&m.substr(14).split(" ").indexOf("trickle")>=0,p.forEach(function(s,u){var l=n.splitLines(s),p=n.getKind(s),m=n.isRejected(s)&&0===n.matchPrefix(s,"a=bundle-only").length,v=l[0].substr(2).split(" ")[2],E=n.getDirection(s,f),T=n.parseMsid(s),y=n.getMid(s)||n.generateIdentifier();if(m||"application"===p&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v))c.transceivers[u]={mid:y,kind:p,protocol:v,rejected:!0};else{var S,C,R,b,I,k,O,L,P;!m&&c.transceivers[u]&&c.transceivers[u].rejected&&(c.transceivers[u]=c._createTransceiver(p,!0));var A,N,M=n.parseRtpParameters(s);m||(A=n.getIceParameters(s,f),(N=n.getDtlsParameters(s,f)).role="client"),O=n.parseRtpEncodingParameters(s);var w=n.parseRtcpParameters(s),D=n.matchPrefix(s,"a=end-of-candidates",f).length>0,U=n.matchPrefix(s,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===o.type||"answer"===o.type)&&!m&&_&&u>0&&c.transceivers[u]&&(c._disposeIceAndDtlsTransports(u),c.transceivers[u].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[u].iceTransport=c.transceivers[0].iceTransport,c.transceivers[u].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[u].rtpSender&&c.transceivers[u].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[u].rtpReceiver&&c.transceivers[u].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),"offer"!==o.type||m)"answer"!==o.type||m||(C=(S=c.transceivers[u]).iceGatherer,R=S.iceTransport,b=S.dtlsTransport,I=S.rtpReceiver,k=S.sendEncodingParameters,L=S.localCapabilities,c.transceivers[u].recvEncodingParameters=O,c.transceivers[u].remoteCapabilities=M,c.transceivers[u].rtcpParameters=w,U.length&&"new"===R.state&&(!g&&!D||_&&0!==u?U.forEach(function(e){a(S.iceTransport,e)}):R.setRemoteCandidates(U)),_&&0!==u||("new"===R.state&&R.start(C,A,"controlling"),"new"===b.state&&b.start(N)),!i(S.localCapabilities,S.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&S.sendEncodingParameters[0].rtx&&delete S.sendEncodingParameters[0].rtx,c._transceive(S,"sendrecv"===E||"recvonly"===E,"sendrecv"===E||"sendonly"===E),!I||"sendrecv"!==E&&"sendonly"!==E?delete S.rtpReceiver:(P=I.track,T?(d[T.stream]||(d[T.stream]=new e.MediaStream),r(P,d[T.stream]),h.push([P,I,d[T.stream]])):(d.default||(d.default=new e.MediaStream),r(P,d.default),h.push([P,I,d.default]))));else{(S=c.transceivers[u]||c._createTransceiver(p)).mid=y,S.iceGatherer||(S.iceGatherer=c._createIceGatherer(u,_)),U.length&&"new"===S.iceTransport.state&&(!D||_&&0!==u?U.forEach(function(e){a(S.iceTransport,e)}):S.iceTransport.setRemoteCandidates(U)),L=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(L.codecs=L.codecs.filter(function(e){return"rtx"!==e.name})),k=S.sendEncodingParameters||[{ssrc:1001*(2*u+2)}];var x,B=!1;"sendrecv"===E||"sendonly"===E?(B=!S.rtpReceiver,I=S.rtpReceiver||new e.RTCRtpReceiver(S.dtlsTransport,p),B&&(P=I.track,T&&"-"===T.stream||(T?(d[T.stream]||(d[T.stream]=new e.MediaStream,Object.defineProperty(d[T.stream],"id",{get:function(){return T.stream}})),Object.defineProperty(P,"id",{get:function(){return T.track}}),x=d[T.stream]):(d.default||(d.default=new e.MediaStream),x=d.default)),x&&(r(P,x),S.associatedRemoteMediaStreams.push(x)),h.push([P,I,x]))):S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach(function(t){var r=t.getTracks().find(function(e){return e.id===S.rtpReceiver.track.id});r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)}),S.associatedRemoteMediaStreams=[]),S.localCapabilities=L,S.remoteCapabilities=M,S.rtpReceiver=I,S.rtcpParameters=w,S.sendEncodingParameters=k,S.recvEncodingParameters=O,c._transceive(c.transceivers[u],!1,B)}}}),void 0===c._dtlsRole&&(c._dtlsRole="offer"===o.type?"active":"passive"),c._remoteDescription={type:o.type,sdp:o.sdp},c._updateSignalingState("offer"===o.type?"have-remote-offer":"stable"),Object.keys(d).forEach(function(t){var r=d[t];if(r.getTracks().length){if(-1===c.remoteStreams.indexOf(r)){c.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){c._dispatchEvent("addstream",n)})}h.forEach(function(e){r.id===e[2].id&&l(c,e[0],e[1],[r])})}}),h.forEach(function(e){e[2]||l(c,e[0],e[1],[])}),e.setTimeout(function(){c&&c.transceivers&&c.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},c.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},c.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},c.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},c.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},c.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},c.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,s=r.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(i=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(s=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?--i<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});i>0||s>0;)i>0&&(r._createTransceiver("audio"),i--),s>0&&(r._createTransceiver("video"),s--);var l=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(o,i){var s=o.track,a=o.kind,u=o.mid||n.generateIdentifier();o.mid=u,o.iceGatherer||(o.iceGatherer=r._createIceGatherer(i,r.usingBundle));var l=e.RTCRtpSender.getCapabilities(a);t<15019&&(l.codecs=l.codecs.filter(function(e){return"rtx"!==e.name})),l.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),o.remoteCapabilities&&o.remoteCapabilities.codecs&&o.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),l.headerExtensions.forEach(function(e){(o.remoteCapabilities&&o.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var c=o.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];s&&t>=15019&&"video"===a&&!c[0].rtx&&(c[0].rtx={ssrc:c[0].ssrc+1}),o.wantReceive&&(o.rtpReceiver=new e.RTCRtpReceiver(o.dtlsTransport,a)),o.localCapabilities=l,o.sendEncodingParameters=c}),"max-compat"!==r._config.bundlePolicy&&(l+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){l+=o(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,l+="a="+n.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))});var c=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(c)},c.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n";var a=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,n){if(!(n+1>a)){if(e.rejected)return"application"===e.kind?s+="DTLS/SCTP"===e.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var u;e.stream&&("audio"===e.kind?u=e.stream.getAudioTracks()[0]:"video"===e.kind&&(u=e.stream.getVideoTracks()[0]),u&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var l=i(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=o(e,l,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var l=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(l)},c.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(o,i){if(!r._remoteDescription)return i(u("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<r.transceivers.length;l++)if(r.transceivers[l].mid===e.sdpMid){s=l;break}var c=r.transceivers[s];if(!c)return i(u("OperationError","Can not add ICE candidate"));if(c.rejected)return o();var d=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return o();if(d.component&&1!==d.component)return o();if((0===s||s>0&&c.iceTransport!==r.transceivers[0].iceTransport)&&!a(c.iceTransport,d))return i(u("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[s]+="a="+(d.type?h:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var p=0;p<r.transceivers.length&&(r.transceivers[p].rejected||(r.transceivers[p].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));p++);o()})},c.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)}),!r)throw u("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&n.push(e[t].getStats())})}),Promise.all(n).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])}),t})}}});var d=["createOffer","createAnswer"];return d.forEach(function(e){var t=c.prototype[e];c.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(d=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=c.prototype[e];c.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=c.prototype[e];c.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),c}},{sdp:17}],17:[function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<n.length;o++)r[(t=n[o].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(e.parameters[t]?t+"="+e.parameters[t]:t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),o=3;o<r.length;o++){var i=r[o],s=n.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){var a=n.parseRtpMap(s),u=n.matchPrefix(e,"a=fmtp:"+i+" ");switch(a.parameters=u.length?n.parseFmtp(u[0]):{},a.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(n.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var o=0;return t.codecs.forEach(function(e){e.maxptime>o&&(o=e.maxptime)}),o>0&&(r+="a=maxptime:"+o+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],o=n.parseRtpParameters(e),i=-1!==o.fecMechanisms.indexOf("RED"),s=-1!==o.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),u=a.length>0&&a[0].ssrc,l=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===u&&(t=l[0][1]),o.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:u,codecPayloadType:parseInt(e.parameters.apt,10)};u&&t&&(n.rtx={ssrc:t}),r.push(n),i&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:u,mechanism:s?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&u&&r.push({ssrc:u});var c=n.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=c})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var o=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=o.length>0,t.compound=0===o.length;var i=n.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return o.length>0?{stream:(t=o[0].value.split(" "))[0],track:t[1]}:void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var o=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||n.generateSessionId())+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,o){var i=n.writeRtpDescription(e.kind,t);if(i+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",i+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var s="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+s,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),i},n.getDirection=function(e,t){for(var r=n.splitLines(e),o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}]},{},[1])(1)},9869:function(e){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,(function(t){return e[t]}).bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=39)}({16:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_RTM_ACTION=void 0,function(e){e.LIVE_SEND_SIGNAL="zm.lv.ssg",e.LIVE_RESPOND_JOIN_LIVE="zm.lv.rjl",e.LIVE_PUSH_SIGNAL="zm.lv.pss",e.SERVICE_PUSH="zm.sv.ps",e.SERVICE_SEND="zm.sv.sd"}(t.ZEGO_RTM_ACTION||(t.ZEGO_RTM_ACTION={}))},17:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"}}},39:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(40);t.default={type:"live",install:function(e,t,r){for(var o in n.rtmPros)Object.defineProperty(e.prototype,o,{value:n.rtmPros[o],writable:!1});for(var o in n.servicePros)Object.defineProperty(r.prototype,o,{value:n.servicePros[o],writable:!1});for(var o in n.modulePros)Object.defineProperty(t.prototype,o,{value:n.modulePros[o],writable:!1})}}},40:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modulePros=t.servicePros=t.rtmPros=void 0;var n=r(16),o=r(17),i=r(41);t.rtmPros={requestJoinLive:function(e,t,r,n,i){var s=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];return s?s.liveHandler.requestJoinLive(e,t,r,n):(r&&r(o.errorCodeList.ROOM_NOT_EXIST,0),!1)},inviteJoinLive:function(e,t,r,n,i){var s=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];return s?s.liveHandler.inviteJoinLive(e,t,r,n):(r&&r(o.errorCodeList.ROOM_NOT_EXIST,0),!1)},endJoinLive:function(e,t,r,n){var i=this.getRoomModules(n)||this.stateCenter.roomModulesList[0];return i?i.liveHandler.endJoinLive(e,t,r):(r&&r(o.errorCodeList.ROOM_NOT_EXIST,0),!1)},respondJoinLive:function(e,t,r,n,i){var s=this.getRoomModules(i)||this.stateCenter.roomModulesList[0];return s?s.liveHandler.respondJoinLive(e,t,r,n):(n&&n(o.errorCodeList.ROOM_NOT_EXIST,0),!1)}},t.servicePros={handlePushSignalMsg:function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});o?o.liveHandler.handlePushSignalMsg(e):this.logger.error(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))}},t.modulePros={initLiveHandler:function(){this.liveHandler=new i.LiveHandler(this.logger,this.stateCenter,this.service,this.rtm,this)}}},41:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveHandler=void 0;var n=r(42),o=r(16),i=r(17),s=function(){function e(e,t,r,n,o){this.logger=e,this.stateCenter=t,this.service=r,this.rtm=n,this.room=o,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}return e.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},e.prototype.getSignalCmdContent=function(e,t,r){var n={request_id:e,room_id:this.room.roomID,from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,to_userid:t};return null!=r&&(n.result=r),JSON.stringify(n)},e.prototype.requestJoinLive=function(e,t,r,o){var i=this.stateCenter.getRequestId(),s=this.getSignalCmdContent(i,e);return null!=o&&(this.joinLiveCallbackMap[i]=o,this.sendSignalCmd(n.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,s,e,t,r),!0)},e.prototype.sendSignalCmd=function(e,t,r,n,s){var a=this;this.room.isLogin()?(this.service.sendSignalCmd({sub_cmd:e,signal_msg:t,dest_id_name:[r]},function(e){n&&n(e.header.seq)},function(e){var t=i.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(s&&s(t,0));s&&s(a.rtm.getServerError(e.body.err_code),e.header.seq)},this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(o.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" call success"+e)):this.logger.error(o.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" state error")},e.prototype.inviteJoinLive=function(e,t,r,o){var i=this.stateCenter.getRequestId(),s=this.getSignalCmdContent(i,e);return null!=o&&(this.joinLiveCallbackMap[i]=o,this.sendSignalCmd(n.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,s,e,t,r),!0)},e.prototype.endJoinLive=function(e,t,r){var o=this.stateCenter.getRequestId(),i=this.getSignalCmdContent(o,e);return this.sendSignalCmd(n.ENUM_SIGNAL_SUB_CMD.joinLiveStop,i,e,t,r),!0},e.prototype.respondJoinLive=function(e,t,r,i){var s=this.joinLiveRequestMap[e];if(!s)return this.logger.info(o.ZEGO_RTM_ACTION.LIVE_RESPOND_JOIN_LIVE+" no dest id name"),!1;var a=0;!0===t&&(a=1);var u=this.getSignalCmdContent(e,s,a);return this.sendSignalCmd(n.ENUM_SIGNAL_SUB_CMD.joinLiveResult,u,s,r,i),delete this.joinLiveRequestMap[e],!0},e.prototype.handlePushSignalMsg=function(e){var t=JSON.parse(e.body.signal_msg);switch(this.logger.info(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" hpsm= ",t),e.body.sub_cmd){case n.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(t);break;case n.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(t);break;case n.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(t);break;case n.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(t)}},e.prototype.handlePushJoinLiveRequestMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.joinLiveRequestMap[t]=r,this.onRecvJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvJoinLiveRequest "+r)):this.logger.error(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvJoinLiveRequest=function(e,t,r,n){this.stateCenter.actionListener("recvJoinLiveRequest",e,t,r,n)},e.prototype.handlePushJoinLiveInviteMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.joinLiveRequestMap[t]=r,this.onRecvInviteJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvInviteJoinLiveRequest "+r)):this.logger.error(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+"no requestId")},e.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,n){this.stateCenter.actionListener("recvInviteJoinLiveRequest",e,t,r,n)},e.prototype.handlePushJoinLiveResultMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.result;if(null!=r){var n=1==r;if(this.joinLiveCallbackMap[t]){var i=this.joinLiveCallbackMap[t];if(!i)return void this.logger.info(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no callback");this.logger.info(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" joinLiveRequest/invite result "+n),delete this.joinLiveCallbackMap[t],i(n,e.from_userid,e.from_username)}}else this.logger.info(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no result")}else this.logger.error(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"==typeof t?(this.logger.info(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id)):this.logger.error(o.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvEndJoinLiveCommand=function(e,t,r,n){this.stateCenter.actionListener("recvEndJoinLiveCommand",e,t,r,n)},e}();t.LiveHandler=s},42:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=void 0,t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004}}})},3126:function(e){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,(function(t){return e[t]}).bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=36)}({13:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_RTM_ACTION=void 0,function(e){e.ZEGOEXPRESSWEBRTM_SEND_CUSTOM="zm.scc",e.ZEGOEXPRESSWEBRTM_SEND_BCM="zm.sbcm",e.ZEGOEXPRESSWEBRTM_SEND_RLM="zm.srlm",e.ZEGOEXPRESSWEBRTM_SEND_BRM="zm.sbrm",e.ZEGOEXPRESSWEBRTM_SEND_RAM="zm.sram",e.MESSAGE_SEND_RELIABLE="zm.msg.sdr",e.MESSAGE_FETCH_RELIABLE="zm.msg.frm",e.MESSAGE_RELIABLE_RSP="zm.msg.rlr",e.MESSAGE_RELIABLE_PUSH="zm.msg.rps",e.MESSAGE_SEND_ROOM_MSG="zm.msg.srm",e.MESSAGE_SEND_CUSTOM_MSG="zm.msg.scm",e.MESSAGE_SEND_BIG_MSG="zm.msg.sbm",e.MESSAGE_BIG_MSG_PUSH="zm.msg.bps",e.MESSAGE_SEND_RELAY_MSG="zm.msg.slm",e.SERVICE_PUSH="zm.sv.ps"}(t.ZEGO_RTM_ACTION||(t.ZEGO_RTM_ACTION={}))},14:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTMLogEvent=void 0;var n=r(8),o=function(e){return e};t.ZegoRTMLogEvent={kZegoTaskLiveSendRoomBigIM:{event:"/liveroom/send_big_room_message",room_sid:o,error:{INPUT_PARAM:n.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:n.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:n.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:n.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendCustomCommand:{event:"/liveroom/send_custom_command",room_sid:o,error:{INPUT_PARAM:n.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:n.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:n.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:n.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendRoomMessage:{event:"/liveroom/send_room_message",room_sid:o,error:{INPUT_PARAM:n.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:n.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:n.errorCodeList.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:n.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendReliableMessage:{event:"/liveroom/send_reliable_message",room_sid:o,error:{INPUT_PARAM:n.errorCodeList.INPUT_PARAM,TRANS_FREQUENTLY:n.errorCodeList.TRANS_FREQUENTLY,ROOM_NOT_EXIST:n.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskLiveGetRoomBigIM:{event:"/liveroom/get_big_room_message"},kZegoTaskLiveRoomGetRoomMessage:{event:"/liveroom/get_room_message",room_sid:o},kZegoTaskLiveRoomGetCustomCommand:{event:"/liveroom/get_custom_command"}}},15:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_MESSAGE_LENGTH=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.ERROR_CODES=void 0,t.ERROR_CODES={FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.MAX_MESSAGE_LENGTH=1024},36:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(37);t.default={type:"message",install:function(e,t,r,o,i){for(var s in n.rtmPros)Object.defineProperty(e.prototype,s,{value:n.rtmPros[s],writable:!1});for(var s in n.servicePros)Object.defineProperty(r.prototype,s,{value:n.servicePros[s],writable:!1}),Object.defineProperty(i.prototype,s,{value:n.servicePros[s],writable:!1});for(var s in n.modulePros)Object.defineProperty(t.prototype,s,{value:n.modulePros[s],writable:!1}),Object.defineProperty(o.prototype,s,{value:n.modulePros[s],writable:!1})}}},37:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modulePros=t.initMessageHandler=t.servicePros=t.handleBigImMsgRsp=t.handlePushTransMsg=t.handlePushMergeMsg=t.handlePushCustomMsg=t.handlePushRoomMsg=t.rtmPros=void 0;var n=r(13),o=r(14),i=r(15),s=r(38),a=r(8);function u(e,t,r,s){var a=this;return void 0===r&&(r=1),void 0===s&&(s=1),new Promise(function(u,l){var c=a.getReportSeq();a.dataReport.newReport(c,o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.event);var d=a.proxyRes(a.dataReport,c,u,l),h=d.interResolve,p=d.interReject;if("string"!=typeof e||""==e)return a.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return a.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message is empty"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_NULL);if("string"!=typeof t)return a.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message must be string"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param message error");if(t.length>i.MAX_MESSAGE_LENGTH)return a.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message too long"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_TOO_LONG);var f="PUBLIC"==a.stateCenter.type?a.getRoomModules(e):a.stateCenter.priModules;f?(a.dataReport.addMsgInfo(c,{room_sid:o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.room_sid(f.sessionID)}),f.messageHandler.sendRoomMsg(r,s,e,t,h,p)):p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.ROOM_NOT_EXIST)})}function l(e,t,r){var s=this;return new Promise(function(u,l){var c=s.getReportSeq();s.dataReport.newReport(c,o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.event);var d=s.proxyRes(s.dataReport,c,u,l),h=d.interResolve,p=d.interReject;if("string"!=typeof e||""==e)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" roomid must be string and not empty"),void p(a.errorCodeList.INPUT_PARAM," param roomID error");if(!(r instanceof Array)||r.find(function(e){return"string"!=typeof e}))return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" dstMembers must be string array"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param toUserList error");if("PUBLIC"===s.stateCenter.type&&"string"!=typeof t&&"object"!=typeof t)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a non empty string or object"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("PRIVATE"===s.stateCenter.type&&"string"!=typeof t)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a not empty string"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("string"==typeof t&&t.length>i.MAX_MESSAGE_LENGTH)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" command too long"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.IM_CONTENT_TOO_LONG);var f="PUBLIC"==s.stateCenter.type?s.getRoomModules(e):s.stateCenter.priModules;f?(s.dataReport.addMsgInfo(c,{room_sid:o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.room_sid(f.sessionID)}),f.messageHandler.sendCustomCommand(r,t,h,p)):p(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.ROOM_NOT_EXIST)})}function c(e,t,r,s){var a=this;return void 0===r&&(r=1),void 0===s&&(s=1),new Promise(function(u,l){var c=a.getReportSeq();a.dataReport.newReport(c,o.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.event);var d=a.proxyRes(a.dataReport,c,u,l),h=d.interResolve,p=d.interReject;if("string"!=typeof e||""==e)return a.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+"roomid must be string and not empty"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return a.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message is empty"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_NULL);if("string"!=typeof t)return a.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message must be string"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param message error");if(t.length>i.MAX_MESSAGE_LENGTH)return a.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message too long"),void p(o.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_TOO_LONG);var f="PUBLIC"==a.stateCenter.type?a.getRoomModules(e):a.stateCenter.priModules;f?(a.dataReport.addMsgInfo(c,{room_sid:o.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.room_sid(f.sessionID)}),f.messageHandler.sendBigRoomMessage(r,s,e,t,h,p)):p(o.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.ROOM_NOT_EXIST)})}function d(e,t,r){var s=this;return new Promise(function(a,u){var l=s.getReportSeq();s.dataReport.newReport(l,o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.event);var c=s.proxyRes(s.dataReport,l,a,u),d=c.interResolve,h=c.interReject;if("string"!=typeof e||""==e)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void h(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(!t||"string"!=typeof t)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type must be string"),void h({errorCode:o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(t.length>i.MAX_TRANS_TYPE_LENGTH)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void h({errorCode:o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(!r||"string"!=typeof r)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" data must be string"),void h({errorCode:o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(r.length>i.MAX_TRANS_DATA_LENGTH)return s.logger.error(n.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void h({errorCode:o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});var p="PUBLIC"==s.stateCenter.type?s.getRoomModules(e):s.stateCenter.priModules;p?(s.dataReport.addMsgInfo(l,{room_sid:o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.room_sid(p.sessionID)}),p.messageHandler.sendReliableMessage(t,r,d,h)):h(o.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.ROOM_NOT_EXIST)})}function h(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o="PUBLIC"==this.stateCenter.type?this.rtm.getRoomModules(r):this.stateCenter.priModules;o?o.messageHandler.handlePushRoomMsg(e):this.logger.error(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))}function p(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o="PUBLIC"==this.stateCenter.type?this.rtm.getRoomModules(r):this.stateCenter.priModules;o?o.messageHandler.handlePushCustomMsg(e):this.logger.error(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))}function f(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o="PUBLIC"==this.stateCenter.type?this.rtm.getRoomModules(r):this.stateCenter.priModules;o?o.messageHandler.handlePushMergeMsg(e):this.logger.error(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))}function g(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o="PUBLIC"==this.stateCenter.type?this.rtm.getRoomModules(r):this.stateCenter.priModules;o?o.messageHandler.handlePushTransMsg(e):this.logger.error(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))}function _(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,o="PUBLIC"==this.stateCenter.type?this.rtm.getRoomModules(r):this.stateCenter.priModules;o?o.messageHandler.handleBigImMsgRsp(e):this.logger.error(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))}function m(){this.messageHandler=new s.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service,this.rtm,this)}t.rtmPros={_sendBroadcastMessage:u,sendBroadcastMessage:function(e,t){var r=this;return new Promise(function(n,o){u.call(r,e,t).then(function(e){n({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})}).catch(function(e){o(e)})})},_sendCustomCommand:l,sendCustomCommand:function(e,t,r){var n=this;return new Promise(function(o,i){l.call(n,e,t,r).then(function(e){o({errorCode:e.errorCode,extendedData:e.extendedData})}).catch(function(e){i(e)})})},_sendBarrageMessage:c,sendBarrageMessage:function(e,t){var r=this;return new Promise(function(n,o){c.call(r,e,t).then(function(e){n({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})}).catch(function(e){o(e)})})},_setRoomExtraInfo:d,setRoomExtraInfo:function(e,t,r){return d.call(this,e,t,r)},sendRelayMessage:function(e,t,r,n,o){var i=this.getRoomModules(o)||this.stateCenter.roomModulesList[0];i?i.messageHandler.sendRelayMessage(e,t,r,n):n&&n(a.errorCodeList.ROOM_NOT_EXIST,0)}},t.handlePushRoomMsg=h,t.handlePushCustomMsg=p,t.handlePushMergeMsg=f,t.handlePushTransMsg=g,t.handleBigImMsgRsp=_,t.servicePros={handlePushRoomMsg:h,handlePushCustomMsg:p,handlePushMergeMsg:f,handlePushTransMsg:g,handleBigImMsgRsp:_},t.initMessageHandler=m,t.modulePros={initMessageHandler:m}},38:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var n=r(8),o=r(13),i=r(14),s=r(15),a=function(){function e(e,t,r,n,o,i){var s=this;this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=n,this.rtm=o,this.room=i,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.isReliable=!1,this.transSeqMap={},this.onRecvReliableMessage=function(e){var t=(e=e.filter(function(e){return e.trans_idname!==s.stateCenter.idName})).map(function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}});s.stateCenter.actionListener("roomExtraInfoUpdate",s.room.roomID,t),e.forEach(function(e){s.stateCenter.actionListener("recvReliableMessage",e.trans_type,e.trans_seq,e.trans_data)})},this.realyMessageList=[]}return e.prototype.loginRsp=function(e){var t=this;if(null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp){var r=parseFloat(e.body.ret_timestamp);this.serverTimeOffset=0==r?0:e.body.ret_timestamp-(new Date).getTime()}if(e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.datiTimeWindow=e.body.dati_time_window),e.body.trans_seqs)for(var n=0;n<e.body.trans_seqs.length;n++){var o=e.body.trans_seqs[n].trans_channel,i=e.body.trans_seqs[n].trans_seq_array;(i=(i=i.filter(function(e){var r=e.trans_type;return!t.transSeqMap[r]||t.transSeqMap[r].seq<e.trans_seq})).map(function(e){return{trans_type:e.trans_type,trans_local_seq:e.trans_seq}})).length>0&&this.fetchReliableMessage(o,i)}},e.prototype.sendReliableMessage=function(e,t,r,s){var a=this;if(this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" call"),this.isReliable)return this.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" send too often"),void s(i.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.TRANS_FREQUENTLY);this.transSeqMap[e]||(this.transSeqMap[e]={seq:0});var u={trans_type:e,trans_data:t,trans_local_seq:this.transSeqMap[e].seq,trans_channel:"clt"};this.isReliable=!0,this.service.sendReliableMessage(u,function(t){a.transSeqMap[e].seq=t.body.trans_seq,a.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" trans "+e+" seq "+t.body.trans_seq),a.isReliable=!1,r({seq:t.header.seq,errorCode:0})},function(e){var t=n.errorCodeList.ROOM_INNER_ERROR;e.body&&e.body.err_code?(t=a.rtm.getServerError(e.body.err_code),a.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+t.msg)):t=e==n.errorCodeList.TIMEOUT?n.errorCodeList.IM_SEND_FAILED:e,a.isReliable=!1,s(t)},this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.fetchReliableMessage=function(e,t){var r=this,n=function(e){r.handleFetchTransRsp(e)};this.service.fetchReliableMessage({trans_channel:e,fetch_array:t},n,n,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_FETCH_RELIABLE+" call success")},e.prototype.handleFetchTransRsp=function(e){if(e.body&&0!=e.body.err_code)this.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e.body.err_code);else if(e.header&&e.body){var t=e.body.trans_fetch_results,r=[];if(Array.isArray(t)&&t.length>0)for(var n=0;n<t.length;n++){var i=t[n];if(i.err_code!==s.ERROR_CODES.FETCH_TRANS_UNKNOWN_TYPE){var a=i.trans_type,u=i.trans_seq;i.err_code!==s.ERROR_CODES.FETCH_TRANS_WRONG_SEQ?(!this.transSeqMap[a]||this.transSeqMap[a].seq<u?(this.transSeqMap[a]={seq:u},r.push(i)):this.logger.warn(o.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq wrong"),r.length>0&&this.onRecvReliableMessage(r)):(this.logger.warn(o.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq is wrong "+i.err_code),this.transSeqMap[a]={seq:u})}else this.logger.warn(o.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans unknown type "+i.err_code)}}else this.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e)},e.prototype.handlePushTransMsg=function(e){var t=e.body.trans_type,r=e.body.trans_seq;!this.transSeqMap[t]||this.transSeqMap[t].seq<r?(this.transSeqMap[t]={seq:r},this.onRecvReliableMessage([e.body])):this.logger.warn(o.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans seq wrong"),this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans "+t+" seq "+r)},e.prototype.sendRoomMsg=function(e,t,r,i,s,a){var u=this;if(!this.room.isLogin())return this.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" state error"),!1;var l=Date.parse(new Date+"");return this.sendRoomMsgTime>0&&this.sendRoomMsgTime+this.sendRoomMsgInterval>l?(this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" freq error"),a&&a(n.errorCodeList.FREQ_LIMITED,0,e,i),!1):(this.sendRoomMsgTime=l,this.service.sendRoomMsg("PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_category:e,msg_type:1,msg_content:i}:{msg_category:e,msg_type:1,msg_content:i},function(e){s({seq:e.header.seq,errorCode:0,messageID:e.body.msg_id})},function(e){var t,r,i=n.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(i=e),void a({seq:0,errorCode:i.code,messageID:0});i=(t=[u.rtm.getServerError("PRIVATE"==u.stateCenter.type?e.body.code:e.body.err_code),e.body.msg_id])[0],r=t[1],u.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+i.msg),u.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+i.msg),i==n.errorCodeList.TIMEOUT&&(i=n.errorCodeList.IM_SEND_FAILED),a({seq:e.header.seq,errorCode:i.code,messageID:r})},this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  call success"),!0)},e.prototype.handlePushRoomMsg=function(e){var t=this,r=this.rtm.getReportSeq();this.dataReport.newReport(r),this.dataReport.addMsgInfo(r,{room_sid:i.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.room_sid(e.header.session_id)});var n=[];e.body.chat_data.forEach("PRIVATE"==this.stateCenter.type?function(e){n.push({fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}),t.dataReport.addMsgInfo(r,{from_msg_id:e.id_name})}:function(e){n.push({fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}),t.dataReport.addMsgInfo(r,{from_msg_id:e.id_name})}),this.dataReport.uploadReport(r,i.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.event),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.room.roomID,n),this.stateCenter.actionListener("_recvRoomMsg",e.body.chat_data,e.body.server_msg_id,e.body.ret_msg_id)},e.prototype.sendCustomCommand=function(e,t,r,i){var s=this;if(!this.room.isLogin())return this.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" state error"),!1;var a={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.room.roomID},u="PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},request_id:this.stateCenter.getRequestId(),msg:t,destids:e}:{dest_id_name:e,custom_msg:JSON.stringify(a)};return this.service.sendCustomCommand(u,function(e){r({seq:e.header.seq,errorCode:0})},function(e){var t=s.rtm.getServerError("PRIVATE"==s.stateCenter.type?e.body.code:e.body.err_code);s.logger.error(o.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" "+t.msg),i({seq:e.header.seq,errorCode:(t==n.errorCodeList.TIMEOUT?n.errorCodeList.IM_SEND_FAILED:t).code})},this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" call success"),!0},e.prototype.handlePushCustomMsg=function(e){var t,r,n,o,s,a;if("PRIVATE"==this.stateCenter.type)n=(t=[e.body.from_user_id,e.body.from_user_name,this.room.roomID,e.body.msg])[0],o=t[1],s=t[2],a=t[3];else{var u=JSON.parse(e.body.custommsg);n=(r=[u.from_userid,u.from_username,u.room_id,u.custom_content])[0],o=r[1],s=r[2],a=r[3]}var l=this.rtm.getReportSeq();this.dataReport.newReport(l),this.dataReport.uploadReport(l,i.ZegoRTMLogEvent.kZegoTaskLiveRoomGetCustomCommand.event),this.stateCenter.actionListener("IMRecvCustomCommand",s,{userID:n,userName:o},a)},e.prototype.sendBigRoomMessage=function(e,t,r,n,o,i){var s=this,a=this.bigimTimeWindow,u=this.serverTimeOffset,l=(new Date).getTime()+u,c=this.rtm.getSeq().toString();if(this.bigImCallbackMap[c]={success:o,error:i},0==a)this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:n,bigmsg_client_id:c}],function(e){s.handleBigImMsgRsp(e)},function(e){i&&i(e)});else{var d=Math.floor(l/a);this.bigImLastTimeIndex<d&&0==this.bigIMmessageList.length?(this.bigImLastTimeIndex=d,this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:n,bigmsg_client_id:c}],function(e){s.handleBigImMsgRsp(e)},function(e){i&&i(e)})):(this.bigIMmessageList.push({msg_category:e,msg_type:1,msg_content:n,bigmsg_client_id:c}),1==this.bigIMmessageList.length&&this.setBigImTimer(u,a))}},e.prototype.sendBigRoomMessageInternal=function(e,t,r){this.service.sendBigRoomMessage({msgs:e},function(e){t(e)},function(e){var t=n.errorCodeList.ROOM_INNER_ERROR;e.header&&e.body||(e.code&&e.msg&&(t=e),r(t)),r(t)},this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_BIG_MSG+" sendBigRoomMessage called")},e.prototype.handleBigImMsgRsp=function(e){this.bigimTimeWindow=e.body.bigim_time_window;for(var t=0;t<e.body.msgs.length;t++){var r=e.body.msgs[t].bigmsg_client_id;if(this.bigImCallbackMap[r]){var n=this.bigImCallbackMap[r].success;null!=n&&n({seq:e.header.seq,errorCode:0,messageID:e.body.msgs[t].bigmsg_id}),delete this.bigImCallbackMap[r]}}},e.prototype.setBigImTimer=function(e,t){var r=this,n=t-((new Date).getTime()+e)%t,o=this.rtm.generateRandumNumber(t)+n;this.bigImTimer=setTimeout(function(){r.onBigImTimer()},o)},e.prototype.onBigImTimer=function(){var e=this,t=(new Date).getTime()+this.serverTimeOffset;this.bigImLastTimeIndex=Math.floor(t/this.bigimTimeWindow);for(var r=[],n=[],o=0;o<this.bigIMmessageList.length&&!(o>=20);o++){var i=this.bigIMmessageList[o];r.push({msg_category:i.msg_category,msg_type:i.msg_type,msg_content:i.msg_content,bigmsg_client_id:i.bigmsg_client_id}),n.push(i.bigmsg_client_id)}this.bigIMmessageList.length>20?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(r,function(t){e.handleBigImMsgRsp(t)},function(t,r){for(var o=0;o<n.length;o++){var i=n[o],s=e.bigImCallbackMap[i];s&&(null!=s.error&&s.error(t,r),delete e.bigImCallbackMap[i])}}),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,this.bigIMmessageList.length>0&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},e.prototype.handlePushMergeMsg=function(e){for(var t=0;t<e.body.messages.length;t++)14001===e.body.messages[t].sub_cmd&&this.handlePushBigRooMsg(e.body.messages[t].msg_body)},e.prototype.handlePushBigRooMsg=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this.logger.warn(o.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"parse json error")}if(t){for(var r=t.room_id,n=[],i=0;i<t.msg_data.length;i++){var s=t.msg_data[i];s.id_name!=this.stateCenter.idName?n.push({idName:s.id_name,nickName:s.nick_name,messageId:s.bigmsg_id,category:s.msg_category,type:s.msg_type,content:s.msg_content,time:s.send_time}):this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" self message")}0==n.length?this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" no other pushData except self"):this.onRecvBigRoomMessage(n,r),this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"call success")}else this.logger.warn(o.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" cann't find message body")},e.prototype.onRecvBigRoomMessage=function(e,t){var r=this.rtm.getReportSeq();this.dataReport.newReport(r);var n=[];e.forEach(function(e){n.push({fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId})}),this.dataReport.uploadReport(r,i.ZegoRTMLogEvent.kZegoTaskLiveGetRoomBigIM.event),this.stateCenter.actionListener("IMRecvBarrageMessage",t,n),this.stateCenter.actionListener("_recvBigRoomMessage",e,t)},e.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},e.prototype.sendRelayMessage=function(e,t,r,n){var o=this.datiTimeWindow,i=this.serverTimeOffset;o>0?(this.realyMessageList.push({type:e,data:t,success:r,error:n}),1==this.realyMessageList.length&&this.setRelayTimer(i,o)):this.sendRelayMessageInternal(e,t,r,n)},e.prototype.sendRelayMessageInternal=function(e,t,r,i){var s=this;this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" call");var a=this.room;this.service.sendRelayMessage({relay_type:e,relay_data:t},function(e){r&&r(e.header.seq,e.body.relay_result)},function(e){var t=n.errorCodeList.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(i&&i(t,0));i&&i(s.rtm.getServerError(e.body.err_code),e.header.seq)},a.sessionID,a.roomID,a.roomSessionID)},e.prototype.setRelayTimer=function(e,t){var r=this,n=2*t-((new Date).getTime()+e)%t,i=this.rtm.generateRandumNumber(n);this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" setTimer "+i),this.relayTimer=setTimeout(function(){r.onRelayTimer()},i)},e.prototype.onRelayTimer=function(){if(0!=this.realyMessageList.length){var e=this.realyMessageList[0];this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),this.realyMessageList.length>0&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow)}else this.logger.info(o.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+"  no relay data")},e.prototype.getRoomChatInfo=function(e,t,r,n){if(this.logger.debug("zb.mh.grc call"),this.room.isLogin()){var o=function(e,t){if(0!==e.body.code)n({errorCode:e.body.code,extendData:e.body.message||""});else{var o=e.body.msg_data.map(function(e){return{fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}});r({chatData:o})}};this.service.sendMessage("zegochat_js.room_im_chat_fetch",{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_id:e,msg_count:t},o,o),this.logger.info("zb.mh.grc call success")}else this.logger.error("zb.mh.srm no enter room")},e}();t.MessageHandler=a},8:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},IM_CONTENT_NULL:{code:1009001,msg:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,msg:"message content is too long"},IM_SEND_FAILED:{code:1009010,msg:"failed to send message"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},TRANS_FREQUENTLY:{code:1102022,msg:"trans send frequently"},FREQ_LIMITED:{code:1109001,msg:"frequency limited."}}}})},4119:function(e){"use strict";e.exports=__WEBPACK_EXTERNAL_MODULE__4119__}},__webpack_module_cache__={};function __nested_webpack_require_1061742__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__nested_webpack_require_1061742__),r.exports}__nested_webpack_require_1061742__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var __webpack_exports__=__nested_webpack_require_1061742__(4780);return __webpack_exports__}()},module.exports=t(__webpack_require__(3276))},3276:function(e){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,(function(t){return e[t]}).bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=19)}([function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.LoggerStateCenter=t.ZegoDataReport=t.ZegoLogger=t.MODULE_TIPS=t.LinkedList=t.ListNode=t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.E_CLIENT_TYPE=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.13.0",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MIX_TASK_ID_LENGTH=256,function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallProgram=2]="ClientType_SmallProgram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={})),t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},t.getSeq=(n=1,function(){return n++}),t.getReportSeq=function(){var e=1;return function(){return e++}}();var o=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=o;var i=function(){function e(){this.start=new o,this.end=new o,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new o(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,n=null;t.hasNext()&&!r;)e(t=t.next)&&(n=t,r=!0);return n},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this.insertBefore(this._numNodes>0?this.start.next:this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=i,t.MODULE_TIPS={MESSAGE:"\u672a\u5f15\u5165\u6d88\u606f\u6a21\u5757"};var s=r(21);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return s.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return s.ZegoDataReport}}),Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return s.LoggerStateCenter}}),Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return s.createZegoWebSocket}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var n=r(22),o=r(0),i=r(1),s=function(){function e(){}return e.checkConfigParam=function(e,t,r){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkPriConfigParam=function(e,t,r,n,o){return e&&"number"==typeof e&&this.checkInteger(e)?t&&"string"==typeof t?"object"!=typeof r||"string"!=typeof r.deviceID?(o.error("ccp.0 deviceID must be string and not empty"),!1):1===n||0===n||(o.error("ccp.0 anType must be 0 or 1"),!1):(o.error("ccp.0 dispatchServer must be string and not empty"),!1):(o.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){t.success&&(r[e+"SuccessCallback"]=t.success),t.error&&(r[e+"ErrorCallback"]=t.error)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,n,o){e.registerCallback(t,{success:function(t,o){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];e.dataReportEvent(r,n,t,o,i)}},o)},e.proxyRes=function(t,r,n,o){return{interResolve:function(e){t.uploadReport(r),n(e)},interReject:function(n,i){var s;void 0===i&&(i=""),(s=n.code<2e9&&n.code>1e9?e.decodeServerError(n.code,n.msg):{code:n.code,message:n.msg})&&t.addMsgInfo(r,{error:s.code,message:s.message+i}),t.uploadReport(r),o({errorCode:n.code})}}},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(0===e)return i.errorCodeList.SUCCESS;var r=i.errorCodeList.ROOM_INNER_ERROR;if(r.code=e,e>1e9){var n=t[e];r.msg=n?"liveroom cmd error, code: "+e+", message: "+n:t[1e9]+e}else r.msg=t[e]?t[e]+" code:"+e:"unknown error code:"+e;return r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return r.code=e>1e9?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={code:e,message:"kickout reason = "+e};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000004,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:t.code=63000005,t.message="zpush token expired",t.name="TOKEN_EXPIRED";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,n,o){switch(r){case"eventStart":e.eventStart(t,n);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,n,o[0]);break;case"addEventMsg":e.addEventMsg(t,n,o[0],o[1]);break;case"addEvent":e.addEvent(t,n);break;case"eventEnd":e.eventEnd(t,n);break;case"addMsgInfo":e.addMsgInfo(t,o[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeUserList=function(e,t,r,n){e.debug("msl.0 call");var o,i=[],s=[];r||(r=[]);for(var a=0;a<r.length;a++){o=!1;for(var u=0;u<t.length;u++)if(r[a].userID===t[u].userID){o=!0;break}o||i.push(r[a])}for(var l=0;l<t.length;l++){o=!1;for(var c=0;c<r.length;c++)if(t[l].userID===r[c].userID){o=!0;break}o||s.push(t[l])}for(t.splice(0),a=0;a<r.length;a++)t.push(t[a]);n(i,s),e.debug("msl.0 call success")},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},e.uuid=function(e,t){var r,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(t=t||n.length,e)for(r=0;r<e;r++)o[r]=n[0|Math.random()*t];else{var i=void 0;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(i=0|16*Math.random(),o[r]=n[19==r?3&i|8:i])}return o.join("")},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var n=0;n<r;n++){var o=parseInt(e[n]),i=parseInt(t[n]);if(o>i)return 1;if(o<i)return-1}return 0},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),n=null!=window.opr,o=e.indexOf("Chrome")&&window.chrome,i=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":n?"Opera":o?"Chrome":i?"Safari":"Unkown"},e.isTestEnv=function(e){return-1!=e.indexOf("wss://wssliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")||-1!=e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")||-1!=e.indexOf("wss://wsliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test-bak.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")||-1!=e.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")},e.getLogLevel=function(e){return o.LOG_LEVEL[e]},e.getUint64=function(e,t,r){var n=r.getUint32(e,t),o=r.getUint32(e+4,t),i=t?n+Math.pow(2,32)*o:Math.pow(2,32)*n+o;return Number.isSafeInteger(i)||console.warn(i,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),i},e.decodeTokenExpire=function(t){try{var r,o=Uint8Array.from(n.Base64.base64decode(t),function(e){return e.charCodeAt(0)}),i=new DataView(o.buffer);return r="function"==typeof i.getBigInt64?i.getBigUint64(0):e.getUint64(0,!1,i),Number(r>0?r:i.getBigUint64(0,!0))}catch(e){console.error("token error")}return-1},e}();t.ClientUtil=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_RTM_ACTION=void 0,function(e){e.ZEGOEXPRESSWEBRTM_CONSTRUCTOR="zm.0",e.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER="zm.wl",e.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG="zm.slf",e.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE="zm.sdv",e.ZEGOEXPRESSWEBRTM_LOGIN_ROOM="zm.lg",e.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM="zm.lo",e.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS="zm.scsu",e.ZEGOEXPRESSWEBRTM_ON="zm.on",e.ZEGOEXPRESSWEBRTM_OFF="zm.off",e.ZEGOEXPRESSWEBRTM_RENEWTOKEN="zm.rntk",e.ZEGOEXPRESSWEBRTM_RESETTOKENTIMER="zm.rstt",e.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM="zm.emr",e.ZEGOEXPRESSWEBRTM_SEND_PB="zm.spb",e.ZEGOEXPRESSWEBRTM_GET_HEADER="zm.gh",e.ROOM_LOGIN_ROOM="zm.rm.lg",e.ROOM_TRY_LOGIN="zm.rm.tl",e.ROOM_OPEN_HANDLER="zm.rm.op",e.ROOM_HANDLE_LOGINRSP="zm.rm.lgr",e.ROOM_CLOSEHANDLER="zm.rm.clh",e.ROOM_LOGOUT="zm.rm.lo",e.ROOM_RESET_ROOM="zm.rm.rr",e.ROOM_DISCONNECT="zm.rm.dcn",e.ROOM_KICK_OUT="zm.rm.kco",e.ROOM_STATUS_CALLBACK="zm.rm.scb",e.ROOM_RESETTOKEN_TIMER="zm.rm.rst",e.HEARTBEAT_START="zm.hb.st",e.HEARTBEAT_HEARTBEAT_RSP="zm.hb.rsp",e.HEARTBEAT_RESET="zm.hb.rst",e.SERVICE_PUSH="zm.sv.ps",e.SERVICE_SEND="zm.sv.sd",e.USER_LOGIN_RSP="zm.us.lgr",e.USER_FETCH_USER="zm.us.ftu",e.USER_FETCH_USER_RSP="zm.us.urp",e.USER_USER_PUSH="zm.us.uph",e.USER_MERGE_SEQ="zm.us.mg",e.USER_MERGE_TIMEOUT="zm.us.mto",e.USER_MERGE="zm.us.mg",e.USER_HB_PATCH="zm.us.pt",e.STATE_ACTION="zm.st.at",e.ON_LISTENER="ON_LISTENER"}(t.ZEGO_RTM_ACTION||(t.ZEGO_RTM_ACTION={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTMLogEvent=void 0;var n=r(1),o=function(e){return e};t.ZegoRTMLogEvent={kZegoTaskInitSetting:{event:"/sdk/init",error:{kInvalidParamError:n.errorCodeList.INPUT_PARAM},system_info:navigator?navigator.appVersion:""},kZegoTaskSetDebug:{event:"/sdk/set_debug",debug:o},kZegoTaskSetLog:{event:"/sdk/set_log_config",error:{kInvalidParamError:n.errorCodeList.INPUT_PARAM},log_level:function(e){return e},remote_log_level:o,log_url:o},kZegoTaskLoginRoom:{event:"/sdk/login",user_update:o,max_member_count:o,message:o,token:o,error:{ROOM_ID_NULL:n.errorCodeList.ROOM_ID_NULL,INPUT_PARAM:n.errorCodeList.INPUT_PARAM,ROOM_ID_TOO_LONG:n.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:n.errorCodeList.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:n.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:n.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:n.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:n.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:n.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:n.errorCodeList.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:n.errorCodeList.LOGIN_TIMEOUT,INNER_ERROR:n.errorCodeList.ROOM_INNER_ERROR,NETWORK_BROKEN:n.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:o,try_cnt:o},liveroom_login:{event:"liveroom_login",server:o,respond_info:o}}},kZegoTaskReNewToken:{event:"/sdk/reNewToken",error:{INPUT_PARAM:n.errorCodeList.INPUT_PARAM,NOT_LOGIN:n.errorCodeList.NOT_LOGIN}},kZegoTaskLogoutRoom:{event:"/sdk/logout",error:{INPUT_PARAM:n.errorCodeList.INPUT_PARAM,ROOM_NOT_EXIST:n.errorCodeList.ROOM_NOT_EXIST}},kZegoTaskReLoginRoom:{event:"/sdk/relogin",error:{ROOM_ID_NULL:n.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:n.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:o,try_cnt:o},liveroom_login:{event:"liveroom_login",server:o,respond_info:o}}},kZegoTaskKickout:{event:"/sdk/kickout",user_id:o,error:{}},kZegoTaskRoomKickout:{event:"/sdk/room_kickout",user_id:o,room_id:o,message:o},kZegoTaskLiveRoomHB:{event:"/liveroom/hb",room_sid:o,error:{NOT_LOGIN:n.errorCodeList.NOT_LOGIN,HB_TIMEOUT:n.errorCodeList.TIMEOUT}},kZegoTaskLiveRoomGetUserUpdateInfo:{event:"/liveroom/get_user_update_info",user_update_type:o},kZegoListener:{event:"/sdk/listener"},kZegoEnableMultiRoom:{event:"sdk/enable_multi_room",error:{kInvalidParamError:n.errorCodeList.INPUT_PARAM,kAlreadyLoginError:n.errorCodeList.ALREADY_LOGIN}},kZegoTaskCloudSettingCache:{event:"/cloud_setting/cache"},kZegoTaskCloudSettingRefresh:{event:"/cloud_setting/refresh"},kZegoTaskCloudSettingRequest:{event:"/cloud_setting/request"}}},,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeatHandler=void 0;var n=r(0),o=r(2),i=r(1),s=r(3),a=r(4),u=3,l=function(){function e(e,t,r,n,o){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=n,this.room=o,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}return e.prototype.init=function(e){var t,r=this;"PRIVATE"==this.stateCenter.type?u=(e.body.hb_timeout||4e4)/(t=e.body.hb_interval<n.MINIUM_HEARTBEAT_INTERVAL?n.MINIUM_HEARTBEAT_INTERVAL:e.body.hb_interval)+1:t=e.body.hearbeat_interval<n.MINIUM_HEARTBEAT_INTERVAL?n.MINIUM_HEARTBEAT_INTERVAL:e.body.hearbeat_interval,this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout(function(){r.start(t)},t),this.initCount++},e.prototype.start=function(e){var t=this;this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" call");var r=n.getReportSeq();if(this.dataReport.newReport(r,a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.event),this.dataReport.addMsgInfo(r,{room_sid:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.room_sid(this.room.sessionID)}),!this.room.isLogin())return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" state error"),this.dataReport.addMsgInfo(r,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.NOT_LOGIN.msg}),void this.dataReport.uploadReport(r);if(++this.tryHeartbeatCount>u)return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" come to try limit"),this.dataReport.addMsgInfo(r,{error:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.code,message:a.ZegoRTMLogEvent.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.msg}),this.dataReport.uploadReport(r),void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT);var l=function(e){if(e.header&&e.body){if(0!==("PRIVATE"==t.stateCenter.type?e.body&&e.body.code:e.body&&e.body.err_code)){var n=o.ClientUtil.decodeServerError(e.body.err_code||e.body.code,e.body.err_message||e.body.message);t.dataReport.addMsgInfo(r,{error:n.code,message:n.message+e.body.err_code})}}else t.dataReport.addMsgInfo(r,{error:e.code>0?e.code:i.errorCodeList.ROOM_INNER_ERROR.code,message:e.msg?e.msg:i.errorCodeList.ROOM_INNER_ERROR});t.dataReport.uploadReport(r),"PRIVATE"==t.stateCenter.type?t.handlePrivateHeartbeatRsp(e):t.handleHeartbeatRsp(e)};this.service.heartBeat(l,l,this.room.sessionID,this.room.roomID,this.room.roomSessionID),this.heartbeatInterval=e;var c=this.heartbeatInterval;this.initCount>=2?(c=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):c=this.heartbeatInterval,this.heartbeatTimer=setTimeout(function(){t.start(t.heartbeatInterval)},c),this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_START+" call success")},e.prototype.handleHeartbeatRsp=function(e){return e.body&&e.body.err_code&&0!==e.body.err_code?(this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.err_code),e.body.err_code==n.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(o.ClientUtil.getServerError(e.body.err_code))):e.header&&e.body?(this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<n.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=n.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),void this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")):(this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, error=",JSON.stringify(e)),void this.hbLogout(e))},e.prototype.handlePrivateHeartbeatRsp=function(e){if(0!==e.body.code)return this.logger.error(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.code),e.body.code==n.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(i.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(o.ClientUtil.getServerError(e.body.code));this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hb_interval,this.heartbeatInterval<n.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=n.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")},e.prototype.heartbeatRspNotiFy=function(e){},e.prototype.hbLogout=function(e){},e.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info(s.ZEGO_RTM_ACTION.HEARTBEAT_RESET+" call success")},e}();t.HeartBeatHandler=l},function(e,t,r){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.UserHandler=void 0;var o=r(0),i=r(2),s=r(3),a=r(4),u=function(){function e(e,t,r,n,o){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=n,this.room=o,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap=null,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}return e.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count),this.logger.info(s.ZEGO_RTM_ACTION.USER_LOGIN_RSP+"  userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList(t)},e.prototype.patchUserList=function(e){var t=this;e.body.server_user_seq!==this.userSeq&&this.stateCenter.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info(s.ZEGO_RTM_ACTION.USER_HB_PATCH+" call update user "+this.userSeq+" server "+e.body.server_user_seq),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout(function(){t.handleMergeTimeout()},this.userListMergeInterval)),this.minUserSeq=e.body.server_user_seq,null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count)},e.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},e.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" the first time call"))},e.prototype.fetchUserListWithPage=function(e,t){var r=this,n=function(e){"PRIVATE"==r.stateCenter.type?r.handleFetchUserListPrivateRsp(e):r.handleFetchUserListRsp(e,t)};"V1"===o.ROOMVERSION?this.service.fetchUserList("PRIVATE"==this.stateCenter.type?{room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid,room_user_session_id:this.room.roomSessionID},mark:"0"}:{user_index:e,sort_type:0},n,n,this.room.sessionID,this.room.roomID,this.room.roomSessionID):this.service.fetchUserListV2({marker:0===e?"":e+"",mode:0,limit:100},n,n,this.room.sessionID,this.room.roomID,this.room.roomSessionID)},e.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(e.body&&0!=e.body.err_code)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e.body.err_code);if(!e.header||!e.body)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e);if(this.stateCenter.userStateUpdate){this.userTempList=n(this.userTempList,e.body.user_baseinfos);var a=e.body.ret_user_index;if(a!=e.body.server_user_index)return this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch another page"),void this.fetchUserListWithPage(a+1,t);this.userSeq=e.body.server_user_seq;for(var u=[],l=[],c=0;c<this.userTempList.length;c++)u.push({userID:this.userTempList[c].id_name,userName:this.userTempList[c].nick_name,role:this.userTempList[c].role}),l.push({idName:this.userTempList[c].id_name,nickName:this.userTempList[c].nick_name,role:this.userTempList[c].role});this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,l),t==o.ENUM_RUN_STATE.login?(this.userList&&i.ClientUtil.mergeUserList(this.logger,this.userList,u,function(e,t){0!==e.length&&r.onUserStateUpdate(r.room.roomID,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.room.roomID,"DELETE",t)}),this.userList=u):(this.userList=u,0!==u.length&&this.onUserStateUpdate(this.room.roomID,"ADD",u)),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" call success user_list "+u+" count "+u.length)}},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" call"),this.stateCenter.userStateUpdate)if(this.userSeq!==e.body.user_list_seq)if(this.userSeq+e.body.user_actions.length===e.body.user_list_seq){this.userSeq=e.body.user_list_seq;var t,r,n=[];if("PRIVATE"==this.stateCenter.type){t=0,r=1;for(var o=0;o<e.body.user_actions.length;o++){var i={action:e.body.user_actions[o].action,idName:e.body.user_actions[o].user_id,nickName:e.body.user_actions[o].user_name,role:e.body.user_actions[o].role,loginTime:e.body.user_actions[o].login_time};n.push(i)}}else{for(t=1,r=2,o=0;o<e.body.user_actions.length;o++)n.push(i={action:e.body.user_actions[o].Action,idName:e.body.user_actions[o].IdName,nickName:e.body.user_actions[o].NickName,role:e.body.user_actions[o].Role,loginTime:e.body.user_actions[o].LoginTime});this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,n)}var a=[],u=[];n.forEach(function(e){e.action==t?a.push({userID:e.idName,userName:e.nickName,role:e.role}):e.action==r&&u.push({userID:e.idName,userName:e.nickName,role:e.role})}),this.userList&&(this.userList=this.userList.concat(a).filter(function(e){return!u.some(function(t){return t.userID==e.userID})})),0!==a.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"ADD",a),0!==u.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"DELETE",u),this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" call success")}else this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else this.logger.warn(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" user_list_seq is the same with local seq");else this.logger.info(s.ZEGO_RTM_ACTION.USER_USER_PUSH+" userStateUpdate is false")},e.prototype.onUserStateUpdate=function(e,t,r){var n=this,i=o.getReportSeq();this.dataReport.newReport(i,a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.event);var s=r.filter(function(e){return e.userID!==n.stateCenter.idName});0!=s.length&&("PRIVATE"!==this.stateCenter.type&&(s=s.map(function(e){return{userID:e.userID,userName:e.userName}})),this.stateCenter.actionListener("roomUserUpdate",e,t,s),this.dataReport.addMsgInfo(i,{user_update_type:a.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("ADD"==t?"added":"deleted")}),this.dataReport.uploadReport(i))},e.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.userSeqMergeMap||(this.logger.warn(s.ZEGO_RTM_ACTION.USER_MERGE_SEQ+" new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout(function(){r.handleMergeTimeout()},this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn(s.ZEGO_RTM_ACTION.USER_MERGE_SEQ+"  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},e.prototype.mergeUser=function(e){var t=this;this.logger.info(s.ZEGO_RTM_ACTION.USER_MERGE+" merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval;var r={};e.forEach(function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach(function(e){r[e.IdName]=e})}),this.userSeqMergeMap=null;var n=Object.values(r).map(function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}});n.sort(function(e,t){return e.loginTime.localeCompare(t.loginTime)});var o=[],i=[];n.forEach(function(e){1==e.action?o.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&i.push({userID:e.idName,userName:e.nickName,role:e.role})}),this.userList=this.userList&&this.userList.concat(o).filter(function(e){return!i.some(function(t){return t.userID==e.userID})}),0!==o.length&&this.onUserStateUpdate(this.room.roomID,"ADD",o),0!==i.length&&this.onUserStateUpdate(this.room.roomID,"DELETE",i),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,n)},e.prototype.handleMergeTimeout=function(){var e=this,t=Object.keys(this.userSeqMergeMap).map(function(e){return+e}).sort(function(e,t){return e-t});if(t[t.length-1]-t[0]+1===t.length||t[t.length-1]>=this.minUserSeq)this.mergeUser(t);else{this.userSeqMergeMap=null;var r=this.lastUserQueryTime-Date.now();this.logger.info(s.ZEGO_RTM_ACTION.USER_MERGE_TIMEOUT+"  fetch merge userlist "+this.userSeq+" userSeqList "+t.join(",")+" wait "+r),r>0?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout(function(){e.fetchUserList()},r)):this.fetchUserList()}},e.prototype.loginPrivateRsp=function(e){this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER," userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList()},e.prototype.handleFetchUserListPrivateRsp=function(e){if(this.logger.debug(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" call"),e.body.code&&0!==e.body.code)return this.userQuerying=!1,void this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" fetch error "+e.body.code+" "+e.body.message);if(this.stateCenter.userStateUpdate){this.userTempList=n(this.userTempList,e.body.users),this.userSeq=e.body.userlist_seq,this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" set user Seq "+this.userSeq);for(var t=[],r=0;r<this.userTempList.length;r++)t.push({userID:this.userTempList[r].user_id,userName:this.userTempList[r].user_name,role:this.userTempList[r].role});this.userQuerying=!1,this.onUserStateUpdate(this.room.roomID,"ADD",t),this.userTempList=[],this.logger.info(s.ZEGO_RTM_ACTION.USER_FETCH_USER+" call success user_list "+t+" count "+t.length)}},e}();t.UserHandler=u},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomService=void 0;var i=r(0),s=r(12),a=r(3),u=r(1),l=function(){function e(e,t,r){this.stateCenter=e,this.logger=t,this.rtm=r,this.service=new s.ZegoSocketService(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}return e.prototype.checkResponse=function(e){return 0!=this.stateCenter.roomModulesList.filter(function(e){return e.runState!==i.ENUM_RUN_STATE.logout}).length&&(e.header.appid!==this.stateCenter.appid||e.header.user_id!==this.stateCenter.userid)},e.prototype.handleSendCommandMsgRsp=function(e){var t=this,r=this.service.sendCommandMap[e.header.seq];if(null!=r){var n=r._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(r),0===e.body.err_code?setTimeout(function(){n&&null!=n.success&&n.success(e,t.cmdSeq)},0):setTimeout(function(){n&&null!=n.error&&n.error(e,t.cmdSeq)},0)}},e.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){t instanceof ArrayBuffer?e.stateCenter.actionListener("_protobufResponse",t):t.header?(0!==t.body.err_code?t.body.err_message&&e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", err_code="+t.body.err_code+", err_message="+t.body.err_message+" "):e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", msg="+JSON.stringify(t)+" "),["login","logout"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.checkResponse(t)?e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq))):e.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" msg type error ")}},e.prototype.handlePushKickout=function(e){var t,r,n,i;if(void 0===(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.protocol)||1===(null===(r=null==e?void 0:e.body)||void 0===r?void 0:r.protocol))o(this.stateCenter.roomModulesList).forEach(function(t){return t.roomHandler.handlePushKickout(e,!0)});else{var s=null===(n=null==e?void 0:e.header)||void 0===n?void 0:n.room_id,u=this.stateCenter.roomModulesList.find(function(e){return e.roomID==s});if(!u)return void this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(null===(i=e.header)||void 0===i?void 0:i.room_id));u.roomHandler.handlePushKickout(e)}},e.prototype.handlePushCustomMsg=function(e){},e.prototype.handlePushRoomMsg=function(e){},e.prototype.handlePushUserStateUpdateMsg=function(e){var t,r=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,n=this.stateCenter.roomModulesList.find(function(e){return e.roomID==r});n?n.userHandler.handlePushUserStateUpdateMsg(e):this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},e.prototype.handlePushMergeMsg=function(e){},e.prototype.handlePushTransMsg=function(e){},e.prototype.handleBigImMsgRsp=function(e){},e.prototype.handlePushSignalMsg=function(e){},e.prototype.handlePushTokenExpire=function(e){this.stateCenter.actionListener("_tokenExpired",e)},e.prototype.closeHandler=function(e){this.service.closeHandler(e)},e.prototype.openHandler=function(e){this.service.openHandler(e)},e.prototype.errorHandler=function(e){this.service.errorHandler(e)},e.prototype.getHeader=function(e,t,r,n){return{Protocol:"V1"===i.ROOMVERSION?"req":"req_v2",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:t||"",room_id:r||"",room_session_id:n||"",biz_version:this.stateCenter.bizVersion||""}},e.prototype.startCheck=function(){this.service.startCheck()},e.prototype.stopCheck=function(){this.service.stopCheck()},e.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},e.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters=n(n({},this.responseRouters),{push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)},push_token_expire:function(e){t.handlePushTokenExpire(e)}})},e.prototype.closeSocket=function(){this.service.closeSocket()},e.prototype.sendMessage=function(e,t,r,n,o,i){var s,l,c;if(this.service.isDisConnect())return this.logger.error(a.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),n(u.errorCodeList.SOCKET_CLOSE),0;var d=(null==i?void 0:i.roomID)?i.roomID:null===(s=this.stateCenter.roomModulesList[0])||void 0===s?void 0:s.roomID,h=(null==i?void 0:i.roomSessionID)?i.roomSessionID:null===(l=this.stateCenter.roomModulesList[0])||void 0===l?void 0:l.roomSessionID,p=(null==i?void 0:i.sessionID)?i.sessionID:null===(c=this.stateCenter.roomModulesList[0])||void 0===c?void 0:c.sessionID,f=o||this.getHeader(e,p,d,h);return this.logger.info(a.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:f,body:t})),this.service.sendMessage(f,t,r,n)},e.prototype.on=function(e,t){this.responseRouters[e]=t},e.prototype.login=function(e,t,r){var n=this.getHeader(e.isMulti?"enter":"login",e.sessionID,e.roomID,e.roomSessionID),o={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:e.token,version:this.stateCenter.sdKVersion,room_name:e.roomID,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:0===this.stateCenter.ENV?i.E_CLIENT_TYPE.ClientType_Webrtc:i.E_CLIENT_TYPE.ClientType_SmallProgram,third_token:e.thirdToken,user_count_limit:this.stateCenter.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",login_logic:this.stateCenter.isMultiRoom?3:1,proto_format:this.stateCenter.protoFormat};return this.sendMessage("",o,t,r,n)},e.prototype.logout=function(e,t,r){var n=e.isMulti?"quit":"logout",o={reserve:0};return"logout"==n&&(o.login_logic=this.stateCenter.isMultiRoom?3:1),this.sendMessage(n,o,t,r,void 0,{sessionID:e.sessionID,roomID:e.roomID,roomSessionID:e.roomSessionID})},e.prototype.heartBeat=function(e,t,r,n,o){return this.sendMessage("hb",{reserve:0},e,t,void 0,{sessionID:r,roomID:n,roomSessionID:o})},e.prototype.fetchUserList=function(e,t,r,n,o,i){return this.sendMessage("user_list",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.fetchUserListV2=function(e,t,r,n,o,i){return this.sendMessage("user_list_v2",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.fetchReliableMessage=function(e,t,r,n,o,i){return this.sendMessage("trans_fetch",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.sendReliableMessage=function(e,t,r,n,o,i){return this.sendMessage("trans",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.sendRoomMsg=function(e,t,r,n,o,i){return this.sendMessage("im_chat",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.sendCustomCommand=function(e,t,r,n,o,i){return this.sendMessage("custommsg",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.sendBigRoomMessage=function(e,t,r,n,o,i){return this.sendMessage("bigim_chat",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.sendRelayMessage=function(e,t,r,n,o,i){return this.sendMessage("relay",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.sendSignalCmd=function(e,t,r,n,o,i){return this.sendMessage("signal",e,t,r,void 0,{sessionID:n,roomID:o,roomSessionID:i})},e.prototype.sendPB=function(e){return this.service.isDisConnect()||this.stateCenter.networkState==i.ENUM_NETWORK_STATE.offline?(this.logger.error(a.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" socket is disconnected"),!1):this.service.sendPB(e)},e}();t.LiveRoomService=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSocketService=void 0;var n=r(0),o=r(1),i=function(){function e(e){this.socket=null,this.sendCommandList=new n.LinkedList,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=e}return e.prototype.createSocket=function(e){this.socket=n.createZegoWebSocket(e,this.ENV%2)},e.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},e.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},e.prototype.sendMessage=function(e,t,r,n,o){void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o={timeOut:6e3});var i={header:e,body:t},s={data:i,seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:o.timeOut,success:r,error:n},a=this.sendCommandList.push(s);return this.sendCommandMap[s.seq]=a,this.socket&&this.socket.send(JSON.stringify(i)),e.seq},e.prototype.sendPB=function(e){return this.socket&&this.socket.send(e),!0},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout(function(){t&&t._data&&t._data.error&&t._data.error(o.errorCodeList.TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg)},0),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),n=Date.parse(new Date+""),i=0;!(null==r||r._data&&r._data.sendTime+r._data.timeOut>n||(r._data&&delete t[r._data.data.header.seq],e.remove(r),r._data&&null==r._data.error||r._data&&r._data.sendTime+this.sendDataDropTimeout<n||setTimeout(function(){r&&r._data&&r._data.error&&r._data.error(o.errorCodeList.TIMEOUT,r._data.data.header.seq,r._data.data.body.custom_msg)},0),++i>=this.sendDataCheckOnceCount));)r=e.getFirst()},e.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout(function(){e.startCheck()},this.sendDataCheckInterval)},e.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},e.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(r){t.socket.binaryType="arraybuffer",t.responseHandler(),e(r)})},e.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){var r="string"==typeof t.data?JSON.parse(t.data):t.data;e.onMessage(r)})},e.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},e.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},e.prototype.onMessage=function(e){},e}();t.ZegoSocketService=i},,,,,,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.getSeq=t.getReportSeq=t.ZegoExpressWebRTMEngine=void 0;var n=r(20);Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return n.ZegoExpressWebRTM}});var o=r(33),i=r(0),s=function(){function e(t,r,s){void 0===s&&(s=0),this.logger=new i.ZegoLogger(s),this.dataReport=new i.ZegoDataReport(this.logger),this.cloudSetting=new o.ZegoSetting,this.zegoWebRTM=new n.ZegoExpressWebRTM(t,r,this.logger,this.dataReport,this.cloudSetting,e.version,s)}return e.prototype.enableMultiRoom=function(e){return this.zegoWebRTM.enableMultiRoom(e)},e.prototype.loginRoom=function(e,t,r,n){return this.zegoWebRTM.loginRoom(e,t,r,n)},e.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},e.prototype.renewToken=function(e,t){return this.zegoWebRTM.renewToken(e,t)},e.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},e.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},e.prototype.sendCustomCommand=function(e,t,r){return this.zegoWebRTM.sendCustomCommand(e,t,r)},e.prototype.setRoomExtraInfo=function(e,t,r){return this.zegoWebRTM.setRoomExtraInfo(e,t,r)},e.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},e.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},e.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},e.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},e.prototype.off=function(e,t){return this.zegoWebRTM.off(e,t)},e.prototype.loginHall=function(e,t,r){return this.zegoWebRTM.loginHall(e,t,r)},e.prototype.logoutHall=function(){return this.zegoWebRTM.logoutHall()},e.prototype.enterRoom=function(e,t){return this.zegoWebRTM.enterRoom(e,t)},e.prototype.leaveRoom=function(){return this.zegoWebRTM.leaveRoom()},e.use=function(e){n.ZegoExpressWebRTM.use(e)},e.version=i.PROTO_VERSION,e}();t.ZegoExpressWebRTMEngine=s;var a=r(0);Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return a.getReportSeq}}),Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return a.getSeq}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return a.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return a.ZegoDataReport}})},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)n[o]=i[s];return n};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=void 0;var s=r(0),a=r(1),u=r(2),l=r(0),c=r(23),d=r(24),h=r(26),p=r(27),f=r(28),g=r(30),_=r(3),m=r(4),v=r(11),E=r(31),T=r(32),y=function(){function e(e,t,r,n,o,i,a){var d=this;this.logger=r,this.dataReport=n,this.cloudSetting=o,this.version=i,this.stateCenter=new p.StateCenter(this.logger,this.dataReport),this.stateCenter.ENV=a,this.getReportSeq=l.getReportSeq,this.getSeq=s.getSeq,this.proxyRes=u.ClientUtil.proxyRes,this.actionSuccessCallback=u.ClientUtil.actionSuccessCallback,this.actionErrorCallback=u.ClientUtil.actionErrorCallback,this.getServerError=u.ClientUtil.getServerError,this.generateRandumNumber=u.ClientUtil.generateRandumNumber,this.unregisterCallback=u.ClientUtil.unregisterCallback,this.logReportCallback=u.ClientUtil.logReportCallback,this.registerCallback=u.ClientUtil.registerCallback;var h=l.getReportSeq();if(this.dataReport.newReport(h),(0==a||1==a)&&this.setDebug(t),u.ClientUtil.checkConfigParam(e,t,this.logger)){if(this.stateCenter.appid=e,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,0==a||1==a){this.stateCenter.settingConfig=new T.ZegoSettingConfig,this.cloudSetting.setLog(this.logger),this.cloudSetting.init({product:c.CLOUD_SETTING.product,appID:e,urls:c.CLOUD_SETTING.URL,env:a,pollingNotify:function(e,t){d.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR," setting file changed "+e+" "+JSON.stringify(t)),d.stateCenter.actionListener("_cloudSettingNotify",e,t)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment});var f="";0===a?f="rtc":1===a&&(f="xcx"),this.cloudSetting.setEnvVariable("environment",f);var y=this.cloudSetting.getSettingCache(c.INIT),S=this.cloudSetting.getSettingCache(c.ROOM_BASIC);Promise.all([y,S]).then(function(e){var t=null==e?void 0:e[0];d.stateCenter.settingConfig.setSetting(null==t?void 0:t.setting);var r=d.stateCenter.settingConfig.getSetting("remote_log_level",!0);r&&(d.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  setting remote_log_level "+r),d.logger.setRemoteLogLevel(r));var n=null==e?void 0:e[1];d.stateCenter.settingConfig.setSetting(null==n?void 0:n.setting);var o=l.getReportSeq();d.dataReport.newReport(o,m.ZegoRTMLogEvent.kZegoTaskCloudSettingCache.event),d.dataReport.addMsgInfo(o,{files:[{name:c.INIT,content:null==t?void 0:t.setting,versions:null==t?void 0:t.versions},{name:c.ROOM_BASIC,content:null==n?void 0:n.setting,versions:null==n?void 0:n.versions}]}),d.dataReport.uploadReport(o)}).catch(function(e){d.logger.warn(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  initConfig "+JSON.stringify(e))}),"string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&t.length>0&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),this.service=new v.LiveRoomService(this.stateCenter,this.logger,this)}else 2!=a&&3!=a||(this.service=new E.LiveRoomPrivateService(this.stateCenter,this.logger,this),this.module=new g.LiveRoomModules(this.stateCenter,this.logger,this.dataReport,this.service,this),this.stateCenter.priModules=this.module,this.module._dispatchServer=t,this.stateCenter.type="PRIVATE");if(0==a||2==a)this.bindWindowListener(),this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  "+navigator.appVersion),this.stateCenter.networkState=navigator?navigator.onLine?s.ENUM_NETWORK_STATE.online:s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online,this.dataReport.addMsgInfo(h,{system_info:m.ZegoRTMLogEvent.kZegoTaskInitSetting.system_info});else if(1==a||3==a){this.bindWxListener();try{var C=wx.getSystemInfoSync();this.dataReport.addMsgInfo(h,{system_info:{brand:C.brand,model:C.model,system:C.system,platform:C.platform,version:C.version,SDKVersion:C.SDKVersion}})}catch(e){this.logger.warn(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" get system info error")}}this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)}else this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" init sdk error"),this.dataReport.addMsgInfo(h,m.ZegoRTMLogEvent.kZegoTaskInitSetting.error.kInvalidParamError);this.dataReport.uploadReport(h,m.ZegoRTMLogEvent.kZegoTaskInitSetting.event)}return Object.defineProperty(e.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),r=u.ClientUtil.getBrowser(),n=t?"pagehide":"Firefox"===r?"beforeunload":"unload";window.addEventListener(n,function(){e.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" "+n),"PUBLIC"===e.stateCenter.type?e.logoutRoom():e.leaveRoom(),e.logoutRoom()}),window.addEventListener("offline",function(){e.netOffLineHandle()}),window.addEventListener("online",function(){e.netOnLineHandle()})},e.prototype.bindWxListener=function(){var e=this;wx.onNetworkStatusChange(function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()})},e.prototype.netOnLineHandle=function(){var e=this;this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+"network is online"),this.stateCenter.networkState=s.ENUM_NETWORK_STATE.online,this.stateCenter.roomModulesList.forEach(function(t){t.roomTryHandler&&e.service.isDisConnect()?t.roomTryHandler.active():t.roomTryHandler&&(t.roomTryHandler.stopMaxTime(),t.roomHandler.roomStateHandle("CONNECTED",{code:0,msg:""}))})},e.prototype.netOffLineHandle=function(){this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" network is broken"),this.stateCenter.networkState=s.ENUM_NETWORK_STATE.offline,this.stateCenter.roomModulesList.forEach(function(e){e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.onactive=function(t,r){e.roomHandler.disconnectedHandle(r)},e.roomTryHandler.startMaxTime(),e.roomHandler.roomStateHandle("CONNECTING",a.errorCodeList.NETWORK_BROKEN))})},e.prototype.setLogConfig=function(e){this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call");var t=l.getReportSeq();if(this.dataReport.newReport(t),e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),this.dataReport.addMsgInfo(t,{log_level:m.ZegoRTMLogEvent.kZegoTaskSetLog.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&this.dataReport.addMsgInfo(t,{remote_log_level:m.ZegoRTMLogEvent.kZegoTaskSetLog.remote_log_level(e.remoteLogLevel)}),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))this.logger.setLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:m.ZegoRTMLogEvent.kZegoTaskSetLog.log_url(e.logURL)}),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.event);else if(e.logURL)return this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+"log url must be a wss or https url"),this.dataReport.addMsgInfo(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.error.kInvalidParamError),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetLog.event),!1;return this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call success"),!0},e.prototype.setDebugVerbose=function(e){var t=l.getReportSeq();this.dataReport.newReport(t),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:m.ZegoRTMLogEvent.kZegoTaskSetDebug.debug(e?"true":"false")})),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskSetDebug.event),this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE+" call success")},e.prototype.setDebug=function(e){"string"==typeof e&&e.indexOf("wss")>-1?this.stateCenter.debug=u.ClientUtil.isTestEnv(e):Array.isArray(e)&&e.length>0&&e.every(function(e){return"string"==typeof e&&e.indexOf("wss")>-1})?this.stateCenter.debug=u.ClientUtil.isTestEnv(e[0])||u.ClientUtil.isTestEnv(e[1]):this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},e.prototype.renewToken=function(e,t){var r,n=this,o=l.getReportSeq();if(this.dataReport.newReport(o),void 0!==t&&("string"!=typeof t||""==t))return this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" roomID must be string and no empty"),!1;var i=this.getRoomModules(t)||this.stateCenter.roomModulesList[0];return i?"string"==typeof e&&i.roomTryHandler?(e===i.roomTryHandler.token?this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token has not changed"):(this.stateCenter.configRoomAuth?this.service.sendMessage("renew_token",{token:e},function(t){var r,o;null===(r=i.roomTryHandler)||void 0===r||r.renewLocalToken(e,null===(o=null==t?void 0:t.body)||void 0===o?void 0:o.token_remain_time),n.stateCenter.configCheckToken=!0,n.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" "+JSON.stringify(t))},function(t){var r,o,s=null===(r=null==t?void 0:t.body)||void 0===r?void 0:r.err_code;s&&1000002014===s?(n.stateCenter.configCheckToken=!1,null===(o=i.roomTryHandler)||void 0===o||o.renewLocalToken(e),n.logger.warn(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" "+JSON.stringify(t))):n.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" "+JSON.stringify(t))},void 0,{sessionID:i.sessionID,roomID:t,roomSessionID:i.roomSessionID}):null===(r=i.roomTryHandler)||void 0===r||r.renewLocalToken(e),this.cloudSetting.setToken(e)),this.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!0):"string"!=typeof e||i.roomTryHandler?(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" token must be string and not empty"),this.dataReport.addMsgInfo(o,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.INPUT_PARAM.msg+" param token error"}),this.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(o,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1):(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(o,{error:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:m.ZegoRTMLogEvent.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(o,m.ZegoRTMLogEvent.kZegoTaskReNewToken.event),!1)},e.prototype.setCloudSettingURLs=function(e){var t=this;this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS+" call "),Array.isArray(e)&&e.length>0&&e.every(function(e){return"string"==typeof e&&e.indexOf("http")>-1})&&this.cloudSetting.init({product:c.CLOUD_SETTING.product,appID:this.stateCenter.appid,urls:e,env:this.stateCenter.ENV,pollingNotify:function(e,r){t.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_CLOUD_SETTING_URLS," setting file changed "+e+" "+JSON.stringify(r)),t.stateCenter.actionListener("_cloudSettingNotify",e,r)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment})},e.prototype.loginRoom=function(e,t,r,a){var u=this;return new Promise(function(l,c){return n(u,void 0,void 0,function(){var n,u,p,g,v,E,T=this;return o(this,function(o){switch(o.label){case 0:return 1!==this.stateCenter.ENV?[3,2]:[4,new Promise(function(e){wx.getNetworkType({success:function(t){T.stateCenter.networkState="none"===t.networkType?s.ENUM_NETWORK_STATE.offline:s.ENUM_NETWORK_STATE.online,e()},fail:function(t){T.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" network "+JSON.stringify(t)),T.stateCenter.networkState=s.ENUM_NETWORK_STATE.online,e()}})})];case 1:o.sent(),o.label=2;case 2:return n=this.loginReport(l,c,t,a),u=n.interResolve,p=n.interReject,!(a=a||{}).maxMemberCount&&(a.maxMemberCount=0),(g=h.checkParams({roomID:{order:0,value:e,rules:[{name:h.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_NULL},{name:h.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:"roomID must be string"},{name:h.RULE_PARAM_NAME.MAX_LENGTH_128,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_TOO_LONG},{name:h.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:h.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM},{name:h.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM}]},user:{order:2,value:r,rules:[{name:h.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."},{name:h.RULE_PARAM_NAME.TYPE_OBJECT,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:r.userID,rules:[{name:h.RULE_PARAM_NAME.NOT_EMPTY,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_NULL,extMsg:" param user error."},{name:h.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param userID error."},{name:h.RULE_PARAM_NAME.MAX_LENGTH_100,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_TOO_LONG},{name:h.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:r.userName,rules:[{name:h.RULE_PARAM_NAME.TYPE_STRING,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" userName must be string."},{name:h.RULE_PARAM_NAME.MAX_LENGTH_256,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_NAME_TOO_LONG}]},config:{order:5,value:a,rules:[]},"config.maxMemberCount":{order:6,value:a.maxMemberCount,rules:[{name:h.RULE_PARAM_NAME.TYPE_INTEGER,error:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM,logger:this.logger}))!==h.RULE_SUCCESS?(p(g.error,g.extMsg),[2]):(this.cloudSetting.setUserID(r.userID),this.cloudSetting.setToken(t),this.cloudSetting.activePolling(),this.stateCenter.onListener("roomLoginResponse",function(e){T.stateCenter.settingFetched||(T.getCloudSetting(),T.stateCenter.actionListener("_settingCanFetch"),T.stateCenter.settingFetched=!0)}),(v=this.getRoomModules(e))?(p(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.REPEATEDLY_LOGIN),[2]):(v=new f.LiveRoomModules(e,this.stateCenter,this.logger,this.dataReport,this.service,this),this.stateCenter.roomModulesList.length>0&&1==this.stateCenter.isMultiRoom?v.isMulti=!0:i(this.stateCenter.roomModulesList).forEach(function(e){return e.roomHandler.logout()}),this.stateCenter.roomModulesList.push(v),v.roomTryHandler||(v.roomTryHandler=new d.RetryRoomHandler(this.logger,this.stateCenter,v)),E=this.stateCenter.settingConfig.getSetting("room_server",!0),Array.isArray(E)&&E.length>0&&(this.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," setting room_server "+E),this.stateCenter.server=E[0],this.stateCenter.serverBak=E[1]||E[0]),v.roomTryHandler.init(this.stateCenter.roomRetryTime),v.roomTryHandler.initRoom(v.roomHandler,e,t,r,this.stateCenter.server,this.stateCenter.serverBak,a),v.roomTryHandler.setLoginRoomCallback(u,p),v.roomTryHandler.active(!0),this.stateCenter.setMultiRoom=!0,[2]))}})})})},e.prototype.getCloudSetting=function(){var e=this;this.cloudSetting.fetchMultiSetting([c.INIT,c.ROOM_BASIC]).then(function(t){var r;e.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," settingConfig "+JSON.stringify(t)),e.stateCenter.settingConfig.setSetting(null===(r=null==t?void 0:t[c.INIT])||void 0===r?void 0:r.setting,["remote_log_level"]);var n=e.stateCenter.settingConfig.getSetting("remote_log_level",!0);n&&(e.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM+"  setting remote_log_level "+n),e.logger.setRemoteLogLevel(n))}).catch(function(t){e.logger.warn(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," settingConfig "+JSON.stringify(t))}),this.stateCenter.onListener("_cloudSettingNotify",function(t,r){var n=l.getReportSeq();e.dataReport.newReport(n,m.ZegoRTMLogEvent.kZegoTaskCloudSettingRefresh.event);var o=e.cloudSetting.getEnvVariables();if(e.dataReport.addMsgInfo(n,{params:o,files:[{name:t,content:r.setting,versions:r.versions}]}),e.dataReport.uploadReport(n),t===c.INIT){e.stateCenter.settingConfig.setSetting(null==r?void 0:r.setting,["remote_log_level"]);var i=e.stateCenter.settingConfig.getSetting("remote_log_level");i&&(e.logger.info(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM," setting remote_log_level "+i),e.logger.setRemoteLogLevel(i))}})},e.prototype.cloudReportNotify=function(e,t,r){if("request_start"===t){var n=l.getReportSeq();this.dataReport.newReport(n,m.ZegoRTMLogEvent.kZegoTaskCloudSettingRequest.event),this.stateCenter.settingConfig.requestList[e]=n}else if("request_end"===t){var o=this.stateCenter.settingConfig.requestList[e];o&&(this.dataReport.addMsgInfo(o,{request_detail:null==r?void 0:r.reportData,files:null==r?void 0:r.files,error:null==r?void 0:r.code,request_params:null==r?void 0:r.params}),this.dataReport.uploadReport(o))}},e.prototype.loginReport=function(e,t,r,n){var o=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,u.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.stateCenter.reportList));var i=l.getReportSeq();this.stateCenter.reportSeqList.login=i,this.dataReport.newReport(i,m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event);var s=this.cloudSetting.getEnvVariable("deviceid");return this.dataReport.addMsgInfo(i,{deviceid:s}),"string"==typeof r&&this.dataReport.addMsgInfo(i,{token:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.token(r),isMulti:this.stateCenter.isMultiRoom}),n&&(n.userUpdate&&"boolean"==typeof n.userUpdate&&this.dataReport.addMsgInfo(i,{user_update:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.user_update(n.userUpdate+"")}),n.maxMemberCount&&"number"==typeof n.maxMemberCount&&this.dataReport.addMsgInfo(i,{max_member_count:m.ZegoRTMLogEvent.kZegoTaskLoginRoom.max_member_count(n.maxMemberCount+"")})),u.ClientUtil.logReportCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.dataReport,i,this.stateCenter.reportList),{interResolve:function(t){o.dataReport.uploadReport(i),o.stateCenter.reportSeqList.login=0,u.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,o.stateCenter.reportList),e(t)},interReject:function(e,r){var n,s;void 0===r&&(r=""),e.code<2e9&&e.code>1e9||e.code<1e6?(n=u.ClientUtil.decodeServerError(e.code,e.msg),s=u.ClientUtil.getLiveRoomError(e.code)):n={code:e.code,message:e.msg},n&&o.dataReport.addMsgInfo(i,{error:n.code,message:n.message+r}),o.dataReport.uploadReport(i),o.stateCenter.reportSeqList.login=0,u.ClientUtil.unregisterCallback(m.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,o.stateCenter.reportList),s&&a.errorCodeList[s]&&(e.code=a.errorCodeList[s].code),t(e.code&&e.msg&&""!==r?{code:e.code,msg:e.msg+r}:e)}}},e.prototype.logoutRoom=function(e){var t=l.getReportSeq();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e,isMulti:this.stateCenter.isMultiRoom}),void 0===e)i(this.stateCenter.roomModulesList).forEach(function(e){return e.roomHandler.logout(!0)}),this.cloudSetting.uninit();else{if("string"!=typeof e||""==e)return this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" roomID must be string and not empty"),this.dataReport.addMsgInfo(t,{error:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event);var r=this.getRoomModules(e);r?(r.roomHandler.logout(),0===this.stateCenter.roomModulesList.length&&this.cloudSetting.uninit(),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event)):(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" room not exist"),this.dataReport.addMsgInfo(t,{error:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.code,message:m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.msg}),this.dataReport.uploadReport(t,m.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event))}},e.prototype.loginHall=function(e,t,r){var i=this;return new Promise(function(e,t){return n(i,void 0,void 0,function(){return o(this,function(e){return[2]})})})},e.prototype.loginHallReport=function(e,t,r,n){},e.prototype.logoutHall=function(){},e.prototype.enterRoom=function(e,t){return new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype.leaveRoom=function(){return new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype.sendCustomCommand=function(e,t,r){return new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype._sendCustomCommand=function(e,t,r){return new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype.sendBroadcastMessage=function(e,t){return new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype._sendBroadcastMessage=function(e,t,r,n){return void 0===r&&(r=1),void 0===n&&(n=1),new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype.setRoomExtraInfo=function(e,t,r){return new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype._setRoomExtraInfo=function(e,t,r){return new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype.sendBarrageMessage=function(e,t){return new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype._sendBarrageMessage=function(e,t,r,n){return void 0===r&&(r=1),void 0===n&&(n=1),new Promise(function(e,t){console.error(s.MODULE_TIPS.MESSAGE),t()})},e.prototype.sendRelayMessage=function(e,t,r,n,o){console.error(s.MODULE_TIPS.MESSAGE)},e.prototype.requestJoinLive=function(e,t,r,n,o){return console.error(s.MODULE_TIPS.MESSAGE),!1},e.prototype.inviteJoinLive=function(e,t,r,n,o){return console.error(s.MODULE_TIPS.MESSAGE),!1},e.prototype.endJoinLive=function(e,t,r,n){return console.error(s.MODULE_TIPS.MESSAGE),!1},e.prototype.respondJoinLive=function(e,t,r,n,o){return console.error(s.MODULE_TIPS.MESSAGE),!1},e.prototype.getVersion=function(){return this.version},e.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},e.prototype.on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype.off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype._off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},e.prototype.isLogin=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return!!t&&t.isLogin()},e.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},e.prototype.getAppID=function(){return this.stateCenter.appid},e.prototype.getUserID=function(){return this.stateCenter.idName},e.prototype.getToken=function(e){return(this.getRoomModules(e)||this.stateCenter.roomModulesList[0]).token},e.prototype.getAnType=function(){return this.module.anType},e.prototype.getRoomSid=function(){return this.module.roomSid},e.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},e.prototype.setRole=function(e){this.stateCenter.role=e},e.prototype.getSessionId=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.sessionID:"0"},e.prototype.getRoomSessionID=function(e){var t=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return t?t.roomSessionID:"0"},e.prototype.enableMultiRoom=function(e){var t=l.getReportSeq();return this.dataReport.newReport(t,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.event),this.dataReport.addMsgInfo(t,{isMulti:e}),"boolean"!=typeof e?(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" param must be boolean"),this.dataReport.uploadReport(t,void 0,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):this.stateCenter.roomModulesList.length>0||this.stateCenter.setMultiRoom?(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ENABLE_MULTI_ROOM+" multi room can only be set once before first login"),this.dataReport.uploadReport(t,void 0,m.ZegoRTMLogEvent.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):(this.dataReport.uploadReport(t),this.stateCenter.isMultiRoom=e,this.stateCenter.setMultiRoom=!0,!0)},e.prototype.getRoomModules=function(e){return this.stateCenter.roomModulesList.find(function(t){return t.roomID==e})},e.prototype.dispatchBodyData=function(){return{seq:1,timestamp:(new Date).getTime,app_id:this.stateCenter.appid,user_id:this.stateCenter.idName,user_name:this.stateCenter.nickName,net_type:2,device_id:this.module.deviceID,login_token:this.module.hallToken,an_type:this.module.anType}},e.use=function(t){switch(t.type){case"message":t.install(e,f.LiveRoomModules,v.LiveRoomService,g.LiveRoomModules,E.LiveRoomPrivateService);break;case"live":t.install(e,f.LiveRoomModules,v.LiveRoomService);break;case"privates":t.install(e,g.LiveRoomModules,E.LiveRoomPrivateService)}},e.prototype.resetRoomTokenTimer=function(e,t){var r=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];r&&t&&t>0&&r.roomHandler.resetTokenTimer(1e3*t-this.stateCenter.local_time_deviation)},e.prototype.setProtoFormat=function(e){if(void 0===e&&(e="json"),!["json","pb"].includes(e))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=e},e.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every(function(e){return"string"==typeof e})&&(this.stateCenter.relateService=e)},e.prototype.sendMessageByService=function(e,t,r,n,o,i){return this.service.sendMessage(e,t,r,n,o,i)},e.prototype.getHeader=function(e){var t=this.stateCenter.roomModulesList[0];if(t&&t.isLogin())return this.service.getHeader(e,t.sessionID,t.roomID,t.roomSessionID);this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_GET_HEADER+" room no found or no login")},e.prototype.sendPB=function(e){return e instanceof Uint8Array?this.service.sendPB(e):(this.logger.error(_.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_PB+" type error"),!1)},e.prototype.onPushBizChannel=function(e){e&&this.service.on("push_biz_channel",e)},e.prototype.getRoomID=function(){return this.stateCenter.roomid},e.prototype.getServerTimeOffset=function(){return this.stateCenter.serverTimeOffset},e}();t.ZegoExpressWebRTM=y},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,(function(t){return e[t]}).bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_ENV=t.ZEGO_BROWSER_TYPE=void 0,function(e){e[e.IE=0]="IE",e[e.FIREFOX=1]="FIREFOX",e[e.CHROME=2]="CHROME",e[e.SAFARI=3]="SAFARI",e[e.OPERA=4]="OPERA",e[e.WEIXIN=5]="WEIXIN",e[e.WEIXINMINI=6]="WEIXINMINI",e[e.UNKOWN=7]="UNKOWN"}(t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={})),function(e){e[e.BROWSER=0]="BROWSER",e[e.WEIXINMINI=1]="WEIXINMINI"}(t.ZEGO_ENV||(t.ZEGO_ENV={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.HTTPS=2]="HTTPS"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=void 0;var n=function(){function e(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}return e.getInstance=function(){return e.instance||(e.instance=new e).init(),e.instance},e.prototype.init=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),e.instance=new e,e}();t.LoggerStateCenter=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.ZegoWeiXinMiniWebSocket=void 0;var n=r(0),o=function(){function e(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}return e.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen(function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose(function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)}),e._websocket.onMessage(function(t){"function"==typeof e.onmessage&&e.onmessage(t)}))}),this._websocket.onError(function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)}))},e.prototype.onopen=function(e){},e.prototype.onerror=function(e){},e.prototype.onclose=function(e){},e.prototype.onmessage=function(e){},e.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},e.prototype.close=function(){this._websocket&&this._websocket.close()},e}();t.ZegoWeiXinMiniWebSocket=o,t.createZegoWebSocket=function(e,t){return t%2===n.ZEGO_ENV.BROWSER?new WebSocket(e):new o(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=t.createZegoWebSocket=t.ZegoDataReport=t.ZegoLogger=void 0;var n=r(1);Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return n.LoggerStateCenter}});var o=r(2);Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return o.createZegoWebSocket}});var i=r(4);Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return i.ZegoDataReport}});var s=r(5);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return s.ZegoLogger}})},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoDataReport=void 0;var o=function(){function e(e){this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn(e+" not exist")},e.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn(e+" not exist")},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},e.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var n=this.dataStatistics[e].events;if(n&&0!==n.length){for(var o=n.length-1;o>=0;o--)if(n[o].event==t&&0==n[o].time_consumed){n[o].time_consumed=Date.now()-n[o].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},e.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var i=o.length-1;i>=0;i--)if(o[i].event==t&&0==o[i].time_consumed){o[i].time_consumed=Date.now()-o[i].event_time,null==o[i].msg_ext&&(o[i].msg_ext={}),o[i].msg_ext=n({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var n=this.dataStatistics[e].events;if(n){for(var o=n.length-1;o>=0;o--)if(n[o].event==t&&0==n[o].time_consumed){n[o].time_consumed=Date.now()-n[o].event_time,Object.assign(n[o],r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.addEventInfo=function(e,t,r,n){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(null!=o){for(var i=o.length-1;i>=0;i--)if(o[i].event==t&&null!=o[i].time_consumed){null==o[i].msg_ext?o[i].msg_ext={}:o[i].msg_ext&&(o[i].msg_ext[r]=n);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},e.prototype.addEventMsg=function(e,t,r,n){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(null!=o){for(var i=o.length-1;i>=0;i--)if(o[i].event==t){o[i][r]=n;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},e.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&this.dataStatistics[e].events.push(r?{event:t,event_time:Date.now(),msg_ext:r}:{event:t,event_time:Date.now()}):this.logger.warn("zd.ae.0 no seq match")},e.prototype.uploadReport=function(e,t,r,n){var o=this.dataStatistics[e];null!=o&&(t&&(o.event=t),o.time_consumed=Date.now()-o.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message||r.msg+" "+(n||"")}),this.logger.report(o),delete this.dataStatistics[e])},e}();t.ZegoDataReport=o},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0;var o=r(0),i=r(2),s=r(1),a=r(6),u=function(){function e(e){this.logLevel=o.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.websocket=null,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=s.LoggerStateCenter.getInstance(),this.env=e}return e.prototype.setLogLevel=function(e){var t=o.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logLevel=t,!0)},e.prototype.setRemoteLogLevel=function(e){var t=o.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logRemoteLevel=t,!0)},e.prototype.setSessionInfo=function(e,t,r,n,o,i){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=n,this.userName=o,this.version=i},e.prototype.report=function(e){var t=this.logReportParamList(o.ENUM_LOG_LEVEL.REPORT,e);this.logLevel!==o.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=o.ENUM_LOG_LEVEL.REPORT&&console.debug(t),this.RemoteLog(o.ENUM_LOG_LEVEL.REPORT,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(o.ENUM_LOG_LEVEL.DEBUG,e.join(""));this.logLevel!==o.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=o.ENUM_LOG_LEVEL.DEBUG&&console.debug(r),this.log(o.ENUM_LOG_LEVEL.DEBUG,r)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(o.ENUM_LOG_LEVEL.INFO,e.join(""));this.logLevel!==o.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=o.ENUM_LOG_LEVEL.INFO&&console.info(r),this.log(o.ENUM_LOG_LEVEL.INFO,r)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(o.ENUM_LOG_LEVEL.WARN,e.join(""));this.logLevel!==o.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=o.ENUM_LOG_LEVEL.WARN&&console.warn(r),this.log(o.ENUM_LOG_LEVEL.WARN,r)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(o.ENUM_LOG_LEVEL.ERROR,e.join(""));this.logLevel!==o.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=o.ENUM_LOG_LEVEL.ERROR&&(console.error(r),window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(o.ENUM_LOG_LEVEL.ERROR,r)},e.prototype.log=function(e,t){this.logRemoteLevel!==o.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.setLogServer=function(e){try{return e.startsWith("wss:")?(this.logType=o.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=o.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=o.ENUM_REMOTE_TYPE.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},e.prototype.stopLogServer=function(){this.logType==o.ENUM_REMOTE_TYPE.WEBSOCKET?this.stopWebSocketServer():this.logType==o.ENUM_REMOTE_TYPE.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=o.ENUM_REMOTE_TYPE.DISABLE},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval(function(){t.SendHttpsLog()},this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==o.ENUM_REMOTE_TYPE.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==o.ENUM_REMOTE_TYPE.HTTPS)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==o.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if("string"==typeof t&&t.length>4e3)console.info("log over maximum, ignore");else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.setLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var o="",i=0;i<this.logCacheSend.length;i++){(o+this.logCacheSend[i]).length>4e3&&(this.websocket.send(o),o="");var s=JSON.parse(this.logCacheSend[i]);s=n(n({},s),{userid:s.userid||this.userid,roomid:s.roomid||this.roomid,userName:s.roomid||this.userName}),o=o+JSON.stringify(s)+"\n"}t=o+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,t){var r=a.getCurrentTime(),n=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t];return JSON.stringify({time:r,level:e,action:n[0],content:n[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid})},e.prototype.logReportParamList=function(e,t){var r=a.getCurrentTime();return t=n(n({},t),{time:r,level:e,console:this.env%2===o.ZEGO_ENV.BROWSER?"rtc":"xcx",appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},e.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;this.stopWebSocketServer(),this.websocket=i.createZegoWebSocket(e,this.env),this.websocket.onopen=function(){},this.websocket.onclose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("onclose   websocket error:",e)},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("open log websocket error:",e)}}},e.prototype.SendHttpsLog=function(){0!=this.logCacheSend.length&&(this.env%2===o.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},e.prototype.SendHttpsLogWeb=function(){var e=this,t=this.logCacheSend.join("\n"),r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(0==r.responseText.length)return;try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(e){console.log("send result failed "+e)}}else console.log("send failed "+r.status)},r.open("POST",this.url,!0),0==this.env?r.send(t):2==this.env&&(r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify({user_id:this.userid,log:t}))),this.logCacheSend=[]},e.prototype.SendHttpsLogWeChatMini=function(){var e=this;!this.existUserID&&this.userid&&this.logCacheSend.forEach(function(t){Array.isArray(t)&&t.forEach(function(r,n){var o=JSON.parse(r);o&&""==JSON.parse(r).userid?(o.userid=e.userid,o.id_name=e.userid,t[n]=JSON.stringify(o)):e.existUserID=!0})});var t=this.logCacheSend.join("\n"),r=1==this.env?t:JSON.stringify({user_id:this.userid,log:t});wx.request({url:this.url,data:r,method:"POST",success:function(t){if(0!=t.data.length){var r=t&&t.data&&t.data.interval;"number"==typeof r&&e.logUploadInterval!==r&&(e.timeInterval=r,e.openHttpsLogServer(e.url))}},fail:function(e){console.log("send failed "+e.statusCode)}}),this.logCacheSend=[]},e}();t.ZegoLogger=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0;var n=r(0);t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,s=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version"),a=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?n.ZEGO_BROWSER_TYPE.IE:r?n.ZEGO_BROWSER_TYPE.FIREFOX:o?n.ZEGO_BROWSER_TYPE.OPERA:i?n.ZEGO_BROWSER_TYPE.CHROME:s?n.ZEGO_BROWSER_TYPE.SAFARI:a?n.ZEGO_BROWSER_TYPE.WEIXIN:n.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise(function(t){-1==e.indexOf("MicroMessage")?t(n.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv(function(e){})})};var o=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(o[e.getMonth()+1]||e.getMonth()+1)+"/",(o[e.getDate()]||e.getDate())+" ",(o[e.getHours()]||e.getHours())+":",(o[e.getMinutes()]||e.getMinutes())+":",o[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base64=void 0;var n=function(){function e(){}return e.base64encode=function(t){var r,n,o,i,s,a;for(o=t.length,n=0,r="";n<o;){if(i=255&t.charCodeAt(n++),n==o){r+=e.base64EncodeChars.charAt(i>>2),r+=e.base64EncodeChars.charAt((3&i)<<4),r+="==";break}if(s=t.charCodeAt(n++),n==o){r+=e.base64EncodeChars.charAt(i>>2),r+=e.base64EncodeChars.charAt((3&i)<<4|(240&s)>>4),r+=e.base64EncodeChars.charAt((15&s)<<2),r+="=";break}a=t.charCodeAt(n++),r+=e.base64EncodeChars.charAt(i>>2),r+=e.base64EncodeChars.charAt((3&i)<<4|(240&s)>>4),r+=e.base64EncodeChars.charAt((15&s)<<2|(192&a)>>6),r+=e.base64EncodeChars.charAt(63&a)}return r},e.base64decode=function(t){var r,n,o,i,s,a,u;for(a=t.length,s=0,u="";s<a;){do{r=e.base64DecodeChars[255&t.charCodeAt(s++)]}while(s<a&&-1==r);if(-1==r)break;do{n=e.base64DecodeChars[255&t.charCodeAt(s++)]}while(s<a&&-1==n);if(-1==n)break;u+=String.fromCharCode(r<<2|(48&n)>>4);do{if(61==(o=255&t.charCodeAt(s++)))return u;o=e.base64DecodeChars[o]}while(s<a&&-1==o);if(-1==o)break;u+=String.fromCharCode((15&n)<<4|(60&o)>>2);do{if(61==(i=255&t.charCodeAt(s++)))return u;i=e.base64DecodeChars[i]}while(s<a&&-1==i);if(-1==i)break;u+=String.fromCharCode((3&o)<<6|i)}return u},e.utf16to8=function(e){var t,r,n,o;for(t="",n=e.length,r=0;r<n;r++)(o=e.charCodeAt(r))>=1&&o<=127?t+=e.charAt(r):o>2047?(t+=String.fromCharCode(224|o>>12&15),t+=String.fromCharCode(128|o>>6&63),t+=String.fromCharCode(128|o>>0&63)):(t+=String.fromCharCode(192|o>>6&31),t+=String.fromCharCode(128|o>>0&63));return t},e.utf8to16=function(e){var t,r,n,o,i,s;for(t="",n=e.length,r=0;r<n;)switch((o=e.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(r-1);break;case 12:case 13:i=e.charCodeAt(r++),t+=String.fromCharCode((31&o)<<6|63&i);break;case 14:i=e.charCodeAt(r++),s=e.charCodeAt(r++),t+=String.fromCharCode((15&o)<<12|(63&i)<<6|(63&s)<<0)}return t},e.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e.base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],e}();t.Base64=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROOM_BASIC=t.INIT=t.CLOUD_SETTING=void 0,t.CLOUD_SETTING={product:"Web_SDK",URL:["https://cloud-setting-api.zego.im/cloud-setting/get","https://cloud-setting-api.zegocloud.com/cloud-setting/get"],ONLINE:!1},t.INIT="init",t.ROOM_BASIC="room"},function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryRoomHandler=void 0;var i=r(25),s=r(0),a=r(3),u=r(1),l=r(2),c=function(e){function t(t,r,n){var o=e.call(this,t,r)||this;return o.logger=t,o.stateCenter=r,o.room=n,o.loginRoomCallback={},o}return o(t,e),t.prototype.renewLocalToken=function(e,t){this.token=e,this.room.token=this.token;var r=(new Date).getTime(),n=void 0;t&&"number"==typeof t?n=1e3*t:["03","04"].includes(e.substring(0,2))&&(n=1e3*l.ClientUtil.decodeTokenExpire(e.substring(2))-r),n&&this.roomHandler.resetTokenTimer(n-this.stateCenter.local_time_deviation),this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},t.prototype.initRoom=function(e,t,r,n,o,i,s){this.roomHandler=e,this.roomID=t,this.renewLocalToken(r),this.user=n,this.server=o,this.serverBak=i||o,this.config=s},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.roomHandler.setRunState(s.ENUM_RUN_STATE.trylogin),this.room.isMulti&&this.room.service.isDisConnect())this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" service is disconnected, multi room stop retry");else if(this.stateCenter.networkState!=s.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}this.retryTimer=setTimeout(function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,function(e){t.handleLoginFinish(e)},function(e,r){t.handleLoginFinish(!1,e,r)}),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++},e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout(function(){e.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,u.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail&&(e.loginRoomCallback.fail(u.errorCodeList.LOGIN_TIMEOUT),e.loginRoomCallback.fail=void 0)},1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var r=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(r)&&(!!["1100040001","1100040100"].includes(r)||this.room.lastRunState==s.ENUM_RUN_STATE.login&&(this.room.sessionID="",this.invalid(),!0))}return!0},t.prototype.setLoginRoomCallback=function(e,t){this.loginRoomCallback.success=e,this.loginRoomCallback.fail=t},t.prototype.handleLoginFinish=function(e,t,r){t?this.handleError(t,r)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.loginRoomCallback.fail=void 0)):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}),this.loginRoomCallback.success&&(this.loginRoomCallback.success(e),this.loginRoomCallback.fail=void 0))},t}(i.TryHandler);t.RetryRoomHandler=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TryHandler=void 0;var n=function(){function e(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,n){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof n&&(this.RETRY_MAX_TIME_INTERVAL=n)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.TryHandler=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkParams=t.RULE_SUCCESS=t.RULE_PARAM_NAME=void 0;var n,o=r(2);!function(e){e.NOT_EMPTY="NOT_EMPTY",e.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",e.TYPE_STRING="TYPE_STRING",e.TYPE_INTEGER="TYPE_INTEGER",e.TYPE_OBJECT="TYPE_OBJECT",e.MAX_LENGTH_10="MAX_LENGTH_10",e.MAX_LENGTH_64="MAX_LENGTH_64",e.MAX_LENGTH_100="MAX_LENGTH_100",e.MAX_LENGTH_128="MAX_LENGTH_128",e.MAX_LENGTH_256="MAX_LENGTH_256",e.MAX_LENGTH_1024="MAX_LENGTH_1024"}(n=t.RULE_PARAM_NAME||(t.RULE_PARAM_NAME={})),t.RULE_SUCCESS={error:{code:0,msg:"suc"}};var i={NOT_EMPTY:function(e,r,n,o,i){return void 0===r||""===r||null===r?(o.error(n+" "+e+" is empty"),i):t.RULE_SUCCESS},ILLEGAL_CHARACTERS:function(e,r,n,i,s){return o.ClientUtil.checkIllegalCharacters(r)?t.RULE_SUCCESS:(i.error(n+" "+e+" contains illegal characters"),s)},TYPE_STRING:function(e,r,n,o,i){return"string"!=typeof r?(o.error(n+" "+e+" must be string"),i):t.RULE_SUCCESS},TYPE_INTEGER:function(e,r,n,i,s){return o.ClientUtil.checkInteger(r,!1)?t.RULE_SUCCESS:(i.error(n+" "+e+"  must be integer number"),s)},TYPE_OBJECT:function(e,r,n,o,i){return r&&"object"==typeof r?t.RULE_SUCCESS:(o.error(n+" "+e+"  must be object"),i)},MAX_LENGTH_10:function(e,r,n,o,i){return r.length>10?(o.error(n+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_64:function(e,r,n,o,i){return r.length>64?(o.error(n+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_100:function(e,r,n,o,i){return r.length>100?(o.error(n+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_128:function(e,r,n,o,i){return r.length>128?(o.error(n+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_256:function(e,r,n,o,i){return r.length>256?(o.error(n+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_1024:function(e,r,n,o,i){return r.length>1024?(o.error(n+" "+e+" is too long"),i):t.RULE_SUCCESS}};t.checkParams=function(e,r){var o=[],s={};for(var a in e)s[e[a].order]=e[a],e[a].key=a;for(var u in s)o.push(s[u]);for(var l=0;l<o.length;l++)for(var c=o[l].rules,d=0;d<c.length;d++){var h={key:o[l].key,value:o[l].value,action:r.action,logger:r.logger},p=h.value,f=c[d].name?""+c[d].name:"";if((void 0===p&&f===n.NOT_EMPTY||void 0!==p)&&i[f]){var g=i[f](h.key,p,h.action,h.logger,c[d]);if(g!=t.RULE_SUCCESS)return g}}return t.RULE_SUCCESS}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var n=r(0),o=r(3),i=r(4),s=function(){function e(e,t){this.logger=e,this.dataReport=t,this._debug=!1,this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=n.ENUM_NETWORK_STATE.offline,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown"}return Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,n.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,n.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,n.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),e.prototype.getRequestId=function(){return this.idName+"-"+n.getSeq()},e.prototype.actionListener=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];if(this.listenerList[e]){var a=n.getReportSeq();this.dataReport.newReport(a,i.ZegoRTMLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(a,{listener:e,params:r}),this.dataReport.uploadReport(a)}this.listenerList[e]&&this.listenerList[e].forEach(function(n){try{n.apply(void 0,r)}catch(r){t.logger.error(o.ZEGO_RTM_ACTION.STATE_ACTION+" ",e," ",JSON.stringify(r))}})},e.prototype.onListener=function(e,t){return this.listenerList[e]?"function"!=typeof t?(this.logger.error(o.ZEGO_RTM_ACTION.ON_LISTENER+" listener callBack must be funciton"),!1):(-1==this.listenerList[e].indexOf(t)&&this.listenerList[e].push(t),!0):(this.logger.error(o.ZEGO_RTM_ACTION.ON_LISTENER+" event "+e+" no found"),!1)},Object.defineProperty(e.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),e}();t.StateCenter=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var n=r(0),o=r(9),i=r(29),s=r(10),a=r(2),u=r(1),l=function(){function e(e,t,r,a,u,l){this.roomID=e,this.stateCenter=t,this.logger=r,this.dataReport=a,this.service=u,this.rtm=l,this.runState=n.ENUM_RUN_STATE.logout,this.lastRunState=n.ENUM_RUN_STATE.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.isMulti=!1,this.token="",this.thirdToken="",this.roomHandler=new i.RoomHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.heartBeatHandler=new o.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.userHandler=new s.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.initMessageHandler(),this.initLiveHandler(),this.init()}return e.prototype.initMessageHandler=function(){},e.prototype.initLiveHandler=function(){},e.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler&&e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t)}},e.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,r){e.heartBeatHandler.init(r),e.service.startCheck(),e.userHandler.loginRsp(r,t),e.messageHandler&&e.messageHandler.loginRsp(r),e.isMulti||e.handleMultiRoom(),e.roomLoginResponse(r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler&&e.liveHandler.resetLiveHandler(),e.messageHandler&&e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler(),e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.stopMaxTime(),e.roomTryHandler=void 0)}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.handleMultiRoom=function(){this.stateCenter.roomModulesList.forEach(function(e){e.runState!==n.ENUM_RUN_STATE.login&&e.roomTryHandler&&1==e.isMulti&&(e.roomTryHandler.onactive=function(t,r){if(r&&0!==r.code){if(0!==r.code){var n=a.ClientUtil.getLiveRoomError(r.code);n&&u.errorCodeList[n]&&(r=u.errorCodeList[n])}e.roomHandler.roomStateHandle("DISCONNECTED",r,r.msg)}else e.roomHandler.roomStateHandle("CONNECTED",r)},e.roomTryHandler.startMaxTime(),e.roomTryHandler.active())})},e.prototype.isLogin=function(){return this.runState===n.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomHandler=void 0;var n=r(0),o=r(2),i=r(3),s=r(1),a=r(4),u=function(){function e(e,t,r,n,o){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=n,this.room=o,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30,this.loginCallback={}}return e.prototype.resetTokenTimer=function(e){var t=this;e=(e=(e-=3e4)<0?0:e)>2147483648?2147483648:e,this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESETTOKEN_TIMER+"  call: "+e),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout(function(){t.stateCenter.actionListener("tokenWillExpire",t.room.roomID),t.stateCenter.actionListener("roomTokenWillExpire",t.room.roomID)},e)},e.prototype.stopTokenTimer=function(){this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=null},e.prototype.setRunState=function(e){this.room.runState!==e&&(this.room.lastRunState=this.room.runState,this.room.runState=e)},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetRoom=function(e){var t=this;if(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.stateCenter.roomModulesList.length>1&&!e&&(this.room.isMulti=!0),this.resetTryLogin(),"0"!==this.room.sessionID&&this.room.runState!==n.ENUM_RUN_STATE.logout&&!this.service.isDisConnect()){var r=function(e){t.handleLogoutRsp(e)};this.service.logout(this.room,r,r)}this.setRunState(n.ENUM_RUN_STATE.logout),this.room.sessionID="",this.room.roomSessionID="",this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter(function(e){return e!==t.room});var o=this.stateCenter.roomModulesList[0];o&&(o.isMulti=!1,o.runState!==n.ENUM_RUN_STATE.login&&o.roomTryHandler&&(o.roomTryHandler.startMaxTime(),o.roomTryHandler.active())),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handlePushKickout=function(e,t){var r=this;if(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+JSON.stringify(e)),this.room.sessionID===e.header.session_id){var u=n.getReportSeq();this.dataReport.newReport(u,a.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(u,{user_id:a.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var l=o.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(u,{error:l.code,message:l.message}),this.dataReport.uploadReport(u);var c=this.room.roomTryHandler;if(c)if(c.onactive=function(e,t){r.disconnectedHandle(t),r.stateCenter.actionListener("_kickout",t)},e.body.need_relogin&&1==e.body.need_relogin)this.room.sessionID="",c.startMaxTime(),c.active();else{this.setRunState(n.ENUM_RUN_STATE.logout),this.resetRoom(t);var d={};e&&e.body.custom_reason?d.custom_kickout_message=e.body.custom_reason:l.name&&s.errorCodeList[l.name]&&(d.custom_kickout_message=s.errorCodeList[l.name].msg+"; kickout reason: "+e.body.reason),this.disconnectedHandle(l.name&&s.errorCodeList[l.name]?s.errorCodeList[l.name]:s.errorCodeList.ROOM_INNER_ERROR,JSON.stringify(d)),this.stateCenter.actionListener("_kickout",{code:s.errorCodeList.MANUAL_KICKOUT.code,msg:s.errorCodeList.MANUAL_KICKOUT.msg+e.body.reason})}else this.logger.info(i.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" try handler no found")}else this.logger.info(i.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" session id wrong, ignore")},e.prototype.handleHbLogout=function(e){var t=this,r=this.room.roomTryHandler;r&&(r.onactive=function(e,r){t.disconnectedHandle(r)},[s.errorCodeList.HEARTBEAT_TIMEOUT,s.errorCodeList.SOCKET_CLOSE,s.errorCodeList.TIMEOUT].includes(e)||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")||e.msg.endsWith("1000000105")?(r.startMaxTime(),r.active()):(r.stopMaxTime(),r.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(i.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.code,message:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var r;(r=e.code<2e9&&e.code>1e9||e.code<1e6?o.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,o.ClientUtil.unregisterCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.stateCenter.reportList);var n=this.room.roomTryHandler;n?(n.onactive=function(e,r){t.roomStateHandle(r&&0!==r.code?"DISCONNECTED":"CONNECTED",r)},n.startMaxTime(),n.active()):this.logger.error(i.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e,t){e&&0!==e.code?(this.stopTokenTimer(),this.roomStateHandle("DISCONNECTED",e,t)):this.roomStateHandle("CONNECTED",e,t)},e.prototype.roomStateHandle=function(e,t,r){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,t?t.code:0,r),this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,t?t.code:0,r))},e.prototype.login=function(e,t,r,u,l,c,d){if(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:",t,r),!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,t,"",u.userID,"",this.stateCenter.sdKVersion),l&&(l.userUpdate&&"boolean"==typeof l.userUpdate&&(this.stateCenter.userStateUpdate=l.userUpdate),l.maxMemberCount&&"number"==typeof l.maxMemberCount&&(this.stateCenter.maxMemberCount=l.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void d(s.errorCodeList.INIT);if(this.room.runState!==n.ENUM_RUN_STATE.trylogin&&this.setRunState(n.ENUM_RUN_STATE.trylogin),this.room.roomID=t,this.room.token=r,this.room.thirdToken=r,this.stateCenter.idName=u.userID,this.stateCenter.nickName=u.userName||u.userID,this.loginCallback.success=c,this.loginCallback.fail=d,0===this.stateCenter.reportSeqList.login){var h=n.getReportSeq();this.stateCenter.reportSeqList.relogin=h,this.dataReport.newReport(h,a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event),this.dataReport.addMsgInfo(h,{server:e}),o.ClientUtil.logReportCallback(a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.dataReport,h,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLogin=function(e){var t=this;if(this.room.runState===n.ENUM_RUN_STATE.trylogin){var r=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),o.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.tryLoginCount>1&&o.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventEnd,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),o.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),o.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler(function(){t.openHandler()}),this.service.closeHandler(function(e){t.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)}),this.service.errorHandler(function(e){t.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)})}catch(e){this.logger.error(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),o.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var s=function(e,r){t.handleLoginRsp(e,r)};this.service.login(this.room,s,s)}this.tryLoginTimer=setTimeout(function(){t.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),t.loginCallback.fail&&t.loginCallback.fail(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)},this.tryLoginInterval),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(i.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;o.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(n.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),o.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(n.REPORT_ACTION.eventStart,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var r=function(t,r){e.handleLoginRsp(t,r)};this.service.login(this.room,r,r)},e.prototype.handleLoginRsp=function(e,t){var r=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(o.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(n.REPORT_ACTION.eventEndWithMsgInfo,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.room.runState===n.ENUM_RUN_STATE.trylogin)if(e.header&&e.body){if(e.header.seq!==t&&0==this.room.isMulti)return void this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq);0!==e.body.err_code?(this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.err_code),this.handleLoginFail(e)):(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),this.handleLoginSuccess(e))}else this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" "+JSON.stringify(e)),this.handleLoginFail(e);else this.logger.error(i.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INNER_ERROR;e.header&&e.body?t=o.ClientUtil.getServerError(e.body.err_code):e.code&&e.msg&&(t=e),this.loginCallback.fail&&this.loginCallback.fail(t,!0)},e.prototype.handleLoginSuccess=function(e){var t,r={},i=this.room.lastRunState;this.setRunState(n.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.room.sessionID=e.body.session_id,this.room.roomSessionID=e.body.room_session_id;var s=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.token_remain_time;if(this.stateCenter.configRoomAuth=s>0,e.body.ret_timestamp&&["03","04"].includes(this.room.token.substring(0,2))){var u=(new Date).getTime(),l=u-e.body.ret_timestamp;this.stateCenter.local_time_deviation=l<5e3?0:l;var c=s>0?1e3*s:1e3*o.ClientUtil.decodeTokenExpire(this.room.token.substring(2))-u;this.resetTokenTimer(c-this.stateCenter.local_time_deviation)}if(!this.room.isMulti&&this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.config_info){var d=this.stateCenter.settingConfig.getSetting("remote_log_level",!0)||e.body.config_info.log_level;this.logger.setRemoteLogLevel(d),r.log_level=d,""==e.body.config_info.log_url||this.logger.url||(this.logger.setLogServer(e.body.config_info.log_url),r.log_url=e.body.config_info.log_url)}e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,r.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var h=0!==this.stateCenter.reportSeqList.login?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:a.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;o.ClientUtil.actionSuccessCallback(h,this.stateCenter.reportList)&&o.ClientUtil.actionSuccessCallback(h,this.stateCenter.reportList)(n.REPORT_ACTION.addEventMsg,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event,a.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.respond_info("respond_info"),r),this.resetTryLogin(),this.loginSuccessCallBack(i,e),this.loginCallback.success&&this.loginCallback.success(!0),this.roomStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code?e.code:e)),this.room.runState!==n.ENUM_RUN_STATE.logout?this.room.runState===n.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==e.code?a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT:e)):this.room.runState===n.ENUM_RUN_STATE.login&&(this.logger.info(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(a.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.NETWORK_BROKEN)):this.logger.info(i.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(e){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.room.runState!==n.ENUM_RUN_STATE.logout?(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",{code:0,msg:""}),this.stopTokenTimer(),this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(i.ZEGO_RTM_ACTION.ROOM_LOGOUT+" result=",e.body&&e.body.err_code?e.body.err_code:"-1")},e}();t.RoomHandler=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var n=r(0),o=r(9),i=r(10),s=function(){function e(e,t,r,s,a){this.stateCenter=e,this.logger=t,this.dataReport=r,this.service=s,this.rtm=a,this.roomID="",this._dispatchServer="",this.deviceID="",this.deviceType="",this.anType=0,this.sessionExpire="",this.pri_roomID="",this.roomSid="0",this.roomFlag=1,this.timeStamp=0,this.netType=2,this.userSeq=0,this.hallRunState=n.ENUM_RUN_STATE.logout,this.hallToken="",this.roomSessionID="",this.lastHallRunState=n.ENUM_RUN_STATE.logout,this.runRoomState=n.ENUM_RUN_STATE.logout,this.lastRunRoomState=n.ENUM_RUN_STATE.logout,this.lastHallState="DISCONNECTED",this.hallState="DISCONNECTED",this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.sessionID="",this.initHandler(),this.heartBeatHandler=new o.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.userHandler=new i.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service,this),this.initMessageHandler(),this.init()}return e.prototype.initMessageHandler=function(){},e.prototype.initHandler=function(){},e.prototype.init=function(){this.bindSocketHandler(),this.bindHeatBeatHandler(),this.bindMessageHandler(),this.bindLiveHandler()},e.prototype.bindSocketHandler=function(){var e=this;this.service.handlePushUserStateUpdateMsg=function(t){e.userHandler.handlePushUserStateUpdateMsg(t)}},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(e){},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.HBResponse(t)}},e.prototype.bindHallHandler=function(){},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.bindRoomHandler=function(){},e.prototype.handleHbLogout=function(e){},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e.prototype.isLogin=function(){return this.hallRunState===n.ENUM_RUN_STATE.login},e}();t.LiveRoomModules=s},function(e,t,r){"use strict";var n,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomPrivateService=void 0;var i=r(12),s=r(0),a=function(e){function t(t,r,n){var o=e.call(this,t,r,n)||this;return o.stateCenter=t,o.logger=r,o.service=new i.ZegoSocketService(o.stateCenter.ENV),o.cmdSeq=0,o.responseRouters={},o}return o(t,e),t.prototype.checkResponse=function(e){return e.header.app_id!==this.stateCenter.appid||e.header.user_uid!==this.stateCenter.userid||this.stateCenter.priModules.hallRunState!==s.ENUM_RUN_STATE.login},t.prototype.handleHallKickout=function(e){},t.prototype.handlePushKickout=function(e){},t.prototype.handlePushCustomMsg=function(e){},t.prototype.handlePushRoomMsg=function(e){},t.prototype.handlePushUserStateUpdateMsg=function(e){},t.prototype.handlePushMergeMsg=function(e){},t.prototype.handlePushTransMsg=function(e){},t.prototype.handleBigImMsgRsp=function(e){},t.prototype.handlePushSignalMsg=function(e){},t.prototype.closeHandler=function(e){this.service.closeHandler(e)},t.prototype.openHandler=function(e){this.service.openHandler(e)},t.prototype.errorHandler=function(e){this.service.errorHandler(e)},t.prototype.getHeader=function(e){return{cmd:e,seq:++this.cmdSeq,timestamp:Math.ceil((new Date).getTime()/1e3)+"",app_id:this.stateCenter.appid,user_uid:this.stateCenter.userid||"0",session_id:this.stateCenter.priModules.sessionID||"0"}},t.prototype.startCheck=function(){this.service.startCheck()},t.prototype.stopCheck=function(){this.service.stopCheck()},t.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},t.prototype.closeSocket=function(){this.service.closeSocket()},t.prototype.on=function(e,t){this.responseRouters[e]=t},t}(r(11).LiveRoomService);t.LiveRoomPrivateService=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSettingConfig=void 0;var n=function(){function e(){this.defaultSetting={remote_log_level:"info"},this.requestList={},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setSetting=function(e,t){var r=Array.isArray(t)&&t.length>0;for(var n in e)for(var o in e[n])if(!o.endsWith("_ctrlmode")){if(r&&-1==t.indexOf(o))continue;var i=e[n][o+"_ctrlmode"];1===i||2===i?this.setting[o]=e[n][o]:this.defaultSetting[o]&&(this.setting[o]=this.defaultSetting[o]),"number"==typeof i&&(this.setting[o+"_ctrlmode"]=e[n][o+"_ctrlmode"])}},e.prototype.getSetting=function(e,t){return void 0===t&&(t=!1),t?2==this.setting[e+"_ctrlmode"]?this.setting[e]:void 0:this.setting[e]},e}();t.ZegoSettingConfig=n},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){return n={},t.m=r=[function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_SETTING_ACTION=void 0,(t=t.ZEGO_SETTING_ACTION||(t.ZEGO_SETTING_ACTION={})).CONSTRUCTOR="zs.0",t.SETTING_INIT="zs.ii.0",t.SETTING_FETCH_SETTING="zs.fs.0",t.SETTING__FETCH_SETTING="zs.fs.1",t.SETTING_GET_CLOUD_SETTING="zs.gcs.0",t.SETTING_POLLING_SETTING="zs.ps.0",t.SETTINGCACHEHANDLER_GET_CACHE_SETTING="zs.sch.gcs.0",t.SETTINGCACHEHANDLER_STORE_SETTING="zs.sch.ss.0",t.SETTINGFETCHHANDLER_FETCHSETTING="zs.sfh.fs.0"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorList=void 0,t.errorList={NOT_INIT:{code:1001,msg:"not init"},FILE_REQUEST_FAIL:{code:1002,msg:"fetch request fail"},INFLATE_DATA_FAIL:{code:1003,msg:"inflate fail"},MULTI_FILE_NOT_EXIST:{code:1004,msg:"get multi file fail"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateUUID=t.checkValidNumber=t.analyzeKey=t.getCurrentTime=t.getBrowser=void 0,t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),n=null!=window.opr,o=e.indexOf("Chrome")&&window.chrome,i=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return e=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0],t?"IE":r?"FIREFOX":n?"OPERA":o?"CHROME":i?"SAFARI":e?"WEIXIN":"UNKOWN"};var n=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(n[e.getMonth()+1]||e.getMonth()+1)+"/",(n[e.getDate()]||e.getDate())+" ",(n[e.getHours()]||e.getHours())+":",(n[e.getMinutes()]||e.getMinutes())+":",n[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")},t.analyzeKey=function(e){return e=e.split("_"),{level:Number(e[0]),timestamp:e[1],seq:e[2]}},t.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&t<=e&&e<=r},t.generateUUID=function(e){if(0===(e=void 0===e?0:e)?r=localStorage.getItem("z_deviceID"):wx.getStorageSync("z_deviceID"),r)return r;var t=(new Date).getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(36)});return 0===e?localStorage.setItem("z_deviceID",r):wx.setStorageSync("z_deviceID",r),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSetting=void 0;var n=r(4);Object.defineProperty(t,"ZegoSetting",{enumerable:!0,get:function(){return n.ZegoSetting}})},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSetting=void 0;var s=r(5),a=r(6),u=r(10),l=r(0),c=r(12),d=r(1),h=r(2);function p(){this.fileList=[],this.publicEnvVariable={},this.proEnvVariable={},this.pollingTimer=null,this.pollingInterval=300,this.inited=!1,this.log=new s.ZegoLog}Object.defineProperty(p.prototype,"envVariable",{get:function(){return Object.assign({},this.publicEnvVariable,this.proEnvVariable)},enumerable:!1,configurable:!0}),p.prototype.init=function(e){var t=this;return e.pollingFreq&&!h.checkValidNumber(e.pollingFreq)?(this.log.error(l.ZEGO_SETTING_ACTION.SETTING_INIT+" pollingFreq must be integer number"),!1):(this.options=Object.assign({},c.INIT_CONFIG,e),this.getPublicEnvVariable(),this.settingFetchHandler=new u.SettingFetchHandler(this.options,this.log),this.settingFetchHandler.setDataReport(this.options.reportNotify),e=Math.round(60*Math.random()),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_INIT+" delay "+e),this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null),this.options.pollingFreq&&60<=this.options.pollingFreq&&(this.pollingInterval=this.options.pollingFreq),this.delayTimer=setTimeout(function(){t.pollingSetting(1e3*t.pollingInterval)},1e3*e),this.settingCacheHandler=new a.SettingCacheHandler("setting_"+(this.options.online?"online_":"test_")+this.options.product+"_"+this.options.appID,this.log,this.options.env),this.inited=!0)},p.prototype.uninit=function(){this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null)},p.prototype.setEnvVariable=function(e,t){this.proEnvVariable[e]=String(t)},p.prototype.getEnvVariable=function(e){return this.envVariable[e]},p.prototype.setEnvVariables=function(e){var t=this;Object.keys(e).forEach(function(r){"string"!=typeof e[r]&&"number"!=typeof e[r]&&t.log.error("zs.sev env "+r+" type error"),t.proEnvVariable[r]=String(e[r])})},p.prototype.getEnvVariables=function(){return this.envVariable},p.prototype.enablePolling=function(e,t){var r=this;t?t.forEach(function(t){var n=r.fileList.find(function(e){return e.fileName===t});n&&(n.needPolling=e)}):this.fileList.forEach(function(t){return t.needPolling=e})},p.prototype.setToken=function(e){this.token=e},p.prototype.setUserID=function(e){this.userID=e},p.prototype.getSettingCache=function(e){return o(this,void 0,void 0,function(){var t,r,n;return i(this,function(o){switch(o.label){case 0:return this.inited?(t=this.fileList.find(function(t){return t.fileName===e}))?[2,Promise.resolve({setting:t.setting,versions:t.versions})]:[3,1]:[2,Promise.reject(d.errorList.NOT_INIT)];case 1:return r=this._getFileName(e),[4,this.settingCacheHandler.getCacheSetting(r)];case 2:return(r=o.sent())&&(this.fileList.find(function(t){return t.fileName===e})||this.fileList.push({fileName:e,fetchedTime:0,needPolling:!1,setting:r.setting,versions:r.versions}),n={setting:r.setting,versions:r.versions}),[2,Promise.resolve(n)]}})})},p.prototype.fetchSetting=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r=!0),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" call "+e),this.inited?(this.activePolling(),0<Object.keys(t).length?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" get file with params"),this._getCloudSetting(e,n(n({},this.envVariable),t))):(t=this.fileList.find(function(t){return t.fileName===e}))?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" file exist"),(new Date).getTime()-t.fetchedTime<1e3*this.pollingInterval?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" fetch time interval in freq"),t.needPolling=r,Promise.resolve({setting:t.setting,versions:t.versions})):this._fetchSetting(e,t,r)):(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" file not found"),this._fetchSetting(e,t,r))):Promise.reject(d.errorList.NOT_INIT)},p.prototype.fetchMultiSetting=function(e,t,r){var s=this;return void 0===t&&(t={}),void 0===r&&(r=!0),this.inited?(this.activePolling(),0<Object.keys(t).length?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" get file with params"),this._getCloudSetting(e,n(n({},this.envVariable),t))):new Promise(function(t,n){var a={},u=[];if(e.forEach(function(e){return o(s,void 0,void 0,function(){var t;return i(this,function(r){return(t=this.fileList.find(function(t){return t.fileName===e}))&&(new Date).getTime()-t.fetchedTime<1e3*this.pollingInterval?(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_FETCH_SETTING+" fetch time interval in freq"),a[e]={setting:t.setting,versions:t.versions}):u.push(e),[2]})})}),!(0<u.length))return t(a);s._getCloudSetting(u,s.envVariable).then(function(e){return s.handleFetchFiles(e,r),Object.assign(a,e),t(a)}).catch(function(e){u.forEach(function(e){return o(s,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return(t=this.fileList.find(function(t){return t.fileName==e}))?t.fetchedTime=(new Date).getTime():this.fileList.find(function(t){return t.fileName===e})||this.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:r,setting:{},versions:{}}),[4,this.settingCacheHandler.getCacheSetting(e)];case 1:return t=n.sent(),a[e]={setting:t.setting,versions:t.versions},[2]}})})}),0<Object.keys(a).length?t(a):n(e)})})):Promise.reject(d.errorList.NOT_INIT)},p.prototype.setLog=function(e){this.log=e},p.prototype._getCloudSetting=function(e,t){var r=this;return new Promise(function(n,s){return o(r,void 0,void 0,function(){var r,o,a,u,c,h;return i(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.settingFetchHandler.fetchSetting((u=e instanceof Array)?e:[e],t,this.token,this.userID)];case 1:return o=i.sent(),r=o.data,"number"==typeof(o=o.polling_interval)&&5<=o&&this.pollingInterval!==60*o&&(this.log.warn(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" polling interval change"),this.pollingInterval=60*o,this.uninit(),this.activePolling()),u?(a={},e.forEach(function(e){var t,n;0==(null===(t=r[e])||void 0===t?void 0:t.code)&&void 0!==(null===(n=r[e])||void 0===n?void 0:n.data)&&(a[e]={setting:null===(n=r[e])||void 0===n?void 0:n.data,versions:null===(e=r[e])||void 0===e?void 0:e.versions})}),0<Object.keys(a).length?n(a):s(d.errorList.MULTI_FILE_NOT_EXIST)):0===(null===(u=r[e])||void 0===u?void 0:u.code)&&null!==(c=r[e])&&void 0!==c&&c.data?n({setting:null===(c=r[e])||void 0===c?void 0:c.data,versions:null===(c=r[e])||void 0===c?void 0:c.versions}):s({code:null===(h=r[e])||void 0===h?void 0:h.code,msg:null===(h=r[e])||void 0===h?void 0:h.message}),[3,3];case 2:return h=i.sent(),s(h),this.log.info(l.ZEGO_SETTING_ACTION.SETTING_GET_CLOUD_SETTING+" fail"),[3,3];case 3:return[2]}})})})},p.prototype.handleFetchFiles=function(e,t){var r=this;Object.keys(e).forEach(function(n){var o=r.fileList.find(function(e){return e.fileName==n});o?(o.fetchedTime=(new Date).getTime(),o.setting=e[n].setting,o.versions=e[n].versions,o.needPolling=t):r.fileList.find(function(e){return e.fileName===n})||r.fileList.push({fileName:n,fetchedTime:(new Date).getTime(),needPolling:t,setting:e[n].setting,versions:e[n].versions}),o=r._getFileName(n),r.settingCacheHandler.storeSetting(o,e[n])})},p.prototype._fetchSetting=function(e,t,r){var n=this;return new Promise(function(s,a){n.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" call"),n._getCloudSetting(e,n.envVariable).then(function(o){t?(t.fetchedTime=(new Date).getTime(),t.setting=o.setting,t.versions=o.versions,t.needPolling=r):n.fileList.find(function(t){return t.fileName===e})||n.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:r,setting:o.setting,versions:o.versions});var i=n._getFileName(e);n.settingCacheHandler.storeSetting(i,o),s(o),n.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" call suc")}).catch(function(u){return o(n,void 0,void 0,function(){var n;return i(this,function(o){switch(o.label){case 0:t?t.fetchedTime=(new Date).getTime():this.fileList.find(function(t){return t.fileName===e})||this.fileList.push({fileName:e,fetchedTime:(new Date).getTime(),needPolling:r,setting:{},versions:{}}),n=this._getFileName(e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.settingCacheHandler.getCacheSetting(n)];case 2:return n=o.sent(),s(n),[3,4];case 3:return o.sent(),a(u),[3,4];case 4:return this.log.info(l.ZEGO_SETTING_ACTION.SETTING__FETCH_SETTING+" setting not contain or fetch file fail"),[2]}})})})})},p.prototype.getPublicEnvVariable=function(){var e;0==this.options.env?(this.publicEnvVariable.userAgent=navigator.userAgent,this.publicEnvVariable.platform=navigator.platform,this.publicEnvVariable.browser=h.getBrowser(),this.publicEnvVariable.deviceid=h.generateUUID()):1==this.options.env&&(e=wx.getSystemInfoSync(),this.publicEnvVariable.brand=e.brand,this.publicEnvVariable.model=e.model,this.publicEnvVariable.system=e.system,this.publicEnvVariable.platform=e.platform,this.publicEnvVariable.wechatVersion=e.version,this.publicEnvVariable.wechatSDKVersion=e.SDKVersion,this.publicEnvVariable.deviceid=h.generateUUID(this.options.env))},p.prototype.pollingSetting=function(e){return o(this,void 0,void 0,function(){var t,r,n,s,a=this;return i(this,function(u){switch(u.label){case 0:if(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" call "+e),t=[],this.fileList.forEach(function(e){e.needPolling&&t.push(e.fileName)}),r=e,!(0<t.length))return[3,5];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.settingFetchHandler.fetchSetting(t,this.envVariable,this.token,this.userID)];case 2:return s=u.sent(),n=s.data,"number"==typeof(s=s.polling_interval)&&5<=s&&this.pollingInterval!==60*s&&(this.log.warn(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" polling interval change"),this.pollingInterval=60*s,r=1e3*this.pollingInterval),this.fileList.forEach(function(e){return o(a,void 0,void 0,function(){var t,r,o,s;return i(this,function(i){switch(i.label){case 0:return e.fetchedTime=(new Date).getTime(),t=this._getFileName(e.fileName),n[e.fileName]&&0===n[e.fileName].code&&n[e.fileName].data?(r=JSON.stringify(n[e.fileName].data),o=JSON.stringify(e.setting),s={setting:n[e.fileName].data,versions:null===(s=n[e.fileName])||void 0===s?void 0:s.versions},o!==r&&(this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" "+e.fileName+" setting changed"),e.setting=s.setting,e.versions=s.versions,this.options.pollingNotify(e.fileName,s)),[4,this.settingCacheHandler.getCacheSetting(t)]):[3,2];case 1:o=i.sent(),r=JSON.stringify(o),o=JSON.stringify(s),r!==o&&this.settingCacheHandler.storeSetting(t,s),i.label=2;case 2:return[2]}})})}),[3,4];case 3:return s=u.sent(),this.log.error(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" fetch fail "+JSON.stringify(s)),[3,4];case 4:return[3,6];case 5:this.log.info(l.ZEGO_SETTING_ACTION.SETTING_POLLING_SETTING+" polling no file"),u.label=6;case 6:return this.pollingTimer&&clearTimeout(this.pollingTimer),this.pollingTimer=setTimeout(function(){a.pollingSetting(r)},r),[2]}})})},p.prototype._getFileName=function(e){return e},p.prototype.activePolling=function(){this.pollingTimer||this.pollingSetting(1e3*this.pollingInterval)},t.ZegoSetting=r=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLog=void 0;var n=(o.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},o.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},o.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},o.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},o.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.join(" ")},o);function o(){}t.ZegoLog=n},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,(s=o?[2&s[0],o.value]:s)[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingCacheHandler=void 0;var i=r(0),s=r(7);function a(e,t,r){void 0===r&&(r=0),this.storeName=e,this.log=t,this.store=s.createZegoStore(e,r)}a.prototype.getCacheSetting=function(e){return n(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.log.info(i.ZEGO_SETTING_ACTION.SETTINGCACHEHANDLER_GET_CACHE_SETTING+" call"),[4,this.store.getItem(e)];case 1:return[2,t.sent()||""]}})})},a.prototype.storeSetting=function(e,t){return n(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return this.log.info(i.ZEGO_SETTING_ACTION.SETTINGCACHEHANDLER_STORE_SETTING+" call"),[4,this.store.setItem(e,t)];case 1:return r.sent(),[2]}})})},t.SettingCacheHandler=r=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoStore=t.ZegoWechatMiniStore=void 0;var n=r(8),o=r(9),i=(s.prototype.getItem=function(e){var t=this;return new Promise(function(r,n){try{r(wx.getStorageSync(t.keyPrefix+e))}catch(r){n(r)}})},s.prototype.setItem=function(e,t){var r=this;return new Promise(function(n,o){try{wx.setStorageSync(r.keyPrefix+e,t),n()}catch(n){o(n)}})},s.prototype.removeItem=function(e){var t=this;return new Promise(function(r,n){try{r(wx.removeStorageSync(t.keyPrefix+e))}catch(r){n(r)}})},s.prototype.clear=function(){return new Promise(function(e,t){try{wx.clearStorageSync(),e()}catch(e){t(e)}})},s.prototype.keys=function(){var e=this;return new Promise(function(t,r){try{var n=wx.getStorageInfoSync().keys,o=[];n.forEach(function(t){0==t.indexOf(e.keyPrefix)&&o.push(t.replace(e.keyPrefix,""))}),o.sort(),t(o)}catch(t){r(t)}})},s);function s(e){this.storeName=e,this.keyPrefix=e+"/"}t.ZegoWechatMiniStore=i,t.createZegoStore=function(e,t){return t===o.ZEGO_ENV.BROWSER?n.createInstance({name:e}):new i(e)}},function(t,r){t.exports=e},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SOCKET_DISCONNECT=t.ENUM_REMOTE_TYPE=t.ZEGO_BROWSER_TYPE=t.ZEGO_ENV=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.0.3",(n=t.ZEGO_ENV||(t.ZEGO_ENV={}))[n.BROWSER=0]="BROWSER",n[n.WEIXINMINI=1]="WEIXINMINI",(n=t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={}))[n.IE=0]="IE",n[n.FIREFOX=1]="FIREFOX",n[n.CHROME=2]="CHROME",n[n.SAFARI=3]="SAFARI",n[n.OPERA=4]="OPERA",n[n.WEIXIN=5]="WEIXIN",n[n.WEIXINMINI=6]="WEIXINMINI",n[n.UNKOWN=7]="UNKOWN",(n=t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={}))[n.DISABLE=0]="DISABLE",n[n.WEBSOCKET=1]="WEBSOCKET",n[n.HTTPS=2]="HTTPS",t.SOCKET_DISCONNECT=-1},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.SettingFetchHandler=void 0;var o=r(0),i=r(11),s=r(2);function a(e,t){this.options=e,this.log=t,this.seq=0}a.prototype.setOptions=function(e){this.options=e},a.prototype.setDataReport=function(e){this.reportFunc=e},a.prototype.fetchSetting=function(e,t,r,a){var u=this;return new Promise(function(l,c){var d={product:u.options.product,files:e,param:n(n({},t),{deviceid:void 0}),appid:u.options.appID,token:r,id_name:a,timestamp:(new Date).getTime(),biztype:0,deviceid:t.deviceid||s.generateUUID(u.options.env),compress:!1,mode:u.options.online?"online":"test"},h=u.seq++;u.reportFunc&&u.reportFunc(h,"request_start"),i.fetch(u.options.urls,d,u.options.env||0).then(function(e){var t,r=e.code,n=e.data,i=e.polling_interval;e=e.reportData,u.log.info(o.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" "+r),n&&(t=[],Object.keys(n).forEach(function(e){t.push({name:e,error:n[e].code})})),u.reportFunc&&u.reportFunc(h,"request_end",{code:r,reportData:e,params:d,files:t}),l({data:n,polling_interval:i})}).catch(function(e){var t=e.code,r=e.msg;e=e.reportData,u.log.warn(o.ZEGO_SETTING_ACTION.SETTINGFETCHHANDLER_FETCHSETTING+" "+t),u.reportFunc&&u.reportFunc(h,"request_end",{code:t,params:d,reportData:e}),c({code:t,msg:r})})})},t.SettingFetchHandler=r=a},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=void 0;var o=r(1);t.fetch=function e(t,r,i,s,a,u){return void 0===s&&(s=5),void 0===a&&(a=0),void 0===u&&(u=[]),new Promise(function(l,c){a=a||(new Date).getTime();var d,h,p,f=(new Date).getTime();0===i?((d=new XMLHttpRequest).open("post",h=t[(s+1)%2]||t[0]),1==r.compress&&(d.responseType="arraybuffer"),d.ontimeout=function(){},d.onreadystatechange=function(){var p,g,_,m,v;4==d.readyState&&(200<=d.status&&d.status<300||304==d.status?(g=void 0,1==r.compress||(g=d.responseText),v=(new Date).getTime()-f,p=(_=JSON.parse(g)).code,m=_.message,g=_.data,_=_.polling_interval,u.push({timestamp:f,url:h,error:p,duration:v}),0===p?l({code:p,msg:m,data:g,polling_interval:_,reportData:u}):c({code:p,msg:m,reportData:u})):(m=(new Date).getTime()-f,u.push({timestamp:f,url:h,error:d.status,duration:m}),v=(new Date).getTime()-a,0<s&&v<8e3?e(t,r,i,--s,a,u).then(function(e){l(e)}).catch(function(e){c(e)}):c(n(n({},o.errorList.FILE_REQUEST_FAIL),{reportData:u}))))},d.timeout=8e3,d.send(JSON.stringify(r))):(p=t[(s+1)%2]||t[0],wx.request({url:p,data:r,method:"POST",success:function(d){var h=(m=d.data).code,g=m.message,_=m.data,m=m.polling_interval;void 0!==h?0===h?l({code:h,msg:g,data:_,polling_interval:m,reportData:u}):c({code:h,msg:g,reportData:u}):(g=(new Date).getTime()-f,u.push({timestamp:f,url:p,error:o.errorList.FILE_REQUEST_FAIL.code,msg:d.data,duration:g}),0<s?e(t,r,i,--s,a,u).then(function(e){l(e)}).catch(function(e){c(e)}):c(n(n({},o.errorList.FILE_REQUEST_FAIL),{reportData:u})))},fail:function(d){var h=(new Date).getTime()-f;u.push({timestamp:f,url:p,error:o.errorList.FILE_REQUEST_FAIL.code,msg:d.errMsg,duration:h}),0<s?e(t,r,i,--s,a,u).then(function(e){l(e)}).catch(function(e){c(e)}):c(n(n({},o.errorList.FILE_REQUEST_FAIL),{reportData:u}))}}))})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INIT_CONFIG=void 0,t.INIT_CONFIG={env:0}}],t.c=n,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,(function(t){return e[t]}).bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3);function t(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return r[e].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r,n}(r(34))},function(e,t,r){(function(t){e.exports=function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){return o(t[s][1][e]||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var i=!1,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,r,n){(function(e){"use strict";var t,n,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var i=0,s=new o(c),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),t=function(){a.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)};else{var u=new e.MessageChannel;u.port1.onmessage=c,t=function(){u.port2.postMessage(0)}}var l=[];function c(){var e,t;n=!0;for(var r=l.length;r;){for(t=l,l=[],e=-1;++e<r;)t[e]();r=l.length}n=!1}r.exports=function(e){1!==l.push(e)||n||t()}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var n=e(1);function o(){}var i={},s=["REJECTED"],a=["FULFILLED"],u=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==o&&p(this,e)}function c(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function d(e,t,r){n(function(){var n;try{n=t(r)}catch(t){return i.reject(e,t)}n===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,n)})}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var r=!1;function n(t){r||(r=!0,i.reject(e,t))}function o(t){r||(r=!0,i.resolve(e,t))}var s=f(function(){t(o,n)});"error"===s.status&&n(s.value)}function f(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var r=new this.constructor(o);return this.state!==u?d(r,this.state===a?e:t,this.outcome):this.queue.push(new c(r,e,t)),r},c.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){i.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},i.resolve=function(e,t){var r=f(h,t);if("error"===r.status)return i.reject(e,r.value);var n=r.value;if(n)p(e,n);else{e.state=a,e.outcome=t;for(var o=-1,s=e.queue.length;++o<s;)e.queue[o].callFulfilled(t)}return e},i.reject=function(e,t){e.state=s,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:i.resolve(new this(o),e)},l.reject=function(e){var t=new this(o);return i.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var s=new Array(r),a=0,u=-1,l=new this(o);++u<r;)c(e[u],u);return l;function c(e,o){t.resolve(e).then(function(e){s[o]=e,++a!==r||n||(n=!0,i.resolve(l,s))},function(e){n||(n=!0,i.reject(l,e))})}},l.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var n=-1,s=new this(o);++n<t;)this.resolve(e[n]).then(function(e){r||(r=!0,i.resolve(s,e))},function(e){r||(r=!0,i.reject(s,e))});return s}},{1:1}],3:[function(e,r,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var s=Promise;function a(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function u(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function c(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d=void 0,h={},p=Object.prototype.toString;function f(e){return"boolean"==typeof d?s.resolve(d):function(e){return new s(function(t){var r=e.transaction("local-forage-detect-blob-support","readwrite"),n=i([""]);r.objectStore("local-forage-detect-blob-support").put(n,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return d=e})}function g(e){var t=h[e.name],r={};r.promise=new s(function(e,t){r.resolve=e,r.reject=t}),t.deferredOperations.push(r),t.dbReady=t.dbReady?t.dbReady.then(function(){return r.promise}):r.promise}function _(e){var t=h[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function m(e,t){var r=h[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function v(e,t){return new s(function(r,n){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);g(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var s=o.open.apply(o,i);t&&(s.onupgradeneeded=function(t){var r=s.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore("local-forage-detect-blob-support")}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),n(s.error)},s.onsuccess=function(){r(s.result),_(e)}})}function E(e){return v(e,!1)}function T(e){return v(e,!0)}function y(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version>e.db.version;if(e.version<e.db.version&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),n||r){if(r){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function S(e){return i([function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),o=0;o<t;o++)n[o]=e.charCodeAt(o);return r}(atob(e.data))],{type:e.type})}function C(e){return e&&e.__local_forage_encoded_blob}function R(e){var t=this,r=t._initReady().then(function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return u(r,e,e),r}function b(e,t,r,n){void 0===n&&(n=1);try{var o=e.db.transaction(e.storeName,t);r(null,o)}catch(o){if(n>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return s.resolve().then(function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),T(e)}).then(function(){return function(e){g(e);for(var t=h[e.name],r=t.forages,n=0;n<r.length;n++){var o=r[n];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,E(e).then(function(t){return e.db=t,y(e)?T(e):t}).then(function(n){e.db=t.db=n;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=n}).catch(function(t){throw m(e,t),t})}(e).then(function(){b(e,t,r,n-1)})}).catch(r);r(o)}}var I={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]=e[n];var o=h[r.name];o||(h[r.name]=o={forages:[],db:null,dbReady:null,deferredOperations:[]}),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=R);var i=[];function a(){return s.resolve()}for(var u=0;u<o.forages.length;u++){var l=o.forages[u];l!==t&&i.push(l._initReady().catch(a))}var c=o.forages.slice(0);return s.all(i).then(function(){return r.db=o.db,E(r)}).then(function(e){return r.db=e,y(r,t._defaultConfig.version)?T(r):e}).then(function(e){r.db=o.db=e,t._dbInfo=r;for(var n=0;n<c.length;n++){var i=c[n];i!==t&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})},_support:function(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=new s(function(t,n){r.ready().then(function(){b(r._dbInfo,"readonly",function(o,i){if(o)return n(o);try{var s=i.objectStore(r._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var r=s.result;if(r){var n=r.value;C(n)&&(n=S(n));var o=e(n,r.key,a++);void 0!==o?t(o):r.continue()}else t()},s.onerror=function(){n(s.error)}}catch(e){n(e)}})}).catch(n)});return a(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=new s(function(t,n){r.ready().then(function(){b(r._dbInfo,"readonly",function(o,i){if(o)return n(o);try{var s=i.objectStore(r._dbInfo.storeName).get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),C(e)&&(e=S(e)),t(e)},s.onerror=function(){n(s.error)}}catch(e){n(e)}})}).catch(n)});return a(n,t),n},setItem:function(e,t,r){var n=this;e=l(e);var o=new s(function(r,o){var i;n.ready().then(function(){return i=n._dbInfo,"[object Blob]"===p.call(t)?f(i.db).then(function(e){return e?t:(r=t,new s(function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){var n=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:r.type})},n.readAsBinaryString(r)}));var r}):t}).then(function(t){b(n._dbInfo,"readwrite",function(i,s){if(i)return o(i);try{var a=s.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var u=a.put(t,e);s.oncomplete=function(){void 0===t&&(t=null),r(t)},s.onabort=s.onerror=function(){o(u.error?u.error:u.transaction.error)}}catch(e){o(e)}})}).catch(o)});return a(o,r),o},removeItem:function(e,t){var r=this;e=l(e);var n=new s(function(t,n){r.ready().then(function(){b(r._dbInfo,"readwrite",function(o,i){if(o)return n(o);try{var s=i.objectStore(r._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){n(s.error)},i.onabort=function(){n(s.error?s.error:s.transaction.error)}}catch(e){n(e)}})}).catch(n)});return a(n,t),n},clear:function(e){var t=this,r=new s(function(e,r){t.ready().then(function(){b(t._dbInfo,"readwrite",function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){r(i.error?i.error:i.transaction.error)}}catch(e){r(e)}})}).catch(r)});return a(r,e),r},length:function(e){var t=this,r=new s(function(e,r){t.ready().then(function(){b(t._dbInfo,"readonly",function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){r(i.error)}}catch(e){r(e)}})}).catch(r)});return a(r,e),r},key:function(e,t){var r=this,n=new s(function(t,n){e<0?t(null):r.ready().then(function(){b(r._dbInfo,"readonly",function(o,i){if(o)return n(o);try{var s=i.objectStore(r._dbInfo.storeName),a=!1,u=s.openKeyCursor();u.onsuccess=function(){var r=u.result;r?0===e||a?t(r.key):(a=!0,r.advance(e)):t(null)},u.onerror=function(){n(u.error)}}catch(e){n(e)}})}).catch(n)});return a(n,t),n},keys:function(e){var t=this,r=new s(function(e,r){t.ready().then(function(){b(t._dbInfo,"readonly",function(n,o){if(n)return r(n);try{var i=o.objectStore(t._dbInfo.storeName).openKeyCursor(),s=[];i.onsuccess=function(){var t=i.result;t?(s.push(t.key),t.continue()):e(s)},i.onerror=function(){r(i.error)}}catch(e){r(e)}})}).catch(r)});return a(r,e),r},dropInstance:function(e,t){t=c.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,i=this;if(e.name){var u=e.name===r.name&&i._dbInfo.db?s.resolve(i._dbInfo.db):E(e).then(function(t){var r=h[e.name],n=r.forages;r.db=t;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=t;return t});n=u.then(e.storeName?function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;g(e);var n=h[e.name],i=n.forages;t.close();for(var a=0;a<i.length;a++){var u=i[a];u._dbInfo.db=null,u._dbInfo.version=r}return new s(function(t,n){var i=o.open(e.name,r);i.onerror=function(e){i.result.close(),n(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<i.length;t++){var r=i[t];r._dbInfo.db=e,_(r._dbInfo)}}).catch(function(t){throw(m(e,t)||s.resolve()).catch(function(){}),t})}}:function(t){g(e);var r=h[e.name],n=r.forages;t.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;return new s(function(t,r){var n=o.deleteDatabase(e.name);n.onerror=n.onblocked=function(e){var t=n.result;t&&t.close(),r(e)},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}).then(function(e){r.db=e;for(var t=0;t<n.length;t++)_(n[t]._dbInfo)}).catch(function(t){throw(m(e,t)||s.resolve()).catch(function(){}),t})})}else n=s.reject("Invalid arguments");return a(n,t),n}},k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O=/^~~local_forage_type~([^~]+)~/,L="__lfsc__:".length,P=L+"arbf".length,A=Object.prototype.toString;function N(e){var t,r,n,o,i,s=.75*e.length,a=e.length,u=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),c=new Uint8Array(l);for(t=0;t<a;t+=4)r=k.indexOf(e[t]),n=k.indexOf(e[t+1]),o=k.indexOf(e[t+2]),i=k.indexOf(e[t+3]),c[u++]=r<<2|n>>4,c[u++]=(15&n)<<4|o>>2,c[u++]=(3&o)<<6|63&i;return l}function M(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=k[r[t]>>2],n+=k[(3&r[t])<<4|r[t+1]>>4],n+=k[(15&r[t+1])<<2|r[t+2]>>6],n+=k[63&r[t+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var w={serialize:function(e,t){var r="";if(e&&(r=A.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===A.call(e.buffer))){var n,o="__lfsc__:";e instanceof ArrayBuffer?(n=e,o+="arbf"):(n=e.buffer,"[object Int8Array]"===r?o+="si08":"[object Uint8Array]"===r?o+="ui08":"[object Uint8ClampedArray]"===r?o+="uic8":"[object Int16Array]"===r?o+="si16":"[object Uint16Array]"===r?o+="ur16":"[object Int32Array]"===r?o+="si32":"[object Uint32Array]"===r?o+="ui32":"[object Float32Array]"===r?o+="fl32":"[object Float64Array]"===r?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+M(n))}else if("[object Blob]"===r){var i=new FileReader;i.onload=function(){var r="~~local_forage_type~"+e.type+"~"+M(this.result);t("__lfsc__:blob"+r)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,L))return JSON.parse(e);var t,r=e.substring(P),n=e.substring(L,P);if("blob"===n&&O.test(r)){var o=r.match(O);t=o[1],r=r.substring(o[0].length)}var s=N(r);switch(n){case"arbf":return s;case"blob":return i([s],{type:t});case"si08":return new Int8Array(s);case"ui08":return new Uint8Array(s);case"uic8":return new Uint8ClampedArray(s);case"si16":return new Int16Array(s);case"ur16":return new Uint16Array(s);case"si32":return new Int32Array(s);case"ui32":return new Uint32Array(s);case"fl32":return new Float32Array(s);case"fl64":return new Float64Array(s);default:throw new Error("Unkown type: "+n)}},stringToBuffer:N,bufferToString:M};function D(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function U(e,t,r,n,o,i){e.executeSql(r,n,o,function(e,s){s.code===s.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,a){a.rows.length?i(e,s):D(e,t,function(){e.executeSql(r,n,o,i)},i)},i):i(e,s)},i)}function x(e,t,r,n){var o=this;e=l(e);var i=new s(function(i,s){o.ready().then(function(){void 0===t&&(t=null);var a=t,u=o._dbInfo;u.serializer.serialize(t,function(t,l){l?s(l):u.db.transaction(function(r){U(r,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){i(a)},function(e,t){s(t)})},function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void i(x.apply(o,[e,a,r,n-1]));s(t)}})})}).catch(s)});return a(i,r),i}function B(e){return new s(function(t,r){e.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(r,n){for(var o=[],i=0;i<n.rows.length;i++)o.push(n.rows.item(i).name);t({db:e,storeNames:o})},function(e,t){r(t)})},function(e){r(e)})})}var Z={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var o=new s(function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction(function(o){D(o,r,function(){t._dbInfo=r,e()},function(e,t){n(t)})},n)});return r.serializer=w,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,n=new s(function(t,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){U(r,o,"SELECT * FROM "+o.storeName,[],function(r,n){for(var i=n.rows,s=i.length,a=0;a<s;a++){var u=i.item(a),l=u.value;if(l&&(l=o.serializer.deserialize(l)),void 0!==(l=e(l,u.key,a+1)))return void t(l)}t()},function(e,t){n(t)})})}).catch(n)});return a(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=new s(function(t,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){U(r,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],function(e,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=o.serializer.deserialize(n)),t(n)},function(e,t){n(t)})})}).catch(n)});return a(n,t),n},setItem:function(e,t,r){return x.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=l(e);var n=new s(function(t,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){U(r,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){n(t)})})}).catch(n)});return a(n,t),n},clear:function(e){var t=this,r=new s(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){U(t,n,"DELETE FROM "+n.storeName,[],function(){e()},function(e,t){r(t)})})}).catch(r)});return a(r,e),r},length:function(e){var t=this,r=new s(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){U(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,r){var n=r.rows.item(0).c;e(n)},function(e,t){r(t)})})}).catch(r)});return a(r,e),r},key:function(e,t){var r=this,n=new s(function(t,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){U(r,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)},function(e,t){n(t)})})}).catch(n)});return a(n,t),n},keys:function(e){var t=this,r=new s(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){U(t,n,"SELECT key FROM "+n.storeName,[],function(t,r){for(var n=[],o=0;o<r.rows.length;o++)n.push(r.rows.item(o).key);e(n)},function(e,t){r(t)})})}).catch(r)});return a(r,e),r},dropInstance:function(e,t){t=c.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,o=this;return a(n=e.name?new s(function(t){var n;n=e.name===r.name?o._dbInfo.db:openDatabase(e.name,"","",0),t(e.storeName?{db:n,storeNames:[e.storeName]}:B(n))}).then(function(e){return new s(function(t,r){e.db.transaction(function(n){function o(e){return new s(function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){r(t)})})}for(var i=[],a=0,u=e.storeNames.length;a<u;a++)i.push(o(e.storeNames[a]));s.all(i).then(function(){t()}).catch(function(e){r(e)})},function(e){r(e)})})}):s.reject("Invalid arguments"),t),n}};function G(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}var H={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=G(e,this._defaultConfig),!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0?(this._dbInfo=t,t.serializer=w,s.resolve()):s.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=r.ready().then(function(){for(var t=r._dbInfo,n=t.keyPrefix,o=n.length,i=localStorage.length,s=1,a=0;a<i;a++){var u=localStorage.key(a);if(0===u.indexOf(n)){var l=localStorage.getItem(u);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,u.substring(o),s++)))return l}}});return a(n,t),n},getItem:function(e,t){var r=this;e=l(e);var n=r.ready().then(function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n});return a(n,t),n},setItem:function(e,t,r){var n=this;e=l(e);var o=n.ready().then(function(){void 0===t&&(t=null);var r=t;return new s(function(o,i){var s=n._dbInfo;s.serializer.serialize(t,function(t,n){if(n)i(n);else try{localStorage.setItem(s.keyPrefix+e,t),o(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}})})});return a(o,r),o},removeItem:function(e,t){var r=this;e=l(e);var n=r.ready().then(function(){localStorage.removeItem(r._dbInfo.keyPrefix+e)});return a(n,t),n},clear:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}});return a(r,e),r},length:function(e){var t=this.keys().then(function(e){return e.length});return a(t,e),t},key:function(e,t){var r=this,n=r.ready().then(function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t});return a(n,t),n},keys:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo,r=localStorage.length,n=[],o=0;o<r;o++){var i=localStorage.key(o);0===i.indexOf(e.keyPrefix)&&n.push(i.substring(e.keyPrefix.length))}return n});return a(r,e),r},dropInstance:function(e,t){if(t=c.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var n,o=this;return a(n=e.name?new s(function(t){t(e.storeName?G(e,o._defaultConfig):e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}}):s.reject("Invalid arguments"),t),n}},W=function(e,t){for(var r,n,o=e.length,i=0;i<o;){if((r=e[i])===(n=t)||"number"==typeof r&&"number"==typeof n&&isNaN(r)&&isNaN(n))return!0;i++}return!1},F=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},q={},V={},j={INDEXEDDB:I,WEBSQL:Z,LOCALSTORAGE:H},z=[j.INDEXEDDB._driver,j.WEBSQL._driver,j.LOCALSTORAGE._driver],Y=["dropInstance"],Q=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Y),X={description:"",driver:z.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function K(e,t){e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}}function J(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(arguments[0][r]=F(t[r])?t[r].slice():t[r])}return arguments[0]}var $=new(function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),j)if(j.hasOwnProperty(r)){var n=j[r],o=n._driver;this[r]=o,q[o]||this.defineDriver(n)}this._defaultConfig=J({},X),this._config=J({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new s(function(t,r){try{var n=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(o);for(var i=Q.concat("_initStorage"),u=0,l=i.length;u<l;u++){var c=i[u];if((!W(Y,c)||e[c])&&"function"!=typeof e[c])return void r(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=s.reject(t);return a(r,arguments[arguments.length-1]),r}},r=0,n=Y.length;r<n;r++){var o=Y[r];e[o]||(e[o]=t(o))}}();var d=function(r){q[n]&&console.info("Redefining LocalForage driver: "+n),q[n]=e,V[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,r):d(!!e._support):d(!0)}catch(e){r(e)}});return u(n,t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var n=q[e]?s.resolve(q[e]):s.reject(new Error("Driver not found."));return u(n,t,r),n},e.prototype.getSerializer=function(e){var t=s.resolve(w);return u(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return u(r,e,e),r},e.prototype.setDriver=function(e,t,r){var n=this;F(e)||(e=[e]);var o=this._getSupportedDrivers(e);function i(){n._config.driver=n.driver()}function a(e){return n._extend(e),i(),n._ready=n._initStorage(n._config),n._ready}var l=null!==this._driverSet?this._driverSet.catch(function(){return s.resolve()}):s.resolve();return this._driverSet=l.then(function(){var e=o[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then(function(e){n._driver=e._driver,i(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var o=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(o).then(a).catch(r)}i();var u=new Error("No available storage method found.");return n._driverSet=s.reject(u),n._driverSet}()}}(o)})}).catch(function(){i();var e=new Error("No available storage method found.");return n._driverSet=s.reject(e),n._driverSet}),u(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!V[e]},e.prototype._extend=function(e){J(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var o=e[r];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Q.length;e<t;e++)K(this,Q[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=$},{3:3}]},{},[4])(4)}).call(this,r(35))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r}])},8305:function(e,t,r){"use strict";function n(e){return"function"==typeof e}var o=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else o&&console.log("RxJS: Back to a better error behavior. Thank you. <3");o=e},get useDeprecatedSynchronousErrorHandling(){return o}};function s(e){setTimeout(function(){throw e},0)}var a={closed:!0,next:function(e){},error:function(e){if(i.useDeprecatedSynchronousErrorHandling)throw e;s(e)},complete:function(){}},u=Array.isArray||function(e){return e&&"number"==typeof e.length};function l(e){return null!==e&&"object"==typeof e}var c=function(){function e(e){return Error.call(this),this.message=e?"".concat(e.length," errors occurred during unsubscription:\n").concat(e.map(function(e,t){return"".concat(t+1,") ").concat(e.toString())}).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),d=function(){function e(t){_classCallCheck(this,e),this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return _createClass(e,[{key:"unsubscribe",value:function(){var t;if(!this.closed){var r=this._parentOrParents,o=this._ctorUnsubscribe,i=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var a=0;a<r.length;++a)r[a].remove(this);if(n(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(g){t=g instanceof c?h(g.errors):[g]}}if(u(s))for(var d=-1,p=s.length;++d<p;){var f=s[d];if(l(f))try{f.unsubscribe()}catch(g){t=t||[],g instanceof c?t=t.concat(h(g.errors)):t.push(g)}}if(t)throw new c(t)}}},{key:"add",value:function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;(r=new e)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var o=r._parentOrParents;if(null===o)r._parentOrParents=this;else if(o instanceof e){if(o===this)return r;r._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return r;o.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[r]:i.push(r),r}},{key:"remove",value:function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}}}]),e}();function h(e){return e.reduce(function(e,t){return e.concat(t instanceof c?t.errors:t)},[])}d.EMPTY=function(e){return e.closed=!0,e}(new d);var p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),f=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o){var i;switch(_classCallCheck(this,r),(i=t.call(this)).syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=a;break;case 1:if(!e){i.destination=a;break}if("object"==typeof e){e instanceof r?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(_assertThisInitialized(i))):(i.syncErrorThrowable=!0,i.destination=new g(_assertThisInitialized(i),e));break}default:i.syncErrorThrowable=!0,i.destination=new g(_assertThisInitialized(i),e,n,o)}return i}return _createClass(r,[{key:p,value:function(){return this}},{key:"next",value:function(e){this.isStopped||this._next(e)}},{key:"error",value:function(e){this.isStopped||(this.isStopped=!0,this._error(e))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,_get(_getPrototypeOf(r.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(e){this.destination.next(e)}},{key:"_error",value:function(e){this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}],[{key:"create",value:function(e,t,n){var o=new r(e,t,n);return o.syncErrorThrowable=!1,o}}]),r}(d),g=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,o,i,s){var u,l;_classCallCheck(this,r),(u=t.call(this))._parentSubscriber=e;var c=_assertThisInitialized(u);return n(o)?l=o:o&&(l=o.next,i=o.error,s=o.complete,o!==a&&(n((c=Object.create(o)).unsubscribe)&&u.add(c.unsubscribe.bind(c)),c.unsubscribe=u.unsubscribe.bind(_assertThisInitialized(u)))),u._context=c,u._next=l,u._error=i,u._complete=s,u}return _createClass(r,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;i.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber,r=i.useDeprecatedSynchronousErrorHandling;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):s(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;s(e)}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};i.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(r){if(this.unsubscribe(),i.useDeprecatedSynchronousErrorHandling)throw r;s(r)}}},{key:"__tryOrSetError",value:function(e,t,r){if(!i.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(n){return i.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=n,e.syncErrorThrown=!0,!0):(s(n),!0)}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),r}(f),_="function"==typeof Symbol&&Symbol.observable||"@@observable";function m(e){return e}var v,E=((v=function(){function e(t){_classCallCheck(this,e),this._isScalar=!1,t&&(this._subscribe=t)}return _createClass(e,[{key:"lift",value:function(t){var r=new e;return r.source=this,r.operator=t,r}},{key:"subscribe",value:function(e,t,r){var n=this.operator,o=function(e,t,r){if(e){if(e instanceof f)return e;if(e[p])return e[p]()}return e||t||r?new f(e,t,r):new f(a)}(e,t,r);if(o.add(n?n.call(o,this.source):this.source||i.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),i.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o}},{key:"_trySubscribe",value:function(e){try{return this._subscribe(e)}catch(t){i.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,r=t.closed,n=t.destination,o=t.isStopped;if(r||o)return!1;e=n&&n instanceof f?n:null}return!0}(e)?e.error(t):console.warn(t)}}},{key:"forEach",value:function(e,t){var r=this;return new(t=T(t))(function(t,n){var o;o=r.subscribe(function(t){try{e(t)}catch(r){n(r),o&&o.unsubscribe()}},n,t)})}},{key:"_subscribe",value:function(e){var t=this.source;return t&&t.subscribe(e)}},{key:_,value:function(){return this}},{key:"pipe",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?this:(0===(n=t).length?m:1===n.length?n[0]:function(e){return n.reduce(function(e,t){return t(e)},e)})(this);var n}},{key:"toPromise",value:function(e){var t=this;return new(e=T(e))(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})}}]),e}()).create=function(e){return new v(e)},v);function T(e){if(e||(e=i.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var y=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),S=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o;return _classCallCheck(this,r),(o=t.call(this)).subject=e,o.subscriber=n,o.closed=!1,o}return _createClass(r,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var r=t.indexOf(this.subscriber);-1!==r&&t.splice(r,1)}}}}]),r}(d),C=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this,e)).destination=e,n}return r}(f),R=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this)).observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return _createClass(r,[{key:p,value:function(){return new C(this)}},{key:"lift",value:function(e){var t=new b(this,this);return t.operator=e,t}},{key:"next",value:function(e){if(this.closed)throw new y;if(!this.isStopped)for(var t=this.observers,r=t.length,n=t.slice(),o=0;o<r;o++)n[o].next(e)}},{key:"error",value:function(e){if(this.closed)throw new y;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,r=t.length,n=t.slice(),o=0;o<r;o++)n[o].error(e);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new y;this.isStopped=!0;for(var e=this.observers,t=e.length,r=e.slice(),n=0;n<t;n++)r[n].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(e){if(this.closed)throw new y;return _get(_getPrototypeOf(r.prototype),"_trySubscribe",this).call(this,e)}},{key:"_subscribe",value:function(e){if(this.closed)throw new y;return this.hasError?(e.error(this.thrownError),d.EMPTY):this.isStopped?(e.complete(),d.EMPTY):(this.observers.push(e),new S(this,e))}},{key:"asObservable",value:function(){var e=new E;return e.source=this,e}}]),r}(E);return e.create=function(e,t){return new b(e,t)},e}(),b=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o;return _classCallCheck(this,r),(o=t.call(this)).destination=e,o.source=n,o}return _createClass(r,[{key:"next",value:function(e){var t=this.destination;t&&t.next&&t.next(e)}},{key:"error",value:function(e){var t=this.destination;t&&t.error&&this.destination.error(e)}},{key:"complete",value:function(){var e=this.destination;e&&e.complete&&this.destination.complete()}},{key:"_subscribe",value:function(e){return this.source?this.source.subscribe(e):d.EMPTY}}]),r}(R);function I(e){return e&&"function"==typeof e.schedule}function k(e,t){return function(r){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new O(e,t))}}var O=function(){function e(t,r){_classCallCheck(this,e),this.project=t,this.thisArg=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new L(e,this.project,this.thisArg))}}]),e}(),L=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o){var i;return _classCallCheck(this,r),(i=t.call(this,e)).project=n,i.count=0,i.thisArg=o||_assertThisInitialized(i),i}return _createClass(r,[{key:"_next",value:function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(t)}}]),r}(f),P=function(e){return function(t){for(var r=0,n=e.length;r<n&&!t.closed;r++)t.next(e[r]);t.complete()}},A="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",N=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function M(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var w=function(e){if(e&&"function"==typeof e[_])return r=e,function(e){var t=r[_]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(N(e))return P(e);if(M(e))return function(e){return function(t){return e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,s),t}}(e);if(e&&"function"==typeof e[A])return t=e,function(e){for(var r=t[A]();;){var n=void 0;try{n=r.next()}catch(o){return e.error(o),e}if(n.done){e.complete();break}if(e.next(n.value),e.closed)break}return"function"==typeof r.return&&e.add(function(){r.return&&r.return()}),e};var t,r,n=l(e)?"an invalid object":"'".concat(e,"'");throw new TypeError("You provided ".concat(n," where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))};function D(e,t){return new E(function(r){var n=new d,o=0;return n.add(t.schedule(function(){o!==e.length?(r.next(e[o++]),r.closed||n.add(this.schedule())):r.complete()})),n})}function U(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[_]}(e))return function(e,t){return new E(function(r){var n=new d;return n.add(t.schedule(function(){var o=e[_]();n.add(o.subscribe({next:function(e){n.add(t.schedule(function(){return r.next(e)}))},error:function(e){n.add(t.schedule(function(){return r.error(e)}))},complete:function(){n.add(t.schedule(function(){return r.complete()}))}}))})),n})}(e,t);if(M(e))return function(e,t){return new E(function(r){var n=new d;return n.add(t.schedule(function(){return e.then(function(e){n.add(t.schedule(function(){r.next(e),n.add(t.schedule(function(){return r.complete()}))}))},function(e){n.add(t.schedule(function(){return r.error(e)}))})})),n})}(e,t);if(N(e))return D(e,t);if(function(e){return e&&"function"==typeof e[A]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new E(function(r){var n,o=new d;return o.add(function(){n&&"function"==typeof n.return&&n.return()}),o.add(t.schedule(function(){n=e[A](),o.add(t.schedule(function(){if(!r.closed){var e,t;try{var o=n.next();e=o.value,t=o.done}catch(i){return void r.error(i)}t?r.complete():(r.next(e),this.schedule())}}))})),o})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof E?e:new E(w(e))}var x=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).parent=e,n}return _createClass(r,[{key:"_next",value:function(e){this.parent.notifyNext(e)}},{key:"_error",value:function(e){this.parent.notifyError(e),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(),this.unsubscribe()}}]),r}(f),B=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"notifyNext",value:function(e){this.destination.next(e)}},{key:"notifyError",value:function(e){this.destination.error(e)}},{key:"notifyComplete",value:function(){this.destination.complete()}}]),r}(f);function Z(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof t?function(n){return n.pipe(Z(function(r,n){return U(e(r,n)).pipe(k(function(e,o){return t(r,e,n,o)}))},r))}:("number"==typeof t&&(r=t),function(t){return t.lift(new G(e,r))})}var G=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;_classCallCheck(this,e),this.project=t,this.concurrent=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new H(e,this.project,this.concurrent))}}]),e}(),H=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return _classCallCheck(this,r),(o=t.call(this,e)).project=n,o.concurrent=i,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return _createClass(r,[{key:"_next",value:function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}},{key:"_tryNext",value:function(e){var t,r=this.index++;try{t=this.project(e,r)}catch(n){return void this.destination.error(n)}this.active++,this._innerSub(t)}},{key:"_innerSub",value:function(e){var t=new x(this),r=this.destination;r.add(t);var n=function(e,t){if(!t.closed){if(e instanceof E)return e.subscribe(t);var r;try{r=w(e)(t)}catch(n){t.error(n)}return r}}(e,t);n!==t&&r.add(n)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(e){this.destination.next(e)}},{key:"notifyComplete",value:function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),r}(B);function W(e,t){return t?D(e,t):new E(P(e))}function F(){return function(e){return e.lift(new V(e))}}var q,V=function(){function e(t){_classCallCheck(this,e),this.connectable=t}return _createClass(e,[{key:"call",value:function(e,t){var r=this.connectable;r._refCount++;var n=new j(e,r),o=t.subscribe(n);return n.closed||(n.connection=r.connect()),o}}]),e}(),j=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o;return _classCallCheck(this,r),(o=t.call(this,e)).connectable=n,o}return _createClass(r,[{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var r=this.connection,n=e._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}else this.connection=null}}]),r}(f),z={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(q=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o;return _classCallCheck(this,r),(o=t.call(this)).source=e,o.subjectFactory=n,o._refCount=0,o._isComplete=!1,o}return _createClass(r,[{key:"_subscribe",value:function(e){return this.getSubject().subscribe(e)}},{key:"getSubject",value:function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}},{key:"connect",value:function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new d).add(this.source.subscribe(new Y(this.getSubject(),this))),e.closed&&(this._connection=null,e=d.EMPTY)),e}},{key:"refCount",value:function(){return F()(this)}}]),r}(E).prototype)._subscribe},_isComplete:{value:q._isComplete,writable:!0},getSubject:{value:q.getSubject},connect:{value:q.connect},refCount:{value:q.refCount}},Y=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o;return _classCallCheck(this,r),(o=t.call(this,e)).connectable=n,o}return _createClass(r,[{key:"_error",value:function(e){this._unsubscribe(),_get(_getPrototypeOf(r.prototype),"_error",this).call(this,e)}},{key:"_complete",value:function(){this.connectable._isComplete=!0,this._unsubscribe(),_get(_getPrototypeOf(r.prototype),"_complete",this).call(this)}},{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}]),r}(C);function Q(){return new R}function X(e){for(var t in e)if(e[t]===X)return t;throw Error("Could not find renamed property on target object.")}function K(e,t){for(var r in t)t.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function J(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(J).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return"".concat(e.overriddenName);if(e.name)return"".concat(e.name);var t=e.toString();if(null==t)return""+t;var r=t.indexOf("\n");return-1===r?t:t.substring(0,r)}function $(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}var ee=X({__forward_ref__:X});function te(e){return e.__forward_ref__=te,e.toString=function(){return J(this())},e}function re(e){return ne(e)?e():e}function ne(e){return"function"==typeof e&&e.hasOwnProperty(ee)&&e.__forward_ref__===te}var oe=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o;return _classCallCheck(this,r),(o=t.call(this,function(e,t){return"".concat(e?"NG0".concat(e,": "):"").concat(t)}(e,n))).code=e,o}return r}(_wrapNativeSuper(Error));function ie(e){return"string"==typeof e?e:null==e?"":String(e)}function se(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():ie(e)}function ae(e,t){var r=t?" in ".concat(t):"";throw new oe("201","No provider for ".concat(se(e)," found").concat(r))}function ue(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function le(e){return{providers:e.providers||[],imports:e.imports||[]}}function ce(e){return de(e,fe)||de(e,_e)}function de(e,t){return e.hasOwnProperty(t)?e[t]:null}function he(e){return e&&(e.hasOwnProperty(ge)||e.hasOwnProperty(me))?e[ge]:null}var pe,fe=X({"\u0275prov":X}),ge=X({"\u0275inj":X}),_e=X({ngInjectableDef:X}),me=X({ngInjectorDef:X}),ve=((ve=ve||{})[ve.Default=0]="Default",ve[ve.Host=1]="Host",ve[ve.Self=2]="Self",ve[ve.SkipSelf=4]="SkipSelf",ve[ve.Optional=8]="Optional",ve);function Ee(e){var t=pe;return pe=e,t}function Te(e,t,r){var n=ce(e);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:r&ve.Optional?null:void 0!==t?t:void ae(J(e),"Injector")}function ye(e){return{toString:e}.toString()}var Se=((Se=Se||{})[Se.OnPush=0]="OnPush",Se[Se.Default=1]="Default",Se),Ce=((Ce=Ce||{})[Ce.Emulated=0]="Emulated",Ce[Ce.None=2]="None",Ce[Ce.ShadowDom=3]="ShadowDom",Ce),Re="undefined"!=typeof globalThis&&globalThis,be="undefined"!=typeof window&&window,Ie="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ke="undefined"!=typeof global&&global,Oe=Re||ke||be||Ie,Le={},Pe=[],Ae=X({"\u0275cmp":X}),Ne=X({"\u0275dir":X}),Me=X({"\u0275pipe":X}),we=X({"\u0275mod":X}),De=X({"\u0275loc":X}),Ue=X({"\u0275fac":X}),xe=X({__NG_ELEMENT_ID__:X}),Be=0;function Ze(e){return ye(function(){var t={},r={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Se.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||Pe,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Ce.Emulated,id:"c",styles:e.styles||Pe,_:null,setInput:null,schemas:e.schemas||null,tView:null},n=e.directives,o=e.features,i=e.pipes;return r.id+=Be++,r.inputs=qe(e.inputs,t),r.outputs=qe(e.outputs),o&&o.forEach(function(e){return e(r)}),r.directiveDefs=n?function(){return("function"==typeof n?n():n).map(Ge)}:null,r.pipeDefs=i?function(){return("function"==typeof i?i():i).map(He)}:null,r})}function Ge(e){return je(e)||function(e){return e[Ne]||null}(e)}function He(e){return function(e){return e[Me]||null}(e)}var We={};function Fe(e){return ye(function(){var t={type:e.type,bootstrap:e.bootstrap||Pe,declarations:e.declarations||Pe,imports:e.imports||Pe,exports:e.exports||Pe,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(We[e.id]=e.type),t})}function qe(e,t){if(null==e)return Le;var r={};for(var n in e)if(e.hasOwnProperty(n)){var o=e[n],i=o;Array.isArray(o)&&(i=o[1],o=o[0]),r[o]=n,t&&(t[o]=i)}return r}var Ve=Ze;function je(e){return e[Ae]||null}function ze(e,t){var r=e[we]||null;if(!r&&!0===t)throw new Error("Type ".concat(J(e)," does not have '\u0275mod' property."));return r}function Ye(e){return Array.isArray(e)&&"object"==typeof e[1]}function Qe(e){return Array.isArray(e)&&!0===e[1]}function Xe(e){return 0!=(8&e.flags)}function Ke(e){return 2==(2&e.flags)}function Je(e){return 1==(1&e.flags)}function $e(e){return null!==e.template}function et(e,t){return e.hasOwnProperty(Ue)?e[Ue]:null}var tt,rt=function(){function e(t,r,n){_classCallCheck(this,e),this.previousValue=t,this.currentValue=r,this.firstChange=n}return _createClass(e,[{key:"isFirstChange",value:function(){return this.firstChange}}]),e}();function nt(){return ot}function ot(e){return e.type.prototype.ngOnChanges&&(e.setInput=st),it}function it(){var e=at(this),t=null==e?void 0:e.current;if(t){var r=e.previous;if(r===Le)e.previous=t;else for(var n in t)r[n]=t[n];e.current=null,this.ngOnChanges(t)}}function st(e,t,r,n){var o=at(e)||function(e,t){return e.__ngSimpleChanges__=t}(e,{previous:Le,current:null}),i=o.current||(o.current={}),s=o.previous,a=this.declaredInputs[r],u=s[a];i[a]=new rt(u&&u.currentValue,t,s===Le),e[n]=t}function at(e){return e.__ngSimpleChanges__||null}function ut(e){return!!e.listen}nt.ngInherit=!0;var lt={createRenderer:function(e,t){return void 0!==tt?tt:"undefined"!=typeof document?document:void 0}};function ct(e){for(;Array.isArray(e);)e=e[0];return e}function dt(e,t){return ct(t[e])}function ht(e,t){return ct(t[e.index])}function pt(e,t){return e.data[t]}function ft(e,t){var r=t[e];return Ye(r)?r:r[0]}function gt(e){return 128==(128&e[2])}function _t(e,t){return null==t?null:e[t]}function mt(e){e[18]=0}function vt(e,t){e[5]+=t;for(var r=e,n=e[3];null!==n&&(1===t&&1===r[5]||-1===t&&0===r[5]);)n[5]+=t,r=n,n=n[3]}var Et={lFrame:Bt(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Tt(){return Et.bindingsEnabled}function yt(){return Et.lFrame.lView}function St(){return Et.lFrame.tView}function Ct(e){return Et.lFrame.contextLView=e,e[8]}function Rt(){for(var e=bt();null!==e&&64===e.type;)e=e.parent;return e}function bt(){return Et.lFrame.currentTNode}function It(e,t){var r=Et.lFrame;r.currentTNode=e,r.isParent=t}function kt(){return Et.lFrame.isParent}function Ot(){return Et.isInCheckNoChangesMode}function Lt(e){Et.isInCheckNoChangesMode=e}function Pt(){return Et.lFrame.bindingIndex++}function At(e){var t=Et.lFrame,r=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,r}function Nt(e){Et.lFrame.currentDirectiveIndex=e}function Mt(e){Et.lFrame.currentQueryIndex=e}function wt(e){var t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function Dt(e,t,r){if(r&ve.SkipSelf){for(var n=t,o=e;!(null!==(n=n.parent)||r&ve.Host||(n=wt(o),null===n)||(o=o[15],10&n.type)););if(null===n)return!1;t=n,e=o}var i=Et.lFrame=xt();return i.currentTNode=t,i.lView=e,!0}function Ut(e){var t=xt(),r=e[1];Et.lFrame=t,t.currentTNode=r.firstChild,t.lView=e,t.tView=r,t.contextLView=e,t.bindingIndex=r.bindingStartIndex,t.inI18n=!1}function xt(){var e=Et.lFrame,t=null===e?null:e.child;return null===t?Bt(e):t}function Bt(e){var t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function Zt(){var e=Et.lFrame;return Et.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}var Gt=Zt;function Ht(){var e=Zt();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Wt(){return Et.lFrame.selectedIndex}function Ft(e){Et.lFrame.selectedIndex=e}function qt(){Et.lFrame.currentNamespace="http://www.w3.org/2000/svg"}function Vt(){Et.lFrame.currentNamespace=null}function jt(e,t){for(var r=t.directiveStart,n=t.directiveEnd;r<n;r++){var o=e.data[r].type.prototype,i=o.ngAfterContentInit,s=o.ngAfterContentChecked,a=o.ngAfterViewInit,u=o.ngAfterViewChecked,l=o.ngOnDestroy;i&&(e.contentHooks||(e.contentHooks=[])).push(-r,i),s&&((e.contentHooks||(e.contentHooks=[])).push(r,s),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(r,s)),a&&(e.viewHooks||(e.viewHooks=[])).push(-r,a),u&&((e.viewHooks||(e.viewHooks=[])).push(r,u),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(r,u)),null!=l&&(e.destroyHooks||(e.destroyHooks=[])).push(r,l)}}function zt(e,t,r){Xt(e,t,3,r)}function Yt(e,t,r,n){(3&e[2])===r&&Xt(e,t,r,n)}function Qt(e,t){var r=e[2];(3&r)===t&&(r&=2047,r+=1,e[2]=r)}function Xt(e,t,r,n){for(var o=null!=n?n:-1,i=t.length-1,s=0,a=void 0!==n?65535&e[18]:0;a<i;a++)if("number"==typeof t[a+1]){if(s=t[a],null!=n&&s>=n)break}else t[a]<0&&(e[18]+=65536),(s<o||-1==o)&&(Kt(e,r,t,a),e[18]=(4294901760&e[18])+a+2),a++}function Kt(e,t,r,n){var o=r[n]<0,i=r[n+1],s=e[o?-r[n]:r[n]];if(o){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{i.call(s)}finally{}}}else try{i.call(s)}finally{}}var Jt=function e(t,r,n){_classCallCheck(this,e),this.factory=t,this.resolving=!1,this.canSeeViewProviders=r,this.injectImpl=n};function $t(e,t,r){for(var n=ut(e),o=0;o<r.length;){var i=r[o];if("number"==typeof i){if(0!==i)break;o++;var s=r[o++],a=r[o++],u=r[o++];n?e.setAttribute(t,a,u,s):t.setAttributeNS(s,a,u)}else{var l=i,c=r[++o];er(l)?n&&e.setProperty(t,l,c):n?e.setAttribute(t,l,c):t.setAttribute(l,c),o++}}return o}function er(e){return 64===e.charCodeAt(0)}function tr(e,t){if(null===t||0===t.length);else if(null===e||0===e.length)e=t.slice();else for(var r=-1,n=0;n<t.length;n++){var o=t[n];"number"==typeof o?r=o:0===r||rr(e,r,o,null,-1===r||2===r?t[++n]:null)}return e}function rr(e,t,r,n,o){var i=0,s=e.length;if(-1===t)s=-1;else for(;i<e.length;){var a=e[i++];if("number"==typeof a){if(a===t){s=-1;break}if(a>t){s=i-1;break}}}for(;i<e.length;){var u=e[i];if("number"==typeof u)break;if(u===r){if(null===n)return void(null!==o&&(e[i+1]=o));if(n===e[i+1])return void(e[i+2]=o)}i++,null!==n&&i++,null!==o&&i++}-1!==s&&(e.splice(s,0,t),i=s+1),e.splice(i++,0,r),null!==n&&e.splice(i++,0,n),null!==o&&e.splice(i++,0,o)}function nr(e){return-1!==e}function or(e){return 32767&e}function ir(e,t){for(var r=e>>16,n=t;r>0;)n=n[15],r--;return n}var sr=!0;function ar(e){var t=sr;return sr=e,t}var ur=0;function lr(e,t){var r=dr(e,t);if(-1!==r)return r;var n=t[1];n.firstCreatePass&&(e.injectorIndex=t.length,cr(n.data,e),cr(t,null),cr(n.blueprint,null));var o=hr(e,t),i=e.injectorIndex;if(nr(o))for(var s=or(o),a=ir(o,t),u=a[1].data,l=0;l<8;l++)t[i+l]=a[s+l]|u[s+l];return t[i+8]=o,i}function cr(e,t){e.push(0,0,0,0,0,0,0,0,t)}function dr(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function hr(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;for(var r=0,n=null,o=t;null!==o;){var i=o[1],s=i.type;if(null===(n=2===s?i.declTNode:1===s?o[6]:null))return-1;if(r++,o=o[15],-1!==n.injectorIndex)return n.injectorIndex|r<<16}return-1}function pr(e,t,r){!function(e,t,r){var n;"string"==typeof r?n=r.charCodeAt(0)||0:r.hasOwnProperty(xe)&&(n=r[xe]),null==n&&(n=r[xe]=ur++);var o=255&n;t.data[e+(o>>5)]|=1<<o}(e,t,r)}function fr(e,t,r){if(r&ve.Optional)return e;ae(t,"NodeInjector")}function gr(e,t,r,n){if(r&ve.Optional&&void 0===n&&(n=null),0==(r&(ve.Self|ve.Host))){var o=e[9],i=Ee(void 0);try{return o?o.get(t,n,r&ve.Optional):Te(t,n,r&ve.Optional)}finally{Ee(i)}}return fr(n,t,r)}function _r(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ve.Default,o=arguments.length>4?arguments[4]:void 0;if(null!==e){var i=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;var t=e.hasOwnProperty(xe)?e[xe]:void 0;return"number"==typeof t?t>=0?255&t:vr:t}(r);if("function"==typeof i){if(!Dt(t,e,n))return n&ve.Host?fr(o,r,n):gr(t,r,n,o);try{var s=i(n);if(null!=s||n&ve.Optional)return s;ae(r)}finally{Gt()}}else if("number"==typeof i){var a=null,u=dr(e,t),l=-1,c=n&ve.Host?t[16][6]:null;for((-1===u||n&ve.SkipSelf)&&(-1!==(l=-1===u?hr(e,t):t[u+8])&&Sr(n,!1)?(a=t[1],u=or(l),t=ir(l,t)):u=-1);-1!==u;){var d=t[1];if(yr(i,u,d.data)){var h=Er(u,t,r,a,n,c);if(h!==mr)return h}-1!==(l=t[u+8])&&Sr(n,t[1].data[u+8]===c)&&yr(i,u,t)?(a=d,u=or(l),t=ir(l,t)):u=-1}}}return gr(t,r,n,o)}var mr={};function vr(){return new Cr(Rt(),yt())}function Er(e,t,r,n,o,i){var s=t[1],a=s.data[e+8],u=function(e,t,r,n,o){for(var i=e.providerIndexes,s=t.data,a=1048575&i,u=e.directiveStart,l=i>>20,c=o?a+l:e.directiveEnd,d=n?a:a+l;d<c;d++){var h=s[d];if(d<u&&r===h||d>=u&&h.type===r)return d}if(o){var p=s[u];if(p&&$e(p)&&p.type===r)return u}return null}(a,s,r,null==n?Ke(a)&&sr:n!=s&&0!=(3&a.type),o&ve.Host&&i===a);return null!==u?Tr(t,s,u,a):mr}function Tr(e,t,r,n){var o=e[r],i=t.data;if(o instanceof Jt){var s=o;s.resolving&&function(e,t){throw new oe("200","Circular dependency in DI detected for ".concat(e))}(se(i[r]));var a=ar(s.canSeeViewProviders);s.resolving=!0;var u=s.injectImpl?Ee(s.injectImpl):null;Dt(e,n,ve.Default);try{o=e[r]=s.factory(void 0,i,e,n),t.firstCreatePass&&r>=n.directiveStart&&function(e,t,r){var n=t.type.prototype,o=n.ngOnChanges,i=n.ngOnInit,s=n.ngDoCheck;if(o){var a=ot(t);(r.preOrderHooks||(r.preOrderHooks=[])).push(e,a),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e,a)}i&&(r.preOrderHooks||(r.preOrderHooks=[])).push(0-e,i),s&&((r.preOrderHooks||(r.preOrderHooks=[])).push(e,s),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e,s))}(r,i[r],t)}finally{null!==u&&Ee(u),ar(a),s.resolving=!1,Gt()}}return o}function yr(e,t,r){return!!(r[t+(e>>5)]&1<<e)}function Sr(e,t){return!(e&ve.Self||e&ve.Host&&t)}var Cr=function(){function e(t,r){_classCallCheck(this,e),this._tNode=t,this._lView=r}return _createClass(e,[{key:"get",value:function(e,t){return _r(this._tNode,this._lView,e,void 0,t)}}]),e}();function Rr(e){return ye(function(){for(var t=e.prototype.constructor,r=t[Ue]||br(t),n=Object.prototype,o=Object.getPrototypeOf(e.prototype).constructor;o&&o!==n;){var i=o[Ue]||br(o);if(i&&i!==r)return i;o=Object.getPrototypeOf(o)}return function(e){return new e}})}function br(e){return ne(e)?function(){var t=br(re(e));return t&&t()}:et(e)}function Ir(e,t,r){return ye(function(){var n=function(e){return function(){if(e){var t=e.apply(void 0,arguments);for(var r in t)this[r]=t[r]}}}(t);function o(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(this instanceof o)return n.apply(this,t),this;var i=_construct(o,t);return s.annotation=i,s;function s(e,t,r){for(var n=e.hasOwnProperty("__parameters__")?e.__parameters__:Object.defineProperty(e,"__parameters__",{value:[]}).__parameters__;n.length<=r;)n.push(null);return(n[r]=n[r]||[]).push(i),e}}return r&&(o.prototype=Object.create(r.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o})}var kr=function(){function e(t,r){_classCallCheck(this,e),this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof r?this.__NG_ELEMENT_ID__=r:void 0!==r&&(this.\u0275prov=ue({token:this,providedIn:r.providedIn||"root",factory:r.factory}))}return _createClass(e,[{key:"toString",value:function(){return"InjectionToken ".concat(this._desc)}}]),e}();function Or(e,t){e.forEach(function(e){return Array.isArray(e)?Or(e,t):t(e)})}function Lr(e,t,r){t>=e.length?e.push(r):e.splice(t,0,r)}function Pr(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Ar(e,t,r){var n=Mr(e,t);return n>=0?e[1|n]=r:function(e,t,r,n){var o=e.length;if(o==t)e.push(r,n);else if(1===o)e.push(n,e[0]),e[0]=r;else{for(o--,e.push(e[o-1],e[o]);o>t;)e[o]=e[o-2],o--;e[t]=r,e[t+1]=n}}(e,n=~n,t,r),n}function Nr(e,t){var r=Mr(e,t);if(r>=0)return e[1|r]}function Mr(e,t){return function(e,t,r){for(var n=0,o=e.length>>1;o!==n;){var i=n+(o-n>>1),s=e[i<<1];if(t===s)return i<<1;s>t?o=i:n=i+1}return~(o<<1)}(e,t)}var wr,Dr={},Ur=/\n/gm,xr=X({provide:String,useValue:X});function Br(e){var t=wr;return wr=e,t}function Zr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ve.Default;if(void 0===wr)throw new Error("inject() must be called from an injection context");return null===wr?Te(e,void 0,t):wr.get(e,t&ve.Optional?null:void 0,t)}function Gr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ve.Default;return(pe||Zr)(re(e),t)}function Hr(e){for(var t=[],r=0;r<e.length;r++){var n=re(e[r]);if(Array.isArray(n)){if(0===n.length)throw new Error("Arguments array must have arguments.");for(var o=void 0,i=ve.Default,s=0;s<n.length;s++){var a=n[s],u=a.__NG_DI_FLAG__;"number"==typeof u?-1===u?o=a.token:i|=u:o=a}t.push(Gr(o,i))}else t.push(Gr(n))}return t}function Wr(e,t){return e.__NG_DI_FLAG__=t,e.prototype.__NG_DI_FLAG__=t,e}var Fr=Wr(Ir("Inject",function(e){return{token:e}}),-1),qr=Wr(Ir("Optional"),8),Vr=Wr(Ir("SkipSelf"),4);function jr(e){return e instanceof function(){function e(t){_classCallCheck(this,e),this.changingThisBreaksApplicationSecurity=t}return _createClass(e,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: ".concat(this.changingThisBreaksApplicationSecurity," (see https://g.co/ng/security#xss)")}}]),e}()?e.changingThisBreaksApplicationSecurity:e}function zr(e,t){e.__ngContext__=t}function Yr(e){var t=function(e){return e.__ngContext__||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Qr(e){return e.ngOriginalError}function Xr(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e.error.apply(e,r)}var Kr=function(){function e(){_classCallCheck(this,e),this._console=console}return _createClass(e,[{key:"handleError",value:function(e){var t=this._findOriginalError(e),r=this._findContext(e),n=function(e){return e&&e.ngErrorLogger||Xr}(e);n(this._console,"ERROR",e),t&&n(this._console,"ORIGINAL ERROR",t),r&&n(this._console,"ERROR CONTEXT",r)}},{key:"_findContext",value:function(e){return e?function(e){return e.ngDebugContext}(e)||this._findContext(Qr(e)):null}},{key:"_findOriginalError",value:function(e){for(var t=e&&Qr(e);t&&Qr(t);)t=Qr(t);return t||null}}]),e}(),Jr=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Oe);function $r(e){return e instanceof Function?e():e}var en=((en=en||{})[en.Important=1]="Important",en[en.DashCase=2]="DashCase",en);function tn(e,t){return(void 0)(e,t)}function rn(e){var t=e[3];return Qe(t)?t[3]:t}function nn(e){return sn(e[13])}function on(e){return sn(e[4])}function sn(e){for(;null!==e&&!Qe(e);)e=e[4];return e}function an(e,t,r,n,o){if(null!=n){var i,s=!1;Qe(n)?i=n:Ye(n)&&(s=!0,n=n[0]);var a=ct(n);0===e&&null!==r?null==o?fn(t,r,a):pn(t,r,a,o||null,!0):1===e&&null!==r?pn(t,r,a,o||null,!0):2===e?function(e,t,r){var n=_n(e,t);n&&function(e,t,r,n){ut(e)?e.removeChild(t,r,n):t.removeChild(r)}(e,n,t,r)}(t,a,s):3===e&&t.destroyNode(a),null!=i&&function(e,t,r,n,o){var i=r[7];i!==ct(r)&&an(t,e,n,i,o);for(var s=10;s<r.length;s++){var a=r[s];Sn(a[1],a,e,t,n,i)}}(t,e,i,r,o)}}function un(e,t,r){return ut(e)?e.createElement(t,r):null===r?e.createElement(t):e.createElementNS(r,t)}function ln(e,t){var r=e[9],n=r.indexOf(t),o=t[3];1024&t[2]&&(t[2]&=-1025,vt(o,-1)),r.splice(n,1)}function cn(e,t){if(!(e.length<=10)){var r,n=10+t,o=e[n];if(o){var i=o[17];null!==i&&i!==e&&ln(i,o),t>0&&(e[n-1][4]=o[4]);var s=Pr(e,10+t);Sn(o[1],r=o,r[11],2,null,null),r[0]=null,r[6]=null;var a=s[19];null!==a&&a.detachView(s[1]),o[3]=null,o[4]=null,o[2]&=-129}return o}}function dn(e,t){if(!(256&t[2])){var r=t[11];ut(r)&&r.destroyNode&&Sn(e,t,r,3,null,null),function(e){var t=e[13];if(!t)return hn(e[1],e);for(;t;){var r=null;if(Ye(t))r=t[13];else{var n=t[10];n&&(r=n)}if(!r){for(;t&&!t[4]&&t!==e;)Ye(t)&&hn(t[1],t),t=t[3];null===t&&(t=e),Ye(t)&&hn(t[1],t),r=t&&t[4]}t=r}}(t)}}function hn(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){var r;if(null!=e&&null!=(r=e.destroyHooks))for(var n=0;n<r.length;n+=2){var o=t[r[n]];if(!(o instanceof Jt)){var i=r[n+1];if(Array.isArray(i))for(var s=0;s<i.length;s+=2){var a=o[i[s]],u=i[s+1];try{u.call(a)}finally{}}else try{i.call(o)}finally{}}}}(e,t),function(e,t){var r=e.cleanup,n=t[7],o=-1;if(null!==r)for(var i=0;i<r.length-1;i+=2)if("string"==typeof r[i]){var s=r[i+1],a="function"==typeof s?s(t):ct(t[s]),u=n[o=r[i+2]],l=r[i+3];"boolean"==typeof l?a.removeEventListener(r[i],u,l):l>=0?n[o=l]():n[o=-l].unsubscribe(),i+=2}else{var c=n[o=r[i+1]];r[i].call(c)}if(null!==n){for(var d=o+1;d<n.length;d++)(0,n[d])();t[7]=null}}(e,t),1===t[1].type&&ut(t[11])&&t[11].destroy();var r=t[17];if(null!==r&&Qe(t[3])){r!==t[3]&&ln(r,t);var n=t[19];null!==n&&n.detachView(e)}}}function pn(e,t,r,n,o){ut(e)?e.insertBefore(t,r,n,o):t.insertBefore(r,n,o)}function fn(e,t,r){ut(e)?e.appendChild(t,r):t.appendChild(r)}function gn(e,t,r,n,o){null!==n?pn(e,t,r,n,o):fn(e,t,r)}function _n(e,t){return ut(e)?e.parentNode(t):t.parentNode}function mn(e,t,r,n){var o=function(e,t,r){return function(e,t,r){for(var n=t;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return r[0];if(2&n.flags){var o=e.data[n.directiveStart].encapsulation;if(o===Ce.None||o===Ce.Emulated)return null}return ht(n,r)}(e,t.parent,r)}(e,n,t),i=t[11],s=function(e,t,r){return function(e,t,r){return 40&e.type?ht(e,r):null}(e,0,r)}(n.parent||t[6],0,t);if(null!=o)if(Array.isArray(r))for(var a=0;a<r.length;a++)gn(i,o,r[a],s,!1);else gn(i,o,r,s,!1)}function vn(e,t){if(null!==t){var r=t.type;if(3&r)return ht(t,e);if(4&r)return Tn(-1,e[t.index]);if(8&r){var n=t.child;if(null!==n)return vn(e,n);var o=e[t.index];return Qe(o)?Tn(-1,o):ct(o)}if(32&r)return tn(t,e)()||ct(e[t.index]);var i=En(e,t);return null!==i?Array.isArray(i)?i[0]:vn(rn(e[16]),i):vn(e,t.next)}return null}function En(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Tn(e,t){var r=10+e+1;if(r<t.length){var n=t[r],o=n[1].firstChild;if(null!==o)return vn(n,o)}return t[7]}function yn(e,t,r,n,o,i,s){for(;null!=r;){var a=n[r.index],u=r.type;if(s&&0===t&&(a&&zr(ct(a),n),r.flags|=4),64!=(64&r.flags))if(8&u)yn(e,t,r.child,n,o,i,!1),an(t,e,o,a,i);else if(32&u){for(var l=tn(r,n),c=void 0;c=l();)an(t,e,o,c,i);an(t,e,o,a,i)}else 16&u?Cn(e,t,n,r,o,i):an(t,e,o,a,i);r=s?r.projectionNext:r.next}}function Sn(e,t,r,n,o,i){yn(r,n,e.firstChild,t,o,i,!1)}function Cn(e,t,r,n,o,i){var s=r[16],a=s[6].projection[n.projection];if(Array.isArray(a))for(var u=0;u<a.length;u++)an(t,e,o,a[u],i);else yn(e,t,a,s[3],o,i,!0)}function Rn(e,t,r){ut(e)?e.setAttribute(t,"style",r):t.style.cssText=r}function bn(e,t,r){ut(e)?""===r?e.removeAttribute(t,"class"):e.setAttribute(t,"class",r):t.className=r}function In(e,t,r){for(var n=e.length;;){var o=e.indexOf(t,r);if(-1===o)return o;if(0===o||e.charCodeAt(o-1)<=32){var i=t.length;if(o+i===n||e.charCodeAt(o+i)<=32)return o}r=o+1}}function kn(e,t,r){for(var n=0;n<e.length;){var o=e[n++];if(r&&"class"===o){if(-1!==In((o=e[n]).toLowerCase(),t,0))return!0}else if(1===o){for(;n<e.length&&"string"==typeof(o=e[n++]);)if(o.toLowerCase()===t)return!0;return!1}}return!1}function On(e){return 4===e.type&&"ng-template"!==e.value}function Ln(e,t,r){return t===(4!==e.type||r?e.value:"ng-template")}function Pn(e,t,r){for(var n=4,o=e.attrs||[],i=function(e){for(var t=0;t<e.length;t++)if(3===(r=e[t])||4===r||6===r)return t;var r;return e.length}(o),s=!1,a=0;a<t.length;a++){var u=t[a];if("number"!=typeof u){if(!s)if(4&n){if(n=2|1&n,""!==u&&!Ln(e,u,r)||""===u&&1===t.length){if(An(n))return!1;s=!0}}else{var l=8&n?u:t[++a];if(8&n&&null!==e.attrs){if(!kn(e.attrs,l,r)){if(An(n))return!1;s=!0}continue}var c=Nn(8&n?"class":u,o,On(e),r);if(-1===c){if(An(n))return!1;s=!0;continue}if(""!==l){var d;d=c>i?"":o[c+1].toLowerCase();var h=8&n?d:null;if(h&&-1!==In(h,l,0)||2&n&&l!==d){if(An(n))return!1;s=!0}}}}else{if(!s&&!An(n)&&!An(u))return!1;if(s&&An(u))continue;s=!1,n=u|1&n}}return An(n)||s}function An(e){return 0==(1&e)}function Nn(e,t,r,n){if(null===t)return-1;var o=0;if(n||!r){for(var i=!1;o<t.length;){var s=t[o];if(s===e)return o;if(3===s||6===s)i=!0;else{if(1===s||2===s){for(var a=t[++o];"string"==typeof a;)a=t[++o];continue}if(4===s)break;if(0===s){o+=4;continue}}o+=i?1:2}return-1}return function(e,t){var r=e.indexOf(4);if(r>-1)for(r++;r<e.length;){var n=e[r];if("number"==typeof n)return-1;if(n===t)return r;r++}return-1}(t,e)}function Mn(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=0;n<t.length;n++)if(Pn(e,t[n],r))return!0;return!1}function wn(e,t){return e?":not("+t.trim()+")":t}function Dn(e){for(var t=e[0],r=1,n=2,o="",i=!1;r<e.length;){var s=e[r];if("string"==typeof s)if(2&n){var a=e[++r];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&n?o+="."+s:4&n&&(o+=" "+s);else""===o||An(s)||(t+=wn(i,o),o=""),n=s,i=i||!An(n);r++}return""!==o&&(t+=wn(i,o)),t}var Un={};function xn(e){Bn(St(),yt(),Wt()+e,Ot())}function Bn(e,t,r,n){if(!n)if(3==(3&t[2])){var o=e.preOrderCheckHooks;null!==o&&zt(t,o,r)}else{var i=e.preOrderHooks;null!==i&&Yt(t,i,0,r)}Ft(r)}function Zn(e,t){return e<<17|t<<2}function Gn(e){return e>>17&32767}function Hn(e){return 2|e}function Wn(e){return(131068&e)>>2}function Fn(e,t){return-131069&e|t<<2}function qn(e){return 1|e}function Vn(e,t){var r=e.contentQueries;if(null!==r)for(var n=0;n<r.length;n+=2){var o=r[n],i=r[n+1];if(-1!==i){var s=e.data[i];Mt(o),s.contentQueries(2,t[i],i)}}}function jn(e,t,r,n,o,i,s,a,u,l){var c=t.blueprint.slice();return c[0]=o,c[2]=140|n,mt(c),c[3]=c[15]=e,c[8]=r,c[10]=s||e&&e[10],c[11]=a||e&&e[11],c[12]=u||e&&e[12]||null,c[9]=l||e&&e[9]||null,c[6]=i,c[16]=2==t.type?e[16]:c,c}function zn(e,t,r,n,o){var i,s,a=e.data[t];if(null===a)a=function(e,t,r,n,o){var i=bt(),s=kt(),a=e.data[t]=function(e,t,r,n,o,i){return{type:r,index:n,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?i:i&&i.parent,r,t,n,o);return null===e.firstChild&&(e.firstChild=a),null!==i&&(s?null==i.child&&null!==a.parent&&(i.child=a):null===i.next&&(i.next=a)),a}(e,t,r,n,o),Et.lFrame.inI18n&&(a.flags|=64);else if(64&a.type){a.type=r,a.value=n,a.attrs=o;var u=(i=Et.lFrame,s=i.currentTNode,i.isParent?s:s.parent);a.injectorIndex=null===u?-1:u.injectorIndex}return It(a,!0),a}function Yn(e,t,r,n){if(0===r)return-1;for(var o=t.length,i=0;i<r;i++)t.push(n),e.blueprint.push(n),e.data.push(null);return o}function Qn(e,t,r){Ut(t);try{var n=e.viewQuery;null!==n&&Co(1,n,r);var o=e.template;null!==o&&Jn(e,t,o,1,r),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Vn(e,t),e.staticViewQueries&&Co(2,e.viewQuery,r);var i=e.components;null!==i&&function(e,t){for(var r=0;r<t.length;r++)vo(e,t[r])}(t,i)}catch(s){throw e.firstCreatePass&&(e.incompleteFirstPass=!0),s}finally{t[2]&=-5,Ht()}}function Xn(e,t,r,n){var o=t[2];if(256!=(256&o)){Ut(t);var i=Ot();try{mt(t),Et.lFrame.bindingIndex=e.bindingStartIndex,null!==r&&Jn(e,t,r,2,n);var s=3==(3&o);if(!i)if(s){var a=e.preOrderCheckHooks;null!==a&&zt(t,a,null)}else{var u=e.preOrderHooks;null!==u&&Yt(t,u,0,null),Qt(t,0)}if(function(e){for(var t=nn(e);null!==t;t=on(t))if(t[2])for(var r=t[9],n=0;n<r.length;n++){var o=r[n],i=o[3];0==(1024&o[2])&&vt(i,1),o[2]|=1024}}(t),function(e){for(var t=nn(e);null!==t;t=on(t))for(var r=10;r<t.length;r++){var n=t[r],o=n[1];gt(n)&&Xn(o,n,o.template,n[8])}}(t),null!==e.contentQueries&&Vn(e,t),!i)if(s){var l=e.contentCheckHooks;null!==l&&zt(t,l)}else{var c=e.contentHooks;null!==c&&Yt(t,c,1),Qt(t,1)}!function(e,t){var r,n,o,i=e.hostBindingOpCodes;if(null!==i)try{for(var s=0;s<i.length;s++){var a=i[s];if(a<0)Ft(~a);else{var u=a,l=i[++s],c=i[++s];r=l,n=u,o=void 0,(o=Et.lFrame).bindingIndex=o.bindingRootIndex=r,Nt(n),c(2,t[u])}}}finally{Ft(-1)}}(e,t);var d=e.components;null!==d&&function(e,t){for(var r=0;r<t.length;r++)_o(e,t[r])}(t,d);var h=e.viewQuery;if(null!==h&&Co(2,h,n),!i)if(s){var p=e.viewCheckHooks;null!==p&&zt(t,p)}else{var f=e.viewHooks;null!==f&&Yt(t,f,2),Qt(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),i||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,vt(t[3],-1))}finally{Ht()}}}function Kn(e,t,r,n){var o=t[10],i=!Ot(),s=4==(4&t[2]);try{i&&!s&&o.begin&&o.begin(),s&&Qn(e,t,n),Xn(e,t,r,n)}finally{i&&!s&&o.end&&o.end()}}function Jn(e,t,r,n,o){var i=Wt(),s=2&n;try{Ft(-1),s&&t.length>20&&Bn(e,t,20,Ot()),r(n,o)}finally{Ft(i)}}function $n(e,t,r){Tt()&&(function(e,t,r,n){var o=r.directiveStart,i=r.directiveEnd;e.firstCreatePass||lr(r,t),zr(n,t);for(var s=r.initialInputs,a=o;a<i;a++){var u=e.data[a],l=$e(u);l&&ho(t,r,u);var c=Tr(t,e,a,r);zr(c,t),null!==s&&po(0,a-o,c,u,0,s),l&&(ft(r.index,t)[8]=c)}}(e,t,r,ht(r,t)),128==(128&r.flags)&&function(e,t,r){var n=r.directiveStart,o=r.directiveEnd,i=r.index,s=Et.lFrame.currentDirectiveIndex;try{Ft(i);for(var a=n;a<o;a++){var u=e.data[a],l=t[a];Nt(a),null===u.hostBindings&&0===u.hostVars&&null===u.hostAttrs||so(u,l)}}finally{Ft(-1),Nt(s)}}(e,t,r))}function eo(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ht,n=t.localNames;if(null!==n)for(var o=t.index+1,i=0;i<n.length;i+=2){var s=n[i+1],a=-1===s?r(t,e):e[s];e[o++]=a}}function to(e){var t=e.tView;return null===t||t.incompleteFirstPass?e.tView=ro(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function ro(e,t,r,n,o,i,s,a,u,l){var c=20+n,d=c+o,h=function(e,t){for(var r=[],n=0;n<t;n++)r.push(n<e?null:Un);return r}(c,d),p="function"==typeof l?l():l;return h[1]={type:e,blueprint:h,template:r,queries:null,viewQuery:a,declTNode:t,data:h.slice().fill(null,c),bindingStartIndex:c,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:u,consts:p,incompleteFirstPass:!1}}function no(e,t,r){for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];(r=null===r?{}:r).hasOwnProperty(n)?r[n].push(t,o):r[n]=[t,o]}return r}function oo(e,t,r,n){var o=!1;if(Tt()){var i=function(e,t,r){var n=e.directiveRegistry,o=null;if(n)for(var i=0;i<n.length;i++){var s=n[i];Mn(r,s.selectors,!1)&&(o||(o=[]),pr(lr(r,t),e,s.type),$e(s)?(ao(e,r),o.unshift(s)):o.push(s))}return o}(e,t,r),s=null===n?null:{"":-1};if(null!==i){o=!0,lo(r,e.data.length,i.length);for(var a=0;a<i.length;a++){var u=i[a];u.providersResolver&&u.providersResolver(u)}for(var l=!1,c=!1,d=Yn(e,t,i.length,null),h=0;h<i.length;h++){var p=i[h];r.mergedAttrs=tr(r.mergedAttrs,p.hostAttrs),co(e,r,t,d,p),uo(d,p,s),null!==p.contentQueries&&(r.flags|=8),null===p.hostBindings&&null===p.hostAttrs&&0===p.hostVars||(r.flags|=128);var f=p.type.prototype;!l&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(r.index),l=!0),c||!f.ngOnChanges&&!f.ngDoCheck||((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(r.index),c=!0),d++}!function(e,t){for(var r=t.directiveEnd,n=e.data,o=t.attrs,i=[],s=null,a=null,u=t.directiveStart;u<r;u++){var l=n[u],c=l.inputs,d=null===o||On(t)?null:fo(c,o);i.push(d),s=no(c,u,s),a=no(l.outputs,u,a)}null!==s&&(s.hasOwnProperty("class")&&(t.flags|=16),s.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=i,t.inputs=s,t.outputs=a}(e,r)}s&&function(e,t,r){if(t)for(var n=e.localNames=[],o=0;o<t.length;o+=2){var i=r[t[o+1]];if(null==i)throw new oe("301","Export of name '".concat(t[o+1],"' not found!"));n.push(t[o],i)}}(r,n,s)}return r.mergedAttrs=tr(r.mergedAttrs,r.attrs),o}function io(e,t,r,n,o,i){var s=i.hostBindings;if(s){var a=e.hostBindingOpCodes;null===a&&(a=e.hostBindingOpCodes=[]);var u=~t.index;(function(e){for(var t=e.length;t>0;){var r=e[--t];if("number"==typeof r&&r<0)return r}return 0})(a)!=u&&a.push(u),a.push(n,o,s)}}function so(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function ao(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function uo(e,t,r){if(r){if(t.exportAs)for(var n=0;n<t.exportAs.length;n++)r[t.exportAs[n]]=e;$e(t)&&(r[""]=e)}}function lo(e,t,r){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+r,e.providerIndexes=t}function co(e,t,r,n,o){e.data[n]=o;var i=o.factory||(o.factory=et(o.type)),s=new Jt(i,$e(o),null);e.blueprint[n]=s,r[n]=s,io(e,t,0,n,Yn(e,r,o.hostVars,Un),o)}function ho(e,t,r){var n=ht(t,e),o=to(r),i=e[10],s=Eo(e,jn(e,o,null,r.onPush?64:16,n,t,i,i.createRenderer(n,r),null,null));e[t.index]=s}function po(e,t,r,n,o,i){var s=i[t];if(null!==s)for(var a=n.setInput,u=0;u<s.length;){var l=s[u++],c=s[u++],d=s[u++];null!==a?n.setInput(r,d,l,c):r[c]=d}}function fo(e,t){for(var r=null,n=0;n<t.length;){var o=t[n];if(0!==o)if(5!==o){if("number"==typeof o)break;e.hasOwnProperty(o)&&(null===r&&(r=[]),r.push(o,e[o],t[n+1])),n+=2}else n+=2;else n+=4}return r}function go(e,t,r,n){return new Array(e,!0,!1,t,null,0,n,r,null,null)}function _o(e,t){var r=ft(t,e);if(gt(r)){var n=r[1];80&r[2]?Xn(n,r,n.template,r[8]):r[5]>0&&mo(r)}}function mo(e){for(var t=nn(e);null!==t;t=on(t))for(var r=10;r<t.length;r++){var n=t[r];if(1024&n[2]){var o=n[1];Xn(o,n,o.template,n[8])}else n[5]>0&&mo(n)}var i=e[1].components;if(null!==i)for(var s=0;s<i.length;s++){var a=ft(i[s],e);gt(a)&&a[5]>0&&mo(a)}}function vo(e,t){var r=ft(t,e),n=r[1];!function(e,t){for(var r=t.length;r<e.blueprint.length;r++)t.push(e.blueprint[r])}(n,r),Qn(n,r,r[8])}function Eo(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function To(e){for(;e;){e[2]|=64;var t=rn(e);if(0!=(512&e[2])&&!t)return e;e=t}return null}function yo(e,t,r){var n=t[10];n.begin&&n.begin();try{Xn(e,t,e.template,r)}catch(o){throw Io(t,o),o}finally{n.end&&n.end()}}function So(e){!function(e){for(var t=0;t<e.components.length;t++){var r=e.components[t],n=Yr(r),o=n[1];Kn(o,n,o.template,r)}}(e[8])}function Co(e,t,r){Mt(0),t(e,r)}var Ro=Promise.resolve(null);function bo(e){return e[7]||(e[7]=[])}function Io(e,t){var r=e[9],n=r?r.get(Kr,null):null;n&&n.handleError(t)}function ko(e,t,r,n,o){for(var i=0;i<r.length;){var s=r[i++],a=r[i++],u=t[s],l=e.data[s];null!==l.setInput?l.setInput(u,o,n,a):u[a]=o}}function Oo(e,t,r){var n=r?e.styles:null,o=r?e.classes:null,i=0;if(null!==t)for(var s=0;s<t.length;s++){var a=t[s];"number"==typeof a?i=a:1==i?o=$(o,a):2==i&&(n=$(n,a+": "+t[++s]+";"))}r?e.styles=n:e.stylesWithoutHost=n,r?e.classes=o:e.classesWithoutHost=o}var Lo,Po=new kr("INJECTOR",-1),Ao=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dr;if(t===Dr){var r=new Error("NullInjectorError: No provider for ".concat(J(e),"!"));throw r.name="NullInjectorError",r}return t}}]),e}(),No=new kr("Set Injector scope."),Mo={},wo={};function Do(){return void 0===Lo&&(Lo=new Ao),Lo}function Uo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;return new xo(e,r,t||Do(),n)}var xo=function(){function e(t,r,n){var o=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,e),this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;var s=[];r&&Or(r,function(e){return o.processProvider(e,t,r)}),Or([t],function(e){return o.processInjectorType(e,[],s)}),this.records.set(Po,Go(void 0,this));var a=this.records.get(No);this.scope=null!=a?a.value:null,this.source=i||("object"==typeof t?null:J(t))}return _createClass(e,[{key:"destroyed",get:function(){return this._destroyed}},{key:"destroy",value:function(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(function(e){return e.ngOnDestroy()})}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dr,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ve.Default;this.assertNotDestroyed();var n,o=Br(this),i=Ee(void 0);try{if(!(r&ve.SkipSelf)){var s=this.records.get(e);if(void 0===s){var a=("function"==typeof(n=e)||"object"==typeof n&&n instanceof kr)&&ce(e);s=a&&this.injectableDefInScope(a)?Go(Bo(e),Mo):null,this.records.set(e,s)}if(null!=s)return this.hydrate(e,s)}return(r&ve.Self?Do():this.parent).get(e,t=r&ve.Optional&&t===Dr?null:t)}catch(u){if("NullInjectorError"===u.name){if((u.ngTempTokenPath=u.ngTempTokenPath||[]).unshift(J(e)),o)throw u;return function(e,t,r,n){var o=e.ngTempTokenPath;throw t.__source&&o.unshift(t.__source),e.message=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;var o=J(t);if(Array.isArray(t))o=t.map(J).join(" -> ");else if("object"==typeof t){var i=[];for(var s in t)if(t.hasOwnProperty(s)){var a=t[s];i.push(s+":"+("string"==typeof a?JSON.stringify(a):J(a)))}o="{".concat(i.join(", "),"}")}return"".concat(r).concat(n?"("+n+")":"","[").concat(o,"]: ").concat(e.replace(Ur,"\n  "))}("\n"+e.message,o,"R3InjectorError",n),e.ngTokenPath=o,e.ngTempTokenPath=null,e}(u,e,0,this.source)}throw u}finally{Ee(i),Br(o)}}},{key:"_resolveInjectorDefTypes",value:function(){var e=this;this.injectorDefTypes.forEach(function(t){return e.get(t)})}},{key:"toString",value:function(){var e=[];return this.records.forEach(function(t,r){return e.push(J(r))}),"R3Injector[".concat(e.join(", "),"]")}},{key:"assertNotDestroyed",value:function(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}},{key:"processInjectorType",value:function(e,t,r){var n=this;if(!(e=re(e)))return!1;var o=he(e),i=null==o&&e.ngModule||void 0,s=void 0===i?e:i,a=-1!==r.indexOf(s);if(void 0!==i&&(o=he(i)),null==o)return!1;if(null!=o.imports&&!a){var u;r.push(s);try{Or(o.imports,function(e){n.processInjectorType(e,t,r)&&(void 0===u&&(u=[]),u.push(e))})}finally{}if(void 0!==u)for(var l=function(e){var t=u[e],r=t.ngModule,o=t.providers;Or(o,function(e){return n.processProvider(e,r,o||Pe)})},c=0;c<u.length;c++)l(c)}this.injectorDefTypes.add(s);var d=et(s)||function(){return new s};this.records.set(s,Go(d,Mo));var h=o.providers;if(null!=h&&!a){var p=e;Or(h,function(e){return n.processProvider(e,p,h)})}return void 0!==i&&void 0!==e.providers}},{key:"processProvider",value:function(e,t,r){var n=Wo(e=re(e))?e:re(e&&e.provide),o=function(e,t,r){return Ho(e)?Go(void 0,e.useValue):Go(Zo(e),Mo)}(e);if(Wo(e)||!0!==e.multi)this.records.get(n);else{var i=this.records.get(n);i||((i=Go(void 0,Mo,!0)).factory=function(){return Hr(i.multi)},this.records.set(n,i)),n=e,i.multi.push(e)}this.records.set(n,o)}},{key:"hydrate",value:function(e,t){var r;return t.value===Mo&&(t.value=wo,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(r=t.value)&&"object"==typeof r&&"function"==typeof r.ngOnDestroy&&this.onDestroy.add(t.value),t.value}},{key:"injectableDefInScope",value:function(e){if(!e.providedIn)return!1;var t=re(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}]),e}();function Bo(e){var t=ce(e),r=null!==t?t.factory:et(e);if(null!==r)return r;if(e instanceof kr)throw new Error("Token ".concat(J(e)," is missing a \u0275prov definition."));if(e instanceof Function)return function(e){var t=e.length;if(t>0){var r=function(e,t){for(var r=[],n=0;n<e;n++)r.push("?");return r}(t);throw new Error("Can't resolve all parameters for ".concat(J(e),": (").concat(r.join(", "),")."))}var n=function(e){var t=e&&(e[fe]||e[_e]);if(t){var r=function(e){if(e.hasOwnProperty("name"))return e.name;var t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn('DEPRECATED: DI is instantiating a token "'.concat(r,'" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "').concat(r,'" class.')),t}return null}(e);return null!==n?function(){return n.factory(e)}:function(){return new e}}(e);throw new Error("unreachable")}function Zo(e,t,r){var n,o;if(Wo(e)){var i=re(e);return et(i)||Bo(i)}if(Ho(e))n=function(){return re(e.useValue)};else if((o=e)&&o.useFactory)n=function(){return e.useFactory.apply(e,_toConsumableArray(Hr(e.deps||[])))};else if(function(e){return!(!e||!e.useExisting)}(e))n=function(){return Gr(re(e.useExisting))};else{var s=re(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return et(s)||Bo(s);n=function(){return _construct(s,_toConsumableArray(Hr(e.deps)))}}return n}function Go(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{factory:e,value:t,multi:r?[]:void 0}}function Ho(e){return null!==e&&"object"==typeof e&&xr in e}function Wo(e){return"function"==typeof e}var Fo=function(e,t,r){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0,o=Uo(e,t,r,n);return o._resolveInjectorDefTypes(),o}({name:r},t,e,r)},qo=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e,t){return Array.isArray(e)?Fo(e,t,""):Fo(e.providers,e.parent,e.name||"")}}]),e}();function Vo(e,t){jt(Yr(e)[1],Rt())}function jo(e){for(var t=Object.getPrototypeOf(e.type.prototype).constructor,r=!0,n=[e];t;){var o=void 0;if($e(e))o=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");o=t.\u0275dir}if(o){if(r){n.push(o);var i=e;i.inputs=zo(e.inputs),i.declaredInputs=zo(e.declaredInputs),i.outputs=zo(e.outputs);var s=o.hostBindings;s&&Xo(e,s);var a=o.viewQuery,u=o.contentQueries;if(a&&Yo(e,a),u&&Qo(e,u),K(e.inputs,o.inputs),K(e.declaredInputs,o.declaredInputs),K(e.outputs,o.outputs),$e(o)&&o.data.animation){var l=e.data;l.animation=(l.animation||[]).concat(o.data.animation)}}var c=o.features;if(c)for(var d=0;d<c.length;d++){var h=c[d];h&&h.ngInherit&&h(e),h===jo&&(r=!1)}}t=Object.getPrototypeOf(t)}!function(e){for(var t=0,r=null,n=e.length-1;n>=0;n--){var o=e[n];o.hostVars=t+=o.hostVars,o.hostAttrs=tr(o.hostAttrs,r=tr(r,o.hostAttrs))}}(n)}function zo(e){return e===Le?{}:e===Pe?[]:e}function Yo(e,t){var r=e.viewQuery;e.viewQuery=r?function(e,n){t(e,n),r(e,n)}:t}function Qo(e,t){var r=e.contentQueries;e.contentQueries=r?function(e,n,o){t(e,n,o),r(e,n,o)}:t}function Xo(e,t){var r=e.hostBindings;e.hostBindings=r?function(e,n){t(e,n),r(e,n)}:t}qo.THROW_IF_NOT_FOUND=Dr,qo.NULL=new Ao,qo.\u0275prov=ue({token:qo,providedIn:"any",factory:function(){return Gr(Po)}}),qo.__NG_ELEMENT_ID__=-1;var Ko=null;function Jo(){if(!Ko){var e=Oe.Symbol;if(e&&e.iterator)Ko=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),r=0;r<t.length;++r){var n=t[r];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Ko=n)}}return Ko}function $o(e){return!!ei(e)&&(Array.isArray(e)||!(e instanceof Map)&&Jo()in e)}function ei(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function ti(e,t,r){return!Object.is(e[t],r)&&(e[t]=r,!0)}function ri(e,t,r,n,o,i,s,a){var u=yt(),l=St(),c=e+20,d=l.firstCreatePass?function(e,t,r,n,o,i,s,a,u){var l=t.consts,c=zn(t,e,4,s||null,_t(l,a));oo(t,r,c,_t(l,u)),jt(t,c);var d=c.tViews=ro(2,c,n,o,i,t.directiveRegistry,t.pipeRegistry,null,t.schemas,l);return null!==t.queries&&(t.queries.template(t,c),d.queries=t.queries.embeddedTView(c)),c}(c,l,u,t,r,n,o,i,s):l.data[c];It(d,!1);var h=u[11].createComment("");mn(l,u,h,d),zr(h,u),Eo(u,u[c]=go(h,u,h,d)),Je(d)&&$n(l,u,d),null!=s&&eo(u,d,a)}function ni(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ve.Default,r=yt();return null===r?Gr(e,t):_r(Rt(),r,re(e),t)}function oi(e,t,r){var n,o=yt();return ti(o,Pt(),t)&&function(e,t,r,n,o,i,s,a){var u,l,c=ht(t,r),d=t.inputs;null!=d&&(u=d[n])?(ko(e,r,u,n,o),Ke(t)&&function(e,t){var r=ft(t,e);16&r[2]||(r[2]|=64)}(r,t.index)):3&t.type&&(n="class"===(l=n)?"className":"for"===l?"htmlFor":"formaction"===l?"formAction":"innerHtml"===l?"innerHTML":"readonly"===l?"readOnly":"tabindex"===l?"tabIndex":l,o=null!=s?s(o,t.value||"",n):o,ut(i)?i.setProperty(c,n,o):er(n)||(c.setProperty?c.setProperty(n,o):c[n]=o))}(St(),pt((n=Et.lFrame).tView,n.selectedIndex),o,e,t,o[11],r),oi}function ii(e,t,r,n,o){var i=o?"class":"style";ko(e,r,t.inputs[i],i,n)}function si(e,t,r,n){var o=yt(),i=St(),s=20+e,a=o[11],u=o[s]=un(a,t,Et.lFrame.currentNamespace),l=i.firstCreatePass?function(e,t,r,n,o,i,s){var a=t.consts,u=zn(t,e,2,o,_t(a,i));return oo(t,r,u,_t(a,s)),null!==u.attrs&&Oo(u,u.attrs,!1),null!==u.mergedAttrs&&Oo(u,u.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,u),u}(s,i,o,0,t,r,n):i.data[s];It(l,!0);var c=l.mergedAttrs;null!==c&&$t(a,u,c);var d=l.classes;null!==d&&bn(a,u,d);var h=l.styles;null!==h&&Rn(a,u,h),64!=(64&l.flags)&&mn(i,o,u,l),0===Et.lFrame.elementDepthCount&&zr(u,o),Et.lFrame.elementDepthCount++,Je(l)&&($n(i,o,l),function(e,t,r){if(Xe(t))for(var n=t.directiveEnd,o=t.directiveStart;o<n;o++){var i=e.data[o];i.contentQueries&&i.contentQueries(1,r[o],o)}}(i,l,o)),null!==n&&eo(o,l)}function ai(){var e=Rt();kt()?Et.lFrame.isParent=!1:It(e=e.parent,!1);var t=e;Et.lFrame.elementDepthCount--;var r=St();r.firstCreatePass&&(jt(r,e),Xe(e)&&r.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&ii(r,t,yt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&ii(r,t,yt(),t.stylesWithoutHost,!1)}function ui(e,t,r,n){si(e,t,r,n),ai()}function li(){return yt()}function ci(e){return!!e&&"function"==typeof e.then}var di=function(e){return!!e&&"function"==typeof e.subscribe};function hi(e,t,r,n){var o=yt(),i=St(),s=Rt();return function(e,t,r,n,o,i,s,a){var u=Je(n),l=e.firstCreatePass&&function(e){return e.cleanup||(e.cleanup=[])}(e),c=bo(t),d=!0;if(3&n.type||a){var h=ht(n,t),p=a?a(h):h,f=c.length,g=a?function(e){return a(ct(e[n.index]))}:n.index;if(ut(r)){var _=null;if(!a&&u&&(_=function(e,t,r,n){var o=e.cleanup;if(null!=o)for(var i=0;i<o.length-1;i+=2){var s=o[i];if(s===r&&o[i+1]===n){var a=t[7],u=o[i+2];return a.length>u?a[u]:null}"string"==typeof s&&(i+=2)}return null}(e,t,o,n.index)),null!==_)(_.__ngLastListenerFn__||_).__ngNextListenerFn__=i,_.__ngLastListenerFn__=i,d=!1;else{i=fi(n,t,0,i,!1);var m=r.listen(p,o,i);c.push(i,m),l&&l.push(o,g,f,f+1)}}else i=fi(n,t,0,i,!0),p.addEventListener(o,i,s),c.push(i),l&&l.push(o,g,f,s)}else i=fi(n,t,0,i,!1);var v,E=n.outputs;if(d&&null!==E&&(v=E[o])){var T=v.length;if(T)for(var y=0;y<T;y+=2){var S=t[v[y]][v[y+1]].subscribe(i),C=c.length;c.push(i,S),l&&l.push(o,n.index,C,-(C+1))}}}(i,o,o[11],s,e,t,!!r,n),hi}function pi(e,t,r,n){try{return!1!==r(n)}catch(o){return Io(e,o),!1}}function fi(e,t,r,n,o){return function r(i){if(i===Function)return n;var s=2&e.flags?ft(e.index,t):t;0==(32&t[2])&&To(s);for(var a=pi(t,0,n,i),u=r.__ngNextListenerFn__;u;)a=pi(t,0,u,i)&&a,u=u.__ngNextListenerFn__;return o&&!1===a&&(i.preventDefault(),i.returnValue=!1),a}}function gi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return function(e){return(Et.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Et.lFrame.contextLView))[8]}(e)}function _i(e,t,r,n,o){for(var i=e[r+1],s=null===t,a=n?Gn(i):Wn(i),u=!1;0!==a&&(!1===u||s);){var l=e[a+1];mi(e[a],t)&&(u=!0,e[a+1]=n?qn(l):Hn(l)),a=n?Gn(l):Wn(l)}u&&(e[r+1]=n?Hn(i):qn(i))}function mi(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Mr(e,t)>=0}var vi={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Ei(e){return e.substring(vi.key,vi.keyEnd)}function Ti(e,t){var r=vi.textEnd;return r===t?-1:(t=vi.keyEnd=function(e,t,r){for(;t<r&&e.charCodeAt(t)>32;)t++;return t}(e,vi.key=t,r),yi(e,t,r))}function yi(e,t,r){for(;t<r&&e.charCodeAt(t)<=32;)t++;return t}function Si(e,t){return function(e,t,r,n){var o=yt(),i=St(),s=At(2);i.firstUpdatePass&&Ii(i,e,s,!0),t!==Un&&ti(o,s,t)&&Li(i,i.data[Wt()],o,o[11],e,o[s+1]=function(e,t){return null==e||"object"==typeof e&&(e=J(jr(e))),e}(t),!0,s)}(e,t),Si}function Ci(e){!function(e,t,r,n){var o=St(),i=At(2);o.firstUpdatePass&&Ii(o,null,i,!0);var s=yt();if(r!==Un&&ti(s,i,r)){var a=o.data[Wt()];if(Ni(a,!0)&&!bi(o,i)){var u=a.classesWithoutHost;null!==u&&(r=$(u,r||"")),ii(o,a,s,r,!0)}else!function(e,t,r,n,o,i,s,a){o===Un&&(o=Pe);for(var u=0,l=0,c=0<o.length?o[0]:null,d=0<i.length?i[0]:null;null!==c||null!==d;){var h=u<o.length?o[u+1]:void 0,p=l<i.length?i[l+1]:void 0,f=void 0,g=null;c===d?(u+=2,l+=2,h!==p&&(g=d,f=p)):null===d||null!==c&&c<d?(u+=2,g=c):(l+=2,g=d,f=p),null!==g&&Li(e,t,r,n,g,f,!0,a),c=u<o.length?o[u]:null,d=l<i.length?i[l]:null}}(o,a,s,s[11],s[i+1],s[i+1]=function(e,t,r){if(null==r||""===r)return Pe;var n=[],o=jr(r);if(Array.isArray(o))for(var i=0;i<o.length;i++)e(n,o[i],!0);else if("object"==typeof o)for(var s in o)o.hasOwnProperty(s)&&e(n,s,o[s]);else"string"==typeof o&&t(n,o);return n}(e,t,r),0,i)}}(Ar,Ri,e)}function Ri(e,t){for(var r=function(e){return function(e){vi.key=0,vi.keyEnd=0,vi.value=0,vi.valueEnd=0,vi.textEnd=e.length}(e),Ti(e,yi(e,0,vi.textEnd))}(t);r>=0;r=Ti(t,r))Ar(e,Ei(t),!0)}function bi(e,t){return t>=e.expandoStartIndex}function Ii(e,t,r,n){var o=e.data;if(null===o[r+1]){var i=o[Wt()],s=bi(e,r);Ni(i,n)&&null===t&&!s&&(t=!1),t=function(e,t,r,n){var o=function(e){var t=Et.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e),i=n?t.residualClasses:t.residualStyles;if(null===o)0===(n?t.classBindings:t.styleBindings)&&(r=Oi(r=ki(null,e,t,r,n),t.attrs,n),i=null);else{var s=t.directiveStylingLast;if(-1===s||e[s]!==o)if(r=ki(o,e,t,r,n),null===i){var a=function(e,t,r){var n=r?t.classBindings:t.styleBindings;if(0!==Wn(n))return e[Gn(n)]}(e,t,n);void 0!==a&&Array.isArray(a)&&function(e,t,r,n){e[Gn(r?t.classBindings:t.styleBindings)]=n}(e,t,n,a=Oi(a=ki(null,e,t,a[1],n),t.attrs,n))}else i=function(e,t,r){for(var n,o=t.directiveEnd,i=1+t.directiveStylingLast;i<o;i++)n=Oi(n,e[i].hostAttrs,r);return Oi(n,t.attrs,r)}(e,t,n)}return void 0!==i&&(n?t.residualClasses=i:t.residualStyles=i),r}(o,i,t,n),function(e,t,r,n,o,i){var s=i?t.classBindings:t.styleBindings,a=Gn(s),u=Wn(s);e[n]=r;var l,c=!1;if(Array.isArray(r)){var d=r;(null===(l=d[1])||Mr(d,l)>0)&&(c=!0)}else l=r;if(o)if(0!==u){var h=Gn(e[a+1]);e[n+1]=Zn(h,a),0!==h&&(e[h+1]=Fn(e[h+1],n)),e[a+1]=131071&e[a+1]|n<<17}else e[n+1]=Zn(a,0),0!==a&&(e[a+1]=Fn(e[a+1],n)),a=n;else e[n+1]=Zn(u,0),0===a?a=n:e[u+1]=Fn(e[u+1],n),u=n;c&&(e[n+1]=Hn(e[n+1])),_i(e,l,n,!0),_i(e,l,n,!1),function(e,t,r,n,o){var i=o?e.residualClasses:e.residualStyles;null!=i&&"string"==typeof t&&Mr(i,t)>=0&&(r[n+1]=qn(r[n+1]))}(t,l,e,n,i),s=Zn(a,u),i?t.classBindings=s:t.styleBindings=s}(o,i,t,r,s,n)}}function ki(e,t,r,n,o){var i=null,s=r.directiveEnd,a=r.directiveStylingLast;for(-1===a?a=r.directiveStart:a++;a<s&&(n=Oi(n,(i=t[a]).hostAttrs,o),i!==e);)a++;return null!==e&&(r.directiveStylingLast=a),n}function Oi(e,t,r){var n=r?1:2,o=-1;if(null!==t)for(var i=0;i<t.length;i++){var s=t[i];"number"==typeof s?o=s:o===n&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Ar(e,s,!!r||t[++i]))}return void 0===e?null:e}function Li(e,t,r,n,o,i,s,a){if(3&t.type){var u=e.data,l=u[a+1];Ai(1==(1&l)?Pi(u,t,r,o,Wn(l),s):void 0)||(Ai(i)||2==(2&l)&&(i=Pi(u,null,r,o,a,s)),function(e,t,r,n,o){var i=ut(e);if(t)o?i?e.addClass(r,n):r.classList.add(n):i?e.removeClass(r,n):r.classList.remove(n);else{var s=-1===n.indexOf("-")?void 0:en.DashCase;if(null==o)i?e.removeStyle(r,n,s):r.style.removeProperty(n);else{var a="string"==typeof o&&o.endsWith("!important");a&&(o=o.slice(0,-10),s|=en.Important),i?e.setStyle(r,n,o,s):r.style.setProperty(n,o,a?"important":"")}}}(n,s,dt(Wt(),r),o,i))}}function Pi(e,t,r,n,o,i){for(var s,a=null===t;o>0;){var u=e[o],l=Array.isArray(u),c=l?u[1]:u,d=null===c,h=r[o+1];h===Un&&(h=d?Pe:void 0);var p=d?Nr(h,n):c===n?h:void 0;if(l&&!Ai(p)&&(p=Nr(u,n)),Ai(p)&&(s=p,a))return s;var f=e[o+1];o=a?Gn(f):Wn(f)}if(null!==t){var g=i?t.residualClasses:t.residualStyles;null!=g&&(s=Nr(g,n))}return s}function Ai(e){return void 0!==e}function Ni(e,t){return 0!=(e.flags&(t?16:32))}function Mi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=yt(),n=St(),o=e+20,i=n.firstCreatePass?zn(n,o,1,t,null):n.data[o],s=r[o]=function(e,t){return ut(e)?e.createText(t):e.createTextNode(t)}(r[11],t);mn(n,r,s,i),It(i,!1)}function wi(e){return Di("",e,""),wi}function Di(e,t,r){var n=yt(),o=function(e,t,r,n){return ti(e,Pt(),r)?t+ie(r)+n:Un}(n,e,t,r);return o!==Un&&function(e,t,r){var n=dt(t,e);!function(e,t,r){ut(e)?e.setValue(t,r):t.textContent=r}(e[11],n,r)}(n,Wt(),o),Di}var Ui=void 0,xi=["en",[["a","p"],["AM","PM"],Ui],[["AM","PM"],Ui,Ui],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ui,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ui,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ui,"{1} 'at' {0}",Ui],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){var t=Math.floor(Math.abs(e)),r=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===r?1:5}],Bi={};function Zi(e){return e in Bi||(Bi[e]=Oe.ng&&Oe.ng.common&&Oe.ng.common.locales&&Oe.ng.common.locales[e]),Bi[e]}var Gi=((Gi=Gi||{})[Gi.LocaleId=0]="LocaleId",Gi[Gi.DayPeriodsFormat=1]="DayPeriodsFormat",Gi[Gi.DayPeriodsStandalone=2]="DayPeriodsStandalone",Gi[Gi.DaysFormat=3]="DaysFormat",Gi[Gi.DaysStandalone=4]="DaysStandalone",Gi[Gi.MonthsFormat=5]="MonthsFormat",Gi[Gi.MonthsStandalone=6]="MonthsStandalone",Gi[Gi.Eras=7]="Eras",Gi[Gi.FirstDayOfWeek=8]="FirstDayOfWeek",Gi[Gi.WeekendRange=9]="WeekendRange",Gi[Gi.DateFormat=10]="DateFormat",Gi[Gi.TimeFormat=11]="TimeFormat",Gi[Gi.DateTimeFormat=12]="DateTimeFormat",Gi[Gi.NumberSymbols=13]="NumberSymbols",Gi[Gi.NumberFormats=14]="NumberFormats",Gi[Gi.CurrencyCode=15]="CurrencyCode",Gi[Gi.CurrencySymbol=16]="CurrencySymbol",Gi[Gi.CurrencyName=17]="CurrencyName",Gi[Gi.Currencies=18]="Currencies",Gi[Gi.Directionality=19]="Directionality",Gi[Gi.PluralCase=20]="PluralCase",Gi[Gi.ExtraData=21]="ExtraData",Gi);function Hi(e){var t;null==(t=e)&&function(e,t,r,n){throw new Error("ASSERTION ERROR: ".concat("Expected localeId to be defined"," [Expected=> null != ").concat(t," <=Actual]"))}(0,t),"string"==typeof e&&e.toLowerCase().replace(/_/g,"-")}function Wi(e,t,r,n,o){if(e=re(e),Array.isArray(e))for(var i=0;i<e.length;i++)Wi(e[i],t,r,n,o);else{var s=St(),a=yt(),u=Wo(e)?e:re(e.provide),l=Zo(e),c=Rt(),d=1048575&c.providerIndexes,h=c.directiveStart,p=c.providerIndexes>>20;if(Wo(e)||!e.multi){var f=new Jt(l,o,ni),g=Vi(u,t,o?d:d+p,h);-1===g?(pr(lr(c,a),s,u),Fi(s,e,t.length),t.push(u),c.directiveStart++,c.directiveEnd++,o&&(c.providerIndexes+=1048576),r.push(f),a.push(f)):(r[g]=f,a[g]=f)}else{var _=Vi(u,t,d+p,h),m=Vi(u,t,d,d+p),v=_>=0&&r[_],E=m>=0&&r[m];if(o&&!E||!o&&!v){pr(lr(c,a),s,u);var T=function(e,t,r,n,o){var i=new Jt(e,r,ni);return i.multi=[],i.index=t,i.componentProviders=0,qi(i,o,n&&!r),i}(o?zi:ji,r.length,o,n,l);!o&&E&&(r[m].providerFactory=T),Fi(s,e,t.length,0),t.push(u),c.directiveStart++,c.directiveEnd++,o&&(c.providerIndexes+=1048576),r.push(T),a.push(T)}else Fi(s,e,_>-1?_:m,qi(r[o?m:_],l,!o&&n));!o&&n&&E&&r[m].componentProviders++}}}function Fi(e,t,r,n){var o=Wo(t);if(o||t.useClass){var i=(t.useClass||t).prototype.ngOnDestroy;if(i){var s=e.destroyHooks||(e.destroyHooks=[]);if(!o&&t.multi){var a=s.indexOf(r);-1===a?s.push(r,[n,i]):s[a+1].push(n,i)}else s.push(r,i)}}}function qi(e,t,r){return r&&e.componentProviders++,e.multi.push(t)-1}function Vi(e,t,r,n){for(var o=r;o<n;o++)if(t[o]===e)return o;return-1}function ji(e,t,r,n){return Yi(this.multi,[])}function zi(e,t,r,n){var o,i=this.multi;if(this.providerFactory){var s=this.providerFactory.componentProviders,a=Tr(r,r[1],this.providerFactory.index,n);Yi(i,o=a.slice(0,s));for(var u=s;u<a.length;u++)o.push(a[u])}else Yi(i,o=[]);return o}function Yi(e,t){for(var r=0;r<e.length;r++)t.push((0,e[r])());return t}function Qi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(r){r.providersResolver=function(r,n){return function(e,t,r){var n=St();if(n.firstCreatePass){var o=$e(e);Wi(r,n.data,n.blueprint,o,!0),Wi(t,n.data,n.blueprint,o,!1)}}(r,n?n(e):e,t)}}}var Xi=function e(){_classCallCheck(this,e)},Ki=function e(){_classCallCheck(this,e)};function Ji(){}function $i(e,t){return new ts(ht(e,t))}Ki.NULL=new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"resolveComponentFactory",value:function(e){throw function(e){var t=Error("No component factory found for ".concat(J(e),". Did you add it to @NgModule.entryComponents?"));return t.ngComponent=e,t}(e)}}]),e}());var es=function(){return $i(Rt(),yt())},ts=function(){var e=function e(t){_classCallCheck(this,e),this.nativeElement=t};return e.__NG_ELEMENT_ID__=es,e}(),rs=function e(){_classCallCheck(this,e)},ns=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return os()},e}(),os=function(){var e=yt(),t=ft(Rt().index,e);return function(e){return e[11]}(Ye(t)?t:e)},is=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275prov=ue({token:e,providedIn:"root",factory:function(){return null}}),e}(),ss=new function e(t){_classCallCheck(this,e),this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}("12.1.4"),as=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return $o(e)}},{key:"create",value:function(e){return new ls(e)}}]),e}(),us=function(e,t){return t},ls=function(){function e(t){_classCallCheck(this,e),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||us}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)}},{key:"forEachOperation",value:function(e){for(var t=this._itHead,r=this._removalsHead,n=0,o=null;t||r;){var i=!r||t&&t.currentIndex<ps(r,n,o)?t:r,s=ps(i,n,o),a=i.currentIndex;if(i===r)n--,r=r._nextRemoved;else if(t=t._next,null==i.previousIndex)n++;else{o||(o=[]);var u=s-n,l=a-n;if(u!=l){for(var c=0;c<u;c++){var d=c<o.length?o[c]:o[c]=0,h=d+c;l<=h&&h<u&&(o[c]=d+1)}o[i.previousIndex]=l-u}}s!==a&&e(i,s,a)}}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachMovedItem",value:function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"forEachIdentityChange",value:function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}},{key:"diff",value:function(e){if(null==e&&(e=[]),!$o(e))throw new Error("Error trying to diff '".concat(J(e),"'. Only arrays and iterables are allowed"));return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var r,n,o,i=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(var a=0;a<this.length;a++)n=e[a],o=this._trackByFn(a,n),null!==i&&Object.is(i.trackById,o)?(s&&(i=this._verifyReinsertion(i,n,o,a)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,o,a),s=!0),i=i._next}else r=0,function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t(e[r]);else for(var n,o=e[Jo()]();!(n=o.next()).done;)t(n.value)}(e,function(e){o=t._trackByFn(r,e),null!==i&&Object.is(i.trackById,o)?(s&&(i=t._verifyReinsertion(i,e,o,r)),Object.is(i.item,e)||t._addIdentityChange(i,e)):(i=t._mismatch(i,e,o,r),s=!0),i=i._next,r++}),this.length=r;return this._truncate(i),this.collection=e,this.isDirty}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}},{key:"_reset",value:function(){if(this.isDirty){var e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(e,t,r,n){var o;return null===e?o=this._itTail:(o=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,n)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,n))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,n)):e=this._addAfter(new cs(t,r),o,n),e}},{key:"_verifyReinsertion",value:function(e,t,r,n){var o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==o?e=this._reinsertAfter(o,e._prev,n):e.currentIndex!=n&&(e.currentIndex=n,this._addToMoves(e,n)),e}},{key:"_truncate",value:function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(e,t,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var n=e._prevRemoved,o=e._nextRemoved;return null===n?this._removalsHead=o:n._nextRemoved=o,null===o?this._removalsTail=n:o._prevRemoved=n,this._insertAfter(e,t,r),this._addToMoves(e,r),e}},{key:"_moveAfter",value:function(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}},{key:"_addAfter",value:function(e,t,r){return this._insertAfter(e,t,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}},{key:"_insertAfter",value:function(e,t,r){var n=null===t?this._itHead:t._next;return e._next=n,e._prev=t,null===n?this._itTail=e:n._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new hs),this._linkedRecords.put(e),e.currentIndex=r,e}},{key:"_remove",value:function(e){return this._addToRemovals(this._unlink(e))}},{key:"_unlink",value:function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,r=e._next;return null===t?this._itHead=r:t._next=r,null===r?this._itTail=t:r._prev=t,e}},{key:"_addToMoves",value:function(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}},{key:"_addToRemovals",value:function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new hs),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}},{key:"_addIdentityChange",value:function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}]),e}(),cs=function e(t,r){_classCallCheck(this,e),this.item=t,this.trackById=r,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},ds=function(){function e(){_classCallCheck(this,e),this._head=null,this._tail=null}return _createClass(e,[{key:"add",value:function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}},{key:"get",value:function(e,t){var r;for(r=this._head;null!==r;r=r._nextDup)if((null===t||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}},{key:"remove",value:function(e){var t=e._prevDup,r=e._nextDup;return null===t?this._head=r:t._nextDup=r,null===r?this._tail=t:r._prevDup=t,null===this._head}}]),e}(),hs=function(){function e(){_classCallCheck(this,e),this.map=new Map}return _createClass(e,[{key:"put",value:function(e){var t=e.trackById,r=this.map.get(t);r||(r=new ds,this.map.set(t,r)),r.add(e)}},{key:"get",value:function(e,t){var r=this.map.get(e);return r?r.get(e,t):null}},{key:"remove",value:function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}},{key:"isEmpty",get:function(){return 0===this.map.size}},{key:"clear",value:function(){this.map.clear()}}]),e}();function ps(e,t,r){var n=e.previousIndex;if(null===n)return n;var o=0;return r&&n<r.length&&(o=r[n]),n+t+o}var fs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return e instanceof Map||ei(e)}},{key:"create",value:function(){return new gs}}]),e}(),gs=function(){function e(){_classCallCheck(this,e),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return _createClass(e,[{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}},{key:"forEachItem",value:function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachChangedItem",value:function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"diff",value:function(e){if(e){if(!(e instanceof Map||ei(e)))throw new Error("Error trying to diff '".concat(J(e),"'. Only maps and objects are allowed"))}else e=new Map;return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var r=this._mapHead;if(this._appendAfter=null,this._forEach(e,function(e,n){if(r&&r.key===n)t._maybeAddToChanges(r,e),t._appendAfter=r,r=r._next;else{var o=t._getOrCreateRecordForKey(n,e);r=t._insertBeforeOrAppend(r,o)}}),r){r._prev&&(r._prev._next=null),this._removalsHead=r;for(var n=r;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(e,t){if(e){var r=e._prev;return t._next=e,t._prev=r,e._prev=t,r&&(r._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}},{key:"_getOrCreateRecordForKey",value:function(e,t){if(this._records.has(e)){var r=this._records.get(e);this._maybeAddToChanges(r,t);var n=r._prev,o=r._next;return n&&(n._next=o),o&&(o._prev=n),r._next=null,r._prev=null,r}var i=new _s(e);return this._records.set(e,i),i.currentValue=t,this._addToAdditions(i),i}},{key:"_reset",value:function(){if(this.isDirty){var e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}},{key:"_addToAdditions",value:function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}},{key:"_addToChanges",value:function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}},{key:"_forEach",value:function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(function(r){return t(e[r],r)})}}]),e}(),_s=function e(t){_classCallCheck(this,e),this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null};function ms(){return new vs([new as])}var vs=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t,r=this.factories.find(function(t){return t.supports(e)});if(null!=r)return r;throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'"))}}],[{key:"create",value:function(t,r){if(null!=r){var n=r.factories.slice();t=t.concat(n)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(r){return e.create(t,r||ms())},deps:[[e,new Vr,new qr]]}}}]),e}();return e.\u0275prov=ue({token:e,providedIn:"root",factory:ms}),e}();function Es(){return new Ts([new fs])}var Ts=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t=this.factories.find(function(t){return t.supports(e)});if(t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"'"))}}],[{key:"create",value:function(t,r){if(r){var n=r.factories.slice();t=t.concat(n)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(r){return e.create(t,r||Es())},deps:[[e,new Vr,new qr]]}}}]),e}();return e.\u0275prov=ue({token:e,providedIn:"root",factory:Es}),e}();function ys(e,t,r,n){for(var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];null!==r;){var i=t[r.index];if(null!==i&&n.push(ct(i)),Qe(i))for(var s=10;s<i.length;s++){var a=i[s],u=a[1].firstChild;null!==u&&ys(a[1],a,u,n)}var l=r.type;if(8&l)ys(e,t,r.child,n);else if(32&l)for(var c=tn(r,t),d=void 0;d=c();)n.push(d);else if(16&l){var h=En(t,r);if(Array.isArray(h))n.push.apply(n,_toConsumableArray(h));else{var p=rn(t[16]);ys(p[1],p,h,n,!0)}}r=o?r.projectionNext:r.next}return n}var Ss=function(){function e(t,r){_classCallCheck(this,e),this._lView=t,this._cdRefInjectingView=r,this._appRef=null,this._attachedToViewContainer=!1}return _createClass(e,[{key:"rootNodes",get:function(){var e=this._lView,t=e[1];return ys(t,e,t.firstChild,[])}},{key:"context",get:function(){return this._lView[8]},set:function(e){this._lView[8]=e}},{key:"destroyed",get:function(){return 256==(256&this._lView[2])}},{key:"destroy",value:function(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){var e=this._lView[3];if(Qe(e)){var t=e[8],r=t?t.indexOf(this):-1;r>-1&&(cn(e,r),Pr(t,r))}this._attachedToViewContainer=!1}dn(this._lView[1],this._lView)}},{key:"onDestroy",value:function(e){var t,r;t=this._lView,r=e,bo(t).push(r)}},{key:"markForCheck",value:function(){To(this._cdRefInjectingView||this._lView)}},{key:"detach",value:function(){this._lView[2]&=-129}},{key:"reattach",value:function(){this._lView[2]|=128}},{key:"detectChanges",value:function(){yo(this._lView[1],this._lView,this.context)}},{key:"checkNoChanges",value:function(){!function(e,t,r){Lt(!0);try{yo(e,t,r)}finally{Lt(!1)}}(this._lView[1],this._lView,this.context)}},{key:"attachToViewContainerRef",value:function(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}},{key:"detachFromAppRef",value:function(){var e;this._appRef=null,Sn(this._lView[1],e=this._lView,e[11],2,null,null)}},{key:"attachToAppRef",value:function(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}]),e}(),Cs=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this,e))._view=e,n}return _createClass(r,[{key:"detectChanges",value:function(){So(this._view)}},{key:"checkNoChanges",value:function(){!function(e){Lt(!0);try{So(e)}finally{Lt(!1)}}(this._view)}},{key:"context",get:function(){return null}}]),r}(Ss),Rs=[new fs],bs=new vs([new as]),Is=new Ts(Rs),ks=function(){return e=Rt(),t=yt(),4&e.type?new Ls(t,e,$i(e,t)):null;var e,t},Os=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=ks,e}(),Ls=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o){var i;return _classCallCheck(this,r),(i=t.call(this))._declarationLView=e,i._declarationTContainer=n,i.elementRef=o,i}return _createClass(r,[{key:"createEmbeddedView",value:function(e){var t=this._declarationTContainer.tViews,r=jn(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];var n=this._declarationLView[19];return null!==n&&(r[19]=n.createEmbeddedView(t)),Qn(t,r,e),new Ss(r)}}]),r}(Os),Ps=function e(){_classCallCheck(this,e)},As=function(){return function(e,t){var r,n=t[e.index];if(Qe(n))r=n;else{var o;if(8&e.type)o=ct(n);else{var i=t[11];o=i.createComment("");var s=ht(e,t);pn(i,_n(i,s),o,function(e,t){return ut(e)?e.nextSibling(t):t.nextSibling}(i,s),!1)}t[e.index]=r=go(n,t,o,e),Eo(t,r)}return new Ms(r,e,t)}(Rt(),yt())},Ns=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=As,e}(),Ms=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o){var i;return _classCallCheck(this,r),(i=t.call(this))._lContainer=e,i._hostTNode=n,i._hostLView=o,i}return _createClass(r,[{key:"element",get:function(){return $i(this._hostTNode,this._hostLView)}},{key:"injector",get:function(){return new Cr(this._hostTNode,this._hostLView)}},{key:"parentInjector",get:function(){var e=hr(this._hostTNode,this._hostLView);if(nr(e)){var t=ir(e,this._hostLView),r=or(e);return new Cr(t[1].data[r+8],t)}return new Cr(null,this._hostLView)}},{key:"clear",value:function(){for(;this.length>0;)this.remove(this.length-1)}},{key:"get",value:function(e){var t=ws(this._lContainer);return null!==t&&t[e]||null}},{key:"length",get:function(){return this._lContainer.length-10}},{key:"createEmbeddedView",value:function(e,t,r){var n=e.createEmbeddedView(t||{});return this.insert(n,r),n}},{key:"createComponent",value:function(e,t,r,n,o){var i=r||this.parentInjector;if(!o&&null==e.ngModule&&i){var s=i.get(Ps,null);s&&(o=s)}var a=e.create(i,n,void 0,o);return this.insert(a.hostView,t),a}},{key:"insert",value:function(e,t){var n=e._lView,o=n[1];if(Qe(n[3])){var i=this.indexOf(e);if(-1!==i)this.detach(i);else{var s=n[3],a=new r(s,s[6],s[3]);a.detach(a.indexOf(e))}}var u=this._adjustIndex(t),l=this._lContainer;!function(e,t,r,n){var o=10+n,i=r.length;n>0&&(r[o-1][4]=t),n<i-10?(t[4]=r[o],Lr(r,10+n,t)):(r.push(t),t[4]=null),t[3]=r;var s=t[17];null!==s&&r!==s&&function(e,t){var r=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===r?e[9]=[t]:r.push(t)}(s,t);var a=t[19];null!==a&&a.insertView(e),t[2]|=128}(o,n,l,u);var c=Tn(u,l),d=n[11],h=_n(d,l[7]);return null!==h&&function(e,t,r,n,o,i){n[0]=o,n[6]=t,Sn(e,n,r,1,o,i)}(o,l[6],d,n,h,c),e.attachToViewContainerRef(),Lr(Ds(l),u,e),e}},{key:"move",value:function(e,t){return this.insert(e,t)}},{key:"indexOf",value:function(e){var t=ws(this._lContainer);return null!==t?t.indexOf(e):-1}},{key:"remove",value:function(e){var t=this._adjustIndex(e,-1),r=cn(this._lContainer,t);r&&(Pr(Ds(this._lContainer),t),dn(r[1],r))}},{key:"detach",value:function(e){var t=this._adjustIndex(e,-1),r=cn(this._lContainer,t);return r&&null!=Pr(Ds(this._lContainer),t)?new Ss(r):null}},{key:"_adjustIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e?this.length+t:e}}]),r}(Ns);function ws(e){return e[8]}function Ds(e){return e[8]||(e[8]=[])}var Us={},xs=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).ngModule=e,n}return _createClass(r,[{key:"resolveComponentFactory",value:function(e){var t=je(e);return new Gs(t,this.ngModule)}}]),r}(Ki);function Bs(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push({propName:e[r],templateName:r});return t}var Zs=new kr("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return Jr}}),Gs=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o;return _classCallCheck(this,r),(o=t.call(this)).componentDef=e,o.ngModule=n,o.componentType=e.type,o.selector=e.selectors.map(Dn).join(","),o.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],o.isBoundToModule=!!n,o}return _createClass(r,[{key:"inputs",get:function(){return Bs(this.componentDef.inputs)}},{key:"outputs",get:function(){return Bs(this.componentDef.outputs)}},{key:"create",value:function(e,t,r,n){var o,i,s=(n=n||this.ngModule)?function(e,t){return{get:function(r,n,o){var i=e.get(r,Us,o);return i!==Us||n===Us?i:t.get(r,n,o)}}}(e,n.injector):e,a=s.get(rs,lt),u=s.get(is,null),l=a.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",d=r?function(e,t,r){if(ut(e))return e.selectRootElement(t,r===Ce.ShadowDom);var n="string"==typeof t?e.querySelector(t):t;return n.textContent="",n}(l,r,this.componentDef.encapsulation):un(a.createRenderer(null,this.componentDef),c,function(e){var t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(c)),h=this.componentDef.onPush?576:528,p={components:[],scheduler:Jr,clean:Ro,playerHandler:null,flags:0},f=ro(0,null,null,1,0,null,null,null,null,null),g=jn(null,f,p,h,null,null,a,l,u,s);Ut(g);try{var _=function(e,t,r,n,o,i){var s=r[1];r[20]=e;var a=zn(s,20,2,"#host",null),u=a.mergedAttrs=t.hostAttrs;null!==u&&(Oo(a,u,!0),null!==e&&($t(o,e,u),null!==a.classes&&bn(o,e,a.classes),null!==a.styles&&Rn(o,e,a.styles)));var l=n.createRenderer(e,t),c=jn(r,to(t),null,t.onPush?64:16,r[20],a,n,l,null,null);return s.firstCreatePass&&(pr(lr(a,r),s,t.type),ao(s,a),lo(a,r.length,1)),Eo(r,c),r[20]=c}(d,this.componentDef,g,a,l);if(d)if(r)$t(l,d,["ng-version",ss.full]);else{var m=function(e){for(var t=[],r=[],n=1,o=2;n<e.length;){var i=e[n];if("string"==typeof i)2===o?""!==i&&t.push(i,e[++n]):8===o&&r.push(i);else{if(!An(o))break;o=i}n++}return{attrs:t,classes:r}}(this.componentDef.selectors[0]),v=m.attrs,E=m.classes;v&&$t(l,d,v),E&&E.length>0&&bn(l,d,E.join(" "))}if(i=pt(f,20),void 0!==t)for(var T=i.projection=[],y=0;y<this.ngContentSelectors.length;y++){var S=t[y];T.push(null!=S?Array.from(S):null)}o=function(e,t,r,n,o){var i=r[1],s=function(e,t,r){var n=Rt();e.firstCreatePass&&(r.providersResolver&&r.providersResolver(r),co(e,n,t,Yn(e,t,1,null),r));var o=Tr(t,e,n.directiveStart,n);zr(o,t);var i=ht(n,t);return i&&zr(i,t),o}(i,r,t);if(n.components.push(s),e[8]=s,o&&o.forEach(function(e){return e(s,t)}),t.contentQueries){var a=Rt();t.contentQueries(1,s,a.directiveStart)}var u=Rt();return!i.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Ft(u.index),io(r[1],u,0,u.directiveStart,u.directiveEnd,t),so(t,s)),s}(_,this.componentDef,g,p,[Vo]),Qn(f,g,null)}finally{Ht()}return new Hs(this.componentType,o,$i(i,g),g,i)}}]),r}(Xi),Hs=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o,i,s){var a;return _classCallCheck(this,r),(a=t.call(this)).location=o,a._rootLView=i,a._tNode=s,a.instance=n,a.hostView=a.changeDetectorRef=new Cs(i),a.componentType=e,a}return _createClass(r,[{key:"injector",get:function(){return new Cr(this._tNode,this._rootLView)}},{key:"destroy",value:function(){this.hostView.destroy()}},{key:"onDestroy",value:function(e){this.hostView.onDestroy(e)}}]),r}(function(){return function e(){_classCallCheck(this,e)}}()),Ws=new Map,Fs=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var o;_classCallCheck(this,r),(o=t.call(this))._parent=n,o._bootstrapComponents=[],o.injector=_assertThisInitialized(o),o.destroyCbs=[],o.componentFactoryResolver=new xs(_assertThisInitialized(o));var i=ze(e),s=e[De]||null;return s&&Hi(s),o._bootstrapComponents=$r(i.bootstrap),o._r3Injector=Uo(e,n,[{provide:Ps,useValue:_assertThisInitialized(o)},{provide:Ki,useValue:o.componentFactoryResolver}],J(e)),o._r3Injector._resolveInjectorDefTypes(),o.instance=o.get(e),o}return _createClass(r,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qo.THROW_IF_NOT_FOUND,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ve.Default;return e===qo||e===Ps||e===Po?this:this._r3Injector.get(e,t,r)}},{key:"destroy",value:function(){var e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(function(e){return e()}),this.destroyCbs=null}},{key:"onDestroy",value:function(e){this.destroyCbs.push(e)}}]),r}(Ps),qs=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n,o,i;return _classCallCheck(this,r),(n=t.call(this)).moduleType=e,null!==ze(e)&&(o=e,i=new Set,function e(t){var r=ze(t,!0),n=r.id;null!==n&&(function(e,t,r){if(t&&t!==r)throw new Error("Duplicate module registered for ".concat(e," - ").concat(J(t)," vs ").concat(J(t.name)))}(n,Ws.get(n),t),Ws.set(n,t));var o,s=_createForOfIteratorHelper($r(r.imports));try{for(s.s();!(o=s.n()).done;){var a=o.value;i.has(a)||(i.add(a),e(a))}}catch(u){s.e(u)}finally{s.f()}}(o)),n}return _createClass(r,[{key:"create",value:function(e){return new Fs(this.moduleType,e)}}]),r}(function(){return function e(){_classCallCheck(this,e)}}());function Vs(e){return function(t){setTimeout(e,void 0,t)}}var js=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck(this,r),(e=t.call(this)).__isAsync=n,e}return _createClass(r,[{key:"emit",value:function(e){_get(_getPrototypeOf(r.prototype),"next",this).call(this,e)}},{key:"subscribe",value:function(e,t,n){var o,i,s,a=e,u=t||function(){return null},l=n;if(e&&"object"==typeof e){var c=e;a=null===(o=c.next)||void 0===o?void 0:o.bind(c),u=null===(i=c.error)||void 0===i?void 0:i.bind(c),l=null===(s=c.complete)||void 0===s?void 0:s.bind(c)}this.__isAsync&&(u=Vs(u),a&&(a=Vs(a)),l&&(l=Vs(l)));var h=_get(_getPrototypeOf(r.prototype),"subscribe",this).call(this,{next:a,error:u,complete:l});return e instanceof d&&e.add(h),h}}]),r}(R);Symbol;var zs=new kr("Application Initializer"),Ys=function(){var e=function(){function e(t){var r=this;_classCallCheck(this,e),this.appInits=t,this.resolve=Ji,this.reject=Ji,this.initialized=!1,this.done=!1,this.donePromise=new Promise(function(e,t){r.resolve=e,r.reject=t})}return _createClass(e,[{key:"runInitializers",value:function(){var e=this;if(!this.initialized){var t=[],r=function(){e.done=!0,e.resolve()};if(this.appInits)for(var n=function(r){var n=e.appInits[r]();if(ci(n))t.push(n);else if(di(n)){var o=new Promise(function(e,t){n.subscribe({complete:e,error:t})});t.push(o)}},o=0;o<this.appInits.length;o++)n(o);Promise.all(t).then(function(){r()}).catch(function(t){e.reject(t)}),0===t.length&&r(),this.initialized=!0}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(zs,8))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),Qs=new kr("AppId"),Xs={provide:Qs,useFactory:function(){return"".concat(Ks()).concat(Ks()).concat(Ks())},deps:[]};function Ks(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var Js=new kr("Platform Initializer"),$s=new kr("Platform ID"),ea=new kr("appBootstrapListener"),ta=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"log",value:function(e){console.log(e)}},{key:"warn",value:function(e){console.warn(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),ra=new kr("LocaleId"),na=new kr("DefaultCurrencyCode"),oa=function e(t,r){_classCallCheck(this,e),this.ngModuleFactory=t,this.componentFactories=r},ia=function(e){return new qs(e)},sa=ia,aa=function(e){return Promise.resolve(ia(e))},ua=function(e){var t=ia(e),r=$r(ze(e).declarations).reduce(function(e,t){var r=je(t);return r&&e.push(new Gs(r)),e},[]);return new oa(t,r)},la=ua,ca=function(e){return Promise.resolve(ua(e))},da=function(){var e=function(){function e(){_classCallCheck(this,e),this.compileModuleSync=sa,this.compileModuleAsync=aa,this.compileModuleAndAllComponentsSync=la,this.compileModuleAndAllComponentsAsync=ca}return _createClass(e,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(e){}},{key:"getModuleId",value:function(e){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),ha=Promise.resolve(0);function pa(e){"undefined"==typeof Zone?ha.then(function(){e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var fa=function(){function e(t){var r,n,o=t.enableLongStackTrace,i=void 0!==o&&o,s=t.shouldCoalesceEventChangeDetection,a=void 0!==s&&s,u=t.shouldCoalesceRunChangeDetection,l=void 0!==u&&u;if(_classCallCheck(this,e),this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new js(!1),this.onMicrotaskEmpty=new js(!1),this.onStable=new js(!1),this.onError=new js(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),this.shouldCoalesceEventChangeDetection=!l&&a,this.shouldCoalesceRunChangeDetection=l,this.lastRequestAnimationFrameId=-1,this.nativeRequestAnimationFrame=function(){var e=Oe.requestAnimationFrame,t=Oe.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){var r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);var n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,n=function(){!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Oe,function(){e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",function(){e.lastRequestAnimationFrameId=-1,ma(e),e.isCheckStableRunning=!0,_a(e),e.isCheckStableRunning=!1},void 0,function(){},function(){})),e.fakeTopEventTask.invoke()}),ma(e))}(r)},(r=this)._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(e,t,o,i,s,a){try{return va(r),e.invokeTask(o,i,s,a)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||r.shouldCoalesceRunChangeDetection)&&n(),Ea(r)}},onInvoke:function(e,t,o,i,s,a,u){try{return va(r),e.invoke(o,i,s,a,u)}finally{r.shouldCoalesceRunChangeDetection&&n(),Ea(r)}},onHasTask:function(e,t,n,o){e.hasTask(n,o),t===n&&("microTask"==o.change?(r._hasPendingMicrotasks=o.microTask,ma(r),_a(r)):"macroTask"==o.change&&(r.hasPendingMacrotasks=o.macroTask))},onHandleError:function(e,t,n,o){return e.handleError(n,o),r.runOutsideAngular(function(){return r.onError.emit(o)}),!1}})}return _createClass(e,[{key:"run",value:function(e,t,r){return this._inner.run(e,t,r)}},{key:"runTask",value:function(e,t,r,n){var o=this._inner,i=o.scheduleEventTask("NgZoneEvent: "+n,e,ga,Ji,Ji);try{return o.runTask(i,t,r)}finally{o.cancelTask(i)}}},{key:"runGuarded",value:function(e,t,r){return this._inner.runGuarded(e,t,r)}},{key:"runOutsideAngular",value:function(e){return this._outer.run(e)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),e}(),ga={};function _a(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(function(){return e.onStable.emit(null)})}finally{e.isStable=!0}}}function ma(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function va(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Ea(e){e._nesting--,_a(e)}var Ta,ya=function(){function e(){_classCallCheck(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new js,this.onMicrotaskEmpty=new js,this.onStable=new js,this.onError=new js}return _createClass(e,[{key:"run",value:function(e,t,r){return e.apply(t,r)}},{key:"runGuarded",value:function(e,t,r){return e.apply(t,r)}},{key:"runOutsideAngular",value:function(e){return e()}},{key:"runTask",value:function(e,t,r,n){return e.apply(t,r)}}]),e}(),Sa=function(){var e=function(){function e(t){var r=this;_classCallCheck(this,e),this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(function(){r.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}return _createClass(e,[{key:"_watchAngularEvents",value:function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular(function(){e._ngZone.onStable.subscribe({next:function(){fa.assertNotInAngularZone(),pa(function(){e._isZoneStable=!0,e._runCallbacksIfReady()})}})})}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var e=this;if(this.isStable())pa(function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1});else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter(function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)}),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}}):[]}},{key:"addCallback",value:function(e,t,r){var n=this,o=-1;t&&t>0&&(o=setTimeout(function(){n._callbacks=n._callbacks.filter(function(e){return e.timeoutId!==o}),e(n._didWork,n.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:o,updateCb:r})}},{key:"whenStable",value:function(e,t,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,r),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(e,t,r){return[]}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(fa))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),Ca=function(){var e=function(){function e(){_classCallCheck(this,e),this._applications=new Map,Ra.addToWindow(this)}return _createClass(e,[{key:"registerApplication",value:function(e,t){this._applications.set(e,t)}},{key:"unregisterApplication",value:function(e){this._applications.delete(e)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(e){return this._applications.get(e)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Ra.findTestabilityInTree(this,e,t)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),Ra=new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){}},{key:"findTestabilityInTree",value:function(e,t,r){return null}}]),e}()),ba=!0,Ia=!1,ka=new kr("AllowMultipleToken");function Oa(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n="Platform: ".concat(t),o=new kr(n);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=La();if(!i||i.injector.get(ka,!1))if(e)e(r.concat(t).concat({provide:o,useValue:!0}));else{var s=r.concat(t).concat({provide:o,useValue:!0},{provide:No,useValue:"platform"});!function(e){if(Ta&&!Ta.destroyed&&!Ta.injector.get(ka,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Ta=e.get(Pa);var t=e.get(Js,null);t&&t.forEach(function(e){return e()})}(qo.create({providers:s,name:n}))}return function(e){var t=La();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(o)}}function La(){return Ta&&!Ta.destroyed?Ta:null}var Pa=function(){var e=function(){function e(t){_classCallCheck(this,e),this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return _createClass(e,[{key:"bootstrapModuleFactory",value:function(e,t){var r,n,o=this,i=(r=t?t.ngZone:void 0,n={ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1},"noop"===r?new ya:("zone.js"===r?void 0:r)||new fa({enableLongStackTrace:(Ia=!0,ba),shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)})),s=[{provide:fa,useValue:i}];return i.run(function(){var t=qo.create({providers:s,parent:o.injector,name:e.moduleType.name}),r=e.create(t),n=r.injector.get(Kr,null);if(!n)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return i.runOutsideAngular(function(){var e=i.onError.subscribe({next:function(e){n.handleError(e)}});r.onDestroy(function(){wa(o._modules,r),e.unsubscribe()})}),function(e,t,n){try{var i=((s=r.injector.get(Ys)).runInitializers(),s.donePromise.then(function(){return Hi(r.injector.get(ra,"en-US")||"en-US"),o._moduleDoBootstrap(r),r}));return ci(i)?i.catch(function(r){throw t.runOutsideAngular(function(){return e.handleError(r)}),r}):i}catch(a){throw t.runOutsideAngular(function(){return e.handleError(a)}),a}var s}(n,i)})}},{key:"bootstrapModule",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Aa({},r);return function(e,t,r){var n=new qs(r);return Promise.resolve(n)}(0,0,e).then(function(e){return t.bootstrapModuleFactory(e,n)})}},{key:"_moduleDoBootstrap",value:function(e){var t=e.injector.get(Ma);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(function(e){return t.bootstrap(e)});else{if(!e.instance.ngDoBootstrap)throw new Error("The module ".concat(J(e.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.'));e.instance.ngDoBootstrap(t)}this._modules.push(e)}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"injector",get:function(){return this._injector}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(function(e){return e.destroy()}),this._destroyListeners.forEach(function(e){return e()}),this._destroyed=!0}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(qo))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}();function Aa(e,t){return Array.isArray(t)?t.reduce(Aa,e):Object.assign(Object.assign({},e),t)}var Na,Ma=((Na=function(){function e(t,r,n,o,i){var s=this;_classCallCheck(this,e),this._zone=t,this._injector=r,this._exceptionHandler=n,this._componentFactoryResolver=o,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:function(){s._zone.run(function(){s.tick()})}});var a=new E(function(e){s._stable=s._zone.isStable&&!s._zone.hasPendingMacrotasks&&!s._zone.hasPendingMicrotasks,s._zone.runOutsideAngular(function(){e.next(s._stable),e.complete()})}),u=new E(function(e){var t;s._zone.runOutsideAngular(function(){t=s._zone.onStable.subscribe(function(){fa.assertNotInAngularZone(),pa(function(){s._stable||s._zone.hasPendingMacrotasks||s._zone.hasPendingMicrotasks||(s._stable=!0,e.next(!0))})})});var r=s._zone.onUnstable.subscribe(function(){fa.assertInAngularZone(),s._stable&&(s._stable=!1,s._zone.runOutsideAngular(function(){e.next(!1)}))});return function(){t.unsubscribe(),r.unsubscribe()}});this.isStable=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=Number.POSITIVE_INFINITY,o=null,i=t[t.length-1];return I(i)?(o=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof i&&(n=t.pop()),null===o&&1===t.length&&t[0]instanceof E?t[0]:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;return Z(m,e)}(n)(W(t,o))}(a,u.pipe(function(e){return F()((t=Q,function(e){var r;r="function"==typeof t?t:function(){return t};var n=Object.create(e,z);return n.source=e,n.subjectFactory=r,n})(e));var t}))}return _createClass(e,[{key:"bootstrap",value:function(e,t){var r,n=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");r=e instanceof Xi?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(r.componentType);var o=r.isBoundToModule?void 0:this._injector.get(Ps),i=r.create(qo.NULL,[],t||r.selector,o),s=i.location.nativeElement,a=i.injector.get(Sa,null),u=a&&i.injector.get(Ca);return a&&u&&u.registerApplication(s,a),i.onDestroy(function(){n.detachView(i.hostView),wa(n.components,i),u&&u.unregisterApplication(s)}),this._loadComponent(i),i}},{key:"tick",value:function(){var e=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;var t,r=_createForOfIteratorHelper(this._views);try{for(r.s();!(t=r.n()).done;)t.value.detectChanges()}catch(n){r.e(n)}finally{r.f()}}catch(o){this._zone.runOutsideAngular(function(){return e._exceptionHandler.handleError(o)})}finally{this._runningTick=!1}}},{key:"attachView",value:function(e){var t=e;this._views.push(t),t.attachToAppRef(this)}},{key:"detachView",value:function(e){var t=e;wa(this._views,t),t.detachFromAppRef()}},{key:"_loadComponent",value:function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(ea,[]).concat(this._bootstrapListeners).forEach(function(t){return t(e)})}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach(function(e){return e.destroy()}),this._onMicrotaskEmptySubscription.unsubscribe()}},{key:"viewCount",get:function(){return this._views.length}}]),e}()).\u0275fac=function(e){return new(e||Na)(Gr(fa),Gr(qo),Gr(Kr),Gr(Ki),Gr(Ys))},Na.\u0275prov=ue({token:Na,factory:Na.\u0275fac}),Na);function wa(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}var Da=Oa(null,"core",[{provide:$s,useValue:"unknown"},{provide:Pa,deps:[qo]},{provide:Ca,deps:[]},{provide:ta,deps:[]}]),Ua=[{provide:Ma,useClass:Ma,deps:[fa,qo,Kr,Ki,Ys]},{provide:Zs,deps:[fa],useFactory:function(e){var t=[];return e.onStable.subscribe(function(){for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Ys,useClass:Ys,deps:[[new qr,zs]]},{provide:da,useClass:da,deps:[]},Xs,{provide:vs,useFactory:function(){return bs},deps:[]},{provide:Ts,useFactory:function(){return Is},deps:[]},{provide:ra,useFactory:function(e){return Hi(e=e||"undefined"!=typeof $localize&&$localize.locale||"en-US"),e},deps:[[new Fr(ra),new qr,new Vr]]},{provide:na,useValue:"USD"}],xa=function(){var e=function e(t){_classCallCheck(this,e)};return e.\u0275fac=function(t){return new(t||e)(Gr(Ma))},e.\u0275mod=Fe({type:e}),e.\u0275inj=le({providers:Ua}),e}(),Ba=null;function Za(){return Ba}var Ga=new kr("DocumentToken"),Ha=((Ha=Ha||{})[Ha.Zero=0]="Zero",Ha[Ha.One=1]="One",Ha[Ha.Two=2]="Two",Ha[Ha.Few=3]="Few",Ha[Ha.Many=4]="Many",Ha[Ha.Other=5]="Other",Ha),Wa=function e(){_classCallCheck(this,e)},Fa=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).locale=e,n}return _createClass(r,[{key:"getPluralCategory",value:function(e,t){switch(function(e){return function(e){var t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e),r=Zi(t);if(r)return r;var n=t.split("-")[0];if(r=Zi(n))return r;if("en"===n)return xi;throw new Error('Missing locale data for the locale "'.concat(e,'".'))}(e)[Gi.PluralCase]}(t||this.locale)(e)){case Ha.Zero:return"zero";case Ha.One:return"one";case Ha.Two:return"two";case Ha.Few:return"few";case Ha.Many:return"many";default:return"other"}}}]),r}(Wa);return e.\u0275fac=function(t){return new(t||e)(Gr(ra))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}();function qa(e,t){t=encodeURIComponent(t);var r,n=_createForOfIteratorHelper(e.split(";"));try{for(n.s();!(r=n.n()).done;){var o=r.value,i=o.indexOf("="),s=_slicedToArray(-1==i?[o,""]:[o.slice(0,i),o.slice(i+1)],2),a=s[0],u=s[1];if(a.trim()===t)return decodeURIComponent(u)}}catch(l){n.e(l)}finally{n.f()}return null}var Va=function(){function e(t,r,n,o){_classCallCheck(this,e),this.$implicit=t,this.ngForOf=r,this.index=n,this.count=o}return _createClass(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(),ja=function(){var e=function(){function e(t,r,n){_classCallCheck(this,e),this._viewContainer=t,this._template=r,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}return _createClass(e,[{key:"ngForOf",set:function(e){this._ngForOf=e,this._ngForOfDirty=!0}},{key:"ngForTrackBy",get:function(){return this._trackByFn},set:function(e){this._trackByFn=e}},{key:"ngForTemplate",set:function(e){e&&(this._template=e)}},{key:"ngDoCheck",value:function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(n){throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'. NgFor only supports binding to Iterables such as Arrays."))}}var t;if(this._differ){var r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}},{key:"_applyChanges",value:function(e){var t=this,r=[];e.forEachOperation(function(e,n,o){if(null==e.previousIndex){var i=t._viewContainer.createEmbeddedView(t._template,new Va(null,t._ngForOf,-1,-1),null===o?void 0:o),s=new za(e,i);r.push(s)}else if(null==o)t._viewContainer.remove(null===n?void 0:n);else if(null!==n){var a=t._viewContainer.get(n);t._viewContainer.move(a,o);var u=new za(e,a);r.push(u)}});for(var n=0;n<r.length;n++)this._perViewChange(r[n].view,r[n].record);for(var o=0,i=this._viewContainer.length;o<i;o++){var s=this._viewContainer.get(o);s.context.index=o,s.context.count=i,s.context.ngForOf=this._ngForOf}e.forEachIdentityChange(function(e){t._viewContainer.get(e.currentIndex).context.$implicit=e.item})}},{key:"_perViewChange",value:function(e,t){e.context.$implicit=t.item}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}();return e.\u0275fac=function(t){return new(t||e)(ni(Ns),ni(Os),ni(vs))},e.\u0275dir=Ve({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e}(),za=function e(t,r){_classCallCheck(this,e),this.record=t,this.view=r},Ya=function(){var e=function(){function e(t,r){_classCallCheck(this,e),this._viewContainer=t,this._context=new Qa,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}return _createClass(e,[{key:"ngIf",set:function(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}},{key:"ngIfThen",set:function(e){Xa("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}},{key:"ngIfElse",set:function(e){Xa("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}},{key:"_updateView",value:function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}();return e.\u0275fac=function(t){return new(t||e)(ni(Ns),ni(Os))},e.\u0275dir=Ve({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e}(),Qa=function e(){_classCallCheck(this,e),this.$implicit=null,this.ngIf=null};function Xa(e,t){if(t&&!t.createEmbeddedView)throw new Error("".concat(e," must be a TemplateRef, but received '").concat(J(t),"'."))}var Ka,Ja=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=le({providers:[{provide:Wa,useClass:Fa}]}),e}(),$a=function e(){_classCallCheck(this,e)},eu=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"onAndCancel",value:function(e,t,r){return e.addEventListener(t,r,!1),function(){e.removeEventListener(t,r,!1)}}},{key:"dispatchEvent",value:function(e,t){e.dispatchEvent(t)}},{key:"remove",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"createElement",value:function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"isElementNode",value:function(e){return e.nodeType===Node.ELEMENT_NODE}},{key:"isShadowRoot",value:function(e){return e instanceof DocumentFragment}},{key:"getGlobalEventTarget",value:function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}},{key:"getBaseHref",value:function(e){var t=(tu=tu||document.querySelector("base"))?tu.getAttribute("href"):null;return null==t?null:function(e){(Ka=Ka||document.createElement("a")).setAttribute("href",e);var t=Ka.pathname;return"/"===t.charAt(0)?t:"/".concat(t)}(t)}},{key:"resetBaseElement",value:function(){tu=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"getCookie",value:function(e){return qa(document.cookie,e)}}],[{key:"makeCurrent",value:function(){var e;e=new r,Ba||(Ba=e)}}]),r}(function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments)).supportsDOMEvents=!0,e}return r}(function(){return function e(){_classCallCheck(this,e)}}())),tu=null,ru=new kr("TRANSITION_ID"),nu=[{provide:zs,useFactory:function(e,t,r){return function(){r.get(Ys).donePromise.then(function(){var r=Za();Array.prototype.slice.apply(t.querySelectorAll("style[ng-transition]")).filter(function(t){return t.getAttribute("ng-transition")===e}).forEach(function(e){return r.remove(e)})})}},deps:[ru,Ga,qo],multi:!0}],ou=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){Oe.getAngularTestability=function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.findTestabilityInTree(t,r);if(null==n)throw new Error("Could not find testability for element.");return n},Oe.getAllAngularTestabilities=function(){return e.getAllTestabilities()},Oe.getAllAngularRootElements=function(){return e.getAllRootElements()},Oe.frameworkStabilizers||(Oe.frameworkStabilizers=[]),Oe.frameworkStabilizers.push(function(e){var t=Oe.getAllAngularTestabilities(),r=t.length,n=!1,o=function(t){n=n||t,0==--r&&e(n)};t.forEach(function(e){e.whenStable(o)})})}},{key:"findTestabilityInTree",value:function(e,t,r){if(null==t)return null;var n=e.getTestability(t);return null!=n?n:r?Za().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}],[{key:"init",value:function(){var t;t=new e,Ra=t}}]),e}(),iu=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"build",value:function(){return new XMLHttpRequest}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),su=new kr("EventManagerPlugins"),au=function(){var e=function(){function e(t,r){var n=this;_classCallCheck(this,e),this._zone=r,this._eventNameToPlugin=new Map,t.forEach(function(e){return e.manager=n}),this._plugins=t.slice().reverse()}return _createClass(e,[{key:"addEventListener",value:function(e,t,r){return this._findPluginFor(t).addEventListener(e,t,r)}},{key:"addGlobalEventListener",value:function(e,t,r){return this._findPluginFor(t).addGlobalEventListener(e,t,r)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var r=this._plugins,n=0;n<r.length;n++){var o=r[n];if(o.supports(e))return this._eventNameToPlugin.set(e,o),o}throw new Error("No event manager plugin found for event ".concat(e))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(su),Gr(fa))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),uu=function(){function e(t){_classCallCheck(this,e),this._doc=t}return _createClass(e,[{key:"addGlobalEventListener",value:function(e,t,r){var n=Za().getGlobalEventTarget(this._doc,e);if(!n)throw new Error("Unsupported event target ".concat(n," for event ").concat(t));return this.addEventListener(n,t,r)}}]),e}(),lu=function(){var e=function(){function e(){_classCallCheck(this,e),this._stylesSet=new Set}return _createClass(e,[{key:"addStyles",value:function(e){var t=this,r=new Set;e.forEach(function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),r.add(e))}),this.onStylesAdded(r)}},{key:"onStylesAdded",value:function(e){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),cu=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this))._doc=e,n._hostNodes=new Map,n._hostNodes.set(e.head,[]),n}return _createClass(r,[{key:"_addStylesToHost",value:function(e,t,r){var n=this;e.forEach(function(e){var o=n._doc.createElement("style");o.textContent=e,r.push(t.appendChild(o))})}},{key:"addHost",value:function(e){var t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}},{key:"removeHost",value:function(e){var t=this._hostNodes.get(e);t&&t.forEach(du),this._hostNodes.delete(e)}},{key:"onStylesAdded",value:function(e){var t=this;this._hostNodes.forEach(function(r,n){t._addStylesToHost(e,n,r)})}},{key:"ngOnDestroy",value:function(){this._hostNodes.forEach(function(e){return e.forEach(du)})}}]),r}(lu);return e.\u0275fac=function(t){return new(t||e)(Gr(Ga))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}();function du(e){Za().remove(e)}var hu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},pu=/%COMP%/g;function fu(e,t,r){for(var n=0;n<t.length;n++){var o=t[n];Array.isArray(o)?fu(e,o,r):(o=o.replace(pu,e),r.push(o))}return r}function gu(e){return function(t){if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var _u=function(){var e=function(){function e(t,r,n){_classCallCheck(this,e),this.eventManager=t,this.sharedStylesHost=r,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new mu(t)}return _createClass(e,[{key:"createRenderer",value:function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Ce.Emulated:var r=this.rendererByCompId.get(t.id);return r||(r=new vu(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,r)),r.applyToHost(e),r;case 1:case Ce.ShadowDom:return new Eu(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var n=fu(t.id,t.styles,[]);this.sharedStylesHost.addStyles(n),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(au),Gr(cu),Gr(Qs))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),mu=function(){function e(t){_classCallCheck(this,e),this.eventManager=t,this.data=Object.create(null)}return _createClass(e,[{key:"destroy",value:function(){}},{key:"createElement",value:function(e,t){return t?document.createElementNS(hu[t]||t,e):document.createElement(e)}},{key:"createComment",value:function(e){return document.createComment(e)}},{key:"createText",value:function(e){return document.createTextNode(e)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"insertBefore",value:function(e,t,r){e&&e.insertBefore(t,r)}},{key:"removeChild",value:function(e,t){e&&e.removeChild(t)}},{key:"selectRootElement",value:function(e,t){var r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error('The selector "'.concat(e,'" did not match any elements'));return t||(r.textContent=""),r}},{key:"parentNode",value:function(e){return e.parentNode}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"setAttribute",value:function(e,t,r,n){if(n){t=n+":"+t;var o=hu[n];o?e.setAttributeNS(o,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}},{key:"removeAttribute",value:function(e,t,r){if(r){var n=hu[r];n?e.removeAttributeNS(n,t):e.removeAttribute("".concat(r,":").concat(t))}else e.removeAttribute(t)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"setStyle",value:function(e,t,r,n){n&(en.DashCase|en.Important)?e.style.setProperty(t,r,n&en.Important?"important":""):e.style[t]=r}},{key:"removeStyle",value:function(e,t,r){r&en.DashCase?e.style.removeProperty(t):e.style[t]=""}},{key:"setProperty",value:function(e,t,r){e[t]=r}},{key:"setValue",value:function(e,t){e.nodeValue=t}},{key:"listen",value:function(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,gu(r)):this.eventManager.addEventListener(e,t,gu(r))}}]),e}(),vu=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o,i){var s;_classCallCheck(this,r),(s=t.call(this,e)).component=o;var a=fu(i+"-"+o.id,o.styles,[]);return n.addStyles(a),s.contentAttr="_ngcontent-%COMP%".replace(pu,i+"-"+o.id),s.hostAttr="_nghost-%COMP%".replace(pu,i+"-"+o.id),s}return _createClass(r,[{key:"applyToHost",value:function(e){_get(_getPrototypeOf(r.prototype),"setAttribute",this).call(this,e,this.hostAttr,"")}},{key:"createElement",value:function(e,t){var n=_get(_getPrototypeOf(r.prototype),"createElement",this).call(this,e,t);return _get(_getPrototypeOf(r.prototype),"setAttribute",this).call(this,n,this.contentAttr,""),n}}]),r}(mu),Eu=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o,i){var s;_classCallCheck(this,r),(s=t.call(this,e)).sharedStylesHost=n,s.hostEl=o,s.shadowRoot=o.attachShadow({mode:"open"}),s.sharedStylesHost.addHost(s.shadowRoot);for(var a=fu(i.id,i.styles,[]),u=0;u<a.length;u++){var l=document.createElement("style");l.textContent=a[u],s.shadowRoot.appendChild(l)}return s}return _createClass(r,[{key:"nodeOrShadowRoot",value:function(e){return e===this.hostEl?this.shadowRoot:e}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(e,t){return _get(_getPrototypeOf(r.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"insertBefore",value:function(e,t,n){return _get(_getPrototypeOf(r.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(e),t,n)}},{key:"removeChild",value:function(e,t){return _get(_getPrototypeOf(r.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"parentNode",value:function(e){return this.nodeOrShadowRoot(_get(_getPrototypeOf(r.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(e)))}}]),r}(mu),Tu=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,e)}return _createClass(r,[{key:"supports",value:function(e){return!0}},{key:"addEventListener",value:function(e,t,r){var n=this;return e.addEventListener(t,r,!1),function(){return n.removeEventListener(e,t,r)}}},{key:"removeEventListener",value:function(e,t,r){return e.removeEventListener(t,r)}}]),r}(uu);return e.\u0275fac=function(t){return new(t||e)(Gr(Ga))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),yu=["alt","control","meta","shift"],Su={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Cu={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Ru={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},bu=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,e)}return _createClass(r,[{key:"supports",value:function(e){return null!=r.parseEventName(e)}},{key:"addEventListener",value:function(e,t,n){var o=r.parseEventName(t),i=r.eventCallback(o.fullKey,n,this.manager.getZone());return this.manager.getZone().runOutsideAngular(function(){return Za().onAndCancel(e,o.domEventName,i)})}}],[{key:"parseEventName",value:function(e){var t=e.toLowerCase().split("."),n=t.shift();if(0===t.length||"keydown"!==n&&"keyup"!==n)return null;var o=r._normalizeKey(t.pop()),i="";if(yu.forEach(function(e){var r=t.indexOf(e);r>-1&&(t.splice(r,1),i+=e+".")}),i+=o,0!=t.length||0===o.length)return null;var s={};return s.domEventName=n,s.fullKey=i,s}},{key:"getEventFullKey",value:function(e){var t="",r=function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Cu.hasOwnProperty(t)&&(t=Cu[t]))}return Su[t]||t}(e);return" "===(r=r.toLowerCase())?r="space":"."===r&&(r="dot"),yu.forEach(function(n){n!=r&&(0,Ru[n])(e)&&(t+=n+".")}),t+=r}},{key:"eventCallback",value:function(e,t,n){return function(o){r.getEventFullKey(o)===e&&n.runGuarded(function(){return t(o)})}}},{key:"_normalizeKey",value:function(e){switch(e){case"esc":return"escape";default:return e}}}]),r}(uu);return e.\u0275fac=function(t){return new(t||e)(Gr(Ga))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),Iu=Oa(Da,"browser",[{provide:$s,useValue:"browser"},{provide:Js,useValue:function(){eu.makeCurrent(),ou.init()},multi:!0},{provide:Ga,useFactory:function(){return function(e){tt=e}(document),document},deps:[]}]),ku=[[],{provide:No,useValue:"root"},{provide:Kr,useFactory:function(){return new Kr},deps:[]},{provide:su,useClass:Tu,multi:!0,deps:[Ga,fa,$s]},{provide:su,useClass:bu,multi:!0,deps:[Ga]},[],{provide:_u,useClass:_u,deps:[au,cu,Qs]},{provide:rs,useExisting:_u},{provide:lu,useExisting:cu},{provide:cu,useClass:cu,deps:[Ga]},{provide:Sa,useClass:Sa,deps:[fa]},{provide:au,useClass:au,deps:[su,fa]},{provide:$a,useClass:iu,deps:[]},[]],Ou=function(){var e=function(){function e(t){if(_classCallCheck(this,e),t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return _createClass(e,null,[{key:"withServerTransition",value:function(t){return{ngModule:e,providers:[{provide:Qs,useValue:t.appId},{provide:ru,useExisting:Qs},nu]}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(e,12))},e.\u0275mod=Fe({type:e}),e.\u0275inj=le({providers:ku,imports:[Ja,xa]}),e}();function Lu(e,t){return new E(function(r){var n=e.length;if(0!==n)for(var o=new Array(n),i=0,s=0,a=function(a){var u=U(e[a]),l=!1;r.add(u.subscribe({next:function(e){l||(l=!0,s++),o[a]=e},error:function(e){return r.error(e)},complete:function(){++i!==n&&l||(s===n&&r.next(t?t.reduce(function(e,t,r){return e[t]=o[r],e},{}):o),r.complete())}}))},u=0;u<n;u++)a(u);else r.complete()})}"undefined"!=typeof window&&window;var Pu=function(){var e=function(){function e(t,r){_classCallCheck(this,e),this._renderer=t,this._elementRef=r,this.onChange=function(e){},this.onTouched=function(){}}return _createClass(e,[{key:"setProperty",value:function(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"registerOnChange",value:function(e){this.onChange=e}},{key:"setDisabledState",value:function(e){this.setProperty("disabled",e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(ni(ns),ni(ts))},e.\u0275dir=Ve({type:e}),e}(),Au=function(){var e,t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return r}(Pu);return t.\u0275fac=function(r){return(e||(e=Rr(t)))(r||t)},t.\u0275dir=Ve({type:t,features:[jo]}),t}(),Nu=new kr("NgValueAccessor"),Mu={provide:Nu,useExisting:te(function(){return wu}),multi:!0},wu=function(){var e,t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"writeValue",value:function(e){this.setProperty("checked",e)}}]),r}(Au);return t.\u0275fac=function(r){return(e||(e=Rr(t)))(r||t)},t.\u0275dir=Ve({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(e,t){1&e&&hi("change",function(e){return t.onChange(e.target.checked)})("blur",function(){return t.onTouched()})},features:[Qi([Mu]),jo]}),t}(),Du={provide:Nu,useExisting:te(function(){return xu}),multi:!0},Uu=new kr("CompositionEventMode"),xu=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o){var i,s;return _classCallCheck(this,r),(i=t.call(this,e,n))._compositionMode=o,i._composing=!1,null==i._compositionMode&&(i._compositionMode=(s=Za()?Za().getUserAgent():"",!/android (\d+)/.test(s.toLowerCase()))),i}return _createClass(r,[{key:"writeValue",value:function(e){this.setProperty("value",null==e?"":e)}},{key:"_handleInput",value:function(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}},{key:"_compositionStart",value:function(){this._composing=!0}},{key:"_compositionEnd",value:function(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}]),r}(Pu);return e.\u0275fac=function(t){return new(t||e)(ni(ns),ni(ts),ni(Uu,8))},e.\u0275dir=Ve({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&hi("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[Qi([Du]),jo]}),e}(),Bu=new kr("NgValidators"),Zu=new kr("NgAsyncValidators");function Gu(e){return null!=e}function Hu(e){var t=ci(e)?U(e):e;return di(t),t}function Wu(e){var t={};return e.forEach(function(e){t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function Fu(e,t){return t.map(function(t){return t(e)})}function qu(e){return e.map(function(e){return function(e){return!e.validate}(e)?e:function(t){return e.validate(t)}})}function Vu(e){return null!=e?function(e){if(!e)return null;var t=e.filter(Gu);return 0==t.length?null:function(e){return Wu(Fu(e,t))}}(qu(e)):null}function ju(e){return null!=e?function(e){if(!e)return null;var t=e.filter(Gu);return 0==t.length?null:function(e){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(1===t.length){var n=t[0];if(u(n))return Lu(n,null);if(l(n)&&Object.getPrototypeOf(n)===Object.prototype){var o=Object.keys(n);return Lu(o.map(function(e){return n[e]}),o)}}if("function"==typeof t[t.length-1]){var i=t.pop();return Lu(t=1===t.length&&u(t[0])?t[0]:t,null).pipe(k(function(e){return i.apply(void 0,_toConsumableArray(e))}))}return Lu(t,null)}(Fu(e,t).map(Hu)).pipe(k(Wu))}}(qu(e)):null}function zu(e,t){return null===e?[t]:Array.isArray(e)?[].concat(_toConsumableArray(e),[t]):[e,t]}var Yu=function(){var e=function(){function e(){_classCallCheck(this,e),this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}return _createClass(e,[{key:"value",get:function(){return this.control?this.control.value:null}},{key:"valid",get:function(){return this.control?this.control.valid:null}},{key:"invalid",get:function(){return this.control?this.control.invalid:null}},{key:"pending",get:function(){return this.control?this.control.pending:null}},{key:"disabled",get:function(){return this.control?this.control.disabled:null}},{key:"enabled",get:function(){return this.control?this.control.enabled:null}},{key:"errors",get:function(){return this.control?this.control.errors:null}},{key:"pristine",get:function(){return this.control?this.control.pristine:null}},{key:"dirty",get:function(){return this.control?this.control.dirty:null}},{key:"touched",get:function(){return this.control?this.control.touched:null}},{key:"status",get:function(){return this.control?this.control.status:null}},{key:"untouched",get:function(){return this.control?this.control.untouched:null}},{key:"statusChanges",get:function(){return this.control?this.control.statusChanges:null}},{key:"valueChanges",get:function(){return this.control?this.control.valueChanges:null}},{key:"path",get:function(){return null}},{key:"_setValidators",value:function(e){this._rawValidators=e||[],this._composedValidatorFn=Vu(this._rawValidators)}},{key:"_setAsyncValidators",value:function(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=ju(this._rawAsyncValidators)}},{key:"validator",get:function(){return this._composedValidatorFn||null}},{key:"asyncValidator",get:function(){return this._composedAsyncValidatorFn||null}},{key:"_registerOnDestroy",value:function(e){this._onDestroyCallbacks.push(e)}},{key:"_invokeOnDestroyCallbacks",value:function(){this._onDestroyCallbacks.forEach(function(e){return e()}),this._onDestroyCallbacks=[]}},{key:"reset",value:function(e){this.control&&this.control.reset(e)}},{key:"hasError",value:function(e,t){return!!this.control&&this.control.hasError(e,t)}},{key:"getError",value:function(e,t){return this.control?this.control.getError(e,t):null}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Ve({type:e}),e}(),Qu=function(){var e,t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"formDirective",get:function(){return null}},{key:"path",get:function(){return null}}]),r}(Yu);return t.\u0275fac=function(r){return(e||(e=Rr(t)))(r||t)},t.\u0275dir=Ve({type:t,features:[jo]}),t}(),Xu=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments))._parent=null,e.name=null,e.valueAccessor=null,e}return r}(Yu),Ku=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){return _classCallCheck(this,r),t.call(this,e)}return r}(function(){function e(t){_classCallCheck(this,e),this._cd=t}return _createClass(e,[{key:"is",value:function(e){var t,r,n;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(n=null===(r=this._cd)||void 0===r?void 0:r.control)||void 0===n?void 0:n[e])}}]),e}());return e.\u0275fac=function(t){return new(t||e)(ni(Xu,2))},e.\u0275dir=Ve({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&Si("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[jo]}),e}();function Ju(e,t){e.forEach(function(e){e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function $u(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function el(e,t){var r=e.indexOf(t);r>-1&&e.splice(r,1)}function tl(e){return(il(e)?e.validators:e)||null}function rl(e){return Array.isArray(e)?Vu(e):e||null}function nl(e,t){return(il(t)?t.asyncValidators:e)||null}function ol(e){return Array.isArray(e)?ju(e):e||null}function il(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}var sl=function(){function e(t,r){_classCallCheck(this,e),this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=function(){},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=r,this._composedValidatorFn=rl(this._rawValidators),this._composedAsyncValidatorFn=ol(this._rawAsyncValidators)}return _createClass(e,[{key:"validator",get:function(){return this._composedValidatorFn},set:function(e){this._rawValidators=this._composedValidatorFn=e}},{key:"asyncValidator",get:function(){return this._composedAsyncValidatorFn},set:function(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}},{key:"parent",get:function(){return this._parent}},{key:"valid",get:function(){return"VALID"===this.status}},{key:"invalid",get:function(){return"INVALID"===this.status}},{key:"pending",get:function(){return"PENDING"==this.status}},{key:"disabled",get:function(){return"DISABLED"===this.status}},{key:"enabled",get:function(){return"DISABLED"!==this.status}},{key:"dirty",get:function(){return!this.pristine}},{key:"untouched",get:function(){return!this.touched}},{key:"updateOn",get:function(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}},{key:"setValidators",value:function(e){this._rawValidators=e,this._composedValidatorFn=rl(e)}},{key:"setAsyncValidators",value:function(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=ol(e)}},{key:"clearValidators",value:function(){this.validator=null}},{key:"clearAsyncValidators",value:function(){this.asyncValidator=null}},{key:"markAsTouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}},{key:"markAllAsTouched",value:function(){this.markAsTouched({onlySelf:!0}),this._forEachChild(function(e){return e.markAllAsTouched()})}},{key:"markAsUntouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=!1,this._pendingTouched=!1,this._forEachChild(function(e){e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}},{key:"markAsDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}},{key:"markAsPristine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!0,this._pendingDirty=!1,this._forEachChild(function(e){e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}},{key:"markAsPending",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.status="PENDING",!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}},{key:"disable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._parentMarkedDirty(e.onlySelf);this.status="DISABLED",this.errors=null,this._forEachChild(function(t){t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(function(e){return e(!0)})}},{key:"enable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._parentMarkedDirty(e.onlySelf);this.status="VALID",this._forEachChild(function(t){t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(function(e){return e(!1)})}},{key:"_updateAncestors",value:function(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}},{key:"setParent",value:function(e){this._parent=e}},{key:"updateValueAndValidity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),"VALID"!==this.status&&"PENDING"!==this.status||this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}},{key:"_updateTreeValidity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{emitEvent:!0};this._forEachChild(function(t){return t._updateTreeValidity(e)}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}},{key:"_setInitialStatus",value:function(){this.status=this._allControlsDisabled()?"DISABLED":"VALID"}},{key:"_runValidator",value:function(){return this.validator?this.validator(this):null}},{key:"_runAsyncValidator",value:function(e){var t=this;if(this.asyncValidator){this.status="PENDING",this._hasOwnPendingAsyncValidator=!0;var r=Hu(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(function(r){t._hasOwnPendingAsyncValidator=!1,t.setErrors(r,{emitEvent:e})})}}},{key:"_cancelExistingSubscription",value:function(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}},{key:"setErrors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}},{key:"get",value:function(e){return function(e,t,r){if(null==t)return null;if(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length)return null;var n=e;return t.forEach(function(e){n=n instanceof ul?n.controls.hasOwnProperty(e)?n.controls[e]:null:n instanceof ll&&n.at(e)||null}),n}(this,e)}},{key:"getError",value:function(e,t){var r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}},{key:"hasError",value:function(e,t){return!!this.getError(e,t)}},{key:"root",get:function(){for(var e=this;e._parent;)e=e._parent;return e}},{key:"_updateControlsErrors",value:function(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}},{key:"_initObservables",value:function(){this.valueChanges=new js,this.statusChanges=new js}},{key:"_calculateStatus",value:function(){return this._allControlsDisabled()?"DISABLED":this.errors?"INVALID":this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus("PENDING")?"PENDING":this._anyControlsHaveStatus("INVALID")?"INVALID":"VALID"}},{key:"_anyControlsHaveStatus",value:function(e){return this._anyControls(function(t){return t.status===e})}},{key:"_anyControlsDirty",value:function(){return this._anyControls(function(e){return e.dirty})}},{key:"_anyControlsTouched",value:function(){return this._anyControls(function(e){return e.touched})}},{key:"_updatePristine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}},{key:"_updateTouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}},{key:"_isBoxedValue",value:function(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}},{key:"_registerOnCollectionChange",value:function(e){this._onCollectionChange=e}},{key:"_setUpdateStrategy",value:function(e){il(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}},{key:"_parentMarkedDirty",value:function(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}]),e}(),al=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return _classCallCheck(this,r),(e=t.call(this,tl(o),nl(i,o)))._onChange=[],e._applyFormState(n),e._setUpdateStrategy(o),e._initObservables(),e.updateValueAndValidity({onlySelf:!0,emitEvent:!!e.asyncValidator}),e}return _createClass(r,[{key:"setValue",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.value=this._pendingValue=e,this._onChange.length&&!1!==r.emitModelToViewChange&&this._onChange.forEach(function(e){return e(t.value,!1!==r.emitViewToModelChange)}),this.updateValueAndValidity(r)}},{key:"patchValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setValue(e,t)}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}},{key:"_updateValue",value:function(){}},{key:"_anyControls",value:function(e){return!1}},{key:"_allControlsDisabled",value:function(){return this.disabled}},{key:"registerOnChange",value:function(e){this._onChange.push(e)}},{key:"_unregisterOnChange",value:function(e){el(this._onChange,e)}},{key:"registerOnDisabledChange",value:function(e){this._onDisabledChange.push(e)}},{key:"_unregisterOnDisabledChange",value:function(e){el(this._onDisabledChange,e)}},{key:"_forEachChild",value:function(e){}},{key:"_syncPendingControls",value:function(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}},{key:"_applyFormState",value:function(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}]),r}(sl),ul=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o){var i;return _classCallCheck(this,r),(i=t.call(this,tl(n),nl(o,n))).controls=e,i._initObservables(),i._setUpdateStrategy(n),i._setUpControls(),i.updateValueAndValidity({onlySelf:!0,emitEvent:!!i.asyncValidator}),i}return _createClass(r,[{key:"registerControl",value:function(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}},{key:"addControl",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}},{key:"removeControl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.controls[e]&&this.controls[e]._registerOnCollectionChange(function(){}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}},{key:"setControl",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.controls[e]&&this.controls[e]._registerOnCollectionChange(function(){}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}},{key:"contains",value:function(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}},{key:"setValue",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkAllValuesPresent(e),Object.keys(e).forEach(function(n){t._throwIfControlMissing(n),t.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r)}},{key:"patchValue",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!=e&&(Object.keys(e).forEach(function(n){t.controls[n]&&t.controls[n].patchValue(e[n],{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r))}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._forEachChild(function(r,n){r.reset(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}},{key:"getRawValue",value:function(){return this._reduceChildren({},function(e,t,r){return e[r]=t instanceof al?t.value:t.getRawValue(),e})}},{key:"_syncPendingControls",value:function(){var e=this._reduceChildren(!1,function(e,t){return!!t._syncPendingControls()||e});return e&&this.updateValueAndValidity({onlySelf:!0}),e}},{key:"_throwIfControlMissing",value:function(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error("Cannot find form control with name: ".concat(e,"."))}},{key:"_forEachChild",value:function(e){var t=this;Object.keys(this.controls).forEach(function(r){var n=t.controls[r];n&&e(n,r)})}},{key:"_setUpControls",value:function(){var e=this;this._forEachChild(function(t){t.setParent(e),t._registerOnCollectionChange(e._onCollectionChange)})}},{key:"_updateValue",value:function(){this.value=this._reduceValue()}},{key:"_anyControls",value:function(e){for(var t=0,r=Object.keys(this.controls);t<r.length;t++){var n=r[t],o=this.controls[n];if(this.contains(n)&&e(o))return!0}return!1}},{key:"_reduceValue",value:function(){var e=this;return this._reduceChildren({},function(t,r,n){return(r.enabled||e.disabled)&&(t[n]=r.value),t})}},{key:"_reduceChildren",value:function(e,t){var r=e;return this._forEachChild(function(e,n){r=t(r,e,n)}),r}},{key:"_allControlsDisabled",value:function(){for(var e=0,t=Object.keys(this.controls);e<t.length;e++){var r=t[e];if(this.controls[r].enabled)return!1}return Object.keys(this.controls).length>0||this.disabled}},{key:"_checkAllValuesPresent",value:function(e){this._forEachChild(function(t,r){if(void 0===e[r])throw new Error("Must supply a value for form control with name: '".concat(r,"'."))})}}]),r}(sl),ll=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o){var i;return _classCallCheck(this,r),(i=t.call(this,tl(n),nl(o,n))).controls=e,i._initObservables(),i._setUpdateStrategy(n),i._setUpControls(),i.updateValueAndValidity({onlySelf:!0,emitEvent:!!i.asyncValidator}),i}return _createClass(r,[{key:"at",value:function(e){return this.controls[e]}},{key:"push",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}},{key:"insert",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}},{key:"removeAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.controls[e]&&this.controls[e]._registerOnCollectionChange(function(){}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}},{key:"setControl",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.controls[e]&&this.controls[e]._registerOnCollectionChange(function(){}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}},{key:"length",get:function(){return this.controls.length}},{key:"setValue",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkAllValuesPresent(e),e.forEach(function(e,n){t._throwIfControlMissing(n),t.at(n).setValue(e,{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r)}},{key:"patchValue",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null!=e&&(e.forEach(function(e,n){t.at(n)&&t.at(n).patchValue(e,{onlySelf:!0,emitEvent:r.emitEvent})}),this.updateValueAndValidity(r))}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._forEachChild(function(r,n){r.reset(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}},{key:"getRawValue",value:function(){return this.controls.map(function(e){return e instanceof al?e.value:e.getRawValue()})}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.controls.length<1||(this._forEachChild(function(e){return e._registerOnCollectionChange(function(){})}),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}},{key:"_syncPendingControls",value:function(){var e=this.controls.reduce(function(e,t){return!!t._syncPendingControls()||e},!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}},{key:"_throwIfControlMissing",value:function(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error("Cannot find form control at index ".concat(e))}},{key:"_forEachChild",value:function(e){this.controls.forEach(function(t,r){e(t,r)})}},{key:"_updateValue",value:function(){var e=this;this.value=this.controls.filter(function(t){return t.enabled||e.disabled}).map(function(e){return e.value})}},{key:"_anyControls",value:function(e){return this.controls.some(function(t){return t.enabled&&e(t)})}},{key:"_setUpControls",value:function(){var e=this;this._forEachChild(function(t){return e._registerControl(t)})}},{key:"_checkAllValuesPresent",value:function(e){this._forEachChild(function(t,r){if(void 0===e[r])throw new Error("Must supply a value for form control at index: ".concat(r,"."))})}},{key:"_allControlsDisabled",value:function(){var e,t=_createForOfIteratorHelper(this.controls);try{for(t.s();!(e=t.n()).done;){if(e.value.enabled)return!1}}catch(r){t.e(r)}finally{t.f()}return this.controls.length>0||this.disabled}},{key:"_registerControl",value:function(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}]),r}(sl),cl={provide:Xu,useExisting:te(function(){return hl})},dl=Promise.resolve(null),hl=function(){var e=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o,i){var s;return _classCallCheck(this,r),(s=t.call(this)).control=new al,s._registered=!1,s.update=new js,s._parent=e,s._setValidators(n),s._setAsyncValidators(o),s.valueAccessor=function(e,t){return t?(Array.isArray(t),t.forEach(function(e){e.constructor===xu?r=e:Object.getPrototypeOf(e.constructor)===Au?n=e:o=e}),o||n||r||null):null;var r,n,o}(0,i),s}return _createClass(r,[{key:"ngOnChanges",value:function(e){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in e&&this._updateDisabled(e),function(e,t){if(!e.hasOwnProperty("model"))return!1;var r=e.model;return!!r.isFirstChange()||!Object.is(t,r.currentValue)}(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}},{key:"ngOnDestroy",value:function(){this.formDirective&&this.formDirective.removeControl(this)}},{key:"path",get:function(){return this._parent?[].concat(_toConsumableArray(this._parent.path),[this.name]):[this.name]}},{key:"formDirective",get:function(){return this._parent?this._parent.formDirective:null}},{key:"viewToModelUpdate",value:function(e){this.viewModel=e,this.update.emit(e)}},{key:"_setUpControl",value:function(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}},{key:"_setUpdateStrategy",value:function(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}},{key:"_isStandalone",value:function(){return!this._parent||!(!this.options||!this.options.standalone)}},{key:"_setUpStandalone",value:function(){var e,t;(function(e,t){var r=function(e){return e._rawValidators}(e);null!==t.validator?e.setValidators(zu(r,t.validator)):"function"==typeof r&&e.setValidators([r]);var n=function(e){return e._rawAsyncValidators}(e);null!==t.asyncValidator?e.setAsyncValidators(zu(n,t.asyncValidator)):"function"==typeof n&&e.setAsyncValidators([n]);var o=function(){return e.updateValueAndValidity()};Ju(t._rawValidators,o),Ju(t._rawAsyncValidators,o)})(e=this.control,t=this),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(function(r){e._pendingValue=r,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&$u(e,t)})}(e,t),function(e,t){var r=function(e,r){t.valueAccessor.writeValue(e),r&&t.viewToModelUpdate(e)};e.registerOnChange(r),t._registerOnDestroy(function(){e._unregisterOnChange(r)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(function(){e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&$u(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){var r=function(e){t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(r),t._registerOnDestroy(function(){e._unregisterOnDisabledChange(r)})}}(e,t),this.control.updateValueAndValidity({emitEvent:!1})}},{key:"_checkForErrors",value:function(){this._isStandalone()||this._checkParentType(),this._checkName()}},{key:"_checkParentType",value:function(){}},{key:"_checkName",value:function(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}},{key:"_updateValue",value:function(e){var t=this;dl.then(function(){t.control.setValue(e,{emitViewToModelChange:!1})})}},{key:"_updateDisabled",value:function(e){var t=this,r=e.isDisabled.currentValue,n=""===r||r&&"false"!==r;dl.then(function(){n&&!t.control.disabled?t.control.disable():!n&&t.control.disabled&&t.control.enable()})}}]),r}(Xu);return e.\u0275fac=function(t){return new(t||e)(ni(Qu,9),ni(Bu,10),ni(Zu,10),ni(Nu,10))},e.\u0275dir=Ve({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Qi([cl]),jo,nt]}),e}(),pl=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=le({}),e}(),fl={provide:Nu,useExisting:te(function(){return _l}),multi:!0};function gl(e,t){return null==e?"".concat(t):(t&&"object"==typeof t&&(t="Object"),"".concat(e,": ").concat(t).slice(0,50))}var _l=function(){var e,t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments))._optionMap=new Map,e._idCounter=0,e._compareWith=Object.is,e}return _createClass(r,[{key:"compareWith",set:function(e){this._compareWith=e}},{key:"writeValue",value:function(e){this.value=e;var t=this._getOptionId(e);null==t&&this.setProperty("selectedIndex",-1);var r=gl(t,e);this.setProperty("value",r)}},{key:"registerOnChange",value:function(e){var t=this;this.onChange=function(r){t.value=t._getOptionValue(r),e(t.value)}}},{key:"_registerOption",value:function(){return(this._idCounter++).toString()}},{key:"_getOptionId",value:function(e){for(var t=0,r=Array.from(this._optionMap.keys());t<r.length;t++){var n=r[t];if(this._compareWith(this._optionMap.get(n),e))return n}return null}},{key:"_getOptionValue",value:function(e){var t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t):e}}]),r}(Au);return t.\u0275fac=function(r){return(e||(e=Rr(t)))(r||t)},t.\u0275dir=Ve({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,t){1&e&&hi("change",function(e){return t.onChange(e.target.value)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[Qi([fl]),jo]}),t}(),ml=function(){var e=function(){function e(t,r,n){_classCallCheck(this,e),this._element=t,this._renderer=r,this._select=n,this._select&&(this.id=this._select._registerOption())}return _createClass(e,[{key:"ngValue",set:function(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(gl(this.id,e)),this._select.writeValue(this._select.value))}},{key:"value",set:function(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}},{key:"_setElementValue",value:function(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}},{key:"ngOnDestroy",value:function(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(ni(ts),ni(ns),ni(_l,9))},e.\u0275dir=Ve({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e}(),vl={provide:Nu,useExisting:te(function(){return Tl}),multi:!0};function El(e,t){return null==e?"".concat(t):("string"==typeof t&&(t="'".concat(t,"'")),t&&"object"==typeof t&&(t="Object"),"".concat(e,": ").concat(t).slice(0,50))}var Tl=function(){var e,t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.apply(this,arguments))._optionMap=new Map,e._idCounter=0,e._compareWith=Object.is,e}return _createClass(r,[{key:"compareWith",set:function(e){this._compareWith=e}},{key:"writeValue",value:function(e){var t,r=this;if(this.value=e,Array.isArray(e)){var n=e.map(function(e){return r._getOptionId(e)});t=function(e,t){e._setSelected(n.indexOf(t.toString())>-1)}}else t=function(e,t){e._setSelected(!1)};this._optionMap.forEach(t)}},{key:"registerOnChange",value:function(e){var t=this;this.onChange=function(r){var n=[];if(void 0!==r.selectedOptions)for(var o=r.selectedOptions,i=0;i<o.length;i++){var s=o.item(i),a=t._getOptionValue(s.value);n.push(a)}else for(var u=r.options,l=0;l<u.length;l++){var c=u.item(l);if(c.selected){var d=t._getOptionValue(c.value);n.push(d)}}t.value=n,e(n)}}},{key:"_registerOption",value:function(e){var t=(this._idCounter++).toString();return this._optionMap.set(t,e),t}},{key:"_getOptionId",value:function(e){for(var t=0,r=Array.from(this._optionMap.keys());t<r.length;t++){var n=r[t];if(this._compareWith(this._optionMap.get(n)._value,e))return n}return null}},{key:"_getOptionValue",value:function(e){var t=function(e){return e.split(":")[0]}(e);return this._optionMap.has(t)?this._optionMap.get(t)._value:e}}]),r}(Au);return t.\u0275fac=function(r){return(e||(e=Rr(t)))(r||t)},t.\u0275dir=Ve({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,t){1&e&&hi("change",function(e){return t.onChange(e.target)})("blur",function(){return t.onTouched()})},inputs:{compareWith:"compareWith"},features:[Qi([vl]),jo]}),t}(),yl=function(){var e=function(){function e(t,r,n){_classCallCheck(this,e),this._element=t,this._renderer=r,this._select=n,this._select&&(this.id=this._select._registerOption(this))}return _createClass(e,[{key:"ngValue",set:function(e){null!=this._select&&(this._value=e,this._setElementValue(El(this.id,e)),this._select.writeValue(this._select.value))}},{key:"value",set:function(e){this._select?(this._value=e,this._setElementValue(El(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}},{key:"_setElementValue",value:function(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}},{key:"_setSelected",value:function(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}},{key:"ngOnDestroy",value:function(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(ni(ts),ni(ns),ni(Tl,9))},e.\u0275dir=Ve({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),e}(),Sl=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=le({imports:[[pl]]}),e}(),Cl=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=le({imports:[Sl]}),e}(),Rl=function(){function e(t,r){_classCallCheck(this,e),this.predicate=t,this.thisArg=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new bl(e,this.predicate,this.thisArg))}}]),e}(),bl=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n,o){var i;return _classCallCheck(this,r),(i=t.call(this,e)).predicate=n,i.thisArg=o,i.count=0,i}return _createClass(r,[{key:"_next",value:function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}t&&this.destination.next(e)}}]),r}(f),Il=function e(){_classCallCheck(this,e)},kl=function e(){_classCallCheck(this,e)},Ol=function(){function e(t){var r=this;_classCallCheck(this,e),this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?function(){r.headers=new Map,t.split("\n").forEach(function(e){var t=e.indexOf(":");if(t>0){var n=e.slice(0,t),o=n.toLowerCase(),i=e.slice(t+1).trim();r.maybeSetNormalizedName(n,o),r.headers.has(o)?r.headers.get(o).push(i):r.headers.set(o,[i])}})}:function(){r.headers=new Map,Object.keys(t).forEach(function(e){var n=t[e],o=e.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(r.headers.set(o,n),r.maybeSetNormalizedName(e,o))})}:this.headers=new Map}return _createClass(e,[{key:"has",value:function(e){return this.init(),this.headers.has(e.toLowerCase())}},{key:"get",value:function(e){this.init();var t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}},{key:"keys",value:function(){return this.init(),Array.from(this.normalizedNames.values())}},{key:"getAll",value:function(e){return this.init(),this.headers.get(e.toLowerCase())||null}},{key:"append",value:function(e,t){return this.clone({name:e,value:t,op:"a"})}},{key:"set",value:function(e,t){return this.clone({name:e,value:t,op:"s"})}},{key:"delete",value:function(e,t){return this.clone({name:e,value:t,op:"d"})}},{key:"maybeSetNormalizedName",value:function(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}},{key:"init",value:function(){var t=this;this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(function(e){return t.applyUpdate(e)}),this.lazyUpdate=null))}},{key:"copyFrom",value:function(e){var t=this;e.init(),Array.from(e.headers.keys()).forEach(function(r){t.headers.set(r,e.headers.get(r)),t.normalizedNames.set(r,e.normalizedNames.get(r))})}},{key:"clone",value:function(t){var r=new e;return r.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,r.lazyUpdate=(this.lazyUpdate||[]).concat([t]),r}},{key:"applyUpdate",value:function(e){var t=e.name.toLowerCase();switch(e.op){case"a":case"s":var r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);var n=("a"===e.op?this.headers.get(t):void 0)||[];n.push.apply(n,_toConsumableArray(r)),this.headers.set(t,n);break;case"d":var o=e.value;if(o){var i=this.headers.get(t);if(!i)return;0===(i=i.filter(function(e){return-1===o.indexOf(e)})).length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,i)}else this.headers.delete(t),this.normalizedNames.delete(t)}}},{key:"forEach",value:function(e){var t=this;this.init(),Array.from(this.normalizedNames.keys()).forEach(function(r){return e(t.normalizedNames.get(r),t.headers.get(r))})}}]),e}(),Ll=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"encodeKey",value:function(e){return Pl(e)}},{key:"encodeValue",value:function(e){return Pl(e)}},{key:"decodeKey",value:function(e){return decodeURIComponent(e)}},{key:"decodeValue",value:function(e){return decodeURIComponent(e)}}]),e}();function Pl(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}function Al(e){return"".concat(e)}var Nl=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),this.updates=null,this.cloneFrom=null,this.encoder=r.encoder||new Ll,r.fromString){if(r.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){var r=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(function(e){var n=e.indexOf("="),o=_slicedToArray(-1==n?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,n)),t.decodeValue(e.slice(n+1))],2),i=o[0],s=o[1],a=r.get(i)||[];a.push(s),r.set(i,a)}),r}(r.fromString,this.encoder)}else r.fromObject?(this.map=new Map,Object.keys(r.fromObject).forEach(function(e){var n=r.fromObject[e];t.map.set(e,Array.isArray(n)?n:[n])})):this.map=null}return _createClass(e,[{key:"has",value:function(e){return this.init(),this.map.has(e)}},{key:"get",value:function(e){this.init();var t=this.map.get(e);return t?t[0]:null}},{key:"getAll",value:function(e){return this.init(),this.map.get(e)||null}},{key:"keys",value:function(){return this.init(),Array.from(this.map.keys())}},{key:"append",value:function(e,t){return this.clone({param:e,value:t,op:"a"})}},{key:"appendAll",value:function(e){var t=[];return Object.keys(e).forEach(function(r){var n=e[r];Array.isArray(n)?n.forEach(function(e){t.push({param:r,value:e,op:"a"})}):t.push({param:r,value:n,op:"a"})}),this.clone(t)}},{key:"set",value:function(e,t){return this.clone({param:e,value:t,op:"s"})}},{key:"delete",value:function(e,t){return this.clone({param:e,value:t,op:"d"})}},{key:"toString",value:function(){var e=this;return this.init(),this.keys().map(function(t){var r=e.encoder.encodeKey(t);return e.map.get(t).map(function(t){return r+"="+e.encoder.encodeValue(t)}).join("&")}).filter(function(e){return""!==e}).join("&")}},{key:"clone",value:function(t){var r=new e({encoder:this.encoder});return r.cloneFrom=this.cloneFrom||this,r.updates=(this.updates||[]).concat(t),r}},{key:"init",value:function(){var e=this;null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(function(t){return e.map.set(t,e.cloneFrom.map.get(t))}),this.updates.forEach(function(t){switch(t.op){case"a":case"s":var r=("a"===t.op?e.map.get(t.param):void 0)||[];r.push(Al(t.value)),e.map.set(t.param,r);break;case"d":if(void 0===t.value){e.map.delete(t.param);break}var n=e.map.get(t.param)||[],o=n.indexOf(Al(t.value));-1!==o&&n.splice(o,1),n.length>0?e.map.set(t.param,n):e.map.delete(t.param)}}),this.cloneFrom=this.updates=null)}}]),e}(),Ml=function(){function e(){_classCallCheck(this,e),this.map=new Map}return _createClass(e,[{key:"set",value:function(e,t){return this.map.set(e,t),this}},{key:"get",value:function(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}},{key:"delete",value:function(e){return this.map.delete(e),this}},{key:"keys",value:function(){return this.map.keys()}}]),e}();function wl(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function Dl(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Ul(e){return"undefined"!=typeof FormData&&e instanceof FormData}var xl=function(){function e(t,r,n,o){var i;if(_classCallCheck(this,e),this.url=r,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==n?n:null,i=o):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Ol),this.context||(this.context=new Ml),this.params){var s=this.params.toString();if(0===s.length)this.urlWithParams=r;else{var a=r.indexOf("?");this.urlWithParams=r+(-1===a?"?":a<r.length-1?"&":"")+s}}else this.params=new Nl,this.urlWithParams=r}return _createClass(e,[{key:"serializeBody",value:function(){return null===this.body?null:wl(this.body)||Dl(this.body)||Ul(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof Nl?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}},{key:"detectContentTypeHeader",value:function(){return null===this.body||Ul(this.body)?null:Dl(this.body)?this.body.type||null:wl(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Nl?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}},{key:"clone",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.method||this.method,o=r.url||this.url,i=r.responseType||this.responseType,s=void 0!==r.body?r.body:this.body,a=void 0!==r.withCredentials?r.withCredentials:this.withCredentials,u=void 0!==r.reportProgress?r.reportProgress:this.reportProgress,l=r.headers||this.headers,c=r.params||this.params,d=null!==(t=r.context)&&void 0!==t?t:this.context;return void 0!==r.setHeaders&&(l=Object.keys(r.setHeaders).reduce(function(e,t){return e.set(t,r.setHeaders[t])},l)),r.setParams&&(c=Object.keys(r.setParams).reduce(function(e,t){return e.set(t,r.setParams[t])},c)),new e(n,o,s,{params:c,headers:l,context:d,reportProgress:u,responseType:i,withCredentials:a})}}]),e}(),Bl=((Bl=Bl||{})[Bl.Sent=0]="Sent",Bl[Bl.UploadProgress=1]="UploadProgress",Bl[Bl.ResponseHeader=2]="ResponseHeader",Bl[Bl.DownloadProgress=3]="DownloadProgress",Bl[Bl.Response=4]="Response",Bl[Bl.User=5]="User",Bl),Zl=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK";_classCallCheck(this,e),this.headers=t.headers||new Ol,this.status=void 0!==t.status?t.status:r,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300},Gl=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).type=Bl.ResponseHeader,e}return _createClass(r,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new r({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}]),r}(Zl),Hl=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,r),(e=t.call(this,n)).type=Bl.Response,e.body=void 0!==n.body?n.body:null,e}return _createClass(r,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new r({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}]),r}(Zl),Wl=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this,e,0,"Unknown Error")).name="HttpErrorResponse",n.ok=!1,n.message=n.status>=200&&n.status<300?"Http failure during parsing for ".concat(e.url||"(unknown url)"):"Http failure response for ".concat(e.url||"(unknown url)",": ").concat(e.status," ").concat(e.statusText),n.error=e.error||null,n}return r}(Zl);function Fl(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}var ql=function(){var e=function(){function e(t){_classCallCheck(this,e),this.handler=t}return _createClass(e,[{key:"request",value:function(e,t){var r,n,o,i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e instanceof xl?r=e:(n=s.headers instanceof Ol?s.headers:new Ol(s.headers),s.params&&(o=s.params instanceof Nl?s.params:new Nl({fromObject:s.params})),r=new xl(e,t,void 0!==s.body?s.body:null,{headers:n,context:s.context,params:o,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials}));var a=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[t.length-1];return I(n)?(t.pop(),D(t,n)):W(t)}(r).pipe(Z(function(e){return i.handler.handle(e)},void 0,1));if(e instanceof xl||"events"===s.observe)return a;var u,l=a.pipe((u=function(e){return e instanceof Hl},function(e){return e.lift(new Rl(u,void 0))}));switch(s.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return l.pipe(k(function(e){if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return l.pipe(k(function(e){if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return l.pipe(k(function(e){if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return l.pipe(k(function(e){return e.body}))}case"response":return l;default:throw new Error("Unreachable: unhandled observe type ".concat(s.observe,"}"))}}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",e,t)}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",e,t)}},{key:"head",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("HEAD",e,t)}},{key:"jsonp",value:function(e,t){return this.request("JSONP",e,{params:(new Nl).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}},{key:"options",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("OPTIONS",e,t)}},{key:"patch",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PATCH",e,Fl(r,t))}},{key:"post",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",e,Fl(r,t))}},{key:"put",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",e,Fl(r,t))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(Il))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),Vl=function(){function e(t,r){_classCallCheck(this,e),this.next=t,this.interceptor=r}return _createClass(e,[{key:"handle",value:function(e){return this.interceptor.intercept(e,this.next)}}]),e}(),jl=new kr("HTTP_INTERCEPTORS"),zl=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"intercept",value:function(e,t){return t.handle(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),Yl=/^\)\]\}',?\n/,Ql=function(){var e=function(){function e(t){_classCallCheck(this,e),this.xhrFactory=t}return _createClass(e,[{key:"handle",value:function(e){var t=this;if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new E(function(r){var n=t.xhrFactory.build();if(n.open(e.method,e.urlWithParams),e.withCredentials&&(n.withCredentials=!0),e.headers.forEach(function(e,t){return n.setRequestHeader(e,t.join(","))}),e.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){var o=e.detectContentTypeHeader();null!==o&&n.setRequestHeader("Content-Type",o)}if(e.responseType){var i=e.responseType.toLowerCase();n.responseType="json"!==i?i:"text"}var s=e.serializeBody(),a=null,u=function(){if(null!==a)return a;var t=1223===n.status?204:n.status,r=n.statusText||"OK",o=new Ol(n.getAllResponseHeaders()),i=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(n)||e.url;return a=new Gl({headers:o,status:t,statusText:r,url:i})},l=function(){var t=u(),o=t.headers,i=t.status,s=t.statusText,a=t.url,l=null;204!==i&&(l=void 0===n.response?n.responseText:n.response),0===i&&(i=l?200:0);var c=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof l){var d=l;l=l.replace(Yl,"");try{l=""!==l?JSON.parse(l):null}catch(h){l=d,c&&(c=!1,l={error:h,text:l})}}c?(r.next(new Hl({body:l,headers:o,status:i,statusText:s,url:a||void 0})),r.complete()):r.error(new Wl({error:l,headers:o,status:i,statusText:s,url:a||void 0}))},c=function(e){var t=u().url,o=new Wl({error:e,status:n.status||0,statusText:n.statusText||"Unknown Error",url:t||void 0});r.error(o)},d=!1,h=function(t){d||(r.next(u()),d=!0);var o={type:Bl.DownloadProgress,loaded:t.loaded};t.lengthComputable&&(o.total=t.total),"text"===e.responseType&&n.responseText&&(o.partialText=n.responseText),r.next(o)},p=function(e){var t={type:Bl.UploadProgress,loaded:e.loaded};e.lengthComputable&&(t.total=e.total),r.next(t)};return n.addEventListener("load",l),n.addEventListener("error",c),n.addEventListener("timeout",c),n.addEventListener("abort",c),e.reportProgress&&(n.addEventListener("progress",h),null!==s&&n.upload&&n.upload.addEventListener("progress",p)),n.send(s),r.next({type:Bl.Sent}),function(){n.removeEventListener("error",c),n.removeEventListener("abort",c),n.removeEventListener("load",l),n.removeEventListener("timeout",c),e.reportProgress&&(n.removeEventListener("progress",h),null!==s&&n.upload&&n.upload.removeEventListener("progress",p)),n.readyState!==n.DONE&&n.abort()}})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr($a))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),Xl=new kr("XSRF_COOKIE_NAME"),Kl=new kr("XSRF_HEADER_NAME"),Jl=function e(){_classCallCheck(this,e)},$l=function(){var e=function(){function e(t,r,n){_classCallCheck(this,e),this.doc=t,this.platform=r,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}return _createClass(e,[{key:"getToken",value:function(){if("server"===this.platform)return null;var e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=qa(e,this.cookieName),this.lastCookieString=e),this.lastToken}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(Ga),Gr($s),Gr(Xl))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),ec=function(){var e=function(){function e(t,r){_classCallCheck(this,e),this.tokenService=t,this.headerName=r}return _createClass(e,[{key:"intercept",value:function(e,t){var r=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||r.startsWith("http://")||r.startsWith("https://"))return t.handle(e);var n=this.tokenService.getToken();return null===n||e.headers.has(this.headerName)||(e=e.clone({headers:e.headers.set(this.headerName,n)})),t.handle(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(Jl),Gr(Kl))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),tc=function(){var e=function(){function e(t,r){_classCallCheck(this,e),this.backend=t,this.injector=r,this.chain=null}return _createClass(e,[{key:"handle",value:function(e){if(null===this.chain){var t=this.injector.get(jl,[]);this.chain=t.reduceRight(function(e,t){return new Vl(e,t)},this.backend)}return this.chain.handle(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Gr(kl),Gr(qo))},e.\u0275prov=ue({token:e,factory:e.\u0275fac}),e}(),rc=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"disable",value:function(){return{ngModule:e,providers:[{provide:ec,useClass:zl}]}}},{key:"withOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ngModule:e,providers:[t.cookieName?{provide:Xl,useValue:t.cookieName}:[],t.headerName?{provide:Kl,useValue:t.headerName}:[]]}}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=le({providers:[ec,{provide:jl,useExisting:ec,multi:!0},{provide:Jl,useClass:$l},{provide:Xl,useValue:"XSRF-TOKEN"},{provide:Kl,useValue:"X-XSRF-TOKEN"}]}),e}(),nc=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Fe({type:e}),e.\u0275inj=le({providers:[ql,{provide:Il,useClass:tc},Ql,{provide:kl,useExisting:Ql}],imports:[[rc.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e}();function oc(e,t,r,n,o,i,s){try{var a=e[i](s),u=a.value}catch(l){return void r(l)}a.done?t(u):Promise.resolve(u).then(n,o)}function ic(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function s(e){oc(i,n,o,s,a,"next",e)}function a(e){oc(i,n,o,s,a,"throw",e)}s(void 0)})}}var sc=r(9576);function ac(e,t){1&e&&(si(0,"div",93),qt(),si(1,"svg",94),ui(2,"circle",95),ai(),ai())}function uc(e,t){1&e&&(si(0,"div",96),qt(),si(1,"svg",94),ui(2,"circle",95),ai(),ai())}function lc(e,t){if(1&e&&(si(0,"span",97),Mi(1),ai()),2&e){var r=gi();xn(1),wi(r.publishInfoStreamID)}}function cc(e,t){if(1&e&&ui(0,"video",98),2&e){var r=gi();Ci("onlyPreview"==r.mirrorVal||"both"==r.mirrorVal?"mirror":""),oi("srcObject",r.localStream)}}function dc(e,t){if(1&e&&(si(0,"span",99),Mi(1),ai()),2&e){var r=gi();xn(1),wi(r.playInfoStreamID)}}function hc(e,t){if(1&e&&ui(0,"video",100),2&e){var r=gi();Ci("onlyPlay"==r.mirrorVal||"both"==r.mirrorVal?"mirror":""),oi("srcObject",r.remoteStream)}}function pc(e,t){1&e&&(si(0,"div",101),qt(),si(1,"svg",102),ui(2,"circle",95),ui(3,"path",103),ai(),ai())}function fc(e,t){1&e&&(si(0,"div",104),qt(),si(1,"svg",102),ui(2,"circle",95),ui(3,"path",103),ai(),ai())}function gc(e,t){1&e&&(si(0,"div",105),qt(),si(1,"svg",102),ui(2,"circle",95),ui(3,"path",106),ai(),ai())}function _c(e,t){1&e&&(si(0,"div",107),qt(),si(1,"svg",102),ui(2,"circle",95),ui(3,"path",103),ai(),ai())}function mc(e,t){1&e&&(si(0,"div",108),qt(),si(1,"svg",102),ui(2,"circle",95),ui(3,"path",103),ai(),ai())}function vc(e,t){if(1&e&&(si(0,"option",111),Mi(1),ai()),2&e){var r=t.$implicit;oi("value",r.deviceID),xn(1),wi(r.deviceName)}}function Ec(e,t){if(1&e){var r=li();si(0,"select",109),hi("ngModelChange",function(e){return Ct(r),gi().cameraDevicesVal=e}),ri(1,vc,2,2,"option",110),ai()}if(2&e){var n=gi();oi("ngModel",n.cameraDevicesVal)("disabled",n.publishStreamStatus),xn(1),oi("ngForOf",n.videoDeviceList)}}function Tc(e,t){if(1&e&&(si(0,"option",111),Mi(1),ai()),2&e){var r=t.$implicit;oi("value",r.deviceID),xn(1),wi(r.deviceName)}}function yc(e,t){if(1&e){var r=li();si(0,"select",112),hi("change",function(){return Ct(r),gi().changeAudioDevices()})("ngModelChange",function(e){return Ct(r),gi().microphoneDevicesVal=e}),ri(1,Tc,2,2,"option",110),ai()}if(2&e){var n=gi();oi("disabled",!n.microphoneCheckStatus)("ngModel",n.microphoneDevicesVal),xn(1),oi("ngForOf",n.audioDeviceList)}}function Sc(e,t){1&e&&(si(0,"div",113),qt(),si(1,"svg",102),ui(2,"circle",95),ui(3,"path",103),ai(),ai())}var Cc=function(e){return[e,"btn","cuBtn"]},Rc=function(){var e=function(){function e(t){_classCallCheck(this,e),this.http=t,this.appID=0,this.server="",this.tokenUrl="https://wsliveroom-alpha.zego.im:8282/token",this.userID=function(){var e=function(){var e=navigator.userAgent;return navigator,{ios:e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1,android:e.indexOf("Android")>-1||e.indexOf("Adr")>-1}}();for(var t in e)if(e[t])return t;return"web"}()+"_"+(new Date).getTime(),this.roomID="0001",this.token="",this.streamID="0001",this.playStreamID="0001",this.zg=null,this.localStream=null,this.remoteStream=null,this.isLogin=!1,this.videoCodec="H.264"===localStorage.getItem("VideoCodec")?"H264":"VP8",this.createSuccessSvgStatus=!1,this.connectStatus="DISCONNECTED",this.checkSystemRequireStatus="",this.audioDeviceList=[],this.videoDeviceList=[],this.microphoneDevicesVal="",this.cameraDevicesVal="",this.cameraCheckStatus=!0,this.microphoneCheckStatus=!0,this.publishStreamStatus=!1,this.mirrorVal="none",this.playStreamStatus=!1,this.videoCheckStatus=!0,this.audioCheckStatus=!1,this.publishInfoStreamID="",this.playInfoStreamID=""}return _createClass(e,[{key:"enumDevices",value:function(){var e=this;return ic(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.zg.enumDevices();case 2:r=t.sent,e.audioDeviceList=r&&r.microphones.map(function(e,t){return e.deviceName||(e.deviceName="microphone"+t),console.log("microphone: "+e.deviceName),e}),e.audioDeviceList.push({deviceID:"0",deviceName:"\u7981\u6b62"}),e.microphoneDevicesVal=e.audioDeviceList[0].deviceID,e.videoDeviceList=r&&r.cameras.map(function(e,t){return e.deviceName||(e.deviceName="camera"+t),console.log("camera: "+e.deviceName),e}),e.videoDeviceList.push({deviceID:"0",deviceName:"\u7981\u6b62"}),e.cameraDevicesVal=e.videoDeviceList[0].deviceID;case 4:case"end":return t.stop()}},t)}))()}},{key:"initEvent",value:function(){var e=this;this.zg.on("roomStateUpdate",function(t,r){"CONNECTED"===r&&e.isLogin&&(e.connectStatus="CONNECTED"),"DISCONNECTED"!==r||e.isLogin||(e.connectStatus="DISCONNECTED"),"DISCONNECTED"===r&&e.isLogin&&location.reload()}),this.zg.on("publisherStateUpdate",function(t){"PUBLISHING"===t.state?e.publishInfoStreamID=t.streamID:"NO_PUBLISH"===t.state&&(e.publishInfoStreamID="")}),this.zg.on("playerStateUpdate",function(t){"PLAYING"===t.state?e.playInfoStreamID=t.streamID:"NO_PLAY"===t.state&&(e.playInfoStreamID="")})}},{key:"getAppInfo",value:function(){var e={};try{var t=localStorage.getItem("app_info");e=JSON.parse(t)||e}catch(r){localStorage.removeItem("app_info")}e.appID&&e.server||alert("Need to set appID and server url!"),this.appID=e.appID,this.server=e.server}},{key:"createZegoExpressEngine",value:function(){this.getAppInfo(),this.zg=new sc.ZegoExpressEngine(this.appID,this.server)}},{key:"checkSystemRequirements",value:function(){var e=this;return ic(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("sdk version is",e.zg.getVersion()),t.prev=1,t.next=4,e.zg.checkSystemRequirements();case 4:return r=t.sent,t.abrupt("return",(console.warn("checkSystemRequirements ",r),r.webRTC?r.videoCodec.H264||r.videoCodec.VP8?r.camera||r.microphones?(r.videoCodec.VP8?r.screenSharing||console.warn("browser is not support screenSharing"):console.log("\u4e0d\u652f\u6301VP8\uff0c\u8bf7\u524d\u5f80\u6df7\u6d41\u8f6c\u7801\u6d4b\u8bd5"),!0):(console.error("camera and microphones not allowed to use"),!1):(console.error("browser is not support H264 and VP8"),!1):(console.error("browser is not support webrtc!!"),!1)));case 8:return t.prev=8,t.t0=t.catch(1),t.abrupt("return",(console.error("checkSystemRequirements",t.t0),!1));case 11:case"end":return t.stop()}},t,null,[[1,8]])}))()}},{key:"loginRoom",value:function(e,t,r,n){var o=this;return ic(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",o.zg.loginRoom(e,n,{userID:t,userName:r}));case 1:case"end":return i.stop()}},i)}))()}},{key:"startPublishingStream",value:function(e,t){var r=this;return ic(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.zg.createStream(t);case 3:return r.localStream=n.sent,r.zg.startPublishingStream(e,r.localStream,{videoCodec:r.videoCodec}),n.abrupt("return",!0);case 8:return n.prev=8,n.t0=n.catch(0),n.abrupt("return",!1);case 11:case"end":return n.stop()}},n,null,[[0,8]])}))()}},{key:"startPlayingStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this;return ic(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.zg.startPlayingStream(e,t);case 3:return r.remoteStream=n.sent,n.abrupt("return",!0);case 7:return n.prev=7,n.t0=n.catch(0),n.abrupt("return",!1);case 10:case"end":return n.stop()}},n,null,[[0,7]])}))()}},{key:"logoutRoom",value:function(e){this.zg.logoutRoom(e)}},{key:"stopPublishingStream",value:function(e){var t=this;return ic(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t.zg.stopPublishingStream(e);case 1:case"end":return r.stop()}},r)}))()}},{key:"stopPlayingStream",value:function(e){var t=this;return ic(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t.zg.stopPlayingStream(e);case 1:case"end":return r.stop()}},r)}))()}},{key:"clearStream",value:function(){this.localStream&&this.zg.destroyStream(this.localStream),this.localStream=null,this.remoteStream&&this.zg.destroyStream(this.remoteStream),this.remoteStream=null}},{key:"changeAudioDevices",value:function(){if(this.zg&&this.localStream){var e=this.zg.isMicrophoneMuted();isNaN(this.microphoneDevicesVal)||e?(this.zg.muteMicrophone(!1),this.zg.useAudioDevice(this.localStream,this.microphoneDevicesVal)):this.zg.muteMicrophone(!0)}}},{key:"createZegoExpressEngineOption",value:function(){this.createZegoExpressEngine(),this.createSuccessSvgStatus=!0,this.initEvent()}},{key:"checkSystemRequire",value:function(){var e=this;return ic(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.zg){t.next=2;break}return t.abrupt("return",alert("you should create zegoExpressEngine"));case 2:return t.next=4,e.checkSystemRequirements();case 4:if(!t.sent){t.next=8;break}e.checkSystemRequireStatus="SUCCESS",e.enumDevices(),t.next=9;break;case 8:e.checkSystemRequireStatus="ERROR";case 9:case"end":return t.stop()}},t)}))()}},{key:"loginRoomOption",value:function(){var e=this;return ic(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.zg){t.next=2;break}return t.abrupt("return",alert("you should create zegoExpressEngine"));case 2:return t.prev=2,e.isLogin=!0,t.next=6,e.loginRoom(e.roomID,e.userID,e.userID,e.token);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),e.isLogin=!1,console.log(t.t0);case 11:case"end":return t.stop()}},t,null,[[2,8]])}))()}},{key:"startPublishing",value:function(){var e=this;return ic(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.startPublishingStream(e.streamID,{camera:{audioInput:e.microphoneDevicesVal,videoInput:e.cameraDevicesVal,video:e.cameraCheckStatus,audio:e.microphoneCheckStatus}});case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}e.publishStreamStatus=!0;case 5:case"end":return t.stop()}},t)}))()}},{key:"startPlaying",value:function(){var e=this;return ic(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.startPlayingStream(e.playStreamID,{video:e.videoCheckStatus,audio:e.audioCheckStatus});case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}e.playStreamStatus=!0;case 5:case"end":return t.stop()}},t)}))()}},{key:"reset",value:function(){var e=this;return ic(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.zg,!t.t0){t.next=14;break}return t.next=4,e.stopPublishingStream(e.streamID);case 4:return t.next=6,e.stopPlayingStream(e.playStreamID);case 6:e.isLogin&&(e.isLogin=!1,e.logoutRoom(e.roomID)),e.clearStream(),e.zg=null,e.playStreamStatus=!1,e.publishStreamStatus=!1,e.createSuccessSvgStatus=!1,e.checkSystemRequireStatus="",e.audioCheckStatus=!1;case 14:case"end":return t.stop()}},t)}))()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(ni(ql))},e.\u0275cmp=Ze({type:e,selectors:[["app-root"]],decls:171,vars:37,consts:[[1,"preloader"],["viewBox","25 25 50 50",1,"circular"],["cx","50","cy","50","r","20","fill","none","stroke-width","2","stroke-miterlimit","10",1,"path"],[1,"container","main-wrapper"],[1,"page-wrapper"],[1,"container-fluid"],[1,"row"],[1,"col-12","col-lg-6","preview-wrapper"],[1,"preview-roomInfo"],["id","roomInfo-id",1,"m-r-10"],["id","roomInfo-state"],["class","success-svg","id","roomStateSuccessSvg","style","display: inline-block;",4,"ngIf"],["class","error-svg","id","roomStateErrorSvg","style","display: inline-block;",4,"ngIf"],[1,"preview-pushlishInfo","col-lg-12","col-6"],[1,"pushlishInfo-title"],["data-lang","Preview"],["id","pushlishInfo-id",4,"ngIf"],[1,"preview-content"],["controls","","id","publishVideo","autoplay","","playsinline","","muted","",3,"srcObject","class",4,"ngIf"],[1,"preview-playInfo","m-t-10","col-lg-12","col-6"],["data-lang","PlayStream"],["id","playInfo-id",4,"ngIf"],["controls","","id","playVideo","autoplay","","playsinline","",3,"srcObject","class",4,"ngIf"],[1,"col-12","col-lg-6","action-wrapper"],[1,"action-step"],[1,"action-title"],[1,"action-info"],[1,"btn-wrapper"],["id","CreateZegoExpressEngine","type","button","title","new ZegoExpressEngine()",1,"btn-outline-info","btn","cuBtn",3,"click"],["class","success-svg","id","createSuccessSvg","style","display: inline-block;",4,"ngIf"],["id","CheckSystemRequire","type","button","title","checkSystemRequirements()",3,"click"],["class","success-svg","id","checkSuccessSvg","style","display: inline-block;",4,"ngIf"],["class","error-svg","id","checkErrorSvg","style","display: inline-block;",4,"ngIf"],["id","checkWarnSvg",1,"warn-svg",2,"display","none"],["t","1617876217862","viewBox","0 0 1024 1024","version","1.1","xmlns","http://www.w3.org/2000/svg","p-id","8340","width","15","height","15",1,"icon"],["fill","#5bb543","cx","512","cy","512","r","510",1,"circle"],["fill","none","stroke","#FFF","stroke-width","6","stroke-linecap","round","d","M512 736.1m-63 0a63 63 0 1 0 126 0 63 63 0 1 0-126 0Z","fill","#FFFFFF","p-id","8344",1,"tick"],["fill","none","stroke","#FFF","stroke-width","6","stroke-linecap","round","stroke-miterlimit","10","d","M512 611.8s63-220.5 63-306.3S549.5 204 512 204s-63 15.8-63 101.5 63 306.3 63 306.3z",1,"tick"],[1,"action-content"],[1,"action-room","font-14"],[1,"action-roomId"],[1,"icon-question"],["data-lang","RoomIDDesc",1,"pop-box"],["type","text","id","RoomID",3,"ngModel","disabled","ngModelChange"],[1,"action-userName"],[1,"pop-box"],["data-lang","UserIDDesc"],["type","text","id","UserName",3,"ngModel","disabled","ngModelChange"],[1,"action-token"],["data-lang","TokenDesc"],["href","https://console.zego.im","data-lang","ApplyToken","target","_blank"],["type","text","id","Token",3,"ngModel","ngModelChange"],["id","LoginRoom","title","loginRoom()",1,"play-pause-button",3,"click"],["class","success-svg m-r-5","id","loginSuccessSvg","style","display: inline-block;",4,"ngIf"],[1,"publish-setting","m-t-10"],[1,"action-input","font-14","m-b-15"],["type","text","id","PublishID",3,"ngModel","disabled","ngModelChange"],[1,"font-12","publish-check","m-b-15"],[1,"check-wrappre","m-r-5"],["for","Camera","data-lang","Camera",1,"form-check-label","m-r-5"],["type","checkbox","id","Camera",1,"check-input",3,"ngModel","disabled","ngModelChange"],[1,"check-wrappre"],["for","Microphone","data-lang","Microphone",1,"form-check-label","m-r-5"],["type","checkbox","id","Microphone",1,"check-input",3,"ngModel","disabled","ngModelChange"],["id","startPublishing","title","createStream() / startPublishingStream()",1,"play-pause-button",3,"click"],["class","success-svg m-r-5","id","publishSuccessSvg","style","display: inline-block;",4,"ngIf"],[1,"publish-setting","m-t-10","m-b-10"],[1,"font-12","select-wrapper"],["data-lang","Mirror"],["id","Mirror",1,"form-control","form-control-sm","m-l-5",3,"ngModel","disabled","ngModelChange"],["value","none"],["value","onlyPreview"],["value","onlyPlay"],["value","both"],[1,"font-12","select-wrapper","f-b-7"],["data-lang","CameraSwitch"],["class","form-control form-control-sm m-l-5","id","CameraDevices",3,"ngModel","disabled","ngModelChange",4,"ngIf"],["data-lang","MicrophoneSwitch"],["class","form-control form-control-sm m-l-5","id","MicrophoneDevices",3,"disabled","ngModel","change","ngModelChange",4,"ngIf"],[1,"publish-setting","m-t-5"],["type","text","id","PlayID",3,"ngModel","disabled","ngModelChange"],["for","Video","data-lang","Video",1,"form-check-label","m-r-5"],["type","checkbox","id","Video",1,"check-input",3,"ngModel","disabled","ngModelChange"],["for","Audio","data-lang","Audio",1,"form-check-label","m-r-5"],["type","checkbox","id","Audio",1,"check-input",3,"ngModel","disabled","ngModelChange"],["id","startPlaying","title","startPlayingStream()",1,"play-pause-button",3,"click"],["class","success-svg m-r-5","id","playSuccessSvg","style","display: inline-block;",4,"ngIf"],["id","reset","type","button",1,"btn-danger","btn","cuBtn",3,"click"],[1,"goToDoc"],["data-lang","HelpDocsVideoCodec"],["href","../../DebugAndConfig/LogAndVersionAndDebug/index.html","data-lang","HelpSettingsPage","target","_blank"],["data-lang","MoreDocs"],["href","https://doc-zh.zego.im/article/7638","data-lang","HelpDocs","target","_blank"],["id","roomStateSuccessSvg",1,"success-svg",2,"display","inline-block"],["xmlns","http://www.w3.org/2000/svg","height","10","width","10","viewBox","0 0 48 48","aria-hidden","true",1,"ft-green-tick"],["fill","#5bb543","cx","24","cy","24","r","22",1,"circle"],["id","roomStateErrorSvg",1,"error-svg",2,"display","inline-block"],["id","pushlishInfo-id"],["controls","","id","publishVideo","autoplay","","playsinline","","muted","",3,"srcObject"],["id","playInfo-id"],["controls","","id","playVideo","autoplay","","playsinline","",3,"srcObject"],["id","createSuccessSvg",1,"success-svg",2,"display","inline-block"],["xmlns","http://www.w3.org/2000/svg","height","15","width","15","viewBox","0 0 48 48","aria-hidden","true",1,"ft-green-tick"],["fill","none","stroke","#FFF","stroke-width","6","stroke-linecap","round","stroke-linejoin","round","stroke-miterlimit","10","d","M14 27l5.917 4.917L34 17",1,"tick"],["id","checkSuccessSvg",1,"success-svg",2,"display","inline-block"],["id","checkErrorSvg",1,"error-svg",2,"display","inline-block"],["fill","none","stroke","#FFF","stroke-width","6","stroke-linecap","round","stroke-linejoin","round","stroke-miterlimit","10","d","M14 14 34 34 M34 14 14 34",1,"tick"],["id","loginSuccessSvg",1,"success-svg","m-r-5",2,"display","inline-block"],["id","publishSuccessSvg",1,"success-svg","m-r-5",2,"display","inline-block"],["id","CameraDevices",1,"form-control","form-control-sm","m-l-5",3,"ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["id","MicrophoneDevices",1,"form-control","form-control-sm","m-l-5",3,"disabled","ngModel","change","ngModelChange"],["id","playSuccessSvg",1,"success-svg","m-r-5",2,"display","inline-block"]],template:function(e,t){var r,n,o,i;1&e&&(si(0,"div",0),qt(),si(1,"svg",1),ui(2,"circle",2),ai(),ai(),Vt(),si(3,"div",3),si(4,"div",4),si(5,"div",5),si(6,"div",6),si(7,"div",7),si(8,"div",8),Mi(9," RoomID:\xa0"),ui(10,"div",9),Mi(11," RoomState:\xa0"),si(12,"div",10),ri(13,ac,3,0,"div",11),ri(14,uc,3,0,"div",12),ai(),ai(),si(15,"div",6),si(16,"div",13),si(17,"div",14),si(18,"span",15),Mi(19,"Preview"),ai(),Mi(20,"\u2003Publish StreamID: "),ri(21,lc,2,1,"span",16),ai(),si(22,"div",17),ri(23,cc,1,3,"video",18),ai(),ai(),si(24,"div",19),si(25,"div",14),si(26,"span",20),Mi(27,"Play Stream"),ai(),Mi(28,"\u2003StreamID: "),ri(29,dc,2,1,"span",21),ai(),si(30,"div",17),ri(31,hc,1,3,"video",22),ai(),ai(),ai(),ai(),si(32,"div",23),si(33,"div",24),si(34,"div",25),Mi(35," Step1\u2003"),si(36,"span",26),Mi(37,"Create ZegoExpressEngine"),ai(),ai(),si(38,"div",27),si(39,"button",28),hi("click",function(){return t.createZegoExpressEngineOption()}),ri(40,pc,4,0,"div",29),Mi(41," Create Engine "),ai(),ai(),ai(),si(42,"div",24),si(43,"div",25),Mi(44," Step2\u2003"),si(45,"span",26),Mi(46,"Test Compatiblity"),ai(),ai(),si(47,"div",27),si(48,"button",30),hi("click",function(){return t.checkSystemRequire()}),ri(49,fc,4,0,"div",31),ri(50,gc,4,0,"div",32),si(51,"div",33),qt(),si(52,"svg",34),ui(53,"circle",35),ui(54,"path",36),ui(55,"path",37),ai(),ai(),Mi(56," Test Compatiblity "),ai(),ai(),ai(),Vt(),si(57,"div",24),si(58,"div",25),Mi(59," Step3\u2003"),si(60,"span",26),Mi(61,"Login Room"),ai(),ai(),si(62,"div",38),si(63,"div",39),si(64,"div",40),Mi(65," RoomID "),si(66,"div",41),Mi(67,"? "),si(68,"div",42),Mi(69,"Tooltip text"),ai(),ai(),si(70,"input",43),hi("ngModelChange",function(e){return t.roomID=e}),ai(),ai(),si(71,"div",44),Mi(72," UserID "),si(73,"div",41),Mi(74,"? "),si(75,"div",45),ui(76,"span",46),ai(),ai(),si(77,"input",47),hi("ngModelChange",function(e){return t.userID=e}),ai(),ai(),si(78,"div",48),Mi(79," Token "),si(80,"div",41),Mi(81,"? "),si(82,"div",45),ui(83,"span",49),ui(84,"a",50),ai(),ai(),si(85,"input",51),hi("ngModelChange",function(e){return t.token=e}),ai(),ai(),ai(),si(86,"button",52),hi("click",function(){return t.loginRoomOption()}),ri(87,_c,4,0,"div",53),Mi(88," Login Room "),ai(),ai(),ai(),si(89,"div",24),si(90,"div",25),Mi(91," Step4\u2003"),si(92,"span",26),Mi(93,"Start Publishing Stream"),ai(),si(94,"div",38),si(95,"div",54),si(96,"div",55),Mi(97," Publish StreamID "),si(98,"input",56),hi("ngModelChange",function(e){return t.streamID=e}),ai(),ai(),si(99,"div",57),si(100,"div",58),si(101,"label",59),Mi(102,"Camera"),ai(),si(103,"input",60),hi("ngModelChange",function(e){return t.cameraCheckStatus=e}),ai(),ai(),si(104,"div",61),si(105,"label",62),Mi(106,"Microphone"),ai(),si(107,"input",63),hi("ngModelChange",function(e){return t.microphoneCheckStatus=e}),ai(),ai(),ai(),ai(),si(108,"button",64),hi("click",function(){return t.startPublishing()}),ri(109,mc,4,0,"div",65),Mi(110,"Start Publishing "),ai(),si(111,"div",66),si(112,"div",67),si(113,"span",68),Mi(114,"Mirror"),ai(),si(115,"select",69),hi("ngModelChange",function(e){return t.mirrorVal=e}),si(116,"option",70),Mi(117,"none"),ai(),si(118,"option",71),Mi(119,"onlyPreview"),ai(),si(120,"option",72),Mi(121,"onlyPlay"),ai(),si(122,"option",73),Mi(123,"both"),ai(),ai(),ai(),si(124,"div",74),si(125,"span",75),Mi(126,"Camera Switch"),ai(),ri(127,Ec,2,3,"select",76),ai(),ai(),si(128,"div",67),si(129,"span",77),Mi(130,"Microphone Switch"),ai(),ri(131,yc,2,3,"select",78),ai(),ai(),ai(),ai(),si(132,"div",24),si(133,"div",25),Mi(134," Step5\u2003"),si(135,"span",26),Mi(136,"Start Play Stream"),ai(),si(137,"div",38),si(138,"div",79),si(139,"div",55),Mi(140," Play StreamID "),si(141,"input",80),hi("ngModelChange",function(e){return t.playStreamID=e}),ai(),ai(),si(142,"div",57),si(143,"div",58),si(144,"label",81),Mi(145,"Video"),ai(),si(146,"input",82),hi("ngModelChange",function(e){return t.videoCheckStatus=e}),ai(),ai(),si(147,"div",61),si(148,"label",83),Mi(149,"Audio"),ai(),si(150,"input",84),hi("ngModelChange",function(e){return t.audioCheckStatus=e}),ai(),ai(),ai(),ai(),si(151,"button",85),hi("click",function(){return t.startPlaying()}),ri(152,Sc,4,0,"div",86),Mi(153,"Start Playing "),ai(),ai(),ai(),ai(),si(154,"div",24),si(155,"div",38),si(156,"button",87),hi("click",function(){return t.reset()}),Mi(157,"Reset"),ai(),ai(),ai(),ai(),ai(),ai(),si(158,"ul",88),si(159,"li"),si(160,"span",89),Mi(161," Web \u7aef\u89c6\u9891\u7f16\u7801\u9ed8\u8ba4\u4f7f\u7528 VP8\u3002\u5982\u679c\u9700\u8981\u4f53\u9a8c\u548c\u5176\u4ed6\u7aef\u4e92\u901a\u6216\u8005\u8f6c\u63a8 CDN \u529f\u80fd\uff0c\u8bf7\u5728\u8c03\u8bd5\u4e0e\u914d\u7f6e\u9875\u9762\u4fee\u6539\u4e3a H.264\u3002"),ai(),Mi(162," \xa0 "),si(163,"a",90),Mi(164," \u70b9\u51fb\u4fee\u6539 "),ai(),ai(),si(165,"li"),si(166,"span",91),Mi(167,"\u66f4\u591a\u6587\u6863\uff0c\u8bf7\u8df3\u8f6c\u81f3\u5373\u6784 "),ai(),Mi(168," \xa0 "),si(169,"a",92),Mi(170," \u5e2e\u52a9\u6587\u6863 "),ai(),ai(),ai(),ai(),ai()),2&e&&(xn(13),oi("ngIf","CONNECTED"==t.connectStatus),xn(1),oi("ngIf","DISCONNECTED"==t.connectStatus),xn(7),oi("ngIf",t.publishInfoStreamID),xn(2),oi("ngIf",t.localStream),xn(6),oi("ngIf",t.playInfoStreamID),xn(2),oi("ngIf",t.remoteStream),xn(9),oi("ngIf",t.createSuccessSvgStatus),xn(8),Ci((35,r=Cc,n="ERROR"==t.checkSystemRequireStatus?"btn-outline-danger":"btn-outline-info",function(e,t,r,n,o,i){var s=t+35;return ti(e,s,o)?function(e,t,r){return e[t]=r}(e,s+1,n(o)):function(e,t){var r=e[t];return r===Un?void 0:r}(e,s+1)}(yt(),(o=Et.lFrame,-1===(i=o.bindingRootIndex)&&(i=o.bindingRootIndex=o.tView.bindingStartIndex),i),0,r,n))),xn(1),oi("ngIf","SUCCESS"==t.checkSystemRequireStatus),xn(1),oi("ngIf","ERROR"==t.checkSystemRequireStatus),xn(20),oi("ngModel",t.roomID)("disabled",t.isLogin),xn(7),oi("ngModel",t.userID)("disabled",t.isLogin),xn(8),oi("ngModel",t.token),xn(2),oi("ngIf",t.isLogin),xn(11),oi("ngModel",t.streamID)("disabled",t.publishStreamStatus),xn(5),oi("ngModel",t.cameraCheckStatus)("disabled",t.publishStreamStatus),xn(4),oi("ngModel",t.microphoneCheckStatus)("disabled",t.publishStreamStatus),xn(2),oi("ngIf",t.publishStreamStatus),xn(6),oi("ngModel",t.mirrorVal)("disabled",t.publishStreamStatus),xn(12),oi("ngIf",t.videoDeviceList),xn(4),oi("ngIf",t.audioDeviceList),xn(10),oi("ngModel",t.playStreamID)("disabled",t.playStreamStatus),xn(5),oi("ngModel",t.videoCheckStatus)("disabled",t.playStreamStatus),xn(4),oi("ngModel",t.audioCheckStatus)("disabled",t.playStreamStatus),xn(2),oi("ngIf",t.playStreamStatus))},directives:[Ya,xu,Ku,hl,wu,_l,ml,yl,ja],styles:[".pushlishInfo-title[_ngcontent-%COMP%]{font-weight:500}.preview-content[_ngcontent-%COMP%]{width:auto;height:200px;border:1px solid #ccc}.preview-content[_ngcontent-%COMP%] > video[_ngcontent-%COMP%]{width:100%;height:100%}.preview-roomInfo[_ngcontent-%COMP%]{font-weight:500}#roomInfo-id[_ngcontent-%COMP%], #roomInfo-state[_ngcontent-%COMP%]{display:inline-block;font-weight:400}.logger-wrapper[_ngcontent-%COMP%]{margin-top:20px;width:100%;height:250px;background-color:#ccc;color:#fcfafa;overflow:scroll}.btn-wrapper[_ngcontent-%COMP%]{display:flex;width:100%;background-color:#fcfafa;border-radius:10px;height:30px;justify-content:center;align-items:center}.action-step[_ngcontent-%COMP%]{margin:10px 0}.action-content[_ngcontent-%COMP%]{width:100%;background-color:#fcfafa;border-radius:10px;padding:10px}.action-title[_ngcontent-%COMP%]{font-weight:700px;color:#000}.action-info[_ngcontent-%COMP%]{font-size:14px}.cuBtn[_ngcontent-%COMP%]{display:block;padding:0 12px;font-size:13px;cursor:pointer;height:30px;width:95%}.action-room[_ngcontent-%COMP%]{padding-bottom:15px}.action-room[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] + div[_ngcontent-%COMP%]{margin-top:4px}.icon-question[_ngcontent-%COMP%]{display:inline-block;text-align:center;line-height:16px;width:16px;height:16px;border-radius:50%;background-color:#0575ff;color:#fff;cursor:pointer;font-weight:700}.icon-question[_ngcontent-%COMP%]   .pop-box[_ngcontent-%COMP%]{visibility:hidden;width:120px;background-color:#fff;box-shadow:0 0 10px #dfdfdf;color:#000;text-align:center;border-radius:6px;padding:4px;position:absolute;z-index:1;font-weight:100;font-size:12px}.icon-question[_ngcontent-%COMP%]:hover   .pop-box[_ngcontent-%COMP%]{visibility:visible}.f-b-3[_ngcontent-%COMP%]{flex-basis:30%}.f-b-7[_ngcontent-%COMP%]{flex-basis:70%!important}input[_ngcontent-%COMP%]{width:40%;height:21px;border:1px solid #ced4da;border-radius:.25rem;color:#495057}.w-70[_ngcontent-%COMP%]{width:70%}.publish-setting[_ngcontent-%COMP%]{display:flex;align-items:center}.publish-check[_ngcontent-%COMP%]{flex-basis:50%;display:flex;justify-content:space-around}.check-wrappre[_ngcontent-%COMP%]{text-align:center;display:flex;align-items:center}.check-input[_ngcontent-%COMP%]{display:inline-block;width:auto!important;height:auto!important}select[_ngcontent-%COMP%]{width:45%!important;height:21px!important;padding:0!important;font-size:12px!important}.select-wrapper[_ngcontent-%COMP%]{flex-basis:30%;display:flex;align-items:center;white-space:nowrap}option[_ngcontent-%COMP%]{height:21px!important;font-size:14px}.mirror[_ngcontent-%COMP%]{transform:scaleX(-1)}@media (max-width: 375px){.preview-playInfo[_ngcontent-%COMP%]{margin-top:0!important}}"]}),e}(),bc=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Fe({type:e,bootstrap:[Rc]}),e.\u0275inj=le({providers:[],imports:[[Ou,Cl,nc]]}),e}();(function(){if(Ia)throw new Error("Cannot enable prod mode after platform setup.");ba=!1})(),Iu().bootstrapModule(bc).catch(function(e){return console.error(e)})}},function(e){"use strict";e(e.s=8305)}])})();